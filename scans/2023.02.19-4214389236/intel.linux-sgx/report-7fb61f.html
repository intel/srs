<!doctype html>
<html>
<head>
<title>/work/repo/external/CppMicroServices/third_party/miniz.c</title>

<style type="text/css">
body { color:#000000; background-color:#ffffff }
body { font-family:Helvetica, sans-serif; font-size:10pt }
h1 { font-size:14pt }
.FileName { margin-top: 5px; margin-bottom: 5px; display: inline; }
.FileNav { margin-left: 5px; margin-right: 5px; display: inline; }
.FileNav a { text-decoration:none; font-size: larger; }
.divider { margin-top: 30px; margin-bottom: 30px; height: 15px; }
.divider { background-color: gray; }
.code { border-collapse:collapse; width:100%; }
.code { font-family: "Monospace", monospace; font-size:10pt }
.code { line-height: 1.2em }
.comment { color: green; font-style: oblique }
.keyword { color: blue }
.string_literal { color: red }
.directive { color: darkmagenta }

/* Macros and variables could have pop-up notes hidden by default.
  - Macro pop-up:    expansion of the macro
  - Variable pop-up: value (table) of the variable */
.macro_popup, .variable_popup { display: none; }

/* Pop-up appears on mouse-hover event. */
.macro:hover .macro_popup, .variable:hover .variable_popup {
  display: block;
  padding: 2px;
  -webkit-border-radius:5px;
  -webkit-box-shadow:1px 1px 7px #000;
  border-radius:5px;
  box-shadow:1px 1px 7px #000;
  position: absolute;
  top: -1em;
  left:10em;
  z-index: 1
}

.macro_popup {
  border: 2px solid red;
  background-color:#FFF0F0;
  font-weight: normal;
}

.variable_popup {
  border: 2px solid blue;
  background-color:#F0F0FF;
  font-weight: bold;
  font-family: Helvetica, sans-serif;
  font-size: 9pt;
}

/* Pop-up notes needs a relative position as a base where they pops up. */
.macro, .variable {
  background-color: PaleGoldenRod;
  position: relative;
}
.macro { color: DarkMagenta; }

#tooltiphint {
  position: fixed;
  width: 50em;
  margin-left: -25em;
  left: 50%;
  padding: 10px;
  border: 1px solid #b0b0b0;
  border-radius: 2px;
  box-shadow: 1px 1px 7px black;
  background-color: #c0c0c0;
  z-index: 2;
}

.num { width:2.5em; padding-right:2ex; background-color:#eeeeee }
.num { text-align:right; font-size:8pt }
.num { color:#444444 }
.line { padding-left: 1ex; border-left: 3px solid #ccc }
.line { white-space: pre }
.msg { -webkit-box-shadow:1px 1px 7px #000 }
.msg { box-shadow:1px 1px 7px #000 }
.msg { -webkit-border-radius:5px }
.msg { border-radius:5px }
.msg { font-family:Helvetica, sans-serif; font-size:8pt }
.msg { float:left }
.msg { position:relative }
.msg { padding:0.25em 1ex 0.25em 1ex }
.msg { margin-top:10px; margin-bottom:10px }
.msg { font-weight:bold }
.msg { max-width:60em; word-wrap: break-word; white-space: pre-wrap }
.msgT { padding:0x; spacing:0x }
.msgEvent { background-color:#fff8b4; color:#000000 }
.msgControl { background-color:#bbbbbb; color:#000000 }
.msgNote { background-color:#ddeeff; color:#000000 }
.mrange { background-color:#dfddf3 }
.mrange { border-bottom:1px solid #6F9DBE }
.PathIndex { font-weight: bold; padding:0px 5px; margin-right:5px; }
.PathIndex { -webkit-border-radius:8px }
.PathIndex { border-radius:8px }
.PathIndexEvent { background-color:#bfba87 }
.PathIndexControl { background-color:#8c8c8c }
.PathIndexPopUp { background-color: #879abc; }
.PathNav a { text-decoration:none; font-size: larger }
.CodeInsertionHint { font-weight: bold; background-color: #10dd10 }
.CodeRemovalHint { background-color:#de1010 }
.CodeRemovalHint { border-bottom:1px solid #6F9DBE }
.msg.selected{ background-color:orange !important; }

table.simpletable {
  padding: 5px;
  font-size:12pt;
  margin:20px;
  border-collapse: collapse; border-spacing: 0px;
}
td.rowname {
  text-align: right;
  vertical-align: top;
  font-weight: bold;
  color:#444444;
  padding-right:2ex;
}

/* Hidden text. */
input.spoilerhider + label {
  cursor: pointer;
  text-decoration: underline;
  display: block;
}
input.spoilerhider {
 display: none;
}
input.spoilerhider ~ .spoiler {
  overflow: hidden;
  margin: 10px auto 0;
  height: 0;
  opacity: 0;
}
input.spoilerhider:checked + label + .spoiler{
  height: auto;
  opacity: 1;
}
</style>
</head>
<body>
<!-- BUGDESC Null pointer passed to 2nd parameter expecting 'nonnull' -->

<!-- BUGTYPE Argument with 'nonnull' attribute passed null -->

<!-- BUGCATEGORY API -->

<!-- BUGFILE /work/repo/external/CppMicroServices/third_party/miniz.c -->

<!-- FILENAME miniz.c -->

<!-- FUNCTIONNAME mz_zip_array_push_back -->

<!-- ISSUEHASHCONTENTOFLINEINCONTEXT 7fb61f4ace8e340e947c3ff7cff7d9a1 -->

<!-- BUGLINE 3063 -->

<!-- BUGCOLUMN 3 -->

<!-- BUGPATHLENGTH 62 -->

<!-- BUGMETAEND -->
<!-- REPORTHEADER -->
<h3>Bug Summary</h3>
<table class="simpletable">
<tr><td class="rowname">File:</td><td>/work/repo/external/CppMicroServices/third_party/miniz.c</td></tr>
<tr><td class="rowname">Warning:</td><td><a href="#EndPath">line 3063, column 3</a><br />Null pointer passed to 2nd parameter expecting 'nonnull'</td></tr>

</table>
<!-- REPORTSUMMARYEXTRA -->
<h3>Annotated Source Code</h3>
<p>Press <a href="#" onclick="toggleHelp(); return false;">'?'</a>
   to see keyboard shortcuts</p>
<input type="checkbox" class="spoilerhider" id="showinvocation" />
<label for="showinvocation" >Show analyzer invocation</label>
<div class="spoiler">clang -cc1 -cc1 -triple x86_64-pc-linux-gnu -analyze -disable-free -clear-ast-before-backend -disable-llvm-verifier -discard-value-names -main-file-name miniz.c -analyzer-checker=core -analyzer-checker=apiModeling -analyzer-checker=unix -analyzer-checker=deadcode -analyzer-checker=security.insecureAPI.UncheckedReturn -analyzer-checker=security.insecureAPI.getpw -analyzer-checker=security.insecureAPI.gets -analyzer-checker=security.insecureAPI.mktemp -analyzer-checker=security.insecureAPI.mkstemp -analyzer-checker=security.insecureAPI.vfork -analyzer-checker=nullability.NullPassedToNonnull -analyzer-checker=nullability.NullReturnedFromNonnull -analyzer-output plist -w -setup-static-analyzer -analyzer-config-compatibility-mode=true -mrelocation-model pic -pic-level 2 -pic-is-pie -mframe-pointer=all -fmath-errno -ffp-contract=on -fno-rounding-math -mconstructor-aliases -funwind-tables=2 -target-cpu x86-64 -tune-cpu generic -debugger-tuning=gdb -fcoverage-compilation-dir=/work/repo/external/CppMicroServices/build/tools/rc -resource-dir /usr/lib/llvm-15/lib/clang/15.0.6 -D MINIZ_NO_ARCHIVE_READING_API -D MINIZ_NO_ZLIB_COMPATIBLE_NAMES -D US_RCC_EXECUTABLE_NAME="usResourceCompiler4" -I /work/repo/external/CppMicroServices/tools/rc/../../third_party -U NDEBUG -internal-isystem /usr/lib/llvm-15/lib/clang/15.0.6/include -internal-isystem /usr/local/include -internal-isystem /usr/bin/../lib/gcc/x86_64-linux-gnu/12/../../../../x86_64-linux-gnu/include -internal-externc-isystem /usr/include/x86_64-linux-gnu -internal-externc-isystem /include -internal-externc-isystem /usr/include -fdebug-compilation-dir=/work/repo/external/CppMicroServices/build/tools/rc -ferror-limit 19 -fgnuc-version=4.2.1 -analyzer-opt-analyze-headers -analyzer-output=html -analyzer-config crosscheck-with-z3=true -analyzer-checker security.FloatLoopCounter,security.insecureAPI.strcpy -analyzer-disable-checker deadcode.DeadStores -faddrsig -D__GCC_HAVE_DWARF2_CFI_ASM=1 -o /work/intel.linux-sgx/scan-build-result/scan-build-2023-02-19-00-27-05-604352-lgxdoyd2 -x c /work/repo/external/CppMicroServices/third_party/miniz.c
</div>
<div id='tooltiphint' hidden="true">
  <p>Keyboard shortcuts: </p>
  <ul>
    <li>Use 'j/k' keys for keyboard navigation</li>
    <li>Use 'Shift+S' to show/hide relevant lines</li>
    <li>Use '?' to toggle this window</li>
  </ul>
  <a href="#" onclick="toggleHelp(); return false;">Close</a>
</div>
<script type='text/javascript'>
var relevant_lines = {"1": {"1011": 1, "3042": 1, "3043": 1, "3044": 1, "3045": 1, "3048": 1, "3049": 1, "3050": 1, "3051": 1, "3052": 1, "3055": 1, "3056": 1, "3057": 1, "3060": 1, "3061": 1, "3062": 1, "3063": 1, "3064": 1, "3077": 1, "3078": 1, "3089": 1, "3091": 1, "3092": 1, "3120": 1, "3121": 1, "3122": 1, "3123": 1, "3126": 1, "3127": 1, "3128": 1, "3130": 1, "3131": 1, "3132": 1, "3133": 1, "3135": 1, "3137": 1, "3138": 1, "3139": 1, "3140": 1, "3141": 1, "3205": 1, "3206": 1, "3207": 1, "3208": 1, "3209": 1, "3210": 1, "3211": 1, "3212": 1, "3213": 1, "3215": 1, "3218": 1, "3219": 1, "3221": 1, "3222": 1, "3224": 1, "3226": 1, "3229": 1, "3231": 1, "3232": 1, "3234": 1, "3235": 1, "3239": 1, "3241": 1, "3242": 1, "3250": 1, "3251": 1, "3252": 1, "3255": 1, "3258": 1, "3259": 1, "3262": 1, "3264": 1, "3265": 1, "3268": 1, "3311": 1, "3314": 1, "3362": 1, "3363": 1, "3364": 1, "3365": 1, "3366": 1, "3368": 1, "3371": 1, "3372": 1, "3373": 1, "3374": 1, "3375": 1, "3377": 1, "3382": 1, "3383": 1, "3388": 1, "3389": 1, "3390": 1, "3391": 1, "3392": 1, "3397": 1, "4016": 1, "4017": 1, "4134": 1, "4135": 1, "4136": 1, "4137": 1, "4140": 1, "4143": 1, "4145": 1, "4151": 1, "4153": 1, "4155": 1, "4156": 1, "4177": 1, "4178": 1, "4179": 1, "4181": 1, "4206": 1, "4207": 1, "4208": 1, "4209": 1, "4210": 1, "4211": 1, "4212": 1, "4213": 1, "4214": 1, "4215": 1, "4216": 1, "4217": 1, "4218": 1, "4219": 1, "4220": 1, "4221": 1, "4224": 1, "4225": 1, "4226": 1, "4227": 1, "4228": 1, "4229": 1, "4230": 1, "4231": 1, "4232": 1, "4233": 1, "4234": 1, "4235": 1, "4236": 1, "4237": 1, "4238": 1, "4239": 1, "4240": 1, "4241": 1, "4242": 1, "4245": 1, "4246": 1, "4247": 1, "4248": 1, "4249": 1, "4250": 1, "4253": 1, "4256": 1, "4259": 1, "4260": 1, "4261": 1, "4273": 1, "4274": 1, "4276": 1, "4278": 1, "4284": 1, "4287": 1, "4288": 1, "4289": 1, "4290": 1, "4291": 1, "4296": 1, "4297": 1, "4298": 1, "4299": 1, "4300": 1, "4302": 1, "4303": 1, "4305": 1, "4307": 1, "4310": 1, "4311": 1, "4312": 1, "4313": 1, "4314": 1, "4315": 1, "4316": 1, "4317": 1, "4318": 1, "4319": 1, "4321": 1, "4323": 1, "4324": 1, "4326": 1, "4329": 1, "4331": 1, "4334": 1, "4336": 1, "4341": 1, "4342": 1, "4346": 1, "4347": 1, "4350": 1, "4353": 1, "4356": 1, "4366": 1, "4369": 1, "4375": 1, "4380": 1, "4381": 1, "4382": 1, "4384": 1, "4385": 1, "4390": 1, "4392": 1, "4403": 1, "4405": 1, "4411": 1, "4412": 1, "4414": 1, "4415": 1, "4438": 1, "4439": 1, "4442": 1, "4445": 1, "4448": 1, "4451": 1, "4860": 1, "4861": 1, "4862": 1, "4863": 1, "4864": 1, "4865": 1, "4866": 1, "4868": 1, "4870": 1, "4872": 1, "4882": 1, "4884": 1, "4890": 1}};

var filterCounterexample = function (hide) {
  var tables = document.getElementsByClassName("code");
  for (var t=0; t<tables.length; t++) {
    var table = tables[t];
    var file_id = table.getAttribute("data-fileid");
    var lines_in_fid = relevant_lines[file_id];
    if (!lines_in_fid) {
      lines_in_fid = {};
    }
    var lines = table.getElementsByClassName("codeline");
    for (var i=0; i<lines.length; i++) {
        var el = lines[i];
        var lineNo = el.getAttribute("data-linenumber");
        if (!lines_in_fid[lineNo]) {
          if (hide) {
            el.setAttribute("hidden", "");
          } else {
            el.removeAttribute("hidden");
          }
        }
    }
  }
}

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  // SHIFT + S
  if (event.shiftKey && event.keyCode == 83) {
    var checked = document.getElementsByName("showCounterexample")[0].checked;
    filterCounterexample(!checked);
    document.getElementsByName("showCounterexample")[0].click();
  } else {
    return;
  }
  event.preventDefault();
}, true);

document.addEventListener("DOMContentLoaded", function() {
    document.querySelector('input[name="showCounterexample"]').onchange=
        function (event) {
      filterCounterexample(this.checked);
    };
});
</script>

<form>
    <input type="checkbox" name="showCounterexample" id="showCounterexample" />
    <label for="showCounterexample">
       Show only relevant lines
    </label>
    <input type="checkbox" name="showArrows"
           id="showArrows" style="margin-left: 10px" />
    <label for="showArrows">
       Show control flow arrows
    </label>
</form>

<script type='text/javascript'>
// Return range of numbers from a range [lower, upper).
function range(lower, upper) {
  var array = [];
  for (var i = lower; i <= upper; ++i) {
      array.push(i);
  }
  return array;
}

var getRelatedArrowIndices = function(pathId) {
  // HTML numeration of events is a bit different than it is in the path.
  // Everything is rotated one step to the right, so the last element
  // (error diagnostic) has index 0.
  if (pathId == 0) {
    // arrowIndices has at least 2 elements
    pathId = arrowIndices.length - 1;
  }

  return range(arrowIndices[pathId], arrowIndices[pathId - 1]);
}

var highlightArrowsForSelectedEvent = function() {
  const selectedNum = findNum();
  const arrowIndicesToHighlight = getRelatedArrowIndices(selectedNum);
  arrowIndicesToHighlight.forEach((index) => {
    var arrow = document.querySelector("#arrow" + index);
    if(arrow) {
      classListAdd(arrow, "selected")
    }
  });
}

var getAbsoluteBoundingRect = function(element) {
  const relative = element.getBoundingClientRect();
  return {
    left: relative.left + window.pageXOffset,
    right: relative.right + window.pageXOffset,
    top: relative.top + window.pageYOffset,
    bottom: relative.bottom + window.pageYOffset,
    height: relative.height,
    width: relative.width
  };
}

var drawArrow = function(index) {
  // This function is based on the great answer from SO:
  //   https://stackoverflow.com/a/39575674/11582326
  var start = document.querySelector("#start" + index);
  var end   = document.querySelector("#end" + index);
  var arrow = document.querySelector("#arrow" + index);

  var startRect = getAbsoluteBoundingRect(start);
  var endRect   = getAbsoluteBoundingRect(end);

  // It is an arrow from a token to itself, no need to visualize it.
  if (startRect.top == endRect.top &&
      startRect.left == endRect.left)
    return;

  // Each arrow is a very simple BÃ©zier curve, with two nodes and
  // two handles.  So, we need to calculate four points in the window:
  //   * start node
  var posStart    = { x: 0, y: 0 };
  //   * end node
  var posEnd      = { x: 0, y: 0 };
  //   * handle for the start node
  var startHandle = { x: 0, y: 0 };
  //   * handle for the end node
  var endHandle   = { x: 0, y: 0 };
  // One can visualize it as follows:
  //
  //         start handle
  //        /
  //       X"""_.-""""X
  //         .'        \
  //        /           start node
  //       |
  //       |
  //       |      end node
  //        \    /
  //         `->X
  //        X-'
  //         \
  //          end handle
  //
  // NOTE: (0, 0) is the top left corner of the window.

  // We have 3 similar, but still different scenarios to cover:
  //
  //   1. Two tokens on different lines.
  //             -xxx
  //           /
  //           \
  //             -> xxx
  //      In this situation, we draw arrow on the left curving to the left.
  //   2. Two tokens on the same line, and the destination is on the right.
  //             ____
  //            /    \
  //           /      V
  //        xxx        xxx
  //      In this situation, we draw arrow above curving upwards.
  //   3. Two tokens on the same line, and the destination is on the left.
  //        xxx        xxx
  //           ^      /
  //            \____/
  //      In this situation, we draw arrow below curving downwards.
  const onDifferentLines = startRect.top <= endRect.top - 5 ||
    startRect.top >= endRect.top + 5;
  const leftToRight = startRect.left < endRect.left;

  // NOTE: various magic constants are chosen empirically for
  //       better positioning and look
  if (onDifferentLines) {
    // Case #1
    const topToBottom = startRect.top < endRect.top;
    posStart.x = startRect.left - 1;
    // We don't want to start it at the top left corner of the token,
    // it doesn't feel like this is where the arrow comes from.
    // For this reason, we start it in the middle of the left side
    // of the token.
    posStart.y = startRect.top + startRect.height / 2;

    // End node has arrow head and we give it a bit more space.
    posEnd.x = endRect.left - 4;
    posEnd.y = endRect.top;

    // Utility object with x and y offsets for handles.
    var curvature = {
      // We want bottom-to-top arrow to curve a bit more, so it doesn't
      // overlap much with top-to-bottom curves (much more frequent).
      x: topToBottom ? 15 : 25,
      y: Math.min((posEnd.y - posStart.y) / 3, 10)
    }

    // When destination is on the different line, we can make a
    // curvier arrow because we have space for it.
    // So, instead of using
    //
    //   startHandle.x = posStart.x - curvature.x
    //   endHandle.x   = posEnd.x - curvature.x
    //
    // We use the leftmost of these two values for both handles.
    startHandle.x = Math.min(posStart.x, posEnd.x) - curvature.x;
    endHandle.x = startHandle.x;

    // Curving downwards from the start node...
    startHandle.y = posStart.y + curvature.y;
    // ... and upwards from the end node.
    endHandle.y = posEnd.y - curvature.y;

  } else if (leftToRight) {
    // Case #2
    // Starting from the top right corner...
    posStart.x = startRect.right - 1;
    posStart.y = startRect.top;

    // ...and ending at the top left corner of the end token.
    posEnd.x = endRect.left + 1;
    posEnd.y = endRect.top - 1;

    // Utility object with x and y offsets for handles.
    var curvature = {
      x: Math.min((posEnd.x - posStart.x) / 3, 15),
      y: 5
    }

    // Curving to the right...
    startHandle.x = posStart.x + curvature.x;
    // ... and upwards from the start node.
    startHandle.y = posStart.y - curvature.y;

    // And to the left...
    endHandle.x = posEnd.x - curvature.x;
    // ... and upwards from the end node.
    endHandle.y = posEnd.y - curvature.y;

  } else {
    // Case #3
    // Starting from the bottom right corner...
    posStart.x = startRect.right;
    posStart.y = startRect.bottom;

    // ...and ending also at the bottom right corner, but of the end token.
    posEnd.x = endRect.right - 1;
    posEnd.y = endRect.bottom + 1;

    // Utility object with x and y offsets for handles.
    var curvature = {
      x: Math.min((posStart.x - posEnd.x) / 3, 15),
      y: 5
    }

    // Curving to the left...
    startHandle.x = posStart.x - curvature.x;
    // ... and downwards from the start node.
    startHandle.y = posStart.y + curvature.y;

    // And to the right...
    endHandle.x = posEnd.x + curvature.x;
    // ... and downwards from the end node.
    endHandle.y = posEnd.y + curvature.y;
  }

  // Put it all together into a path.
  // More information on the format:
  //   https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths
  var pathStr = "M" + posStart.x + "," + posStart.y + " " +
    "C" + startHandle.x + "," + startHandle.y + " " +
    endHandle.x + "," + endHandle.y + " " +
    posEnd.x + "," + posEnd.y;

  arrow.setAttribute("d", pathStr);
};

var drawArrows = function() {
  const numOfArrows = document.querySelectorAll("path[id^=arrow]").length;
  for (var i = 0; i < numOfArrows; ++i) {
    drawArrow(i);
  }
}

var toggleArrows = function(event) {
  const arrows = document.querySelector("#arrows");
  if (event.target.checked) {
    arrows.setAttribute("visibility", "visible");
  } else {
    arrows.setAttribute("visibility", "hidden");
  }
}

window.addEventListener("resize", drawArrows);
document.addEventListener("DOMContentLoaded", function() {
  // Whenever we show invocation, locations change, i.e. we
  // need to redraw arrows.
  document
    .querySelector('input[id="showinvocation"]')
    .addEventListener("click", drawArrows);
  // Hiding irrelevant lines also should cause arrow rerender.
  document
    .querySelector('input[name="showCounterexample"]')
    .addEventListener("change", drawArrows);
  document
    .querySelector('input[name="showArrows"]')
    .addEventListener("change", toggleArrows);
  drawArrows();
  // Default highlighting for the last event.
  highlightArrowsForSelectedEvent();
});
</script>
  
<script type='text/javascript'>
var digitMatcher = new RegExp("[0-9]+");

var querySelectorAllArray = function(selector) {
  return Array.prototype.slice.call(
    document.querySelectorAll(selector));
}

document.addEventListener("DOMContentLoaded", function() {
    querySelectorAllArray(".PathNav > a").forEach(
        function(currentValue, currentIndex) {
            var hrefValue = currentValue.getAttribute("href");
            currentValue.onclick = function() {
                scrollTo(document.querySelector(hrefValue));
                return false;
            };
        });
});

var findNum = function() {
    var s = document.querySelector(".msg.selected");
    if (!s || s.id == "EndPath") {
        return 0;
    }
    var out = parseInt(digitMatcher.exec(s.id)[0]);
    return out;
};

var classListAdd = function(el, theClass) {
  if(!el.className.baseVal)
    el.className += " " + theClass;
  else
    el.className.baseVal += " " + theClass;
};

var classListRemove = function(el, theClass) {
  var className = (!el.className.baseVal) ?
      el.className : el.className.baseVal;
    className = className.replace(" " + theClass, "");
  if(!el.className.baseVal)
    el.className = className;
  else
    el.className.baseVal = className;
};

var scrollTo = function(el) {
    querySelectorAllArray(".selected").forEach(function(s) {
      classListRemove(s, "selected");
    });
    classListAdd(el, "selected");
    window.scrollBy(0, el.getBoundingClientRect().top -
        (window.innerHeight / 2));
    highlightArrowsForSelectedEvent();
};

var move = function(num, up, numItems) {
  if (num == 1 && up || num == numItems - 1 && !up) {
    return 0;
  } else if (num == 0 && up) {
    return numItems - 1;
  } else if (num == 0 && !up) {
    return 1 % numItems;
  }
  return up ? num - 1 : num + 1;
}

var numToId = function(num) {
  if (num == 0) {
    return document.getElementById("EndPath")
  }
  return document.getElementById("Path" + num);
};

var navigateTo = function(up) {
  var numItems = document.querySelectorAll(
      ".line > .msgEvent, .line > .msgControl").length;
  var currentSelected = findNum();
  var newSelected = move(currentSelected, up, numItems);
  var newEl = numToId(newSelected, numItems);

  // Scroll element into center.
  scrollTo(newEl);
};

window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  // key 'j'
  if (event.keyCode == 74) {
    navigateTo(/*up=*/false);
  // key 'k'
  } else if (event.keyCode == 75) {
    navigateTo(/*up=*/true);
  } else {
    return;
  }
  event.preventDefault();
}, true);
</script>
  
<script type='text/javascript'>

var toggleHelp = function() {
    var hint = document.querySelector("#tooltiphint");
    var attributeName = "hidden";
    if (hint.hasAttribute(attributeName)) {
      hint.removeAttribute(attributeName);
    } else {
      hint.setAttribute("hidden", "true");
    }
};
window.addEventListener("keydown", function (event) {
  if (event.defaultPrevented) {
    return;
  }
  if (event.key == "?") {
    toggleHelp();
  } else {
    return;
  }
  event.preventDefault();
});
</script>

<style type="text/css">
  svg {
      position:absolute;
      top:0;
      left:0;
      height:100%;
      width:100%;
      pointer-events: none;
      overflow: visible
  }
  .arrow {
      stroke-opacity: 0.2;
      stroke-width: 1;
      marker-end: url(#arrowhead);
  }

  .arrow.selected {
      stroke-opacity: 0.6;
      stroke-width: 2;
      marker-end: url(#arrowheadSelected);
  }

  .arrowhead {
      orient: auto;
      stroke: none;
      opacity: 0.6;
      fill: blue;
  }
</style>
<svg xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowheadSelected" class="arrowhead" opacity="0.6"
            viewBox="0 0 10 10" refX="3" refY="5"
            markerWidth="4" markerHeight="4">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
    <marker id="arrowhead" class="arrowhead" opacity="0.2"
            viewBox="0 0 10 10" refX="3" refY="5"
            markerWidth="4" markerHeight="4">
      <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>
  </defs>
  <g id="arrows" fill="none" stroke="blue" visibility="hidden">
    <path class="arrow" id="arrow0"/>
    <path class="arrow" id="arrow1"/>
    <path class="arrow" id="arrow2"/>
    <path class="arrow" id="arrow3"/>
    <path class="arrow" id="arrow4"/>
    <path class="arrow" id="arrow5"/>
    <path class="arrow" id="arrow6"/>
    <path class="arrow" id="arrow7"/>
    <path class="arrow" id="arrow8"/>
    <path class="arrow" id="arrow9"/>
    <path class="arrow" id="arrow10"/>
    <path class="arrow" id="arrow11"/>
    <path class="arrow" id="arrow12"/>
    <path class="arrow" id="arrow13"/>
    <path class="arrow" id="arrow14"/>
    <path class="arrow" id="arrow15"/>
    <path class="arrow" id="arrow16"/>
    <path class="arrow" id="arrow17"/>
    <path class="arrow" id="arrow18"/>
    <path class="arrow" id="arrow19"/>
    <path class="arrow" id="arrow20"/>
    <path class="arrow" id="arrow21"/>
    <path class="arrow" id="arrow22"/>
    <path class="arrow" id="arrow23"/>
    <path class="arrow" id="arrow24"/>
    <path class="arrow" id="arrow25"/>
    <path class="arrow" id="arrow26"/>
    <path class="arrow" id="arrow27"/>
    <path class="arrow" id="arrow28"/>
    <path class="arrow" id="arrow29"/>
    <path class="arrow" id="arrow30"/>
    <path class="arrow" id="arrow31"/>
    <path class="arrow" id="arrow32"/>
    <path class="arrow" id="arrow33"/>
    <path class="arrow" id="arrow34"/>
    <path class="arrow" id="arrow35"/>
    <path class="arrow" id="arrow36"/>
    <path class="arrow" id="arrow37"/>
    <path class="arrow" id="arrow38"/>
    <path class="arrow" id="arrow39"/>
    <path class="arrow" id="arrow40"/>
    <path class="arrow" id="arrow41"/>
    <path class="arrow" id="arrow42"/>
    <path class="arrow" id="arrow43"/>
    <path class="arrow" id="arrow44"/>
    <path class="arrow" id="arrow45"/>
    <path class="arrow" id="arrow46"/>
    <path class="arrow" id="arrow47"/>
    <path class="arrow" id="arrow48"/>
    <path class="arrow" id="arrow49"/>
    <path class="arrow" id="arrow50"/>
    <path class="arrow" id="arrow51"/>
    <path class="arrow" id="arrow52"/>
    <path class="arrow" id="arrow53"/>
    <path class="arrow" id="arrow54"/>
    <path class="arrow" id="arrow55"/>
    <path class="arrow" id="arrow56"/>
    <path class="arrow" id="arrow57"/>
    <path class="arrow" id="arrow58"/>
    <path class="arrow" id="arrow59"/>
    <path class="arrow" id="arrow60"/>
    <path class="arrow" id="arrow61"/>
    <path class="arrow" id="arrow62"/>
    <path class="arrow" id="arrow63"/>
    <path class="arrow" id="arrow64"/>
    <path class="arrow" id="arrow65"/>
    <path class="arrow" id="arrow66"/>
    <path class="arrow" id="arrow67"/>
    <path class="arrow" id="arrow68"/>
    <path class="arrow" id="arrow69"/>
    <path class="arrow" id="arrow70"/>
    <path class="arrow" id="arrow71"/>
    <path class="arrow" id="arrow72"/>
    <path class="arrow" id="arrow73"/>
    <path class="arrow" id="arrow74"/>
    <path class="arrow" id="arrow75"/>
    <path class="arrow" id="arrow76"/>
    <path class="arrow" id="arrow77"/>
    <path class="arrow" id="arrow78"/>
    <path class="arrow" id="arrow79"/>
    <path class="arrow" id="arrow80"/>
    <path class="arrow" id="arrow81"/>
    <path class="arrow" id="arrow82"/>
    <path class="arrow" id="arrow83"/>
    <path class="arrow" id="arrow84"/>
    <path class="arrow" id="arrow85"/>
    <path class="arrow" id="arrow86"/>
    <path class="arrow" id="arrow87"/>
    <path class="arrow" id="arrow88"/>
    <path class="arrow" id="arrow89"/>
    <path class="arrow" id="arrow90"/>
    <path class="arrow" id="arrow91"/>
    <path class="arrow" id="arrow92"/>
    <path class="arrow" id="arrow93"/>
    <path class="arrow" id="arrow94"/>
    <path class="arrow" id="arrow95"/>
    <path class="arrow" id="arrow96"/>
    <path class="arrow" id="arrow97"/>
    <path class="arrow" id="arrow98"/>
    <path class="arrow" id="arrow99"/>
    <path class="arrow" id="arrow100"/>
    <path class="arrow" id="arrow101"/>
    <path class="arrow" id="arrow102"/>
    <path class="arrow" id="arrow103"/>
    <path class="arrow" id="arrow104"/>
    <path class="arrow" id="arrow105"/>
    <path class="arrow" id="arrow106"/>

  </g>
</svg>
<script type='text/javascript'>
const arrowIndices = [ 107,105,103,102,101,100,99,97,95,94,92,90,88,87,82,79,64,61,56,55,51,49,45,43,40,38,37,35,34,31,29,29,28,26,22,20,18,18,16,15,14,11,10,8,5,4,1,0 ]
</script>
<table class="code" data-fileid="1">
<tr class="codeline" data-linenumber="1"><td class="num" id="LN1">1</td><td class="line"><span class='comment'>/* miniz.c v1.15 - public domain deflate/inflate, zlib-subset, ZIP reading/writing/appending, PNG writing</span></td></tr>
<tr class="codeline" data-linenumber="2"><td class="num" id="LN2">2</td><td class="line">   <span class='comment'>See "unlicense" statement at the end of this file.</span></td></tr>
<tr class="codeline" data-linenumber="3"><td class="num" id="LN3">3</td><td class="line">   <span class='comment'>Rich Geldreich &lt;richgel99@gmail.com&gt;, last updated Oct. 13, 2013</span></td></tr>
<tr class="codeline" data-linenumber="4"><td class="num" id="LN4">4</td><td class="line">   <span class='comment'>Implements RFC 1950: http://www.ietf.org/rfc/rfc1950.txt and RFC 1951: http://www.ietf.org/rfc/rfc1951.txt</span></td></tr>
<tr class="codeline" data-linenumber="5"><td class="num" id="LN5">5</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="6"><td class="num" id="LN6">6</td><td class="line">   <span class='comment'>Most API's defined in miniz.c are optional. For example, to disable the archive related functions just define</span></td></tr>
<tr class="codeline" data-linenumber="7"><td class="num" id="LN7">7</td><td class="line">   <span class='comment'>MINIZ_NO_ARCHIVE_APIS, or to get rid of all stdio usage define MINIZ_NO_STDIO (see the list below for more macros).</span></td></tr>
<tr class="codeline" data-linenumber="8"><td class="num" id="LN8">8</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="9"><td class="num" id="LN9">9</td><td class="line">   <span class='comment'>* Change History</span></td></tr>
<tr class="codeline" data-linenumber="10"><td class="num" id="LN10">10</td><td class="line">     <span class='comment'>10/13/13 v1.15 r4 - Interim bugfix release while I work on the next major release with Zip64 support (almost there!):</span></td></tr>
<tr class="codeline" data-linenumber="11"><td class="num" id="LN11">11</td><td class="line">       <span class='comment'>- Critical fix for the MZ_ZIP_FLAG_DO_NOT_SORT_CENTRAL_DIRECTORY bug (thanks kahmyong.moon@hp.com) which could cause locate files to not find files. This bug</span></td></tr>
<tr class="codeline" data-linenumber="12"><td class="num" id="LN12">12</td><td class="line">        <span class='comment'>would only have occured in earlier versions if you explicitly used this flag, OR if you used mz_zip_extract_archive_file_to_heap() or mz_zip_add_mem_to_archive_file_in_place()</span></td></tr>
<tr class="codeline" data-linenumber="13"><td class="num" id="LN13">13</td><td class="line">        <span class='comment'>(which used this flag). If you can't switch to v1.15 but want to fix this bug, just remove the uses of this flag from both helper funcs (and of course don't use the flag).</span></td></tr>
<tr class="codeline" data-linenumber="14"><td class="num" id="LN14">14</td><td class="line">       <span class='comment'>- Bugfix in mz_zip_reader_extract_to_mem_no_alloc() from kymoon when pUser_read_buf is not NULL and compressed size is &gt; uncompressed size</span></td></tr>
<tr class="codeline" data-linenumber="15"><td class="num" id="LN15">15</td><td class="line">       <span class='comment'>- Fixing mz_zip_reader_extract_*() funcs so they don't try to extract compressed data from directory entries, to account for weird zipfiles which contain zero-size compressed data on dir entries.</span></td></tr>
<tr class="codeline" data-linenumber="16"><td class="num" id="LN16">16</td><td class="line">         <span class='comment'>Hopefully this fix won't cause any issues on weird zip archives, because it assumes the low 16-bits of zip external attributes are DOS attributes (which I believe they always are in practice).</span></td></tr>
<tr class="codeline" data-linenumber="17"><td class="num" id="LN17">17</td><td class="line">       <span class='comment'>- Fixing mz_zip_reader_is_file_a_directory() so it doesn't check the internal attributes, just the filename and external attributes</span></td></tr>
<tr class="codeline" data-linenumber="18"><td class="num" id="LN18">18</td><td class="line">       <span class='comment'>- mz_zip_reader_init_file() - missing MZ_FCLOSE() call if the seek failed</span></td></tr>
<tr class="codeline" data-linenumber="19"><td class="num" id="LN19">19</td><td class="line">       <span class='comment'>- Added cmake support for Linux builds which builds all the examples, tested with clang v3.3 and gcc v4.6.</span></td></tr>
<tr class="codeline" data-linenumber="20"><td class="num" id="LN20">20</td><td class="line">       <span class='comment'>- Clang fix for tdefl_write_image_to_png_file_in_memory() from toffaletti</span></td></tr>
<tr class="codeline" data-linenumber="21"><td class="num" id="LN21">21</td><td class="line">       <span class='comment'>- Merged MZ_FORCEINLINE fix from hdeanclark</span></td></tr>
<tr class="codeline" data-linenumber="22"><td class="num" id="LN22">22</td><td class="line">       <span class='comment'>- Fix &lt;time.h&gt; include before config #ifdef, thanks emil.brink</span></td></tr>
<tr class="codeline" data-linenumber="23"><td class="num" id="LN23">23</td><td class="line">       <span class='comment'>- Added tdefl_write_image_to_png_file_in_memory_ex(): supports Y flipping (super useful for OpenGL apps), and explicit control over the compression level (so you can</span></td></tr>
<tr class="codeline" data-linenumber="24"><td class="num" id="LN24">24</td><td class="line">        <span class='comment'>set it to 1 for real-time compression).</span></td></tr>
<tr class="codeline" data-linenumber="25"><td class="num" id="LN25">25</td><td class="line">       <span class='comment'>- Merged in some compiler fixes from paulharris's github repro.</span></td></tr>
<tr class="codeline" data-linenumber="26"><td class="num" id="LN26">26</td><td class="line">       <span class='comment'>- Retested this build under Windows (VS 2010, including static analysis), tcc  0.9.26, gcc v4.6 and clang v3.3.</span></td></tr>
<tr class="codeline" data-linenumber="27"><td class="num" id="LN27">27</td><td class="line">       <span class='comment'>- Added example6.c, which dumps an image of the mandelbrot set to a PNG file.</span></td></tr>
<tr class="codeline" data-linenumber="28"><td class="num" id="LN28">28</td><td class="line">       <span class='comment'>- Modified example2 to help test the MZ_ZIP_FLAG_DO_NOT_SORT_CENTRAL_DIRECTORY flag more.</span></td></tr>
<tr class="codeline" data-linenumber="29"><td class="num" id="LN29">29</td><td class="line">       <span class='comment'>- In r3: Bugfix to mz_zip_writer_add_file() found during merge: Fix possible src file fclose() leak if alignment bytes+local header file write faiiled</span></td></tr>
<tr class="codeline" data-linenumber="30"><td class="num" id="LN30">30</td><td class="line">       <span class='comment'>- In r4: Minor bugfix to mz_zip_writer_add_from_zip_reader(): Was pushing the wrong central dir header offset, appears harmless in this release, but it became a problem in the zip64 branch</span></td></tr>
<tr class="codeline" data-linenumber="31"><td class="num" id="LN31">31</td><td class="line">     <span class='comment'>5/20/12 v1.14 - MinGW32/64 GCC 4.6.1 compiler fixes: added MZ_FORCEINLINE, #include &lt;time.h&gt; (thanks fermtect).</span></td></tr>
<tr class="codeline" data-linenumber="32"><td class="num" id="LN32">32</td><td class="line">     <span class='comment'>5/19/12 v1.13 - From jason@cornsyrup.org and kelwert@mtu.edu - Fix mz_crc32() so it doesn't compute the wrong CRC-32's when mz_ulong is 64-bit.</span></td></tr>
<tr class="codeline" data-linenumber="33"><td class="num" id="LN33">33</td><td class="line">       <span class='comment'>- Temporarily/locally slammed in "typedef unsigned long mz_ulong" and re-ran a randomized regression test on ~500k files.</span></td></tr>
<tr class="codeline" data-linenumber="34"><td class="num" id="LN34">34</td><td class="line">       <span class='comment'>- Eliminated a bunch of warnings when compiling with GCC 32-bit/64.</span></td></tr>
<tr class="codeline" data-linenumber="35"><td class="num" id="LN35">35</td><td class="line">       <span class='comment'>- Ran all examples, miniz.c, and tinfl.c through MSVC 2008's /analyze (static analysis) option and fixed all warnings (except for the silly</span></td></tr>
<tr class="codeline" data-linenumber="36"><td class="num" id="LN36">36</td><td class="line">        <span class='comment'>"Use of the comma-operator in a tested expression.." analysis warning, which I purposely use to work around a MSVC compiler warning).</span></td></tr>
<tr class="codeline" data-linenumber="37"><td class="num" id="LN37">37</td><td class="line">       <span class='comment'>- Created 32-bit and 64-bit Codeblocks projects/workspace. Built and tested Linux executables. The codeblocks workspace is compatible with Linux+Win32/x64.</span></td></tr>
<tr class="codeline" data-linenumber="38"><td class="num" id="LN38">38</td><td class="line">       <span class='comment'>- Added miniz_tester solution/project, which is a useful little app derived from LZHAM's tester app that I use as part of the regression test.</span></td></tr>
<tr class="codeline" data-linenumber="39"><td class="num" id="LN39">39</td><td class="line">       <span class='comment'>- Ran miniz.c and tinfl.c through another series of regression testing on ~500,000 files and archives.</span></td></tr>
<tr class="codeline" data-linenumber="40"><td class="num" id="LN40">40</td><td class="line">       <span class='comment'>- Modified example5.c so it purposely disables a bunch of high-level functionality (MINIZ_NO_STDIO, etc.). (Thanks to corysama for the MINIZ_NO_STDIO bug report.)</span></td></tr>
<tr class="codeline" data-linenumber="41"><td class="num" id="LN41">41</td><td class="line">       <span class='comment'>- Fix ftell() usage in examples so they exit with an error on files which are too large (a limitation of the examples, not miniz itself).</span></td></tr>
<tr class="codeline" data-linenumber="42"><td class="num" id="LN42">42</td><td class="line">     <span class='comment'>4/12/12 v1.12 - More comments, added low-level example5.c, fixed a couple minor level_and_flags issues in the archive API's.</span></td></tr>
<tr class="codeline" data-linenumber="43"><td class="num" id="LN43">43</td><td class="line">      <span class='comment'>level_and_flags can now be set to MZ_DEFAULT_COMPRESSION. Thanks to Bruce Dawson &lt;bruced@valvesoftware.com&gt; for the feedback/bug report.</span></td></tr>
<tr class="codeline" data-linenumber="44"><td class="num" id="LN44">44</td><td class="line">     <span class='comment'>5/28/11 v1.11 - Added statement from unlicense.org</span></td></tr>
<tr class="codeline" data-linenumber="45"><td class="num" id="LN45">45</td><td class="line">     <span class='comment'>5/27/11 v1.10 - Substantial compressor optimizations:</span></td></tr>
<tr class="codeline" data-linenumber="46"><td class="num" id="LN46">46</td><td class="line">      <span class='comment'>- Level 1 is now ~4x faster than before. The L1 compressor's throughput now varies between 70-110MB/sec. on a</span></td></tr>
<tr class="codeline" data-linenumber="47"><td class="num" id="LN47">47</td><td class="line">      <span class='comment'>- Core i7 (actual throughput varies depending on the type of data, and x64 vs. x86).</span></td></tr>
<tr class="codeline" data-linenumber="48"><td class="num" id="LN48">48</td><td class="line">      <span class='comment'>- Improved baseline L2-L9 compression perf. Also, greatly improved compression perf. issues on some file types.</span></td></tr>
<tr class="codeline" data-linenumber="49"><td class="num" id="LN49">49</td><td class="line">      <span class='comment'>- Refactored the compression code for better readability and maintainability.</span></td></tr>
<tr class="codeline" data-linenumber="50"><td class="num" id="LN50">50</td><td class="line">      <span class='comment'>- Added level 10 compression level (L10 has slightly better ratio than level 9, but could have a potentially large</span></td></tr>
<tr class="codeline" data-linenumber="51"><td class="num" id="LN51">51</td><td class="line">       <span class='comment'>drop in throughput on some files).</span></td></tr>
<tr class="codeline" data-linenumber="52"><td class="num" id="LN52">52</td><td class="line">     <span class='comment'>5/15/11 v1.09 - Initial stable release.</span></td></tr>
<tr class="codeline" data-linenumber="53"><td class="num" id="LN53">53</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="54"><td class="num" id="LN54">54</td><td class="line">   <span class='comment'>* Low-level Deflate/Inflate implementation notes:</span></td></tr>
<tr class="codeline" data-linenumber="55"><td class="num" id="LN55">55</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="56"><td class="num" id="LN56">56</td><td class="line">     <span class='comment'>Compression: Use the "tdefl" API's. The compressor supports raw, static, and dynamic blocks, lazy or</span></td></tr>
<tr class="codeline" data-linenumber="57"><td class="num" id="LN57">57</td><td class="line">     <span class='comment'>greedy parsing, match length filtering, RLE-only, and Huffman-only streams. It performs and compresses</span></td></tr>
<tr class="codeline" data-linenumber="58"><td class="num" id="LN58">58</td><td class="line">     <span class='comment'>approximately as well as zlib.</span></td></tr>
<tr class="codeline" data-linenumber="59"><td class="num" id="LN59">59</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="60"><td class="num" id="LN60">60</td><td class="line">     <span class='comment'>Decompression: Use the "tinfl" API's. The entire decompressor is implemented as a single function</span></td></tr>
<tr class="codeline" data-linenumber="61"><td class="num" id="LN61">61</td><td class="line">     <span class='comment'>coroutine: see tinfl_decompress(). It supports decompression into a 32KB (or larger power of 2) wrapping buffer, or into a memory</span></td></tr>
<tr class="codeline" data-linenumber="62"><td class="num" id="LN62">62</td><td class="line">     <span class='comment'>block large enough to hold the entire file.</span></td></tr>
<tr class="codeline" data-linenumber="63"><td class="num" id="LN63">63</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="64"><td class="num" id="LN64">64</td><td class="line">     <span class='comment'>The low-level tdefl/tinfl API's do not make any use of dynamic memory allocation.</span></td></tr>
<tr class="codeline" data-linenumber="65"><td class="num" id="LN65">65</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="66"><td class="num" id="LN66">66</td><td class="line">   <span class='comment'>* zlib-style API notes:</span></td></tr>
<tr class="codeline" data-linenumber="67"><td class="num" id="LN67">67</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="68"><td class="num" id="LN68">68</td><td class="line">     <span class='comment'>miniz.c implements a fairly large subset of zlib. There's enough functionality present for it to be a drop-in</span></td></tr>
<tr class="codeline" data-linenumber="69"><td class="num" id="LN69">69</td><td class="line">     <span class='comment'>zlib replacement in many apps:</span></td></tr>
<tr class="codeline" data-linenumber="70"><td class="num" id="LN70">70</td><td class="line">        <span class='comment'>The z_stream struct, optional memory allocation callbacks</span></td></tr>
<tr class="codeline" data-linenumber="71"><td class="num" id="LN71">71</td><td class="line">        <span class='comment'>deflateInit/deflateInit2/deflate/deflateReset/deflateEnd/deflateBound</span></td></tr>
<tr class="codeline" data-linenumber="72"><td class="num" id="LN72">72</td><td class="line">        <span class='comment'>inflateInit/inflateInit2/inflate/inflateEnd</span></td></tr>
<tr class="codeline" data-linenumber="73"><td class="num" id="LN73">73</td><td class="line">        <span class='comment'>compress, compress2, compressBound, uncompress</span></td></tr>
<tr class="codeline" data-linenumber="74"><td class="num" id="LN74">74</td><td class="line">        <span class='comment'>CRC-32, Adler-32 - Using modern, minimal code size, CPU cache friendly routines.</span></td></tr>
<tr class="codeline" data-linenumber="75"><td class="num" id="LN75">75</td><td class="line">        <span class='comment'>Supports raw deflate streams or standard zlib streams with adler-32 checking.</span></td></tr>
<tr class="codeline" data-linenumber="76"><td class="num" id="LN76">76</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="77"><td class="num" id="LN77">77</td><td class="line">     <span class='comment'>Limitations:</span></td></tr>
<tr class="codeline" data-linenumber="78"><td class="num" id="LN78">78</td><td class="line">      <span class='comment'>The callback API's are not implemented yet. No support for gzip headers or zlib static dictionaries.</span></td></tr>
<tr class="codeline" data-linenumber="79"><td class="num" id="LN79">79</td><td class="line">      <span class='comment'>I've tried to closely emulate zlib's various flavors of stream flushing and return status codes, but</span></td></tr>
<tr class="codeline" data-linenumber="80"><td class="num" id="LN80">80</td><td class="line">      <span class='comment'>there are no guarantees that miniz.c pulls this off perfectly.</span></td></tr>
<tr class="codeline" data-linenumber="81"><td class="num" id="LN81">81</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="82"><td class="num" id="LN82">82</td><td class="line">   <span class='comment'>* PNG writing: See the tdefl_write_image_to_png_file_in_memory() function, originally written by</span></td></tr>
<tr class="codeline" data-linenumber="83"><td class="num" id="LN83">83</td><td class="line">     <span class='comment'>Alex Evans. Supports 1-4 bytes/pixel images.</span></td></tr>
<tr class="codeline" data-linenumber="84"><td class="num" id="LN84">84</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="85"><td class="num" id="LN85">85</td><td class="line">   <span class='comment'>* ZIP archive API notes:</span></td></tr>
<tr class="codeline" data-linenumber="86"><td class="num" id="LN86">86</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="87"><td class="num" id="LN87">87</td><td class="line">     <span class='comment'>The ZIP archive API's where designed with simplicity and efficiency in mind, with just enough abstraction to</span></td></tr>
<tr class="codeline" data-linenumber="88"><td class="num" id="LN88">88</td><td class="line">     <span class='comment'>get the job done with minimal fuss. There are simple API's to retrieve file information, read files from</span></td></tr>
<tr class="codeline" data-linenumber="89"><td class="num" id="LN89">89</td><td class="line">     <span class='comment'>existing archives, create new archives, append new files to existing archives, or clone archive data from</span></td></tr>
<tr class="codeline" data-linenumber="90"><td class="num" id="LN90">90</td><td class="line">     <span class='comment'>one archive to another. It supports archives located in memory or the heap, on disk (using stdio.h),</span></td></tr>
<tr class="codeline" data-linenumber="91"><td class="num" id="LN91">91</td><td class="line">     <span class='comment'>or you can specify custom file read/write callbacks.</span></td></tr>
<tr class="codeline" data-linenumber="92"><td class="num" id="LN92">92</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="93"><td class="num" id="LN93">93</td><td class="line">     <span class='comment'>- Archive reading: Just call this function to read a single file from a disk archive:</span></td></tr>
<tr class="codeline" data-linenumber="94"><td class="num" id="LN94">94</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="95"><td class="num" id="LN95">95</td><td class="line">      <span class='comment'>void *mz_zip_extract_archive_file_to_heap(const char *pZip_filename, const char *pArchive_name,</span></td></tr>
<tr class="codeline" data-linenumber="96"><td class="num" id="LN96">96</td><td class="line">        <span class='comment'>size_t *pSize, mz_uint zip_flags);</span></td></tr>
<tr class="codeline" data-linenumber="97"><td class="num" id="LN97">97</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="98"><td class="num" id="LN98">98</td><td class="line">     <span class='comment'>For more complex cases, use the "mz_zip_reader" functions. Upon opening an archive, the entire central</span></td></tr>
<tr class="codeline" data-linenumber="99"><td class="num" id="LN99">99</td><td class="line">     <span class='comment'>directory is located and read as-is into memory, and subsequent file access only occurs when reading individual files.</span></td></tr>
<tr class="codeline" data-linenumber="100"><td class="num" id="LN100">100</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="101"><td class="num" id="LN101">101</td><td class="line">     <span class='comment'>- Archives file scanning: The simple way is to use this function to scan a loaded archive for a specific file:</span></td></tr>
<tr class="codeline" data-linenumber="102"><td class="num" id="LN102">102</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="103"><td class="num" id="LN103">103</td><td class="line">     <span class='comment'>int mz_zip_reader_locate_file(mz_zip_archive *pZip, const char *pName, const char *pComment, mz_uint flags);</span></td></tr>
<tr class="codeline" data-linenumber="104"><td class="num" id="LN104">104</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="105"><td class="num" id="LN105">105</td><td class="line">     <span class='comment'>The locate operation can optionally check file comments too, which (as one example) can be used to identify</span></td></tr>
<tr class="codeline" data-linenumber="106"><td class="num" id="LN106">106</td><td class="line">     <span class='comment'>multiple versions of the same file in an archive. This function uses a simple linear search through the central</span></td></tr>
<tr class="codeline" data-linenumber="107"><td class="num" id="LN107">107</td><td class="line">     <span class='comment'>directory, so it's not very fast.</span></td></tr>
<tr class="codeline" data-linenumber="108"><td class="num" id="LN108">108</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="109"><td class="num" id="LN109">109</td><td class="line">     <span class='comment'>Alternately, you can iterate through all the files in an archive (using mz_zip_reader_get_num_files()) and</span></td></tr>
<tr class="codeline" data-linenumber="110"><td class="num" id="LN110">110</td><td class="line">     <span class='comment'>retrieve detailed info on each file by calling mz_zip_reader_file_stat().</span></td></tr>
<tr class="codeline" data-linenumber="111"><td class="num" id="LN111">111</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="112"><td class="num" id="LN112">112</td><td class="line">     <span class='comment'>- Archive creation: Use the "mz_zip_writer" functions. The ZIP writer immediately writes compressed file data</span></td></tr>
<tr class="codeline" data-linenumber="113"><td class="num" id="LN113">113</td><td class="line">     <span class='comment'>to disk and builds an exact image of the central directory in memory. The central directory image is written</span></td></tr>
<tr class="codeline" data-linenumber="114"><td class="num" id="LN114">114</td><td class="line">     <span class='comment'>all at once at the end of the archive file when the archive is finalized.</span></td></tr>
<tr class="codeline" data-linenumber="115"><td class="num" id="LN115">115</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="116"><td class="num" id="LN116">116</td><td class="line">     <span class='comment'>The archive writer can optionally align each file's local header and file data to any power of 2 alignment,</span></td></tr>
<tr class="codeline" data-linenumber="117"><td class="num" id="LN117">117</td><td class="line">     <span class='comment'>which can be useful when the archive will be read from optical media. Also, the writer supports placing</span></td></tr>
<tr class="codeline" data-linenumber="118"><td class="num" id="LN118">118</td><td class="line">     <span class='comment'>arbitrary data blobs at the very beginning of ZIP archives. Archives written using either feature are still</span></td></tr>
<tr class="codeline" data-linenumber="119"><td class="num" id="LN119">119</td><td class="line">     <span class='comment'>readable by any ZIP tool.</span></td></tr>
<tr class="codeline" data-linenumber="120"><td class="num" id="LN120">120</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="121"><td class="num" id="LN121">121</td><td class="line">     <span class='comment'>- Archive appending: The simple way to add a single file to an archive is to call this function:</span></td></tr>
<tr class="codeline" data-linenumber="122"><td class="num" id="LN122">122</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="123"><td class="num" id="LN123">123</td><td class="line">      <span class='comment'>mz_bool mz_zip_add_mem_to_archive_file_in_place(const char *pZip_filename, const char *pArchive_name,</span></td></tr>
<tr class="codeline" data-linenumber="124"><td class="num" id="LN124">124</td><td class="line">        <span class='comment'>const void *pBuf, size_t buf_size, const void *pComment, mz_uint16 comment_size, mz_uint level_and_flags);</span></td></tr>
<tr class="codeline" data-linenumber="125"><td class="num" id="LN125">125</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="126"><td class="num" id="LN126">126</td><td class="line">     <span class='comment'>The archive will be created if it doesn't already exist, otherwise it'll be appended to.</span></td></tr>
<tr class="codeline" data-linenumber="127"><td class="num" id="LN127">127</td><td class="line">     <span class='comment'>Note the appending is done in-place and is not an atomic operation, so if something goes wrong</span></td></tr>
<tr class="codeline" data-linenumber="128"><td class="num" id="LN128">128</td><td class="line">     <span class='comment'>during the operation it's possible the archive could be left without a central directory (although the local</span></td></tr>
<tr class="codeline" data-linenumber="129"><td class="num" id="LN129">129</td><td class="line">     <span class='comment'>file headers and file data will be fine, so the archive will be recoverable).</span></td></tr>
<tr class="codeline" data-linenumber="130"><td class="num" id="LN130">130</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="131"><td class="num" id="LN131">131</td><td class="line">     <span class='comment'>For more complex archive modification scenarios:</span></td></tr>
<tr class="codeline" data-linenumber="132"><td class="num" id="LN132">132</td><td class="line">     <span class='comment'>1. The safest way is to use a mz_zip_reader to read the existing archive, cloning only those bits you want to</span></td></tr>
<tr class="codeline" data-linenumber="133"><td class="num" id="LN133">133</td><td class="line">     <span class='comment'>preserve into a new archive using using the mz_zip_writer_add_from_zip_reader() function (which compiles the</span></td></tr>
<tr class="codeline" data-linenumber="134"><td class="num" id="LN134">134</td><td class="line">     <span class='comment'>compressed file data as-is). When you're done, delete the old archive and rename the newly written archive, and</span></td></tr>
<tr class="codeline" data-linenumber="135"><td class="num" id="LN135">135</td><td class="line">     <span class='comment'>you're done. This is safe but requires a bunch of temporary disk space or heap memory.</span></td></tr>
<tr class="codeline" data-linenumber="136"><td class="num" id="LN136">136</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="137"><td class="num" id="LN137">137</td><td class="line">     <span class='comment'>2. Or, you can convert an mz_zip_reader in-place to an mz_zip_writer using mz_zip_writer_init_from_reader(),</span></td></tr>
<tr class="codeline" data-linenumber="138"><td class="num" id="LN138">138</td><td class="line">     <span class='comment'>append new files as needed, then finalize the archive which will write an updated central directory to the</span></td></tr>
<tr class="codeline" data-linenumber="139"><td class="num" id="LN139">139</td><td class="line">     <span class='comment'>original archive. (This is basically what mz_zip_add_mem_to_archive_file_in_place() does.) There's a</span></td></tr>
<tr class="codeline" data-linenumber="140"><td class="num" id="LN140">140</td><td class="line">     <span class='comment'>possibility that the archive's central directory could be lost with this method if anything goes wrong, though.</span></td></tr>
<tr class="codeline" data-linenumber="141"><td class="num" id="LN141">141</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="142"><td class="num" id="LN142">142</td><td class="line">     <span class='comment'>- ZIP archive support limitations:</span></td></tr>
<tr class="codeline" data-linenumber="143"><td class="num" id="LN143">143</td><td class="line">     <span class='comment'>No zip64 or spanning support. Extraction functions can only handle unencrypted, stored or deflated files.</span></td></tr>
<tr class="codeline" data-linenumber="144"><td class="num" id="LN144">144</td><td class="line">     <span class='comment'>Requires streams capable of seeking.</span></td></tr>
<tr class="codeline" data-linenumber="145"><td class="num" id="LN145">145</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="146"><td class="num" id="LN146">146</td><td class="line">   <span class='comment'>* This is a header file library, like stb_image.c. To get only a header file, either cut and paste the</span></td></tr>
<tr class="codeline" data-linenumber="147"><td class="num" id="LN147">147</td><td class="line">     <span class='comment'>below header, or create miniz.h, #define MINIZ_HEADER_FILE_ONLY, and then include miniz.c from it.</span></td></tr>
<tr class="codeline" data-linenumber="148"><td class="num" id="LN148">148</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="149"><td class="num" id="LN149">149</td><td class="line">   <span class='comment'>* Important: For best perf. be sure to customize the below macros for your target platform:</span></td></tr>
<tr class="codeline" data-linenumber="150"><td class="num" id="LN150">150</td><td class="line">     <span class='comment'>#define MINIZ_USE_UNALIGNED_LOADS_AND_STORES 1</span></td></tr>
<tr class="codeline" data-linenumber="151"><td class="num" id="LN151">151</td><td class="line">     <span class='comment'>#define MINIZ_LITTLE_ENDIAN 1</span></td></tr>
<tr class="codeline" data-linenumber="152"><td class="num" id="LN152">152</td><td class="line">     <span class='comment'>#define MINIZ_HAS_64BIT_REGISTERS 1</span></td></tr>
<tr class="codeline" data-linenumber="153"><td class="num" id="LN153">153</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="154"><td class="num" id="LN154">154</td><td class="line">   <span class='comment'>* On platforms using glibc, Be sure to "#define _LARGEFILE64_SOURCE 1" before including miniz.c to ensure miniz</span></td></tr>
<tr class="codeline" data-linenumber="155"><td class="num" id="LN155">155</td><td class="line">     <span class='comment'>uses the 64-bit variants: fopen64(), stat64(), etc. Otherwise you won't be able to process large files</span></td></tr>
<tr class="codeline" data-linenumber="156"><td class="num" id="LN156">156</td><td class="line">     <span class='comment'>(i.e. 32-bit stat() fails for me on files &gt; 0x7FFFFFFF bytes).</span></td></tr>
<tr class="codeline" data-linenumber="157"><td class="num" id="LN157">157</td><td class="line"><span class='comment'>*/</span></td></tr>
<tr class="codeline" data-linenumber="158"><td class="num" id="LN158">158</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="159"><td class="num" id="LN159">159</td><td class="line"><span class='directive'>#ifndef MINIZ_HEADER_INCLUDED</span></td></tr>
<tr class="codeline" data-linenumber="160"><td class="num" id="LN160">160</td><td class="line"><span class='directive'>#define MINIZ_HEADER_INCLUDED</span></td></tr>
<tr class="codeline" data-linenumber="161"><td class="num" id="LN161">161</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="162"><td class="num" id="LN162">162</td><td class="line"><span class='directive'>#include &lt;stdlib.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="163"><td class="num" id="LN163">163</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="164"><td class="num" id="LN164">164</td><td class="line"><span class='comment'>// Defines to completely disable specific portions of miniz.c:</span></td></tr>
<tr class="codeline" data-linenumber="165"><td class="num" id="LN165">165</td><td class="line"><span class='comment'>// If all macros here are defined the only functionality remaining will be CRC-32, adler-32, tinfl, and tdefl.</span></td></tr>
<tr class="codeline" data-linenumber="166"><td class="num" id="LN166">166</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="167"><td class="num" id="LN167">167</td><td class="line"><span class='comment'>// Define MINIZ_NO_STDIO to disable all usage and any functions which rely on stdio for file I/O.</span></td></tr>
<tr class="codeline" data-linenumber="168"><td class="num" id="LN168">168</td><td class="line"><span class='comment'>//#define MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="169"><td class="num" id="LN169">169</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="170"><td class="num" id="LN170">170</td><td class="line"><span class='comment'>// If MINIZ_NO_TIME is specified then the ZIP archive functions will not be able to get the current time, or</span></td></tr>
<tr class="codeline" data-linenumber="171"><td class="num" id="LN171">171</td><td class="line"><span class='comment'>// get/set file times, and the C run-time funcs that get/set times won't be called.</span></td></tr>
<tr class="codeline" data-linenumber="172"><td class="num" id="LN172">172</td><td class="line"><span class='comment'>// The current downside is the times written to your archives will be from 1979.</span></td></tr>
<tr class="codeline" data-linenumber="173"><td class="num" id="LN173">173</td><td class="line"><span class='comment'>//#define MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="174"><td class="num" id="LN174">174</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="175"><td class="num" id="LN175">175</td><td class="line"><span class='comment'>// Define MINIZ_NO_ARCHIVE_APIS to disable all ZIP archive API's.</span></td></tr>
<tr class="codeline" data-linenumber="176"><td class="num" id="LN176">176</td><td class="line"><span class='comment'>//#define MINIZ_NO_ARCHIVE_APIS</span></td></tr>
<tr class="codeline" data-linenumber="177"><td class="num" id="LN177">177</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="178"><td class="num" id="LN178">178</td><td class="line"><span class='comment'>// Define MINIZ_NO_ARCHIVE_APIS to disable all writing related ZIP archive API's.</span></td></tr>
<tr class="codeline" data-linenumber="179"><td class="num" id="LN179">179</td><td class="line"><span class='comment'>//#define MINIZ_NO_ARCHIVE_WRITING_APIS</span></td></tr>
<tr class="codeline" data-linenumber="180"><td class="num" id="LN180">180</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="181"><td class="num" id="LN181">181</td><td class="line"><span class='comment'>// Define MINIZ_NO_ZLIB_APIS to remove all ZLIB-style compression/decompression API's.</span></td></tr>
<tr class="codeline" data-linenumber="182"><td class="num" id="LN182">182</td><td class="line"><span class='comment'>//#define MINIZ_NO_ZLIB_APIS</span></td></tr>
<tr class="codeline" data-linenumber="183"><td class="num" id="LN183">183</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="184"><td class="num" id="LN184">184</td><td class="line"><span class='comment'>// Define MINIZ_NO_ZLIB_COMPATIBLE_NAME to disable zlib names, to prevent conflicts against stock zlib.</span></td></tr>
<tr class="codeline" data-linenumber="185"><td class="num" id="LN185">185</td><td class="line"><span class='comment'>//#define MINIZ_NO_ZLIB_COMPATIBLE_NAMES</span></td></tr>
<tr class="codeline" data-linenumber="186"><td class="num" id="LN186">186</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="187"><td class="num" id="LN187">187</td><td class="line"><span class='comment'>// Define MINIZ_NO_MALLOC to disable all calls to malloc, free, and realloc.</span></td></tr>
<tr class="codeline" data-linenumber="188"><td class="num" id="LN188">188</td><td class="line"><span class='comment'>// Note if MINIZ_NO_MALLOC is defined then the user must always provide custom user alloc/free/realloc</span></td></tr>
<tr class="codeline" data-linenumber="189"><td class="num" id="LN189">189</td><td class="line"><span class='comment'>// callbacks to the zlib and archive API's, and a few stand-alone helper API's which don't provide custom user</span></td></tr>
<tr class="codeline" data-linenumber="190"><td class="num" id="LN190">190</td><td class="line"><span class='comment'>// functions (such as tdefl_compress_mem_to_heap() and tinfl_decompress_mem_to_heap()) won't work.</span></td></tr>
<tr class="codeline" data-linenumber="191"><td class="num" id="LN191">191</td><td class="line"><span class='comment'>//#define MINIZ_NO_MALLOC</span></td></tr>
<tr class="codeline" data-linenumber="192"><td class="num" id="LN192">192</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="193"><td class="num" id="LN193">193</td><td class="line"><span class='directive'>#if defined(__TINYC__) &amp;&amp; (defined(<span class='macro'>__linux<span class='macro_popup'>1</span></span>) || defined(<span class='macro'>__linux__<span class='macro_popup'>1</span></span>))</span></td></tr>
<tr class="codeline" data-linenumber="194"><td class="num" id="LN194">194</td><td class="line">  <span class='comment'>// TODO: Work around "error: include file 'sys\utime.h' when compiling with tcc on Linux</span></td></tr>
<tr class="codeline" data-linenumber="195"><td class="num" id="LN195">195</td><td class="line">  <span class='directive'>#define MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="196"><td class="num" id="LN196">196</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="197"><td class="num" id="LN197">197</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="198"><td class="num" id="LN198">198</td><td class="line"><span class='directive'>#if !defined(MINIZ_NO_TIME) &amp;&amp; !defined(MINIZ_NO_ARCHIVE_APIS)</span></td></tr>
<tr class="codeline" data-linenumber="199"><td class="num" id="LN199">199</td><td class="line">  <span class='directive'>#include &lt;time.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="200"><td class="num" id="LN200">200</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="201"><td class="num" id="LN201">201</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="202"><td class="num" id="LN202">202</td><td class="line"><span class='directive'>#if defined(_M_IX86) || defined(_M_X64) || defined(__i386__) || defined(__i386) || defined(__i486__) || defined(__i486) || defined(i386) || defined(__ia64__) || defined(<span class='macro'>__x86_64__<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="203"><td class="num" id="LN203">203</td><td class="line"><span class='comment'>// MINIZ_X86_OR_X64_CPU is only used to help set the below macros.</span></td></tr>
<tr class="codeline" data-linenumber="204"><td class="num" id="LN204">204</td><td class="line"><span class='directive'>#define <span class='macro'>MINIZ_X86_OR_X64_CPU<span class='macro_popup'>1</span></span> 1</span></td></tr>
<tr class="codeline" data-linenumber="205"><td class="num" id="LN205">205</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="206"><td class="num" id="LN206">206</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="207"><td class="num" id="LN207">207</td><td class="line"><span class='directive'>#if (<span class='macro'>__BYTE_ORDER__<span class='macro_popup'>1234</span></span>==<span class='macro'>__ORDER_LITTLE_ENDIAN__<span class='macro_popup'>1234</span></span>) || <span class='macro'>MINIZ_X86_OR_X64_CPU<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="208"><td class="num" id="LN208">208</td><td class="line"><span class='comment'>// Set MINIZ_LITTLE_ENDIAN to 1 if the processor is little endian.</span></td></tr>
<tr class="codeline" data-linenumber="209"><td class="num" id="LN209">209</td><td class="line"><span class='directive'>#define <span class='macro'>MINIZ_LITTLE_ENDIAN<span class='macro_popup'>1</span></span> 1</span></td></tr>
<tr class="codeline" data-linenumber="210"><td class="num" id="LN210">210</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="211"><td class="num" id="LN211">211</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="212"><td class="num" id="LN212">212</td><td class="line"><span class='directive'>#if <span class='macro'>MINIZ_X86_OR_X64_CPU<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="213"><td class="num" id="LN213">213</td><td class="line"><span class='comment'>// Set MINIZ_USE_UNALIGNED_LOADS_AND_STORES to 1 on CPU's that permit efficient integer loads and stores from unaligned addresses.</span></td></tr>
<tr class="codeline" data-linenumber="214"><td class="num" id="LN214">214</td><td class="line"><span class='directive'>#define <span class='macro'>MINIZ_USE_UNALIGNED_LOADS_AND_STORES<span class='macro_popup'>1</span></span> 1</span></td></tr>
<tr class="codeline" data-linenumber="215"><td class="num" id="LN215">215</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="216"><td class="num" id="LN216">216</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="217"><td class="num" id="LN217">217</td><td class="line"><span class='directive'>#if defined(_M_X64) || defined(_WIN64) || defined(__MINGW64__) || defined(<span class='macro'>_LP64<span class='macro_popup'>1</span></span>) || defined(<span class='macro'>__LP64__<span class='macro_popup'>1</span></span>) || defined(__ia64__) || defined(<span class='macro'>__x86_64__<span class='macro_popup'>1</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="218"><td class="num" id="LN218">218</td><td class="line"><span class='comment'>// Set MINIZ_HAS_64BIT_REGISTERS to 1 if operations on 64-bit integers are reasonably fast (and don't involve compiler generated calls to helper functions).</span></td></tr>
<tr class="codeline" data-linenumber="219"><td class="num" id="LN219">219</td><td class="line"><span class='directive'>#define <span class='macro'>MINIZ_HAS_64BIT_REGISTERS<span class='macro_popup'>1</span></span> 1</span></td></tr>
<tr class="codeline" data-linenumber="220"><td class="num" id="LN220">220</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="221"><td class="num" id="LN221">221</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="222"><td class="num" id="LN222">222</td><td class="line"><span class='directive'>#ifdef __cplusplus</span></td></tr>
<tr class="codeline" data-linenumber="223"><td class="num" id="LN223">223</td><td class="line"><span class='keyword'>extern</span> <span class='string_literal'>"C"</span> {</td></tr>
<tr class="codeline" data-linenumber="224"><td class="num" id="LN224">224</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="225"><td class="num" id="LN225">225</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="226"><td class="num" id="LN226">226</td><td class="line"><span class='comment'>// ------------------- zlib-style API Definitions.</span></td></tr>
<tr class="codeline" data-linenumber="227"><td class="num" id="LN227">227</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="228"><td class="num" id="LN228">228</td><td class="line"><span class='comment'>// For more compatibility with zlib, miniz.c uses unsigned long for some parameters/struct members. Beware: mz_ulong can be either 32 or 64-bits!</span></td></tr>
<tr class="codeline" data-linenumber="229"><td class="num" id="LN229">229</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>long</span> mz_ulong;</td></tr>
<tr class="codeline" data-linenumber="230"><td class="num" id="LN230">230</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="231"><td class="num" id="LN231">231</td><td class="line"><span class='comment'>// mz_free() internally uses the MZ_FREE() macro (which by default calls free() unless you've modified the MZ_MALLOC macro) to release a block allocated from the heap.</span></td></tr>
<tr class="codeline" data-linenumber="232"><td class="num" id="LN232">232</td><td class="line"><span class='keyword'>void</span> mz_free(<span class='keyword'>void</span> *p);</td></tr>
<tr class="codeline" data-linenumber="233"><td class="num" id="LN233">233</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="234"><td class="num" id="LN234">234</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_ADLER32_INIT<span class='macro_popup'>(1)</span></span> (1)</span></td></tr>
<tr class="codeline" data-linenumber="235"><td class="num" id="LN235">235</td><td class="line"><span class='comment'>// mz_adler32() returns the initial adler-32 value to use when called with ptr==NULL.</span></td></tr>
<tr class="codeline" data-linenumber="236"><td class="num" id="LN236">236</td><td class="line">mz_ulong mz_adler32(mz_ulong adler, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *ptr, size_t buf_len);</td></tr>
<tr class="codeline" data-linenumber="237"><td class="num" id="LN237">237</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="238"><td class="num" id="LN238">238</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_CRC32_INIT<span class='macro_popup'>(0)</span></span> (0)</span></td></tr>
<tr class="codeline" data-linenumber="239"><td class="num" id="LN239">239</td><td class="line"><span class='comment'>// mz_crc32() returns the initial CRC-32 value to use when called with ptr==NULL.</span></td></tr>
<tr class="codeline" data-linenumber="240"><td class="num" id="LN240">240</td><td class="line">mz_ulong mz_crc32(mz_ulong crc, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *ptr, size_t buf_len);</td></tr>
<tr class="codeline" data-linenumber="241"><td class="num" id="LN241">241</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="242"><td class="num" id="LN242">242</td><td class="line"><span class='comment'>// Compression strategies.</span></td></tr>
<tr class="codeline" data-linenumber="243"><td class="num" id="LN243">243</td><td class="line"><span class='keyword'>enum</span> { MZ_DEFAULT_STRATEGY = 0, MZ_FILTERED = 1, MZ_HUFFMAN_ONLY = 2, MZ_RLE = 3, MZ_FIXED = 4 };</td></tr>
<tr class="codeline" data-linenumber="244"><td class="num" id="LN244">244</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="245"><td class="num" id="LN245">245</td><td class="line"><span class='comment'>// Method</span></td></tr>
<tr class="codeline" data-linenumber="246"><td class="num" id="LN246">246</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_DEFLATED<span class='macro_popup'>8</span></span> 8</span></td></tr>
<tr class="codeline" data-linenumber="247"><td class="num" id="LN247">247</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="248"><td class="num" id="LN248">248</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_ZLIB_APIS</span></td></tr>
<tr class="codeline" data-linenumber="249"><td class="num" id="LN249">249</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="250"><td class="num" id="LN250">250</td><td class="line"><span class='comment'>// Heap allocation callbacks.</span></td></tr>
<tr class="codeline" data-linenumber="251"><td class="num" id="LN251">251</td><td class="line"><span class='comment'>// Note that mz_alloc_func parameter types purpsosely differ from zlib's: items/size is size_t, not unsigned long.</span></td></tr>
<tr class="codeline" data-linenumber="252"><td class="num" id="LN252">252</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>void</span> *(*mz_alloc_func)(<span class='keyword'>void</span> *opaque, size_t items, size_t size);</td></tr>
<tr class="codeline" data-linenumber="253"><td class="num" id="LN253">253</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>void</span> (*mz_free_func)(<span class='keyword'>void</span> *opaque, <span class='keyword'>void</span> *address);</td></tr>
<tr class="codeline" data-linenumber="254"><td class="num" id="LN254">254</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>void</span> *(*mz_realloc_func)(<span class='keyword'>void</span> *opaque, <span class='keyword'>void</span> *address, size_t items, size_t size);</td></tr>
<tr class="codeline" data-linenumber="255"><td class="num" id="LN255">255</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="256"><td class="num" id="LN256">256</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_VERSION<span class='macro_popup'>"9.1.15"</span></span>          "9.1.15"</span></td></tr>
<tr class="codeline" data-linenumber="257"><td class="num" id="LN257">257</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_VERNUM<span class='macro_popup'>0x91F0</span></span>           0x91F0</span></td></tr>
<tr class="codeline" data-linenumber="258"><td class="num" id="LN258">258</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_VER_MAJOR<span class='macro_popup'>9</span></span>        9</span></td></tr>
<tr class="codeline" data-linenumber="259"><td class="num" id="LN259">259</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_VER_MINOR<span class='macro_popup'>1</span></span>        1</span></td></tr>
<tr class="codeline" data-linenumber="260"><td class="num" id="LN260">260</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_VER_REVISION<span class='macro_popup'>15</span></span>     15</span></td></tr>
<tr class="codeline" data-linenumber="261"><td class="num" id="LN261">261</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_VER_SUBREVISION<span class='macro_popup'>0</span></span>  0</span></td></tr>
<tr class="codeline" data-linenumber="262"><td class="num" id="LN262">262</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="263"><td class="num" id="LN263">263</td><td class="line"><span class='comment'>// Flush values. For typical usage you only need MZ_NO_FLUSH and MZ_FINISH. The other values are for advanced use (refer to the zlib docs).</span></td></tr>
<tr class="codeline" data-linenumber="264"><td class="num" id="LN264">264</td><td class="line"><span class='keyword'>enum</span> { MZ_NO_FLUSH = 0, MZ_PARTIAL_FLUSH = 1, MZ_SYNC_FLUSH = 2, MZ_FULL_FLUSH = 3, MZ_FINISH = 4, MZ_BLOCK = 5 };</td></tr>
<tr class="codeline" data-linenumber="265"><td class="num" id="LN265">265</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="266"><td class="num" id="LN266">266</td><td class="line"><span class='comment'>// Return status codes. MZ_PARAM_ERROR is non-standard.</span></td></tr>
<tr class="codeline" data-linenumber="267"><td class="num" id="LN267">267</td><td class="line"><span class='keyword'>enum</span> { MZ_OK = 0, MZ_STREAM_END = 1, MZ_NEED_DICT = 2, MZ_ERRNO = -1, MZ_STREAM_ERROR = -2, MZ_DATA_ERROR = -3, MZ_MEM_ERROR = -4, MZ_BUF_ERROR = -5, MZ_VERSION_ERROR = -6, MZ_PARAM_ERROR = -10000 };</td></tr>
<tr class="codeline" data-linenumber="268"><td class="num" id="LN268">268</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="269"><td class="num" id="LN269">269</td><td class="line"><span class='comment'>// Compression levels: 0-9 are the standard zlib-style levels, 10 is best possible compression (not zlib compatible, and may be very slow), MZ_DEFAULT_COMPRESSION=MZ_DEFAULT_LEVEL.</span></td></tr>
<tr class="codeline" data-linenumber="270"><td class="num" id="LN270">270</td><td class="line"><span class='keyword'>enum</span> { MZ_NO_COMPRESSION = 0, MZ_BEST_SPEED = 1, MZ_BEST_COMPRESSION = 9, MZ_UBER_COMPRESSION = 10, MZ_DEFAULT_LEVEL = 6, MZ_DEFAULT_COMPRESSION = -1 };</td></tr>
<tr class="codeline" data-linenumber="271"><td class="num" id="LN271">271</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="272"><td class="num" id="LN272">272</td><td class="line"><span class='comment'>// Window bits</span></td></tr>
<tr class="codeline" data-linenumber="273"><td class="num" id="LN273">273</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_DEFAULT_WINDOW_BITS<span class='macro_popup'>15</span></span> 15</span></td></tr>
<tr class="codeline" data-linenumber="274"><td class="num" id="LN274">274</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="275"><td class="num" id="LN275">275</td><td class="line"><span class='keyword'>struct</span> mz_internal_state;</td></tr>
<tr class="codeline" data-linenumber="276"><td class="num" id="LN276">276</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="277"><td class="num" id="LN277">277</td><td class="line"><span class='comment'>// Compression/decompression stream struct.</span></td></tr>
<tr class="codeline" data-linenumber="278"><td class="num" id="LN278">278</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span> mz_stream_s</td></tr>
<tr class="codeline" data-linenumber="279"><td class="num" id="LN279">279</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="280"><td class="num" id="LN280">280</td><td class="line">  <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *next_in;     <span class='comment'>// pointer to next byte to read</span></td></tr>
<tr class="codeline" data-linenumber="281"><td class="num" id="LN281">281</td><td class="line">  <span class='keyword'>unsigned</span> <span class='keyword'>int</span> avail_in;            <span class='comment'>// number of bytes available at next_in</span></td></tr>
<tr class="codeline" data-linenumber="282"><td class="num" id="LN282">282</td><td class="line">  mz_ulong total_in;                <span class='comment'>// total number of bytes consumed so far</span></td></tr>
<tr class="codeline" data-linenumber="283"><td class="num" id="LN283">283</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="284"><td class="num" id="LN284">284</td><td class="line">  <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *next_out;          <span class='comment'>// pointer to next byte to write</span></td></tr>
<tr class="codeline" data-linenumber="285"><td class="num" id="LN285">285</td><td class="line">  <span class='keyword'>unsigned</span> <span class='keyword'>int</span> avail_out;           <span class='comment'>// number of bytes that can be written to next_out</span></td></tr>
<tr class="codeline" data-linenumber="286"><td class="num" id="LN286">286</td><td class="line">  mz_ulong total_out;               <span class='comment'>// total number of bytes produced so far</span></td></tr>
<tr class="codeline" data-linenumber="287"><td class="num" id="LN287">287</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="288"><td class="num" id="LN288">288</td><td class="line">  <span class='keyword'>char</span> *msg;                        <span class='comment'>// error msg (unused)</span></td></tr>
<tr class="codeline" data-linenumber="289"><td class="num" id="LN289">289</td><td class="line">  <span class='keyword'>struct</span> mz_internal_state *state;  <span class='comment'>// internal state, allocated by zalloc/zfree</span></td></tr>
<tr class="codeline" data-linenumber="290"><td class="num" id="LN290">290</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="291"><td class="num" id="LN291">291</td><td class="line">  mz_alloc_func zalloc;             <span class='comment'>// optional heap allocation function (defaults to malloc)</span></td></tr>
<tr class="codeline" data-linenumber="292"><td class="num" id="LN292">292</td><td class="line">  mz_free_func zfree;               <span class='comment'>// optional heap free function (defaults to free)</span></td></tr>
<tr class="codeline" data-linenumber="293"><td class="num" id="LN293">293</td><td class="line">  <span class='keyword'>void</span> *opaque;                     <span class='comment'>// heap alloc function user pointer</span></td></tr>
<tr class="codeline" data-linenumber="294"><td class="num" id="LN294">294</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="295"><td class="num" id="LN295">295</td><td class="line">  <span class='keyword'>int</span> data_type;                    <span class='comment'>// data_type (unused)</span></td></tr>
<tr class="codeline" data-linenumber="296"><td class="num" id="LN296">296</td><td class="line">  mz_ulong adler;                   <span class='comment'>// adler32 of the source or uncompressed data</span></td></tr>
<tr class="codeline" data-linenumber="297"><td class="num" id="LN297">297</td><td class="line">  mz_ulong reserved;                <span class='comment'>// not used</span></td></tr>
<tr class="codeline" data-linenumber="298"><td class="num" id="LN298">298</td><td class="line">} mz_stream;</td></tr>
<tr class="codeline" data-linenumber="299"><td class="num" id="LN299">299</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="300"><td class="num" id="LN300">300</td><td class="line"><span class='keyword'>typedef</span> mz_stream *mz_streamp;</td></tr>
<tr class="codeline" data-linenumber="301"><td class="num" id="LN301">301</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="302"><td class="num" id="LN302">302</td><td class="line"><span class='comment'>// Returns the version string of miniz.c.</span></td></tr>
<tr class="codeline" data-linenumber="303"><td class="num" id="LN303">303</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>char</span> *mz_version(<span class='keyword'>void</span>);</td></tr>
<tr class="codeline" data-linenumber="304"><td class="num" id="LN304">304</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="305"><td class="num" id="LN305">305</td><td class="line"><span class='comment'>// mz_deflateInit() initializes a compressor with default options:</span></td></tr>
<tr class="codeline" data-linenumber="306"><td class="num" id="LN306">306</td><td class="line"><span class='comment'>// Parameters:</span></td></tr>
<tr class="codeline" data-linenumber="307"><td class="num" id="LN307">307</td><td class="line"><span class='comment'>//  pStream must point to an initialized mz_stream struct.</span></td></tr>
<tr class="codeline" data-linenumber="308"><td class="num" id="LN308">308</td><td class="line"><span class='comment'>//  level must be between [MZ_NO_COMPRESSION, MZ_BEST_COMPRESSION].</span></td></tr>
<tr class="codeline" data-linenumber="309"><td class="num" id="LN309">309</td><td class="line"><span class='comment'>//  level 1 enables a specially optimized compression function that's been optimized purely for performance, not ratio.</span></td></tr>
<tr class="codeline" data-linenumber="310"><td class="num" id="LN310">310</td><td class="line"><span class='comment'>//  (This special func. is currently only enabled when MINIZ_USE_UNALIGNED_LOADS_AND_STORES and MINIZ_LITTLE_ENDIAN are defined.)</span></td></tr>
<tr class="codeline" data-linenumber="311"><td class="num" id="LN311">311</td><td class="line"><span class='comment'>// Return values:</span></td></tr>
<tr class="codeline" data-linenumber="312"><td class="num" id="LN312">312</td><td class="line"><span class='comment'>//  MZ_OK on success.</span></td></tr>
<tr class="codeline" data-linenumber="313"><td class="num" id="LN313">313</td><td class="line"><span class='comment'>//  MZ_STREAM_ERROR if the stream is bogus.</span></td></tr>
<tr class="codeline" data-linenumber="314"><td class="num" id="LN314">314</td><td class="line"><span class='comment'>//  MZ_PARAM_ERROR if the input parameters are bogus.</span></td></tr>
<tr class="codeline" data-linenumber="315"><td class="num" id="LN315">315</td><td class="line"><span class='comment'>//  MZ_MEM_ERROR on out of memory.</span></td></tr>
<tr class="codeline" data-linenumber="316"><td class="num" id="LN316">316</td><td class="line"><span class='keyword'>int</span> mz_deflateInit(mz_streamp pStream, <span class='keyword'>int</span> level);</td></tr>
<tr class="codeline" data-linenumber="317"><td class="num" id="LN317">317</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="318"><td class="num" id="LN318">318</td><td class="line"><span class='comment'>// mz_deflateInit2() is like mz_deflate(), except with more control:</span></td></tr>
<tr class="codeline" data-linenumber="319"><td class="num" id="LN319">319</td><td class="line"><span class='comment'>// Additional parameters:</span></td></tr>
<tr class="codeline" data-linenumber="320"><td class="num" id="LN320">320</td><td class="line"><span class='comment'>//   method must be MZ_DEFLATED</span></td></tr>
<tr class="codeline" data-linenumber="321"><td class="num" id="LN321">321</td><td class="line"><span class='comment'>//   window_bits must be MZ_DEFAULT_WINDOW_BITS (to wrap the deflate stream with zlib header/adler-32 footer) or -MZ_DEFAULT_WINDOW_BITS (raw deflate/no header or footer)</span></td></tr>
<tr class="codeline" data-linenumber="322"><td class="num" id="LN322">322</td><td class="line"><span class='comment'>//   mem_level must be between [1, 9] (it's checked but ignored by miniz.c)</span></td></tr>
<tr class="codeline" data-linenumber="323"><td class="num" id="LN323">323</td><td class="line"><span class='keyword'>int</span> mz_deflateInit2(mz_streamp pStream, <span class='keyword'>int</span> level, <span class='keyword'>int</span> method, <span class='keyword'>int</span> window_bits, <span class='keyword'>int</span> mem_level, <span class='keyword'>int</span> strategy);</td></tr>
<tr class="codeline" data-linenumber="324"><td class="num" id="LN324">324</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="325"><td class="num" id="LN325">325</td><td class="line"><span class='comment'>// Quickly resets a compressor without having to reallocate anything. Same as calling mz_deflateEnd() followed by mz_deflateInit()/mz_deflateInit2().</span></td></tr>
<tr class="codeline" data-linenumber="326"><td class="num" id="LN326">326</td><td class="line"><span class='keyword'>int</span> mz_deflateReset(mz_streamp pStream);</td></tr>
<tr class="codeline" data-linenumber="327"><td class="num" id="LN327">327</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="328"><td class="num" id="LN328">328</td><td class="line"><span class='comment'>// mz_deflate() compresses the input to output, consuming as much of the input and producing as much output as possible.</span></td></tr>
<tr class="codeline" data-linenumber="329"><td class="num" id="LN329">329</td><td class="line"><span class='comment'>// Parameters:</span></td></tr>
<tr class="codeline" data-linenumber="330"><td class="num" id="LN330">330</td><td class="line"><span class='comment'>//   pStream is the stream to read from and write to. You must initialize/update the next_in, avail_in, next_out, and avail_out members.</span></td></tr>
<tr class="codeline" data-linenumber="331"><td class="num" id="LN331">331</td><td class="line"><span class='comment'>//   flush may be MZ_NO_FLUSH, MZ_PARTIAL_FLUSH/MZ_SYNC_FLUSH, MZ_FULL_FLUSH, or MZ_FINISH.</span></td></tr>
<tr class="codeline" data-linenumber="332"><td class="num" id="LN332">332</td><td class="line"><span class='comment'>// Return values:</span></td></tr>
<tr class="codeline" data-linenumber="333"><td class="num" id="LN333">333</td><td class="line"><span class='comment'>//   MZ_OK on success (when flushing, or if more input is needed but not available, and/or there's more output to be written but the output buffer is full).</span></td></tr>
<tr class="codeline" data-linenumber="334"><td class="num" id="LN334">334</td><td class="line"><span class='comment'>//   MZ_STREAM_END if all input has been consumed and all output bytes have been written. Don't call mz_deflate() on the stream anymore.</span></td></tr>
<tr class="codeline" data-linenumber="335"><td class="num" id="LN335">335</td><td class="line"><span class='comment'>//   MZ_STREAM_ERROR if the stream is bogus.</span></td></tr>
<tr class="codeline" data-linenumber="336"><td class="num" id="LN336">336</td><td class="line"><span class='comment'>//   MZ_PARAM_ERROR if one of the parameters is invalid.</span></td></tr>
<tr class="codeline" data-linenumber="337"><td class="num" id="LN337">337</td><td class="line"><span class='comment'>//   MZ_BUF_ERROR if no forward progress is possible because the input and/or output buffers are empty. (Fill up the input buffer or free up some output space and try again.)</span></td></tr>
<tr class="codeline" data-linenumber="338"><td class="num" id="LN338">338</td><td class="line"><span class='keyword'>int</span> mz_deflate(mz_streamp pStream, <span class='keyword'>int</span> flush);</td></tr>
<tr class="codeline" data-linenumber="339"><td class="num" id="LN339">339</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="340"><td class="num" id="LN340">340</td><td class="line"><span class='comment'>// mz_deflateEnd() deinitializes a compressor:</span></td></tr>
<tr class="codeline" data-linenumber="341"><td class="num" id="LN341">341</td><td class="line"><span class='comment'>// Return values:</span></td></tr>
<tr class="codeline" data-linenumber="342"><td class="num" id="LN342">342</td><td class="line"><span class='comment'>//  MZ_OK on success.</span></td></tr>
<tr class="codeline" data-linenumber="343"><td class="num" id="LN343">343</td><td class="line"><span class='comment'>//  MZ_STREAM_ERROR if the stream is bogus.</span></td></tr>
<tr class="codeline" data-linenumber="344"><td class="num" id="LN344">344</td><td class="line"><span class='keyword'>int</span> mz_deflateEnd(mz_streamp pStream);</td></tr>
<tr class="codeline" data-linenumber="345"><td class="num" id="LN345">345</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="346"><td class="num" id="LN346">346</td><td class="line"><span class='comment'>// mz_deflateBound() returns a (very) conservative upper bound on the amount of data that could be generated by deflate(), assuming flush is set to only MZ_NO_FLUSH or MZ_FINISH.</span></td></tr>
<tr class="codeline" data-linenumber="347"><td class="num" id="LN347">347</td><td class="line">mz_ulong mz_deflateBound(mz_streamp pStream, mz_ulong source_len);</td></tr>
<tr class="codeline" data-linenumber="348"><td class="num" id="LN348">348</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="349"><td class="num" id="LN349">349</td><td class="line"><span class='comment'>// Single-call compression functions mz_compress() and mz_compress2():</span></td></tr>
<tr class="codeline" data-linenumber="350"><td class="num" id="LN350">350</td><td class="line"><span class='comment'>// Returns MZ_OK on success, or one of the error codes from mz_deflate() on failure.</span></td></tr>
<tr class="codeline" data-linenumber="351"><td class="num" id="LN351">351</td><td class="line"><span class='keyword'>int</span> mz_compress(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pDest, mz_ulong *pDest_len, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pSource, mz_ulong source_len);</td></tr>
<tr class="codeline" data-linenumber="352"><td class="num" id="LN352">352</td><td class="line"><span class='keyword'>int</span> mz_compress2(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pDest, mz_ulong *pDest_len, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pSource, mz_ulong source_len, <span class='keyword'>int</span> level);</td></tr>
<tr class="codeline" data-linenumber="353"><td class="num" id="LN353">353</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="354"><td class="num" id="LN354">354</td><td class="line"><span class='comment'>// mz_compressBound() returns a (very) conservative upper bound on the amount of data that could be generated by calling mz_compress().</span></td></tr>
<tr class="codeline" data-linenumber="355"><td class="num" id="LN355">355</td><td class="line">mz_ulong mz_compressBound(mz_ulong source_len);</td></tr>
<tr class="codeline" data-linenumber="356"><td class="num" id="LN356">356</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="357"><td class="num" id="LN357">357</td><td class="line"><span class='comment'>// Initializes a decompressor.</span></td></tr>
<tr class="codeline" data-linenumber="358"><td class="num" id="LN358">358</td><td class="line"><span class='keyword'>int</span> mz_inflateInit(mz_streamp pStream);</td></tr>
<tr class="codeline" data-linenumber="359"><td class="num" id="LN359">359</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="360"><td class="num" id="LN360">360</td><td class="line"><span class='comment'>// mz_inflateInit2() is like mz_inflateInit() with an additional option that controls the window size and whether or not the stream has been wrapped with a zlib header/footer:</span></td></tr>
<tr class="codeline" data-linenumber="361"><td class="num" id="LN361">361</td><td class="line"><span class='comment'>// window_bits must be MZ_DEFAULT_WINDOW_BITS (to parse zlib header/footer) or -MZ_DEFAULT_WINDOW_BITS (raw deflate).</span></td></tr>
<tr class="codeline" data-linenumber="362"><td class="num" id="LN362">362</td><td class="line"><span class='keyword'>int</span> mz_inflateInit2(mz_streamp pStream, <span class='keyword'>int</span> window_bits);</td></tr>
<tr class="codeline" data-linenumber="363"><td class="num" id="LN363">363</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="364"><td class="num" id="LN364">364</td><td class="line"><span class='comment'>// Decompresses the input stream to the output, consuming only as much of the input as needed, and writing as much to the output as possible.</span></td></tr>
<tr class="codeline" data-linenumber="365"><td class="num" id="LN365">365</td><td class="line"><span class='comment'>// Parameters:</span></td></tr>
<tr class="codeline" data-linenumber="366"><td class="num" id="LN366">366</td><td class="line"><span class='comment'>//   pStream is the stream to read from and write to. You must initialize/update the next_in, avail_in, next_out, and avail_out members.</span></td></tr>
<tr class="codeline" data-linenumber="367"><td class="num" id="LN367">367</td><td class="line"><span class='comment'>//   flush may be MZ_NO_FLUSH, MZ_SYNC_FLUSH, or MZ_FINISH.</span></td></tr>
<tr class="codeline" data-linenumber="368"><td class="num" id="LN368">368</td><td class="line"><span class='comment'>//   On the first call, if flush is MZ_FINISH it's assumed the input and output buffers are both sized large enough to decompress the entire stream in a single call (this is slightly faster).</span></td></tr>
<tr class="codeline" data-linenumber="369"><td class="num" id="LN369">369</td><td class="line"><span class='comment'>//   MZ_FINISH implies that there are no more source bytes available beside what's already in the input buffer, and that the output buffer is large enough to hold the rest of the decompressed data.</span></td></tr>
<tr class="codeline" data-linenumber="370"><td class="num" id="LN370">370</td><td class="line"><span class='comment'>// Return values:</span></td></tr>
<tr class="codeline" data-linenumber="371"><td class="num" id="LN371">371</td><td class="line"><span class='comment'>//   MZ_OK on success. Either more input is needed but not available, and/or there's more output to be written but the output buffer is full.</span></td></tr>
<tr class="codeline" data-linenumber="372"><td class="num" id="LN372">372</td><td class="line"><span class='comment'>//   MZ_STREAM_END if all needed input has been consumed and all output bytes have been written. For zlib streams, the adler-32 of the decompressed data has also been verified.</span></td></tr>
<tr class="codeline" data-linenumber="373"><td class="num" id="LN373">373</td><td class="line"><span class='comment'>//   MZ_STREAM_ERROR if the stream is bogus.</span></td></tr>
<tr class="codeline" data-linenumber="374"><td class="num" id="LN374">374</td><td class="line"><span class='comment'>//   MZ_DATA_ERROR if the deflate stream is invalid.</span></td></tr>
<tr class="codeline" data-linenumber="375"><td class="num" id="LN375">375</td><td class="line"><span class='comment'>//   MZ_PARAM_ERROR if one of the parameters is invalid.</span></td></tr>
<tr class="codeline" data-linenumber="376"><td class="num" id="LN376">376</td><td class="line"><span class='comment'>//   MZ_BUF_ERROR if no forward progress is possible because the input buffer is empty but the inflater needs more input to continue, or if the output buffer is not large enough. Call mz_inflate() again</span></td></tr>
<tr class="codeline" data-linenumber="377"><td class="num" id="LN377">377</td><td class="line"><span class='comment'>//   with more input data, or with more room in the output buffer (except when using single call decompression, described above).</span></td></tr>
<tr class="codeline" data-linenumber="378"><td class="num" id="LN378">378</td><td class="line"><span class='keyword'>int</span> mz_inflate(mz_streamp pStream, <span class='keyword'>int</span> flush);</td></tr>
<tr class="codeline" data-linenumber="379"><td class="num" id="LN379">379</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="380"><td class="num" id="LN380">380</td><td class="line"><span class='comment'>// Deinitializes a decompressor.</span></td></tr>
<tr class="codeline" data-linenumber="381"><td class="num" id="LN381">381</td><td class="line"><span class='keyword'>int</span> mz_inflateEnd(mz_streamp pStream);</td></tr>
<tr class="codeline" data-linenumber="382"><td class="num" id="LN382">382</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="383"><td class="num" id="LN383">383</td><td class="line"><span class='comment'>// Single-call decompression.</span></td></tr>
<tr class="codeline" data-linenumber="384"><td class="num" id="LN384">384</td><td class="line"><span class='comment'>// Returns MZ_OK on success, or one of the error codes from mz_inflate() on failure.</span></td></tr>
<tr class="codeline" data-linenumber="385"><td class="num" id="LN385">385</td><td class="line"><span class='keyword'>int</span> mz_uncompress(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pDest, mz_ulong *pDest_len, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pSource, mz_ulong source_len);</td></tr>
<tr class="codeline" data-linenumber="386"><td class="num" id="LN386">386</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="387"><td class="num" id="LN387">387</td><td class="line"><span class='comment'>// Returns a string description of the specified error code, or NULL if the error code is invalid.</span></td></tr>
<tr class="codeline" data-linenumber="388"><td class="num" id="LN388">388</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>char</span> *mz_error(<span class='keyword'>int</span> err);</td></tr>
<tr class="codeline" data-linenumber="389"><td class="num" id="LN389">389</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="390"><td class="num" id="LN390">390</td><td class="line"><span class='comment'>// Redefine zlib-compatible names to miniz equivalents, so miniz.c can be used as a drop-in replacement for the subset of zlib that miniz.c supports.</span></td></tr>
<tr class="codeline" data-linenumber="391"><td class="num" id="LN391">391</td><td class="line"><span class='comment'>// Define MINIZ_NO_ZLIB_COMPATIBLE_NAMES to disable zlib-compatibility if you use zlib in the same project.</span></td></tr>
<tr class="codeline" data-linenumber="392"><td class="num" id="LN392">392</td><td class="line"><span class='directive'>#ifndef <span class='macro'>MINIZ_NO_ZLIB_COMPATIBLE_NAMES<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="393"><td class="num" id="LN393">393</td><td class="line">  <span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> Byte;</td></tr>
<tr class="codeline" data-linenumber="394"><td class="num" id="LN394">394</td><td class="line">  <span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> uInt;</td></tr>
<tr class="codeline" data-linenumber="395"><td class="num" id="LN395">395</td><td class="line">  <span class='keyword'>typedef</span> mz_ulong uLong;</td></tr>
<tr class="codeline" data-linenumber="396"><td class="num" id="LN396">396</td><td class="line">  <span class='keyword'>typedef</span> Byte Bytef;</td></tr>
<tr class="codeline" data-linenumber="397"><td class="num" id="LN397">397</td><td class="line">  <span class='keyword'>typedef</span> uInt uIntf;</td></tr>
<tr class="codeline" data-linenumber="398"><td class="num" id="LN398">398</td><td class="line">  <span class='keyword'>typedef</span> <span class='keyword'>char</span> charf;</td></tr>
<tr class="codeline" data-linenumber="399"><td class="num" id="LN399">399</td><td class="line">  <span class='keyword'>typedef</span> <span class='keyword'>int</span> intf;</td></tr>
<tr class="codeline" data-linenumber="400"><td class="num" id="LN400">400</td><td class="line">  <span class='keyword'>typedef</span> <span class='keyword'>void</span> *voidpf;</td></tr>
<tr class="codeline" data-linenumber="401"><td class="num" id="LN401">401</td><td class="line">  <span class='keyword'>typedef</span> uLong uLongf;</td></tr>
<tr class="codeline" data-linenumber="402"><td class="num" id="LN402">402</td><td class="line">  <span class='keyword'>typedef</span> <span class='keyword'>void</span> *voidp;</td></tr>
<tr class="codeline" data-linenumber="403"><td class="num" id="LN403">403</td><td class="line">  <span class='keyword'>typedef</span> <span class='keyword'>void</span> *<span class='keyword'>const</span> voidpc;</td></tr>
<tr class="codeline" data-linenumber="404"><td class="num" id="LN404">404</td><td class="line">  <span class='directive'>#define Z_NULL                0</span></td></tr>
<tr class="codeline" data-linenumber="405"><td class="num" id="LN405">405</td><td class="line">  <span class='directive'>#define Z_NO_FLUSH            MZ_NO_FLUSH</span></td></tr>
<tr class="codeline" data-linenumber="406"><td class="num" id="LN406">406</td><td class="line">  <span class='directive'>#define Z_PARTIAL_FLUSH       MZ_PARTIAL_FLUSH</span></td></tr>
<tr class="codeline" data-linenumber="407"><td class="num" id="LN407">407</td><td class="line">  <span class='directive'>#define Z_SYNC_FLUSH          MZ_SYNC_FLUSH</span></td></tr>
<tr class="codeline" data-linenumber="408"><td class="num" id="LN408">408</td><td class="line">  <span class='directive'>#define Z_FULL_FLUSH          MZ_FULL_FLUSH</span></td></tr>
<tr class="codeline" data-linenumber="409"><td class="num" id="LN409">409</td><td class="line">  <span class='directive'>#define Z_FINISH              MZ_FINISH</span></td></tr>
<tr class="codeline" data-linenumber="410"><td class="num" id="LN410">410</td><td class="line">  <span class='directive'>#define Z_BLOCK               MZ_BLOCK</span></td></tr>
<tr class="codeline" data-linenumber="411"><td class="num" id="LN411">411</td><td class="line">  <span class='directive'>#define Z_OK                  MZ_OK</span></td></tr>
<tr class="codeline" data-linenumber="412"><td class="num" id="LN412">412</td><td class="line">  <span class='directive'>#define Z_STREAM_END          MZ_STREAM_END</span></td></tr>
<tr class="codeline" data-linenumber="413"><td class="num" id="LN413">413</td><td class="line">  <span class='directive'>#define Z_NEED_DICT           MZ_NEED_DICT</span></td></tr>
<tr class="codeline" data-linenumber="414"><td class="num" id="LN414">414</td><td class="line">  <span class='directive'>#define Z_ERRNO               MZ_ERRNO</span></td></tr>
<tr class="codeline" data-linenumber="415"><td class="num" id="LN415">415</td><td class="line">  <span class='directive'>#define Z_STREAM_ERROR        MZ_STREAM_ERROR</span></td></tr>
<tr class="codeline" data-linenumber="416"><td class="num" id="LN416">416</td><td class="line">  <span class='directive'>#define Z_DATA_ERROR          MZ_DATA_ERROR</span></td></tr>
<tr class="codeline" data-linenumber="417"><td class="num" id="LN417">417</td><td class="line">  <span class='directive'>#define Z_MEM_ERROR           MZ_MEM_ERROR</span></td></tr>
<tr class="codeline" data-linenumber="418"><td class="num" id="LN418">418</td><td class="line">  <span class='directive'>#define Z_BUF_ERROR           MZ_BUF_ERROR</span></td></tr>
<tr class="codeline" data-linenumber="419"><td class="num" id="LN419">419</td><td class="line">  <span class='directive'>#define Z_VERSION_ERROR       MZ_VERSION_ERROR</span></td></tr>
<tr class="codeline" data-linenumber="420"><td class="num" id="LN420">420</td><td class="line">  <span class='directive'>#define Z_PARAM_ERROR         MZ_PARAM_ERROR</span></td></tr>
<tr class="codeline" data-linenumber="421"><td class="num" id="LN421">421</td><td class="line">  <span class='directive'>#define Z_NO_COMPRESSION      MZ_NO_COMPRESSION</span></td></tr>
<tr class="codeline" data-linenumber="422"><td class="num" id="LN422">422</td><td class="line">  <span class='directive'>#define Z_BEST_SPEED          MZ_BEST_SPEED</span></td></tr>
<tr class="codeline" data-linenumber="423"><td class="num" id="LN423">423</td><td class="line">  <span class='directive'>#define Z_BEST_COMPRESSION    MZ_BEST_COMPRESSION</span></td></tr>
<tr class="codeline" data-linenumber="424"><td class="num" id="LN424">424</td><td class="line">  <span class='directive'>#define Z_DEFAULT_COMPRESSION MZ_DEFAULT_COMPRESSION</span></td></tr>
<tr class="codeline" data-linenumber="425"><td class="num" id="LN425">425</td><td class="line">  <span class='directive'>#define Z_DEFAULT_STRATEGY    MZ_DEFAULT_STRATEGY</span></td></tr>
<tr class="codeline" data-linenumber="426"><td class="num" id="LN426">426</td><td class="line">  <span class='directive'>#define Z_FILTERED            MZ_FILTERED</span></td></tr>
<tr class="codeline" data-linenumber="427"><td class="num" id="LN427">427</td><td class="line">  <span class='directive'>#define Z_HUFFMAN_ONLY        MZ_HUFFMAN_ONLY</span></td></tr>
<tr class="codeline" data-linenumber="428"><td class="num" id="LN428">428</td><td class="line">  <span class='directive'>#define Z_RLE                 MZ_RLE</span></td></tr>
<tr class="codeline" data-linenumber="429"><td class="num" id="LN429">429</td><td class="line">  <span class='directive'>#define Z_FIXED               MZ_FIXED</span></td></tr>
<tr class="codeline" data-linenumber="430"><td class="num" id="LN430">430</td><td class="line">  <span class='directive'>#define Z_DEFLATED            <span class='macro'>MZ_DEFLATED<span class='macro_popup'>8</span></span></span></td></tr>
<tr class="codeline" data-linenumber="431"><td class="num" id="LN431">431</td><td class="line">  <span class='directive'>#define Z_DEFAULT_WINDOW_BITS <span class='macro'>MZ_DEFAULT_WINDOW_BITS<span class='macro_popup'>15</span></span></span></td></tr>
<tr class="codeline" data-linenumber="432"><td class="num" id="LN432">432</td><td class="line">  <span class='directive'>#define alloc_func            mz_alloc_func</span></td></tr>
<tr class="codeline" data-linenumber="433"><td class="num" id="LN433">433</td><td class="line">  <span class='directive'>#define free_func             mz_free_func</span></td></tr>
<tr class="codeline" data-linenumber="434"><td class="num" id="LN434">434</td><td class="line">  <span class='directive'>#define internal_state        mz_internal_state</span></td></tr>
<tr class="codeline" data-linenumber="435"><td class="num" id="LN435">435</td><td class="line">  <span class='directive'>#define z_stream              mz_stream</span></td></tr>
<tr class="codeline" data-linenumber="436"><td class="num" id="LN436">436</td><td class="line">  <span class='directive'>#define deflateInit           mz_deflateInit</span></td></tr>
<tr class="codeline" data-linenumber="437"><td class="num" id="LN437">437</td><td class="line">  <span class='directive'>#define deflateInit2          mz_deflateInit2</span></td></tr>
<tr class="codeline" data-linenumber="438"><td class="num" id="LN438">438</td><td class="line">  <span class='directive'>#define deflateReset          mz_deflateReset</span></td></tr>
<tr class="codeline" data-linenumber="439"><td class="num" id="LN439">439</td><td class="line">  <span class='directive'>#define deflate               mz_deflate</span></td></tr>
<tr class="codeline" data-linenumber="440"><td class="num" id="LN440">440</td><td class="line">  <span class='directive'>#define deflateEnd            mz_deflateEnd</span></td></tr>
<tr class="codeline" data-linenumber="441"><td class="num" id="LN441">441</td><td class="line">  <span class='directive'>#define deflateBound          mz_deflateBound</span></td></tr>
<tr class="codeline" data-linenumber="442"><td class="num" id="LN442">442</td><td class="line">  <span class='directive'>#define compress              mz_compress</span></td></tr>
<tr class="codeline" data-linenumber="443"><td class="num" id="LN443">443</td><td class="line">  <span class='directive'>#define compress2             mz_compress2</span></td></tr>
<tr class="codeline" data-linenumber="444"><td class="num" id="LN444">444</td><td class="line">  <span class='directive'>#define compressBound         mz_compressBound</span></td></tr>
<tr class="codeline" data-linenumber="445"><td class="num" id="LN445">445</td><td class="line">  <span class='directive'>#define inflateInit           mz_inflateInit</span></td></tr>
<tr class="codeline" data-linenumber="446"><td class="num" id="LN446">446</td><td class="line">  <span class='directive'>#define inflateInit2          mz_inflateInit2</span></td></tr>
<tr class="codeline" data-linenumber="447"><td class="num" id="LN447">447</td><td class="line">  <span class='directive'>#define inflate               mz_inflate</span></td></tr>
<tr class="codeline" data-linenumber="448"><td class="num" id="LN448">448</td><td class="line">  <span class='directive'>#define inflateEnd            mz_inflateEnd</span></td></tr>
<tr class="codeline" data-linenumber="449"><td class="num" id="LN449">449</td><td class="line">  <span class='directive'>#define uncompress            mz_uncompress</span></td></tr>
<tr class="codeline" data-linenumber="450"><td class="num" id="LN450">450</td><td class="line">  <span class='directive'>#define crc32                 mz_crc32</span></td></tr>
<tr class="codeline" data-linenumber="451"><td class="num" id="LN451">451</td><td class="line">  <span class='directive'>#define adler32               mz_adler32</span></td></tr>
<tr class="codeline" data-linenumber="452"><td class="num" id="LN452">452</td><td class="line">  <span class='directive'>#define MAX_WBITS             15</span></td></tr>
<tr class="codeline" data-linenumber="453"><td class="num" id="LN453">453</td><td class="line">  <span class='directive'>#define MAX_MEM_LEVEL         9</span></td></tr>
<tr class="codeline" data-linenumber="454"><td class="num" id="LN454">454</td><td class="line">  <span class='directive'>#define zError                mz_error</span></td></tr>
<tr class="codeline" data-linenumber="455"><td class="num" id="LN455">455</td><td class="line">  <span class='directive'>#define ZLIB_VERSION          <span class='macro'>MZ_VERSION<span class='macro_popup'>"9.1.15"</span></span></span></td></tr>
<tr class="codeline" data-linenumber="456"><td class="num" id="LN456">456</td><td class="line">  <span class='directive'>#define ZLIB_VERNUM           <span class='macro'>MZ_VERNUM<span class='macro_popup'>0x91F0</span></span></span></td></tr>
<tr class="codeline" data-linenumber="457"><td class="num" id="LN457">457</td><td class="line">  <span class='directive'>#define ZLIB_VER_MAJOR        <span class='macro'>MZ_VER_MAJOR<span class='macro_popup'>9</span></span></span></td></tr>
<tr class="codeline" data-linenumber="458"><td class="num" id="LN458">458</td><td class="line">  <span class='directive'>#define ZLIB_VER_MINOR        <span class='macro'>MZ_VER_MINOR<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="459"><td class="num" id="LN459">459</td><td class="line">  <span class='directive'>#define ZLIB_VER_REVISION     <span class='macro'>MZ_VER_REVISION<span class='macro_popup'>15</span></span></span></td></tr>
<tr class="codeline" data-linenumber="460"><td class="num" id="LN460">460</td><td class="line">  <span class='directive'>#define ZLIB_VER_SUBREVISION  <span class='macro'>MZ_VER_SUBREVISION<span class='macro_popup'>0</span></span></span></td></tr>
<tr class="codeline" data-linenumber="461"><td class="num" id="LN461">461</td><td class="line">  <span class='directive'>#define zlibVersion           mz_version</span></td></tr>
<tr class="codeline" data-linenumber="462"><td class="num" id="LN462">462</td><td class="line">  <span class='directive'>#define zlib_version          mz_version()</span></td></tr>
<tr class="codeline" data-linenumber="463"><td class="num" id="LN463">463</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_ZLIB_COMPATIBLE_NAMES</span></td></tr>
<tr class="codeline" data-linenumber="464"><td class="num" id="LN464">464</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="465"><td class="num" id="LN465">465</td><td class="line"><span class='directive'>#endif // MINIZ_NO_ZLIB_APIS</span></td></tr>
<tr class="codeline" data-linenumber="466"><td class="num" id="LN466">466</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="467"><td class="num" id="LN467">467</td><td class="line"><span class='comment'>// ------------------- Types and macros</span></td></tr>
<tr class="codeline" data-linenumber="468"><td class="num" id="LN468">468</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="469"><td class="num" id="LN469">469</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> mz_uint8;</td></tr>
<tr class="codeline" data-linenumber="470"><td class="num" id="LN470">470</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>signed</span> <span class='keyword'>short</span> mz_int16;</td></tr>
<tr class="codeline" data-linenumber="471"><td class="num" id="LN471">471</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>short</span> mz_uint16;</td></tr>
<tr class="codeline" data-linenumber="472"><td class="num" id="LN472">472</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> mz_uint32;</td></tr>
<tr class="codeline" data-linenumber="473"><td class="num" id="LN473">473</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>int</span> mz_uint;</td></tr>
<tr class="codeline" data-linenumber="474"><td class="num" id="LN474">474</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>long</span> <span class='keyword'>long</span> mz_int64;</td></tr>
<tr class="codeline" data-linenumber="475"><td class="num" id="LN475">475</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>long</span> <span class='keyword'>long</span> mz_uint64;</td></tr>
<tr class="codeline" data-linenumber="476"><td class="num" id="LN476">476</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>int</span> mz_bool;</td></tr>
<tr class="codeline" data-linenumber="477"><td class="num" id="LN477">477</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="478"><td class="num" id="LN478">478</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span> (0)</span></td></tr>
<tr class="codeline" data-linenumber="479"><td class="num" id="LN479">479</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span> (1)</span></td></tr>
<tr class="codeline" data-linenumber="480"><td class="num" id="LN480">480</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="481"><td class="num" id="LN481">481</td><td class="line"><span class='comment'>// An attempt to work around MSVC's spammy "warning C4127: conditional expression is constant" message.</span></td></tr>
<tr class="codeline" data-linenumber="482"><td class="num" id="LN482">482</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="483"><td class="num" id="LN483">483</td><td class="line">   <span class='directive'>#define <span class='macro'>MZ_MACRO_END<span class='macro_popup'>while (0)</span></span> while (0, 0)</span></td></tr>
<tr class="codeline" data-linenumber="484"><td class="num" id="LN484">484</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="485"><td class="num" id="LN485">485</td><td class="line">   <span class='directive'>#define <span class='macro'>MZ_MACRO_END<span class='macro_popup'>while (0)</span></span> while (0)</span></td></tr>
<tr class="codeline" data-linenumber="486"><td class="num" id="LN486">486</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="487"><td class="num" id="LN487">487</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="488"><td class="num" id="LN488">488</td><td class="line"><span class='comment'>// ------------------- ZIP archive reading/writing</span></td></tr>
<tr class="codeline" data-linenumber="489"><td class="num" id="LN489">489</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="490"><td class="num" id="LN490">490</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_ARCHIVE_APIS</span></td></tr>
<tr class="codeline" data-linenumber="491"><td class="num" id="LN491">491</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="492"><td class="num" id="LN492">492</td><td class="line"><span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="493"><td class="num" id="LN493">493</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="494"><td class="num" id="LN494">494</td><td class="line">  MZ_ZIP_MAX_IO_BUF_SIZE = 64*1024,</td></tr>
<tr class="codeline" data-linenumber="495"><td class="num" id="LN495">495</td><td class="line">  MZ_ZIP_MAX_ARCHIVE_FILENAME_SIZE = 260,</td></tr>
<tr class="codeline" data-linenumber="496"><td class="num" id="LN496">496</td><td class="line">  MZ_ZIP_MAX_ARCHIVE_FILE_COMMENT_SIZE = 256</td></tr>
<tr class="codeline" data-linenumber="497"><td class="num" id="LN497">497</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="498"><td class="num" id="LN498">498</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="499"><td class="num" id="LN499">499</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="500"><td class="num" id="LN500">500</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="501"><td class="num" id="LN501">501</td><td class="line">  mz_uint32 m_file_index;</td></tr>
<tr class="codeline" data-linenumber="502"><td class="num" id="LN502">502</td><td class="line">  mz_uint32 m_central_dir_ofs;</td></tr>
<tr class="codeline" data-linenumber="503"><td class="num" id="LN503">503</td><td class="line">  mz_uint16 m_version_made_by;</td></tr>
<tr class="codeline" data-linenumber="504"><td class="num" id="LN504">504</td><td class="line">  mz_uint16 m_version_needed;</td></tr>
<tr class="codeline" data-linenumber="505"><td class="num" id="LN505">505</td><td class="line">  mz_uint16 m_bit_flag;</td></tr>
<tr class="codeline" data-linenumber="506"><td class="num" id="LN506">506</td><td class="line">  mz_uint16 m_method;</td></tr>
<tr class="codeline" data-linenumber="507"><td class="num" id="LN507">507</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="508"><td class="num" id="LN508">508</td><td class="line">  time_t m_time;</td></tr>
<tr class="codeline" data-linenumber="509"><td class="num" id="LN509">509</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="510"><td class="num" id="LN510">510</td><td class="line">  mz_uint32 m_crc32;</td></tr>
<tr class="codeline" data-linenumber="511"><td class="num" id="LN511">511</td><td class="line">  mz_uint64 m_comp_size;</td></tr>
<tr class="codeline" data-linenumber="512"><td class="num" id="LN512">512</td><td class="line">  mz_uint64 m_uncomp_size;</td></tr>
<tr class="codeline" data-linenumber="513"><td class="num" id="LN513">513</td><td class="line">  mz_uint16 m_internal_attr;</td></tr>
<tr class="codeline" data-linenumber="514"><td class="num" id="LN514">514</td><td class="line">  mz_uint32 m_external_attr;</td></tr>
<tr class="codeline" data-linenumber="515"><td class="num" id="LN515">515</td><td class="line">  mz_uint64 m_local_header_ofs;</td></tr>
<tr class="codeline" data-linenumber="516"><td class="num" id="LN516">516</td><td class="line">  mz_uint32 m_comment_size;</td></tr>
<tr class="codeline" data-linenumber="517"><td class="num" id="LN517">517</td><td class="line">  <span class='keyword'>char</span> m_filename[MZ_ZIP_MAX_ARCHIVE_FILENAME_SIZE];</td></tr>
<tr class="codeline" data-linenumber="518"><td class="num" id="LN518">518</td><td class="line">  <span class='keyword'>char</span> m_comment[MZ_ZIP_MAX_ARCHIVE_FILE_COMMENT_SIZE];</td></tr>
<tr class="codeline" data-linenumber="519"><td class="num" id="LN519">519</td><td class="line">} mz_zip_archive_file_stat;</td></tr>
<tr class="codeline" data-linenumber="520"><td class="num" id="LN520">520</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="521"><td class="num" id="LN521">521</td><td class="line"><span class='keyword'>typedef</span> size_t (*mz_file_read_func)(<span class='keyword'>void</span> *pOpaque, mz_uint64 file_ofs, <span class='keyword'>void</span> *pBuf, size_t n);</td></tr>
<tr class="codeline" data-linenumber="522"><td class="num" id="LN522">522</td><td class="line"><span class='keyword'>typedef</span> size_t (*mz_file_write_func)(<span class='keyword'>void</span> *pOpaque, mz_uint64 file_ofs, <span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t n);</td></tr>
<tr class="codeline" data-linenumber="523"><td class="num" id="LN523">523</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="524"><td class="num" id="LN524">524</td><td class="line"><span class='keyword'>struct</span> mz_zip_internal_state_tag;</td></tr>
<tr class="codeline" data-linenumber="525"><td class="num" id="LN525">525</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span> mz_zip_internal_state_tag mz_zip_internal_state;</td></tr>
<tr class="codeline" data-linenumber="526"><td class="num" id="LN526">526</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="527"><td class="num" id="LN527">527</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="528"><td class="num" id="LN528">528</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="529"><td class="num" id="LN529">529</td><td class="line">  MZ_ZIP_MODE_INVALID = 0,</td></tr>
<tr class="codeline" data-linenumber="530"><td class="num" id="LN530">530</td><td class="line">  MZ_ZIP_MODE_READING = 1,</td></tr>
<tr class="codeline" data-linenumber="531"><td class="num" id="LN531">531</td><td class="line">  MZ_ZIP_MODE_WRITING = 2,</td></tr>
<tr class="codeline" data-linenumber="532"><td class="num" id="LN532">532</td><td class="line">  MZ_ZIP_MODE_WRITING_HAS_BEEN_FINALIZED = 3</td></tr>
<tr class="codeline" data-linenumber="533"><td class="num" id="LN533">533</td><td class="line">} mz_zip_mode;</td></tr>
<tr class="codeline" data-linenumber="534"><td class="num" id="LN534">534</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="535"><td class="num" id="LN535">535</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span> mz_zip_archive_tag</td></tr>
<tr class="codeline" data-linenumber="536"><td class="num" id="LN536">536</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="537"><td class="num" id="LN537">537</td><td class="line">  mz_uint64 m_archive_size;</td></tr>
<tr class="codeline" data-linenumber="538"><td class="num" id="LN538">538</td><td class="line">  mz_uint64 m_archive_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="539"><td class="num" id="LN539">539</td><td class="line">  mz_uint64 m_central_directory_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="540"><td class="num" id="LN540">540</td><td class="line">  mz_uint m_total_files;</td></tr>
<tr class="codeline" data-linenumber="541"><td class="num" id="LN541">541</td><td class="line">  mz_zip_mode m_zip_mode;</td></tr>
<tr class="codeline" data-linenumber="542"><td class="num" id="LN542">542</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="543"><td class="num" id="LN543">543</td><td class="line">  mz_uint m_file_offset_alignment;</td></tr>
<tr class="codeline" data-linenumber="544"><td class="num" id="LN544">544</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="545"><td class="num" id="LN545">545</td><td class="line">  mz_alloc_func m_pAlloc;</td></tr>
<tr class="codeline" data-linenumber="546"><td class="num" id="LN546">546</td><td class="line">  mz_free_func m_pFree;</td></tr>
<tr class="codeline" data-linenumber="547"><td class="num" id="LN547">547</td><td class="line">  mz_realloc_func m_pRealloc;</td></tr>
<tr class="codeline" data-linenumber="548"><td class="num" id="LN548">548</td><td class="line">  <span class='keyword'>void</span> *m_pAlloc_opaque;</td></tr>
<tr class="codeline" data-linenumber="549"><td class="num" id="LN549">549</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="550"><td class="num" id="LN550">550</td><td class="line">  mz_file_read_func m_pRead;</td></tr>
<tr class="codeline" data-linenumber="551"><td class="num" id="LN551">551</td><td class="line">  mz_file_write_func m_pWrite;</td></tr>
<tr class="codeline" data-linenumber="552"><td class="num" id="LN552">552</td><td class="line">  <span class='keyword'>void</span> *m_pIO_opaque;</td></tr>
<tr class="codeline" data-linenumber="553"><td class="num" id="LN553">553</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="554"><td class="num" id="LN554">554</td><td class="line">  mz_zip_internal_state *m_pState;</td></tr>
<tr class="codeline" data-linenumber="555"><td class="num" id="LN555">555</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="556"><td class="num" id="LN556">556</td><td class="line">} mz_zip_archive;</td></tr>
<tr class="codeline" data-linenumber="557"><td class="num" id="LN557">557</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="558"><td class="num" id="LN558">558</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="559"><td class="num" id="LN559">559</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="560"><td class="num" id="LN560">560</td><td class="line">  MZ_ZIP_FLAG_CASE_SENSITIVE                = 0x0100,</td></tr>
<tr class="codeline" data-linenumber="561"><td class="num" id="LN561">561</td><td class="line">  MZ_ZIP_FLAG_IGNORE_PATH                   = 0x0200,</td></tr>
<tr class="codeline" data-linenumber="562"><td class="num" id="LN562">562</td><td class="line">  MZ_ZIP_FLAG_COMPRESSED_DATA               = 0x0400,</td></tr>
<tr class="codeline" data-linenumber="563"><td class="num" id="LN563">563</td><td class="line">  MZ_ZIP_FLAG_DO_NOT_SORT_CENTRAL_DIRECTORY = 0x0800</td></tr>
<tr class="codeline" data-linenumber="564"><td class="num" id="LN564">564</td><td class="line">} mz_zip_flags;</td></tr>
<tr class="codeline" data-linenumber="565"><td class="num" id="LN565">565</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="566"><td class="num" id="LN566">566</td><td class="line"><span class='comment'>// ZIP archive reading</span></td></tr>
<tr class="codeline" data-linenumber="567"><td class="num" id="LN567">567</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="568"><td class="num" id="LN568">568</td><td class="line"><span class='comment'>// Inits a ZIP archive reader.</span></td></tr>
<tr class="codeline" data-linenumber="569"><td class="num" id="LN569">569</td><td class="line"><span class='comment'>// These functions read and validate the archive's central directory.</span></td></tr>
<tr class="codeline" data-linenumber="570"><td class="num" id="LN570">570</td><td class="line">mz_bool mz_zip_reader_init(mz_zip_archive *pZip, mz_uint64 size, mz_uint32 flags);</td></tr>
<tr class="codeline" data-linenumber="571"><td class="num" id="LN571">571</td><td class="line">mz_bool mz_zip_reader_init_mem(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>void</span> *pMem, size_t size, mz_uint32 flags);</td></tr>
<tr class="codeline" data-linenumber="572"><td class="num" id="LN572">572</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="573"><td class="num" id="LN573">573</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="574"><td class="num" id="LN574">574</td><td class="line">mz_bool mz_zip_reader_init_file(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, mz_uint32 flags);</td></tr>
<tr class="codeline" data-linenumber="575"><td class="num" id="LN575">575</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="576"><td class="num" id="LN576">576</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="577"><td class="num" id="LN577">577</td><td class="line"><span class='comment'>// Returns the total number of files in the archive.</span></td></tr>
<tr class="codeline" data-linenumber="578"><td class="num" id="LN578">578</td><td class="line">mz_uint mz_zip_reader_get_num_files(mz_zip_archive *pZip);</td></tr>
<tr class="codeline" data-linenumber="579"><td class="num" id="LN579">579</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="580"><td class="num" id="LN580">580</td><td class="line"><span class='comment'>// Returns detailed information about an archive file entry.</span></td></tr>
<tr class="codeline" data-linenumber="581"><td class="num" id="LN581">581</td><td class="line">mz_bool mz_zip_reader_file_stat(mz_zip_archive *pZip, mz_uint file_index, mz_zip_archive_file_stat *pStat);</td></tr>
<tr class="codeline" data-linenumber="582"><td class="num" id="LN582">582</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="583"><td class="num" id="LN583">583</td><td class="line"><span class='comment'>// Determines if an archive file entry is a directory entry.</span></td></tr>
<tr class="codeline" data-linenumber="584"><td class="num" id="LN584">584</td><td class="line">mz_bool mz_zip_reader_is_file_a_directory(mz_zip_archive *pZip, mz_uint file_index);</td></tr>
<tr class="codeline" data-linenumber="585"><td class="num" id="LN585">585</td><td class="line">mz_bool mz_zip_reader_is_file_encrypted(mz_zip_archive *pZip, mz_uint file_index);</td></tr>
<tr class="codeline" data-linenumber="586"><td class="num" id="LN586">586</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="587"><td class="num" id="LN587">587</td><td class="line"><span class='comment'>// Retrieves the filename of an archive file entry.</span></td></tr>
<tr class="codeline" data-linenumber="588"><td class="num" id="LN588">588</td><td class="line"><span class='comment'>// Returns the number of bytes written to pFilename, or if filename_buf_size is 0 this function returns the number of bytes needed to fully store the filename.</span></td></tr>
<tr class="codeline" data-linenumber="589"><td class="num" id="LN589">589</td><td class="line">mz_uint mz_zip_reader_get_filename(mz_zip_archive *pZip, mz_uint file_index, <span class='keyword'>char</span> *pFilename, mz_uint filename_buf_size);</td></tr>
<tr class="codeline" data-linenumber="590"><td class="num" id="LN590">590</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="591"><td class="num" id="LN591">591</td><td class="line"><span class='comment'>// Attempts to locates a file in the archive's central directory.</span></td></tr>
<tr class="codeline" data-linenumber="592"><td class="num" id="LN592">592</td><td class="line"><span class='comment'>// Valid flags: MZ_ZIP_FLAG_CASE_SENSITIVE, MZ_ZIP_FLAG_IGNORE_PATH</span></td></tr>
<tr class="codeline" data-linenumber="593"><td class="num" id="LN593">593</td><td class="line"><span class='comment'>// Returns -1 if the file cannot be found.</span></td></tr>
<tr class="codeline" data-linenumber="594"><td class="num" id="LN594">594</td><td class="line"><span class='keyword'>int</span> mz_zip_reader_locate_file(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pName, <span class='keyword'>const</span> <span class='keyword'>char</span> *pComment, mz_uint flags);</td></tr>
<tr class="codeline" data-linenumber="595"><td class="num" id="LN595">595</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="596"><td class="num" id="LN596">596</td><td class="line"><span class='comment'>// Extracts a archive file to a memory buffer using no memory allocation.</span></td></tr>
<tr class="codeline" data-linenumber="597"><td class="num" id="LN597">597</td><td class="line">mz_bool mz_zip_reader_extract_to_mem_no_alloc(mz_zip_archive *pZip, mz_uint file_index, <span class='keyword'>void</span> *pBuf, size_t buf_size, mz_uint flags, <span class='keyword'>void</span> *pUser_read_buf, size_t user_read_buf_size);</td></tr>
<tr class="codeline" data-linenumber="598"><td class="num" id="LN598">598</td><td class="line">mz_bool mz_zip_reader_extract_file_to_mem_no_alloc(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, <span class='keyword'>void</span> *pBuf, size_t buf_size, mz_uint flags, <span class='keyword'>void</span> *pUser_read_buf, size_t user_read_buf_size);</td></tr>
<tr class="codeline" data-linenumber="599"><td class="num" id="LN599">599</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="600"><td class="num" id="LN600">600</td><td class="line"><span class='comment'>// Extracts a archive file to a memory buffer.</span></td></tr>
<tr class="codeline" data-linenumber="601"><td class="num" id="LN601">601</td><td class="line">mz_bool mz_zip_reader_extract_to_mem(mz_zip_archive *pZip, mz_uint file_index, <span class='keyword'>void</span> *pBuf, size_t buf_size, mz_uint flags);</td></tr>
<tr class="codeline" data-linenumber="602"><td class="num" id="LN602">602</td><td class="line">mz_bool mz_zip_reader_extract_file_to_mem(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, <span class='keyword'>void</span> *pBuf, size_t buf_size, mz_uint flags);</td></tr>
<tr class="codeline" data-linenumber="603"><td class="num" id="LN603">603</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="604"><td class="num" id="LN604">604</td><td class="line"><span class='comment'>// Extracts a archive file to a dynamically allocated heap buffer.</span></td></tr>
<tr class="codeline" data-linenumber="605"><td class="num" id="LN605">605</td><td class="line"><span class='keyword'>void</span> *mz_zip_reader_extract_to_heap(mz_zip_archive *pZip, mz_uint file_index, size_t *pSize, mz_uint flags);</td></tr>
<tr class="codeline" data-linenumber="606"><td class="num" id="LN606">606</td><td class="line"><span class='keyword'>void</span> *mz_zip_reader_extract_file_to_heap(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, size_t *pSize, mz_uint flags);</td></tr>
<tr class="codeline" data-linenumber="607"><td class="num" id="LN607">607</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="608"><td class="num" id="LN608">608</td><td class="line"><span class='comment'>// Extracts a archive file using a callback function to output the file's data.</span></td></tr>
<tr class="codeline" data-linenumber="609"><td class="num" id="LN609">609</td><td class="line">mz_bool mz_zip_reader_extract_to_callback(mz_zip_archive *pZip, mz_uint file_index, mz_file_write_func pCallback, <span class='keyword'>void</span> *pOpaque, mz_uint flags);</td></tr>
<tr class="codeline" data-linenumber="610"><td class="num" id="LN610">610</td><td class="line">mz_bool mz_zip_reader_extract_file_to_callback(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, mz_file_write_func pCallback, <span class='keyword'>void</span> *pOpaque, mz_uint flags);</td></tr>
<tr class="codeline" data-linenumber="611"><td class="num" id="LN611">611</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="612"><td class="num" id="LN612">612</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="613"><td class="num" id="LN613">613</td><td class="line"><span class='comment'>// Extracts a archive file to a disk file and sets its last accessed and modified times.</span></td></tr>
<tr class="codeline" data-linenumber="614"><td class="num" id="LN614">614</td><td class="line"><span class='comment'>// This function only extracts files, not archive directory records.</span></td></tr>
<tr class="codeline" data-linenumber="615"><td class="num" id="LN615">615</td><td class="line">mz_bool mz_zip_reader_extract_to_file(mz_zip_archive *pZip, mz_uint file_index, <span class='keyword'>const</span> <span class='keyword'>char</span> *pDst_filename, mz_uint flags);</td></tr>
<tr class="codeline" data-linenumber="616"><td class="num" id="LN616">616</td><td class="line">mz_bool mz_zip_reader_extract_file_to_file(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_filename, <span class='keyword'>const</span> <span class='keyword'>char</span> *pDst_filename, mz_uint flags);</td></tr>
<tr class="codeline" data-linenumber="617"><td class="num" id="LN617">617</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="618"><td class="num" id="LN618">618</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="619"><td class="num" id="LN619">619</td><td class="line"><span class='comment'>// Ends archive reading, freeing all allocations, and closing the input archive file if mz_zip_reader_init_file() was used.</span></td></tr>
<tr class="codeline" data-linenumber="620"><td class="num" id="LN620">620</td><td class="line">mz_bool mz_zip_reader_end(mz_zip_archive *pZip);</td></tr>
<tr class="codeline" data-linenumber="621"><td class="num" id="LN621">621</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="622"><td class="num" id="LN622">622</td><td class="line"><span class='comment'>// ZIP archive writing</span></td></tr>
<tr class="codeline" data-linenumber="623"><td class="num" id="LN623">623</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="624"><td class="num" id="LN624">624</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_ARCHIVE_WRITING_APIS</span></td></tr>
<tr class="codeline" data-linenumber="625"><td class="num" id="LN625">625</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="626"><td class="num" id="LN626">626</td><td class="line"><span class='comment'>// Inits a ZIP archive writer.</span></td></tr>
<tr class="codeline" data-linenumber="627"><td class="num" id="LN627">627</td><td class="line">mz_bool mz_zip_writer_init(mz_zip_archive *pZip, mz_uint64 existing_size);</td></tr>
<tr class="codeline" data-linenumber="628"><td class="num" id="LN628">628</td><td class="line">mz_bool mz_zip_writer_init_heap(mz_zip_archive *pZip, size_t size_to_reserve_at_beginning, size_t initial_allocation_size);</td></tr>
<tr class="codeline" data-linenumber="629"><td class="num" id="LN629">629</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="630"><td class="num" id="LN630">630</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="631"><td class="num" id="LN631">631</td><td class="line">mz_bool mz_zip_writer_init_file(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, mz_uint64 size_to_reserve_at_beginning);</td></tr>
<tr class="codeline" data-linenumber="632"><td class="num" id="LN632">632</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="633"><td class="num" id="LN633">633</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="634"><td class="num" id="LN634">634</td><td class="line"><span class='comment'>// Converts a ZIP archive reader object into a writer object, to allow efficient in-place file appends to occur on an existing archive.</span></td></tr>
<tr class="codeline" data-linenumber="635"><td class="num" id="LN635">635</td><td class="line"><span class='comment'>// For archives opened using mz_zip_reader_init_file, pFilename must be the archive's filename so it can be reopened for writing. If the file can't be reopened, mz_zip_reader_end() will be called.</span></td></tr>
<tr class="codeline" data-linenumber="636"><td class="num" id="LN636">636</td><td class="line"><span class='comment'>// For archives opened using mz_zip_reader_init_mem, the memory block must be growable using the realloc callback (which defaults to realloc unless you've overridden it).</span></td></tr>
<tr class="codeline" data-linenumber="637"><td class="num" id="LN637">637</td><td class="line"><span class='comment'>// Finally, for archives opened using mz_zip_reader_init, the mz_zip_archive's user provided m_pWrite function cannot be NULL.</span></td></tr>
<tr class="codeline" data-linenumber="638"><td class="num" id="LN638">638</td><td class="line"><span class='comment'>// Note: In-place archive modification is not recommended unless you know what you're doing, because if execution stops or something goes wrong before</span></td></tr>
<tr class="codeline" data-linenumber="639"><td class="num" id="LN639">639</td><td class="line"><span class='comment'>// the archive is finalized the file's central directory will be hosed.</span></td></tr>
<tr class="codeline" data-linenumber="640"><td class="num" id="LN640">640</td><td class="line">mz_bool mz_zip_writer_init_from_reader(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename);</td></tr>
<tr class="codeline" data-linenumber="641"><td class="num" id="LN641">641</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="642"><td class="num" id="LN642">642</td><td class="line"><span class='comment'>// Adds the contents of a memory buffer to an archive. These functions record the current local time into the archive.</span></td></tr>
<tr class="codeline" data-linenumber="643"><td class="num" id="LN643">643</td><td class="line"><span class='comment'>// To add a directory entry, call this method with an archive name ending in a forwardslash with empty buffer.</span></td></tr>
<tr class="codeline" data-linenumber="644"><td class="num" id="LN644">644</td><td class="line"><span class='comment'>// level_and_flags - compression level (0-10, see MZ_BEST_SPEED, MZ_BEST_COMPRESSION, etc.) logically OR'd with zero or more mz_zip_flags, or just set to MZ_DEFAULT_COMPRESSION.</span></td></tr>
<tr class="codeline" data-linenumber="645"><td class="num" id="LN645">645</td><td class="line">mz_bool mz_zip_writer_add_mem(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_name, <span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t buf_size, mz_uint level_and_flags);</td></tr>
<tr class="codeline" data-linenumber="646"><td class="num" id="LN646">646</td><td class="line">mz_bool mz_zip_writer_add_mem_ex(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_name, <span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t buf_size, <span class='keyword'>const</span> <span class='keyword'>void</span> *pComment, mz_uint16 comment_size, mz_uint level_and_flags, mz_uint64 uncomp_size, mz_uint32 uncomp_crc32);</td></tr>
<tr class="codeline" data-linenumber="647"><td class="num" id="LN647">647</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="648"><td class="num" id="LN648">648</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="649"><td class="num" id="LN649">649</td><td class="line"><span class='comment'>// Adds the contents of a disk file to an archive. This function also records the disk file's modified time into the archive.</span></td></tr>
<tr class="codeline" data-linenumber="650"><td class="num" id="LN650">650</td><td class="line"><span class='comment'>// level_and_flags - compression level (0-10, see MZ_BEST_SPEED, MZ_BEST_COMPRESSION, etc.) logically OR'd with zero or more mz_zip_flags, or just set to MZ_DEFAULT_COMPRESSION.</span></td></tr>
<tr class="codeline" data-linenumber="651"><td class="num" id="LN651">651</td><td class="line">mz_bool mz_zip_writer_add_file(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_name, <span class='keyword'>const</span> <span class='keyword'>char</span> *pSrc_filename, <span class='keyword'>const</span> <span class='keyword'>void</span> *pComment, mz_uint16 comment_size, mz_uint level_and_flags);</td></tr>
<tr class="codeline" data-linenumber="652"><td class="num" id="LN652">652</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="653"><td class="num" id="LN653">653</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="654"><td class="num" id="LN654">654</td><td class="line"><span class='comment'>// Adds a file to an archive by fully cloning the data from another archive.</span></td></tr>
<tr class="codeline" data-linenumber="655"><td class="num" id="LN655">655</td><td class="line"><span class='comment'>// This function fully clones the source file's compressed data (no recompression), along with its full filename, extra data, and comment fields.</span></td></tr>
<tr class="codeline" data-linenumber="656"><td class="num" id="LN656">656</td><td class="line">mz_bool mz_zip_writer_add_from_zip_reader(mz_zip_archive *pZip, mz_zip_archive *pSource_zip, mz_uint file_index);</td></tr>
<tr class="codeline" data-linenumber="657"><td class="num" id="LN657">657</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="658"><td class="num" id="LN658">658</td><td class="line"><span class='comment'>// Finalizes the archive by writing the central directory records followed by the end of central directory record.</span></td></tr>
<tr class="codeline" data-linenumber="659"><td class="num" id="LN659">659</td><td class="line"><span class='comment'>// After an archive is finalized, the only valid call on the mz_zip_archive struct is mz_zip_writer_end().</span></td></tr>
<tr class="codeline" data-linenumber="660"><td class="num" id="LN660">660</td><td class="line"><span class='comment'>// An archive must be manually finalized by calling this function for it to be valid.</span></td></tr>
<tr class="codeline" data-linenumber="661"><td class="num" id="LN661">661</td><td class="line">mz_bool mz_zip_writer_finalize_archive(mz_zip_archive *pZip);</td></tr>
<tr class="codeline" data-linenumber="662"><td class="num" id="LN662">662</td><td class="line">mz_bool mz_zip_writer_finalize_heap_archive(mz_zip_archive *pZip, <span class='keyword'>void</span> **pBuf, size_t *pSize);</td></tr>
<tr class="codeline" data-linenumber="663"><td class="num" id="LN663">663</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="664"><td class="num" id="LN664">664</td><td class="line"><span class='comment'>// Ends archive writing, freeing all allocations, and closing the output file if mz_zip_writer_init_file() was used.</span></td></tr>
<tr class="codeline" data-linenumber="665"><td class="num" id="LN665">665</td><td class="line"><span class='comment'>// Note for the archive to be valid, it must have been finalized before ending.</span></td></tr>
<tr class="codeline" data-linenumber="666"><td class="num" id="LN666">666</td><td class="line">mz_bool mz_zip_writer_end(mz_zip_archive *pZip);</td></tr>
<tr class="codeline" data-linenumber="667"><td class="num" id="LN667">667</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="668"><td class="num" id="LN668">668</td><td class="line"><span class='comment'>// Misc. high-level helper functions:</span></td></tr>
<tr class="codeline" data-linenumber="669"><td class="num" id="LN669">669</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="670"><td class="num" id="LN670">670</td><td class="line"><span class='comment'>// mz_zip_add_mem_to_archive_file_in_place() efficiently (but not atomically) appends a memory blob to a ZIP archive.</span></td></tr>
<tr class="codeline" data-linenumber="671"><td class="num" id="LN671">671</td><td class="line"><span class='comment'>// level_and_flags - compression level (0-10, see MZ_BEST_SPEED, MZ_BEST_COMPRESSION, etc.) logically OR'd with zero or more mz_zip_flags, or just set to MZ_DEFAULT_COMPRESSION.</span></td></tr>
<tr class="codeline" data-linenumber="672"><td class="num" id="LN672">672</td><td class="line">mz_bool mz_zip_add_mem_to_archive_file_in_place(<span class='keyword'>const</span> <span class='keyword'>char</span> *pZip_filename, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_name, <span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t buf_size, <span class='keyword'>const</span> <span class='keyword'>void</span> *pComment, mz_uint16 comment_size, mz_uint level_and_flags);</td></tr>
<tr class="codeline" data-linenumber="673"><td class="num" id="LN673">673</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="674"><td class="num" id="LN674">674</td><td class="line"><span class='comment'>// Reads a single file from an archive into a heap block.</span></td></tr>
<tr class="codeline" data-linenumber="675"><td class="num" id="LN675">675</td><td class="line"><span class='comment'>// Returns NULL on failure.</span></td></tr>
<tr class="codeline" data-linenumber="676"><td class="num" id="LN676">676</td><td class="line"><span class='keyword'>void</span> *mz_zip_extract_archive_file_to_heap(<span class='keyword'>const</span> <span class='keyword'>char</span> *pZip_filename, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_name, size_t *pSize, mz_uint zip_flags);</td></tr>
<tr class="codeline" data-linenumber="677"><td class="num" id="LN677">677</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="678"><td class="num" id="LN678">678</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_ARCHIVE_WRITING_APIS</span></td></tr>
<tr class="codeline" data-linenumber="679"><td class="num" id="LN679">679</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="680"><td class="num" id="LN680">680</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_ARCHIVE_APIS</span></td></tr>
<tr class="codeline" data-linenumber="681"><td class="num" id="LN681">681</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="682"><td class="num" id="LN682">682</td><td class="line"><span class='comment'>// ------------------- Low-level Decompression API Definitions</span></td></tr>
<tr class="codeline" data-linenumber="683"><td class="num" id="LN683">683</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="684"><td class="num" id="LN684">684</td><td class="line"><span class='comment'>// Decompression flags used by tinfl_decompress().</span></td></tr>
<tr class="codeline" data-linenumber="685"><td class="num" id="LN685">685</td><td class="line"><span class='comment'>// TINFL_FLAG_PARSE_ZLIB_HEADER: If set, the input has a valid zlib header and ends with an adler32 checksum (it's a valid zlib stream). Otherwise, the input is a raw deflate stream.</span></td></tr>
<tr class="codeline" data-linenumber="686"><td class="num" id="LN686">686</td><td class="line"><span class='comment'>// TINFL_FLAG_HAS_MORE_INPUT: If set, there are more input bytes available beyond the end of the supplied input buffer. If clear, the input buffer contains all remaining input.</span></td></tr>
<tr class="codeline" data-linenumber="687"><td class="num" id="LN687">687</td><td class="line"><span class='comment'>// TINFL_FLAG_USING_NON_WRAPPING_OUTPUT_BUF: If set, the output buffer is large enough to hold the entire decompressed stream. If clear, the output buffer is at least the size of the dictionary (typically 32KB).</span></td></tr>
<tr class="codeline" data-linenumber="688"><td class="num" id="LN688">688</td><td class="line"><span class='comment'>// TINFL_FLAG_COMPUTE_ADLER32: Force adler-32 checksum computation of the decompressed bytes.</span></td></tr>
<tr class="codeline" data-linenumber="689"><td class="num" id="LN689">689</td><td class="line"><span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="690"><td class="num" id="LN690">690</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="691"><td class="num" id="LN691">691</td><td class="line">  TINFL_FLAG_PARSE_ZLIB_HEADER = 1,</td></tr>
<tr class="codeline" data-linenumber="692"><td class="num" id="LN692">692</td><td class="line">  TINFL_FLAG_HAS_MORE_INPUT = 2,</td></tr>
<tr class="codeline" data-linenumber="693"><td class="num" id="LN693">693</td><td class="line">  TINFL_FLAG_USING_NON_WRAPPING_OUTPUT_BUF = 4,</td></tr>
<tr class="codeline" data-linenumber="694"><td class="num" id="LN694">694</td><td class="line">  TINFL_FLAG_COMPUTE_ADLER32 = 8</td></tr>
<tr class="codeline" data-linenumber="695"><td class="num" id="LN695">695</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="696"><td class="num" id="LN696">696</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="697"><td class="num" id="LN697">697</td><td class="line"><span class='comment'>// High level decompression functions:</span></td></tr>
<tr class="codeline" data-linenumber="698"><td class="num" id="LN698">698</td><td class="line"><span class='comment'>// tinfl_decompress_mem_to_heap() decompresses a block in memory to a heap block allocated via malloc().</span></td></tr>
<tr class="codeline" data-linenumber="699"><td class="num" id="LN699">699</td><td class="line"><span class='comment'>// On entry:</span></td></tr>
<tr class="codeline" data-linenumber="700"><td class="num" id="LN700">700</td><td class="line"><span class='comment'>//  pSrc_buf, src_buf_len: Pointer and size of the Deflate or zlib source data to decompress.</span></td></tr>
<tr class="codeline" data-linenumber="701"><td class="num" id="LN701">701</td><td class="line"><span class='comment'>// On return:</span></td></tr>
<tr class="codeline" data-linenumber="702"><td class="num" id="LN702">702</td><td class="line"><span class='comment'>//  Function returns a pointer to the decompressed data, or NULL on failure.</span></td></tr>
<tr class="codeline" data-linenumber="703"><td class="num" id="LN703">703</td><td class="line"><span class='comment'>//  *pOut_len will be set to the decompressed data's size, which could be larger than src_buf_len on uncompressible data.</span></td></tr>
<tr class="codeline" data-linenumber="704"><td class="num" id="LN704">704</td><td class="line"><span class='comment'>//  The caller must call mz_free() on the returned block when it's no longer needed.</span></td></tr>
<tr class="codeline" data-linenumber="705"><td class="num" id="LN705">705</td><td class="line"><span class='keyword'>void</span> *tinfl_decompress_mem_to_heap(<span class='keyword'>const</span> <span class='keyword'>void</span> *pSrc_buf, size_t src_buf_len, size_t *pOut_len, <span class='keyword'>int</span> flags);</td></tr>
<tr class="codeline" data-linenumber="706"><td class="num" id="LN706">706</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="707"><td class="num" id="LN707">707</td><td class="line"><span class='comment'>// tinfl_decompress_mem_to_mem() decompresses a block in memory to another block in memory.</span></td></tr>
<tr class="codeline" data-linenumber="708"><td class="num" id="LN708">708</td><td class="line"><span class='comment'>// Returns TINFL_DECOMPRESS_MEM_TO_MEM_FAILED on failure, or the number of bytes written on success.</span></td></tr>
<tr class="codeline" data-linenumber="709"><td class="num" id="LN709">709</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_DECOMPRESS_MEM_TO_MEM_FAILED<span class='macro_popup'>((size_t)(-1))</span></span> ((size_t)(-1))</span></td></tr>
<tr class="codeline" data-linenumber="710"><td class="num" id="LN710">710</td><td class="line">size_t tinfl_decompress_mem_to_mem(<span class='keyword'>void</span> *pOut_buf, size_t out_buf_len, <span class='keyword'>const</span> <span class='keyword'>void</span> *pSrc_buf, size_t src_buf_len, <span class='keyword'>int</span> flags);</td></tr>
<tr class="codeline" data-linenumber="711"><td class="num" id="LN711">711</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="712"><td class="num" id="LN712">712</td><td class="line"><span class='comment'>// tinfl_decompress_mem_to_callback() decompresses a block in memory to an internal 32KB buffer, and a user provided callback function will be called to flush the buffer.</span></td></tr>
<tr class="codeline" data-linenumber="713"><td class="num" id="LN713">713</td><td class="line"><span class='comment'>// Returns 1 on success or 0 on failure.</span></td></tr>
<tr class="codeline" data-linenumber="714"><td class="num" id="LN714">714</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>int</span> (*tinfl_put_buf_func_ptr)(<span class='keyword'>const</span> <span class='keyword'>void</span>* pBuf, <span class='keyword'>int</span> len, <span class='keyword'>void</span> *pUser);</td></tr>
<tr class="codeline" data-linenumber="715"><td class="num" id="LN715">715</td><td class="line"><span class='keyword'>int</span> tinfl_decompress_mem_to_callback(<span class='keyword'>const</span> <span class='keyword'>void</span> *pIn_buf, size_t *pIn_buf_size, tinfl_put_buf_func_ptr pPut_buf_func, <span class='keyword'>void</span> *pPut_buf_user, <span class='keyword'>int</span> flags);</td></tr>
<tr class="codeline" data-linenumber="716"><td class="num" id="LN716">716</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="717"><td class="num" id="LN717">717</td><td class="line"><span class='keyword'>struct</span> tinfl_decompressor_tag; <span class='keyword'>typedef</span> <span class='keyword'>struct</span> tinfl_decompressor_tag tinfl_decompressor;</td></tr>
<tr class="codeline" data-linenumber="718"><td class="num" id="LN718">718</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="719"><td class="num" id="LN719">719</td><td class="line"><span class='comment'>// Max size of LZ dictionary.</span></td></tr>
<tr class="codeline" data-linenumber="720"><td class="num" id="LN720">720</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_LZ_DICT_SIZE<span class='macro_popup'>32768</span></span> 32768</span></td></tr>
<tr class="codeline" data-linenumber="721"><td class="num" id="LN721">721</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="722"><td class="num" id="LN722">722</td><td class="line"><span class='comment'>// Return status.</span></td></tr>
<tr class="codeline" data-linenumber="723"><td class="num" id="LN723">723</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="724"><td class="num" id="LN724">724</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="725"><td class="num" id="LN725">725</td><td class="line">  TINFL_STATUS_BAD_PARAM = -3,</td></tr>
<tr class="codeline" data-linenumber="726"><td class="num" id="LN726">726</td><td class="line">  TINFL_STATUS_ADLER32_MISMATCH = -2,</td></tr>
<tr class="codeline" data-linenumber="727"><td class="num" id="LN727">727</td><td class="line">  TINFL_STATUS_FAILED = -1,</td></tr>
<tr class="codeline" data-linenumber="728"><td class="num" id="LN728">728</td><td class="line">  TINFL_STATUS_DONE = 0,</td></tr>
<tr class="codeline" data-linenumber="729"><td class="num" id="LN729">729</td><td class="line">  TINFL_STATUS_NEEDS_MORE_INPUT = 1,</td></tr>
<tr class="codeline" data-linenumber="730"><td class="num" id="LN730">730</td><td class="line">  TINFL_STATUS_HAS_MORE_OUTPUT = 2</td></tr>
<tr class="codeline" data-linenumber="731"><td class="num" id="LN731">731</td><td class="line">} tinfl_status;</td></tr>
<tr class="codeline" data-linenumber="732"><td class="num" id="LN732">732</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="733"><td class="num" id="LN733">733</td><td class="line"><span class='comment'>// Initializes the decompressor to its initial state.</span></td></tr>
<tr class="codeline" data-linenumber="734"><td class="num" id="LN734">734</td><td class="line"><span class='directive'>#define <span class='macro'>tinfl_init(r)<span class='macro_popup'>do { (r)-&gt;m_state = 0; } while (0)</span></span> do { (r)-&gt;m_state = 0; } <span class='macro'>MZ_MACRO_END<span class='macro_popup'>while (0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="735"><td class="num" id="LN735">735</td><td class="line"><span class='directive'>#define <span class='macro'>tinfl_get_adler32(r)<span class='macro_popup'>(r)-&gt;m_check_adler32</span></span> (r)-&gt;m_check_adler32</span></td></tr>
<tr class="codeline" data-linenumber="736"><td class="num" id="LN736">736</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="737"><td class="num" id="LN737">737</td><td class="line"><span class='comment'>// Main low-level decompressor coroutine function. This is the only function actually needed for decompression. All the other functions are just high-level helpers for improved usability.</span></td></tr>
<tr class="codeline" data-linenumber="738"><td class="num" id="LN738">738</td><td class="line"><span class='comment'>// This is a universal API, i.e. it can be used as a building block to build any desired higher level decompression API. In the limit case, it can be called once per every byte input or output.</span></td></tr>
<tr class="codeline" data-linenumber="739"><td class="num" id="LN739">739</td><td class="line">tinfl_status tinfl_decompress(tinfl_decompressor *r, <span class='keyword'>const</span> mz_uint8 *pIn_buf_next, size_t *pIn_buf_size, mz_uint8 *pOut_buf_start, mz_uint8 *pOut_buf_next, size_t *pOut_buf_size, <span class='keyword'>const</span> mz_uint32 decomp_flags);</td></tr>
<tr class="codeline" data-linenumber="740"><td class="num" id="LN740">740</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="741"><td class="num" id="LN741">741</td><td class="line"><span class='comment'>// Internal/private bits follow.</span></td></tr>
<tr class="codeline" data-linenumber="742"><td class="num" id="LN742">742</td><td class="line"><span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="743"><td class="num" id="LN743">743</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="744"><td class="num" id="LN744">744</td><td class="line">  TINFL_MAX_HUFF_TABLES = 3, TINFL_MAX_HUFF_SYMBOLS_0 = 288, TINFL_MAX_HUFF_SYMBOLS_1 = 32, TINFL_MAX_HUFF_SYMBOLS_2 = 19,</td></tr>
<tr class="codeline" data-linenumber="745"><td class="num" id="LN745">745</td><td class="line">  TINFL_FAST_LOOKUP_BITS = 10, TINFL_FAST_LOOKUP_SIZE = 1 &lt;&lt; TINFL_FAST_LOOKUP_BITS</td></tr>
<tr class="codeline" data-linenumber="746"><td class="num" id="LN746">746</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="747"><td class="num" id="LN747">747</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="748"><td class="num" id="LN748">748</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="749"><td class="num" id="LN749">749</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="750"><td class="num" id="LN750">750</td><td class="line">  mz_uint8 m_code_size[TINFL_MAX_HUFF_SYMBOLS_0];</td></tr>
<tr class="codeline" data-linenumber="751"><td class="num" id="LN751">751</td><td class="line">  mz_int16 m_look_up[TINFL_FAST_LOOKUP_SIZE], m_tree[TINFL_MAX_HUFF_SYMBOLS_0 * 2];</td></tr>
<tr class="codeline" data-linenumber="752"><td class="num" id="LN752">752</td><td class="line">} tinfl_huff_table;</td></tr>
<tr class="codeline" data-linenumber="753"><td class="num" id="LN753">753</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="754"><td class="num" id="LN754">754</td><td class="line"><span class='directive'>#if <span class='macro'>MINIZ_HAS_64BIT_REGISTERS<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="755"><td class="num" id="LN755">755</td><td class="line">  <span class='directive'>#define <span class='macro'>TINFL_USE_64BIT_BITBUF<span class='macro_popup'>1</span></span> 1</span></td></tr>
<tr class="codeline" data-linenumber="756"><td class="num" id="LN756">756</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="757"><td class="num" id="LN757">757</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="758"><td class="num" id="LN758">758</td><td class="line"><span class='directive'>#if <span class='macro'>TINFL_USE_64BIT_BITBUF<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="759"><td class="num" id="LN759">759</td><td class="line">  <span class='keyword'>typedef</span> mz_uint64 tinfl_bit_buf_t;</td></tr>
<tr class="codeline" data-linenumber="760"><td class="num" id="LN760">760</td><td class="line">  <span class='directive'>#define <span class='macro'>TINFL_BITBUF_SIZE<span class='macro_popup'>(64)</span></span> (64)</span></td></tr>
<tr class="codeline" data-linenumber="761"><td class="num" id="LN761">761</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="762"><td class="num" id="LN762">762</td><td class="line">  <span class='keyword'>typedef</span> mz_uint32 tinfl_bit_buf_t;</td></tr>
<tr class="codeline" data-linenumber="763"><td class="num" id="LN763">763</td><td class="line">  <span class='directive'>#define <span class='macro'>TINFL_BITBUF_SIZE<span class='macro_popup'>(64)</span></span> (32)</span></td></tr>
<tr class="codeline" data-linenumber="764"><td class="num" id="LN764">764</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="765"><td class="num" id="LN765">765</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="766"><td class="num" id="LN766">766</td><td class="line"><span class='keyword'>struct</span> tinfl_decompressor_tag</td></tr>
<tr class="codeline" data-linenumber="767"><td class="num" id="LN767">767</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="768"><td class="num" id="LN768">768</td><td class="line">  mz_uint32 m_state, m_num_bits, m_zhdr0, m_zhdr1, m_z_adler32, m_final, m_type, m_check_adler32, m_dist, m_counter, m_num_extra, m_table_sizes[TINFL_MAX_HUFF_TABLES];</td></tr>
<tr class="codeline" data-linenumber="769"><td class="num" id="LN769">769</td><td class="line">  tinfl_bit_buf_t m_bit_buf;</td></tr>
<tr class="codeline" data-linenumber="770"><td class="num" id="LN770">770</td><td class="line">  size_t m_dist_from_out_buf_start;</td></tr>
<tr class="codeline" data-linenumber="771"><td class="num" id="LN771">771</td><td class="line">  tinfl_huff_table m_tables[TINFL_MAX_HUFF_TABLES];</td></tr>
<tr class="codeline" data-linenumber="772"><td class="num" id="LN772">772</td><td class="line">  mz_uint8 m_raw_header[4], m_len_codes[TINFL_MAX_HUFF_SYMBOLS_0 + TINFL_MAX_HUFF_SYMBOLS_1 + 137];</td></tr>
<tr class="codeline" data-linenumber="773"><td class="num" id="LN773">773</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="774"><td class="num" id="LN774">774</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="775"><td class="num" id="LN775">775</td><td class="line"><span class='comment'>// ------------------- Low-level Compression API Definitions</span></td></tr>
<tr class="codeline" data-linenumber="776"><td class="num" id="LN776">776</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="777"><td class="num" id="LN777">777</td><td class="line"><span class='comment'>// Set TDEFL_LESS_MEMORY to 1 to use less memory (compression will be slightly slower, and raw/dynamic blocks will be output more frequently).</span></td></tr>
<tr class="codeline" data-linenumber="778"><td class="num" id="LN778">778</td><td class="line"><span class='directive'>#define <span class='macro'>TDEFL_LESS_MEMORY<span class='macro_popup'>0</span></span> 0</span></td></tr>
<tr class="codeline" data-linenumber="779"><td class="num" id="LN779">779</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="780"><td class="num" id="LN780">780</td><td class="line"><span class='comment'>// tdefl_init() compression flags logically OR'd together (low 12 bits contain the max. number of probes per dictionary search):</span></td></tr>
<tr class="codeline" data-linenumber="781"><td class="num" id="LN781">781</td><td class="line"><span class='comment'>// TDEFL_DEFAULT_MAX_PROBES: The compressor defaults to 128 dictionary probes per dictionary search. 0=Huffman only, 1=Huffman+LZ (fastest/crap compression), 4095=Huffman+LZ (slowest/best compression).</span></td></tr>
<tr class="codeline" data-linenumber="782"><td class="num" id="LN782">782</td><td class="line"><span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="783"><td class="num" id="LN783">783</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="784"><td class="num" id="LN784">784</td><td class="line">  TDEFL_HUFFMAN_ONLY = 0, TDEFL_DEFAULT_MAX_PROBES = 128, TDEFL_MAX_PROBES_MASK = 0xFFF</td></tr>
<tr class="codeline" data-linenumber="785"><td class="num" id="LN785">785</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="786"><td class="num" id="LN786">786</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="787"><td class="num" id="LN787">787</td><td class="line"><span class='comment'>// TDEFL_WRITE_ZLIB_HEADER: If set, the compressor outputs a zlib header before the deflate data, and the Adler-32 of the source data at the end. Otherwise, you'll get raw deflate data.</span></td></tr>
<tr class="codeline" data-linenumber="788"><td class="num" id="LN788">788</td><td class="line"><span class='comment'>// TDEFL_COMPUTE_ADLER32: Always compute the adler-32 of the input data (even when not writing zlib headers).</span></td></tr>
<tr class="codeline" data-linenumber="789"><td class="num" id="LN789">789</td><td class="line"><span class='comment'>// TDEFL_GREEDY_PARSING_FLAG: Set to use faster greedy parsing, instead of more efficient lazy parsing.</span></td></tr>
<tr class="codeline" data-linenumber="790"><td class="num" id="LN790">790</td><td class="line"><span class='comment'>// TDEFL_NONDETERMINISTIC_PARSING_FLAG: Enable to decrease the compressor's initialization time to the minimum, but the output may vary from run to run given the same input (depending on the contents of memory).</span></td></tr>
<tr class="codeline" data-linenumber="791"><td class="num" id="LN791">791</td><td class="line"><span class='comment'>// TDEFL_RLE_MATCHES: Only look for RLE matches (matches with a distance of 1)</span></td></tr>
<tr class="codeline" data-linenumber="792"><td class="num" id="LN792">792</td><td class="line"><span class='comment'>// TDEFL_FILTER_MATCHES: Discards matches &lt;= 5 chars if enabled.</span></td></tr>
<tr class="codeline" data-linenumber="793"><td class="num" id="LN793">793</td><td class="line"><span class='comment'>// TDEFL_FORCE_ALL_STATIC_BLOCKS: Disable usage of optimized Huffman tables.</span></td></tr>
<tr class="codeline" data-linenumber="794"><td class="num" id="LN794">794</td><td class="line"><span class='comment'>// TDEFL_FORCE_ALL_RAW_BLOCKS: Only use raw (uncompressed) deflate blocks.</span></td></tr>
<tr class="codeline" data-linenumber="795"><td class="num" id="LN795">795</td><td class="line"><span class='comment'>// The low 12 bits are reserved to control the max # of hash probes per dictionary lookup (see TDEFL_MAX_PROBES_MASK).</span></td></tr>
<tr class="codeline" data-linenumber="796"><td class="num" id="LN796">796</td><td class="line"><span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="797"><td class="num" id="LN797">797</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="798"><td class="num" id="LN798">798</td><td class="line">  TDEFL_WRITE_ZLIB_HEADER             = 0x01000,</td></tr>
<tr class="codeline" data-linenumber="799"><td class="num" id="LN799">799</td><td class="line">  TDEFL_COMPUTE_ADLER32               = 0x02000,</td></tr>
<tr class="codeline" data-linenumber="800"><td class="num" id="LN800">800</td><td class="line">  TDEFL_GREEDY_PARSING_FLAG           = 0x04000,</td></tr>
<tr class="codeline" data-linenumber="801"><td class="num" id="LN801">801</td><td class="line">  TDEFL_NONDETERMINISTIC_PARSING_FLAG = 0x08000,</td></tr>
<tr class="codeline" data-linenumber="802"><td class="num" id="LN802">802</td><td class="line">  TDEFL_RLE_MATCHES                   = 0x10000,</td></tr>
<tr class="codeline" data-linenumber="803"><td class="num" id="LN803">803</td><td class="line">  TDEFL_FILTER_MATCHES                = 0x20000,</td></tr>
<tr class="codeline" data-linenumber="804"><td class="num" id="LN804">804</td><td class="line">  TDEFL_FORCE_ALL_STATIC_BLOCKS       = 0x40000,</td></tr>
<tr class="codeline" data-linenumber="805"><td class="num" id="LN805">805</td><td class="line">  TDEFL_FORCE_ALL_RAW_BLOCKS          = 0x80000</td></tr>
<tr class="codeline" data-linenumber="806"><td class="num" id="LN806">806</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="807"><td class="num" id="LN807">807</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="808"><td class="num" id="LN808">808</td><td class="line"><span class='comment'>// High level compression functions:</span></td></tr>
<tr class="codeline" data-linenumber="809"><td class="num" id="LN809">809</td><td class="line"><span class='comment'>// tdefl_compress_mem_to_heap() compresses a block in memory to a heap block allocated via malloc().</span></td></tr>
<tr class="codeline" data-linenumber="810"><td class="num" id="LN810">810</td><td class="line"><span class='comment'>// On entry:</span></td></tr>
<tr class="codeline" data-linenumber="811"><td class="num" id="LN811">811</td><td class="line"><span class='comment'>//  pSrc_buf, src_buf_len: Pointer and size of source block to compress.</span></td></tr>
<tr class="codeline" data-linenumber="812"><td class="num" id="LN812">812</td><td class="line"><span class='comment'>//  flags: The max match finder probes (default is 128) logically OR'd against the above flags. Higher probes are slower but improve compression.</span></td></tr>
<tr class="codeline" data-linenumber="813"><td class="num" id="LN813">813</td><td class="line"><span class='comment'>// On return:</span></td></tr>
<tr class="codeline" data-linenumber="814"><td class="num" id="LN814">814</td><td class="line"><span class='comment'>//  Function returns a pointer to the compressed data, or NULL on failure.</span></td></tr>
<tr class="codeline" data-linenumber="815"><td class="num" id="LN815">815</td><td class="line"><span class='comment'>//  *pOut_len will be set to the compressed data's size, which could be larger than src_buf_len on uncompressible data.</span></td></tr>
<tr class="codeline" data-linenumber="816"><td class="num" id="LN816">816</td><td class="line"><span class='comment'>//  The caller must free() the returned block when it's no longer needed.</span></td></tr>
<tr class="codeline" data-linenumber="817"><td class="num" id="LN817">817</td><td class="line"><span class='keyword'>void</span> *tdefl_compress_mem_to_heap(<span class='keyword'>const</span> <span class='keyword'>void</span> *pSrc_buf, size_t src_buf_len, size_t *pOut_len, <span class='keyword'>int</span> flags);</td></tr>
<tr class="codeline" data-linenumber="818"><td class="num" id="LN818">818</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="819"><td class="num" id="LN819">819</td><td class="line"><span class='comment'>// tdefl_compress_mem_to_mem() compresses a block in memory to another block in memory.</span></td></tr>
<tr class="codeline" data-linenumber="820"><td class="num" id="LN820">820</td><td class="line"><span class='comment'>// Returns 0 on failure.</span></td></tr>
<tr class="codeline" data-linenumber="821"><td class="num" id="LN821">821</td><td class="line">size_t tdefl_compress_mem_to_mem(<span class='keyword'>void</span> *pOut_buf, size_t out_buf_len, <span class='keyword'>const</span> <span class='keyword'>void</span> *pSrc_buf, size_t src_buf_len, <span class='keyword'>int</span> flags);</td></tr>
<tr class="codeline" data-linenumber="822"><td class="num" id="LN822">822</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="823"><td class="num" id="LN823">823</td><td class="line"><span class='comment'>// Compresses an image to a compressed PNG file in memory.</span></td></tr>
<tr class="codeline" data-linenumber="824"><td class="num" id="LN824">824</td><td class="line"><span class='comment'>// On entry:</span></td></tr>
<tr class="codeline" data-linenumber="825"><td class="num" id="LN825">825</td><td class="line"><span class='comment'>//  pImage, w, h, and num_chans describe the image to compress. num_chans may be 1, 2, 3, or 4.</span></td></tr>
<tr class="codeline" data-linenumber="826"><td class="num" id="LN826">826</td><td class="line"><span class='comment'>//  The image pitch in bytes per scanline will be w*num_chans. The leftmost pixel on the top scanline is stored first in memory.</span></td></tr>
<tr class="codeline" data-linenumber="827"><td class="num" id="LN827">827</td><td class="line"><span class='comment'>//  level may range from [0,10], use MZ_NO_COMPRESSION, MZ_BEST_SPEED, MZ_BEST_COMPRESSION, etc. or a decent default is MZ_DEFAULT_LEVEL</span></td></tr>
<tr class="codeline" data-linenumber="828"><td class="num" id="LN828">828</td><td class="line"><span class='comment'>//  If flip is true, the image will be flipped on the Y axis (useful for OpenGL apps).</span></td></tr>
<tr class="codeline" data-linenumber="829"><td class="num" id="LN829">829</td><td class="line"><span class='comment'>// On return:</span></td></tr>
<tr class="codeline" data-linenumber="830"><td class="num" id="LN830">830</td><td class="line"><span class='comment'>//  Function returns a pointer to the compressed data, or NULL on failure.</span></td></tr>
<tr class="codeline" data-linenumber="831"><td class="num" id="LN831">831</td><td class="line"><span class='comment'>//  *pLen_out will be set to the size of the PNG image file.</span></td></tr>
<tr class="codeline" data-linenumber="832"><td class="num" id="LN832">832</td><td class="line"><span class='comment'>//  The caller must mz_free() the returned heap block (which will typically be larger than *pLen_out) when it's no longer needed.</span></td></tr>
<tr class="codeline" data-linenumber="833"><td class="num" id="LN833">833</td><td class="line"><span class='keyword'>void</span> *tdefl_write_image_to_png_file_in_memory_ex(<span class='keyword'>const</span> <span class='keyword'>void</span> *pImage, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> num_chans, size_t *pLen_out, mz_uint level, mz_bool flip);</td></tr>
<tr class="codeline" data-linenumber="834"><td class="num" id="LN834">834</td><td class="line"><span class='keyword'>void</span> *tdefl_write_image_to_png_file_in_memory(<span class='keyword'>const</span> <span class='keyword'>void</span> *pImage, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> num_chans, size_t *pLen_out);</td></tr>
<tr class="codeline" data-linenumber="835"><td class="num" id="LN835">835</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="836"><td class="num" id="LN836">836</td><td class="line"><span class='comment'>// Output stream interface. The compressor uses this interface to write compressed data. It'll typically be called TDEFL_OUT_BUF_SIZE at a time.</span></td></tr>
<tr class="codeline" data-linenumber="837"><td class="num" id="LN837">837</td><td class="line"><span class='keyword'>typedef</span> mz_bool (*tdefl_put_buf_func_ptr)(<span class='keyword'>const</span> <span class='keyword'>void</span>* pBuf, <span class='keyword'>int</span> len, <span class='keyword'>void</span> *pUser);</td></tr>
<tr class="codeline" data-linenumber="838"><td class="num" id="LN838">838</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="839"><td class="num" id="LN839">839</td><td class="line"><span class='comment'>// tdefl_compress_mem_to_output() compresses a block to an output stream. The above helpers use this function internally.</span></td></tr>
<tr class="codeline" data-linenumber="840"><td class="num" id="LN840">840</td><td class="line">mz_bool tdefl_compress_mem_to_output(<span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t buf_len, tdefl_put_buf_func_ptr pPut_buf_func, <span class='keyword'>void</span> *pPut_buf_user, <span class='keyword'>int</span> flags);</td></tr>
<tr class="codeline" data-linenumber="841"><td class="num" id="LN841">841</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="842"><td class="num" id="LN842">842</td><td class="line"><span class='keyword'>enum</span> { TDEFL_MAX_HUFF_TABLES = 3, TDEFL_MAX_HUFF_SYMBOLS_0 = 288, TDEFL_MAX_HUFF_SYMBOLS_1 = 32, TDEFL_MAX_HUFF_SYMBOLS_2 = 19, TDEFL_LZ_DICT_SIZE = 32768, TDEFL_LZ_DICT_SIZE_MASK = TDEFL_LZ_DICT_SIZE - 1, TDEFL_MIN_MATCH_LEN = 3, TDEFL_MAX_MATCH_LEN = 258 };</td></tr>
<tr class="codeline" data-linenumber="843"><td class="num" id="LN843">843</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="844"><td class="num" id="LN844">844</td><td class="line"><span class='comment'>// TDEFL_OUT_BUF_SIZE MUST be large enough to hold a single entire compressed output block (using static/fixed Huffman codes).</span></td></tr>
<tr class="codeline" data-linenumber="845"><td class="num" id="LN845">845</td><td class="line"><span class='directive'>#if <span class='macro'>TDEFL_LESS_MEMORY<span class='macro_popup'>0</span></span></span></td></tr>
<tr class="codeline" data-linenumber="846"><td class="num" id="LN846">846</td><td class="line"><span class='keyword'>enum</span> { TDEFL_LZ_CODE_BUF_SIZE = 24 * 1024, TDEFL_OUT_BUF_SIZE = (TDEFL_LZ_CODE_BUF_SIZE * 13 ) / 10, TDEFL_MAX_HUFF_SYMBOLS = 288, TDEFL_LZ_HASH_BITS = 12, TDEFL_LEVEL1_HASH_SIZE_MASK = 4095, TDEFL_LZ_HASH_SHIFT = (TDEFL_LZ_HASH_BITS + 2) / 3, TDEFL_LZ_HASH_SIZE = 1 &lt;&lt; TDEFL_LZ_HASH_BITS };</td></tr>
<tr class="codeline" data-linenumber="847"><td class="num" id="LN847">847</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="848"><td class="num" id="LN848">848</td><td class="line"><span class='keyword'>enum</span> { TDEFL_LZ_CODE_BUF_SIZE = 64 * 1024, TDEFL_OUT_BUF_SIZE = (TDEFL_LZ_CODE_BUF_SIZE * 13 ) / 10, TDEFL_MAX_HUFF_SYMBOLS = 288, TDEFL_LZ_HASH_BITS = 15, TDEFL_LEVEL1_HASH_SIZE_MASK = 4095, TDEFL_LZ_HASH_SHIFT = (TDEFL_LZ_HASH_BITS + 2) / 3, TDEFL_LZ_HASH_SIZE = 1 &lt;&lt; TDEFL_LZ_HASH_BITS };</td></tr>
<tr class="codeline" data-linenumber="849"><td class="num" id="LN849">849</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="850"><td class="num" id="LN850">850</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="851"><td class="num" id="LN851">851</td><td class="line"><span class='comment'>// The low-level tdefl functions below may be used directly if the above helper functions aren't flexible enough. The low-level functions don't make any heap allocations, unlike the above helper functions.</span></td></tr>
<tr class="codeline" data-linenumber="852"><td class="num" id="LN852">852</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="853"><td class="num" id="LN853">853</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="854"><td class="num" id="LN854">854</td><td class="line">  TDEFL_STATUS_BAD_PARAM = -2,</td></tr>
<tr class="codeline" data-linenumber="855"><td class="num" id="LN855">855</td><td class="line">  TDEFL_STATUS_PUT_BUF_FAILED = -1,</td></tr>
<tr class="codeline" data-linenumber="856"><td class="num" id="LN856">856</td><td class="line">  TDEFL_STATUS_OKAY = 0,</td></tr>
<tr class="codeline" data-linenumber="857"><td class="num" id="LN857">857</td><td class="line">  TDEFL_STATUS_DONE = 1,</td></tr>
<tr class="codeline" data-linenumber="858"><td class="num" id="LN858">858</td><td class="line">} tdefl_status;</td></tr>
<tr class="codeline" data-linenumber="859"><td class="num" id="LN859">859</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="860"><td class="num" id="LN860">860</td><td class="line"><span class='comment'>// Must map to MZ_NO_FLUSH, MZ_SYNC_FLUSH, etc. enums</span></td></tr>
<tr class="codeline" data-linenumber="861"><td class="num" id="LN861">861</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="862"><td class="num" id="LN862">862</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="863"><td class="num" id="LN863">863</td><td class="line">  TDEFL_NO_FLUSH = 0,</td></tr>
<tr class="codeline" data-linenumber="864"><td class="num" id="LN864">864</td><td class="line">  TDEFL_SYNC_FLUSH = 2,</td></tr>
<tr class="codeline" data-linenumber="865"><td class="num" id="LN865">865</td><td class="line">  TDEFL_FULL_FLUSH = 3,</td></tr>
<tr class="codeline" data-linenumber="866"><td class="num" id="LN866">866</td><td class="line">  TDEFL_FINISH = 4</td></tr>
<tr class="codeline" data-linenumber="867"><td class="num" id="LN867">867</td><td class="line">} tdefl_flush;</td></tr>
<tr class="codeline" data-linenumber="868"><td class="num" id="LN868">868</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="869"><td class="num" id="LN869">869</td><td class="line"><span class='comment'>// tdefl's compression state structure.</span></td></tr>
<tr class="codeline" data-linenumber="870"><td class="num" id="LN870">870</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="871"><td class="num" id="LN871">871</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="872"><td class="num" id="LN872">872</td><td class="line">  tdefl_put_buf_func_ptr m_pPut_buf_func;</td></tr>
<tr class="codeline" data-linenumber="873"><td class="num" id="LN873">873</td><td class="line">  <span class='keyword'>void</span> *m_pPut_buf_user;</td></tr>
<tr class="codeline" data-linenumber="874"><td class="num" id="LN874">874</td><td class="line">  mz_uint m_flags, m_max_probes[2];</td></tr>
<tr class="codeline" data-linenumber="875"><td class="num" id="LN875">875</td><td class="line">  <span class='keyword'>int</span> m_greedy_parsing;</td></tr>
<tr class="codeline" data-linenumber="876"><td class="num" id="LN876">876</td><td class="line">  mz_uint m_adler32, m_lookahead_pos, m_lookahead_size, m_dict_size;</td></tr>
<tr class="codeline" data-linenumber="877"><td class="num" id="LN877">877</td><td class="line">  mz_uint8 *m_pLZ_code_buf, *m_pLZ_flags, *m_pOutput_buf, *m_pOutput_buf_end;</td></tr>
<tr class="codeline" data-linenumber="878"><td class="num" id="LN878">878</td><td class="line">  mz_uint m_num_flags_left, m_total_lz_bytes, m_lz_code_buf_dict_pos, m_bits_in, m_bit_buffer;</td></tr>
<tr class="codeline" data-linenumber="879"><td class="num" id="LN879">879</td><td class="line">  mz_uint m_saved_match_dist, m_saved_match_len, m_saved_lit, m_output_flush_ofs, m_output_flush_remaining, m_finished, m_block_index, m_wants_to_finish;</td></tr>
<tr class="codeline" data-linenumber="880"><td class="num" id="LN880">880</td><td class="line">  tdefl_status m_prev_return_status;</td></tr>
<tr class="codeline" data-linenumber="881"><td class="num" id="LN881">881</td><td class="line">  <span class='keyword'>const</span> <span class='keyword'>void</span> *m_pIn_buf;</td></tr>
<tr class="codeline" data-linenumber="882"><td class="num" id="LN882">882</td><td class="line">  <span class='keyword'>void</span> *m_pOut_buf;</td></tr>
<tr class="codeline" data-linenumber="883"><td class="num" id="LN883">883</td><td class="line">  size_t *m_pIn_buf_size, *m_pOut_buf_size;</td></tr>
<tr class="codeline" data-linenumber="884"><td class="num" id="LN884">884</td><td class="line">  tdefl_flush m_flush;</td></tr>
<tr class="codeline" data-linenumber="885"><td class="num" id="LN885">885</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *m_pSrc;</td></tr>
<tr class="codeline" data-linenumber="886"><td class="num" id="LN886">886</td><td class="line">  size_t m_src_buf_left, m_out_buf_ofs;</td></tr>
<tr class="codeline" data-linenumber="887"><td class="num" id="LN887">887</td><td class="line">  mz_uint8 m_dict[TDEFL_LZ_DICT_SIZE + TDEFL_MAX_MATCH_LEN - 1];</td></tr>
<tr class="codeline" data-linenumber="888"><td class="num" id="LN888">888</td><td class="line">  mz_uint16 m_huff_count[TDEFL_MAX_HUFF_TABLES][TDEFL_MAX_HUFF_SYMBOLS];</td></tr>
<tr class="codeline" data-linenumber="889"><td class="num" id="LN889">889</td><td class="line">  mz_uint16 m_huff_codes[TDEFL_MAX_HUFF_TABLES][TDEFL_MAX_HUFF_SYMBOLS];</td></tr>
<tr class="codeline" data-linenumber="890"><td class="num" id="LN890">890</td><td class="line">  mz_uint8 m_huff_code_sizes[TDEFL_MAX_HUFF_TABLES][TDEFL_MAX_HUFF_SYMBOLS];</td></tr>
<tr class="codeline" data-linenumber="891"><td class="num" id="LN891">891</td><td class="line">  mz_uint8 m_lz_code_buf[TDEFL_LZ_CODE_BUF_SIZE];</td></tr>
<tr class="codeline" data-linenumber="892"><td class="num" id="LN892">892</td><td class="line">  mz_uint16 m_next[TDEFL_LZ_DICT_SIZE];</td></tr>
<tr class="codeline" data-linenumber="893"><td class="num" id="LN893">893</td><td class="line">  mz_uint16 m_hash[TDEFL_LZ_HASH_SIZE];</td></tr>
<tr class="codeline" data-linenumber="894"><td class="num" id="LN894">894</td><td class="line">  mz_uint8 m_output_buf[TDEFL_OUT_BUF_SIZE];</td></tr>
<tr class="codeline" data-linenumber="895"><td class="num" id="LN895">895</td><td class="line">} tdefl_compressor;</td></tr>
<tr class="codeline" data-linenumber="896"><td class="num" id="LN896">896</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="897"><td class="num" id="LN897">897</td><td class="line"><span class='comment'>// Initializes the compressor.</span></td></tr>
<tr class="codeline" data-linenumber="898"><td class="num" id="LN898">898</td><td class="line"><span class='comment'>// There is no corresponding deinit() function because the tdefl API's do not dynamically allocate memory.</span></td></tr>
<tr class="codeline" data-linenumber="899"><td class="num" id="LN899">899</td><td class="line"><span class='comment'>// pBut_buf_func: If NULL, output data will be supplied to the specified callback. In this case, the user should call the tdefl_compress_buffer() API for compression.</span></td></tr>
<tr class="codeline" data-linenumber="900"><td class="num" id="LN900">900</td><td class="line"><span class='comment'>// If pBut_buf_func is NULL the user should always call the tdefl_compress() API.</span></td></tr>
<tr class="codeline" data-linenumber="901"><td class="num" id="LN901">901</td><td class="line"><span class='comment'>// flags: See the above enums (TDEFL_HUFFMAN_ONLY, TDEFL_WRITE_ZLIB_HEADER, etc.)</span></td></tr>
<tr class="codeline" data-linenumber="902"><td class="num" id="LN902">902</td><td class="line">tdefl_status tdefl_init(tdefl_compressor *d, tdefl_put_buf_func_ptr pPut_buf_func, <span class='keyword'>void</span> *pPut_buf_user, <span class='keyword'>int</span> flags);</td></tr>
<tr class="codeline" data-linenumber="903"><td class="num" id="LN903">903</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="904"><td class="num" id="LN904">904</td><td class="line"><span class='comment'>// Compresses a block of data, consuming as much of the specified input buffer as possible, and writing as much compressed data to the specified output buffer as possible.</span></td></tr>
<tr class="codeline" data-linenumber="905"><td class="num" id="LN905">905</td><td class="line">tdefl_status tdefl_compress(tdefl_compressor *d, <span class='keyword'>const</span> <span class='keyword'>void</span> *pIn_buf, size_t *pIn_buf_size, <span class='keyword'>void</span> *pOut_buf, size_t *pOut_buf_size, tdefl_flush flush);</td></tr>
<tr class="codeline" data-linenumber="906"><td class="num" id="LN906">906</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="907"><td class="num" id="LN907">907</td><td class="line"><span class='comment'>// tdefl_compress_buffer() is only usable when the tdefl_init() is called with a non-NULL tdefl_put_buf_func_ptr.</span></td></tr>
<tr class="codeline" data-linenumber="908"><td class="num" id="LN908">908</td><td class="line"><span class='comment'>// tdefl_compress_buffer() always consumes the entire input buffer.</span></td></tr>
<tr class="codeline" data-linenumber="909"><td class="num" id="LN909">909</td><td class="line">tdefl_status tdefl_compress_buffer(tdefl_compressor *d, <span class='keyword'>const</span> <span class='keyword'>void</span> *pIn_buf, size_t in_buf_size, tdefl_flush flush);</td></tr>
<tr class="codeline" data-linenumber="910"><td class="num" id="LN910">910</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="911"><td class="num" id="LN911">911</td><td class="line">tdefl_status tdefl_get_prev_return_status(tdefl_compressor *d);</td></tr>
<tr class="codeline" data-linenumber="912"><td class="num" id="LN912">912</td><td class="line">mz_uint32 tdefl_get_adler32(tdefl_compressor *d);</td></tr>
<tr class="codeline" data-linenumber="913"><td class="num" id="LN913">913</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="914"><td class="num" id="LN914">914</td><td class="line"><span class='comment'>// Can't use tdefl_create_comp_flags_from_zip_params if MINIZ_NO_ZLIB_APIS isn't defined, because it uses some of its macros.</span></td></tr>
<tr class="codeline" data-linenumber="915"><td class="num" id="LN915">915</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_ZLIB_APIS</span></td></tr>
<tr class="codeline" data-linenumber="916"><td class="num" id="LN916">916</td><td class="line"><span class='comment'>// Create tdefl_compress() flags given zlib-style compression parameters.</span></td></tr>
<tr class="codeline" data-linenumber="917"><td class="num" id="LN917">917</td><td class="line"><span class='comment'>// level may range from [0,10] (where 10 is absolute max compression, but may be much slower on some files)</span></td></tr>
<tr class="codeline" data-linenumber="918"><td class="num" id="LN918">918</td><td class="line"><span class='comment'>// window_bits may be -15 (raw deflate) or 15 (zlib)</span></td></tr>
<tr class="codeline" data-linenumber="919"><td class="num" id="LN919">919</td><td class="line"><span class='comment'>// strategy may be either MZ_DEFAULT_STRATEGY, MZ_FILTERED, MZ_HUFFMAN_ONLY, MZ_RLE, or MZ_FIXED</span></td></tr>
<tr class="codeline" data-linenumber="920"><td class="num" id="LN920">920</td><td class="line">mz_uint tdefl_create_comp_flags_from_zip_params(<span class='keyword'>int</span> level, <span class='keyword'>int</span> window_bits, <span class='keyword'>int</span> strategy);</td></tr>
<tr class="codeline" data-linenumber="921"><td class="num" id="LN921">921</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_ZLIB_APIS</span></td></tr>
<tr class="codeline" data-linenumber="922"><td class="num" id="LN922">922</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="923"><td class="num" id="LN923">923</td><td class="line"><span class='directive'>#ifdef __cplusplus</span></td></tr>
<tr class="codeline" data-linenumber="924"><td class="num" id="LN924">924</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="925"><td class="num" id="LN925">925</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="926"><td class="num" id="LN926">926</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="927"><td class="num" id="LN927">927</td><td class="line"><span class='directive'>#endif // MINIZ_HEADER_INCLUDED</span></td></tr>
<tr class="codeline" data-linenumber="928"><td class="num" id="LN928">928</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="929"><td class="num" id="LN929">929</td><td class="line"><span class='comment'>// ------------------- End of Header: Implementation follows. (If you only want the header, define MINIZ_HEADER_FILE_ONLY.)</span></td></tr>
<tr class="codeline" data-linenumber="930"><td class="num" id="LN930">930</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="931"><td class="num" id="LN931">931</td><td class="line"><span class='directive'>#ifndef MINIZ_HEADER_FILE_ONLY</span></td></tr>
<tr class="codeline" data-linenumber="932"><td class="num" id="LN932">932</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="933"><td class="num" id="LN933">933</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> mz_validate_uint16[<span class='keyword'>sizeof</span>(mz_uint16)==2 ? 1 : -1];</td></tr>
<tr class="codeline" data-linenumber="934"><td class="num" id="LN934">934</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> mz_validate_uint32[<span class='keyword'>sizeof</span>(mz_uint32)==4 ? 1 : -1];</td></tr>
<tr class="codeline" data-linenumber="935"><td class="num" id="LN935">935</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> mz_validate_uint64[<span class='keyword'>sizeof</span>(mz_uint64)==8 ? 1 : -1];</td></tr>
<tr class="codeline" data-linenumber="936"><td class="num" id="LN936">936</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="937"><td class="num" id="LN937">937</td><td class="line"><span class='directive'>#include &lt;string.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="938"><td class="num" id="LN938">938</td><td class="line"><span class='directive'>#include &lt;assert.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="939"><td class="num" id="LN939">939</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="940"><td class="num" id="LN940">940</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_ASSERT(x)<span class='macro_popup'>((void) sizeof ((x) ? 1 : 0), __extension__ ({ if (x) ; else __assert_fail<br> ("x", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 940, __extension__ __PRETTY_FUNCTION__); }))</span></span> <span class='macro'>assert(x)<span class='macro_popup'>((void) sizeof ((x) ? 1 : 0), __extension__ ({ if (x) ; else __assert_fail<br> ("x", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 940, __extension__ __PRETTY_FUNCTION__); }))</span></span></span></td></tr>
<tr class="codeline" data-linenumber="941"><td class="num" id="LN941">941</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="942"><td class="num" id="LN942">942</td><td class="line"><span class='directive'>#ifdef MINIZ_NO_MALLOC</span></td></tr>
<tr class="codeline" data-linenumber="943"><td class="num" id="LN943">943</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_MALLOC(x)<span class='macro_popup'>malloc(x)</span></span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="944"><td class="num" id="LN944">944</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_FREE(x)<span class='macro_popup'>free(x)</span></span> (void)x, ((void)0)</span></td></tr>
<tr class="codeline" data-linenumber="945"><td class="num" id="LN945">945</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_REALLOC(p, x)<span class='macro_popup'>realloc(p, x)</span></span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="946"><td class="num" id="LN946">946</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="947"><td class="num" id="LN947">947</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_MALLOC(x)<span class='macro_popup'>malloc(x)</span></span> malloc(x)</span></td></tr>
<tr class="codeline" data-linenumber="948"><td class="num" id="LN948">948</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_FREE(x)<span class='macro_popup'>free(x)</span></span> free(x)</span></td></tr>
<tr class="codeline" data-linenumber="949"><td class="num" id="LN949">949</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_REALLOC(p, x)<span class='macro_popup'>realloc(p, x)</span></span> realloc(p, x)</span></td></tr>
<tr class="codeline" data-linenumber="950"><td class="num" id="LN950">950</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="951"><td class="num" id="LN951">951</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="952"><td class="num" id="LN952">952</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_MAX(a,b)<span class='macro_popup'>(((a)&gt;(b))?(a):(b))</span></span> (((a)&gt;(b))?(a):(b))</span></td></tr>
<tr class="codeline" data-linenumber="953"><td class="num" id="LN953">953</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_MIN(a,b)<span class='macro_popup'>(((a)&lt;(b))?(a):(b))</span></span> (((a)&lt;(b))?(a):(b))</span></td></tr>
<tr class="codeline" data-linenumber="954"><td class="num" id="LN954">954</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_CLEAR_OBJ(obj)<span class='macro_popup'>memset(&amp;(obj), 0, sizeof(obj))</span></span> memset(&amp;(obj), 0, sizeof(obj))</span></td></tr>
<tr class="codeline" data-linenumber="955"><td class="num" id="LN955">955</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="956"><td class="num" id="LN956">956</td><td class="line"><span class='directive'>#if <span class='macro'>MINIZ_USE_UNALIGNED_LOADS_AND_STORES<span class='macro_popup'>1</span></span> &amp;&amp; <span class='macro'>MINIZ_LITTLE_ENDIAN<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="957"><td class="num" id="LN957">957</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_READ_LE16(p)<span class='macro_popup'>*((const mz_uint16 *)(p))</span></span> *((const mz_uint16 *)(p))</span></td></tr>
<tr class="codeline" data-linenumber="958"><td class="num" id="LN958">958</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_READ_LE32(p)<span class='macro_popup'>*((const mz_uint32 *)(p))</span></span> *((const mz_uint32 *)(p))</span></td></tr>
<tr class="codeline" data-linenumber="959"><td class="num" id="LN959">959</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="960"><td class="num" id="LN960">960</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_READ_LE16(p)<span class='macro_popup'>*((const mz_uint16 *)(p))</span></span> ((mz_uint32)(((const mz_uint8 *)(p))[0]) | ((mz_uint32)(((const mz_uint8 *)(p))[1]) &lt;&lt; 8U))</span></td></tr>
<tr class="codeline" data-linenumber="961"><td class="num" id="LN961">961</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_READ_LE32(p)<span class='macro_popup'>*((const mz_uint32 *)(p))</span></span> ((mz_uint32)(((const mz_uint8 *)(p))[0]) | ((mz_uint32)(((const mz_uint8 *)(p))[1]) &lt;&lt; 8U) | ((mz_uint32)(((const mz_uint8 *)(p))[2]) &lt;&lt; 16U) | ((mz_uint32)(((const mz_uint8 *)(p))[3]) &lt;&lt; 24U))</span></td></tr>
<tr class="codeline" data-linenumber="962"><td class="num" id="LN962">962</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="963"><td class="num" id="LN963">963</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="964"><td class="num" id="LN964">964</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="965"><td class="num" id="LN965">965</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> __forceinline</span></td></tr>
<tr class="codeline" data-linenumber="966"><td class="num" id="LN966">966</td><td class="line"><span class='directive'>#elif defined(<span class='macro'>__GNUC__<span class='macro_popup'>4</span></span>)</span></td></tr>
<tr class="codeline" data-linenumber="967"><td class="num" id="LN967">967</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> inline __attribute__((__always_inline__))</span></td></tr>
<tr class="codeline" data-linenumber="968"><td class="num" id="LN968">968</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="969"><td class="num" id="LN969">969</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> inline</span></td></tr>
<tr class="codeline" data-linenumber="970"><td class="num" id="LN970">970</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="971"><td class="num" id="LN971">971</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="972"><td class="num" id="LN972">972</td><td class="line"><span class='directive'>#ifdef __cplusplus</span></td></tr>
<tr class="codeline" data-linenumber="973"><td class="num" id="LN973">973</td><td class="line">  <span class='keyword'>extern</span> <span class='string_literal'>"C"</span> {</td></tr>
<tr class="codeline" data-linenumber="974"><td class="num" id="LN974">974</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="975"><td class="num" id="LN975">975</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="976"><td class="num" id="LN976">976</td><td class="line"><span class='comment'>// ------------------- zlib-style API's</span></td></tr>
<tr class="codeline" data-linenumber="977"><td class="num" id="LN977">977</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="978"><td class="num" id="LN978">978</td><td class="line">mz_ulong mz_adler32(mz_ulong adler, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *ptr, size_t buf_len)</td></tr>
<tr class="codeline" data-linenumber="979"><td class="num" id="LN979">979</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="980"><td class="num" id="LN980">980</td><td class="line">  mz_uint32 i, s1 = (mz_uint32)(adler &amp; 0xffff), s2 = (mz_uint32)(adler &gt;&gt; 16); size_t block_len = buf_len % 5552;</td></tr>
<tr class="codeline" data-linenumber="981"><td class="num" id="LN981">981</td><td class="line">  <span class='keyword'>if</span> (!ptr) <span class='keyword'>return</span> <span class='macro'>MZ_ADLER32_INIT<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="982"><td class="num" id="LN982">982</td><td class="line">  <span class='keyword'>while</span> (buf_len) {</td></tr>
<tr class="codeline" data-linenumber="983"><td class="num" id="LN983">983</td><td class="line">    <span class='keyword'>for</span> (i = 0; i + 7 &lt; block_len; i += 8, ptr += 8) {</td></tr>
<tr class="codeline" data-linenumber="984"><td class="num" id="LN984">984</td><td class="line">      s1 += ptr[0], s2 += s1; s1 += ptr[1], s2 += s1; s1 += ptr[2], s2 += s1; s1 += ptr[3], s2 += s1;</td></tr>
<tr class="codeline" data-linenumber="985"><td class="num" id="LN985">985</td><td class="line">      s1 += ptr[4], s2 += s1; s1 += ptr[5], s2 += s1; s1 += ptr[6], s2 += s1; s1 += ptr[7], s2 += s1;</td></tr>
<tr class="codeline" data-linenumber="986"><td class="num" id="LN986">986</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="987"><td class="num" id="LN987">987</td><td class="line">    <span class='keyword'>for</span> ( ; i &lt; block_len; ++i) s1 += *ptr++, s2 += s1;</td></tr>
<tr class="codeline" data-linenumber="988"><td class="num" id="LN988">988</td><td class="line">    s1 %= 65521U, s2 %= 65521U; buf_len -= block_len; block_len = 5552;</td></tr>
<tr class="codeline" data-linenumber="989"><td class="num" id="LN989">989</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="990"><td class="num" id="LN990">990</td><td class="line">  <span class='keyword'>return</span> (s2 &lt;&lt; 16) + s1;</td></tr>
<tr class="codeline" data-linenumber="991"><td class="num" id="LN991">991</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="992"><td class="num" id="LN992">992</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="993"><td class="num" id="LN993">993</td><td class="line"><span class='comment'>// Karl Malbrain's compact CRC-32. See "A compact CCITT crc16 and crc32 C implementation that balances processor cache usage against speed": http://www.geocities.com/malbrain/</span></td></tr>
<tr class="codeline" data-linenumber="994"><td class="num" id="LN994">994</td><td class="line">mz_ulong mz_crc32(mz_ulong crc, <span class='keyword'>const</span> mz_uint8 *ptr, size_t buf_len)</td></tr>
<tr class="codeline" data-linenumber="995"><td class="num" id="LN995">995</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="996"><td class="num" id="LN996">996</td><td class="line">  <span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint32 s_crc32[16] = { 0, 0x1db71064, 0x3b6e20c8, 0x26d930ac, 0x76dc4190, 0x6b6b51f4, 0x4db26158, 0x5005713c,</td></tr>
<tr class="codeline" data-linenumber="997"><td class="num" id="LN997">997</td><td class="line">    0xedb88320, 0xf00f9344, 0xd6d6a3e8, 0xcb61b38c, 0x9b64c2b0, 0x86d3d2d4, 0xa00ae278, 0xbdbdf21c };</td></tr>
<tr class="codeline" data-linenumber="998"><td class="num" id="LN998">998</td><td class="line">  mz_uint32 crcu32 = (mz_uint32)crc;</td></tr>
<tr class="codeline" data-linenumber="999"><td class="num" id="LN999">999</td><td class="line">  <span class='keyword'>if</span> (!ptr) <span class='keyword'>return</span> <span class='macro'>MZ_CRC32_INIT<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1000"><td class="num" id="LN1000">1000</td><td class="line">  crcu32 = ~crcu32; <span class='keyword'>while</span> (buf_len--) { mz_uint8 b = *ptr++; crcu32 = (crcu32 &gt;&gt; 4) ^ s_crc32[(crcu32 &amp; 0xF) ^ (b &amp; 0xF)]; crcu32 = (crcu32 &gt;&gt; 4) ^ s_crc32[(crcu32 &amp; 0xF) ^ (b &gt;&gt; 4)]; }</td></tr>
<tr class="codeline" data-linenumber="1001"><td class="num" id="LN1001">1001</td><td class="line">  <span class='keyword'>return</span> ~crcu32;</td></tr>
<tr class="codeline" data-linenumber="1002"><td class="num" id="LN1002">1002</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1003"><td class="num" id="LN1003">1003</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1004"><td class="num" id="LN1004">1004</td><td class="line"><span class='keyword'>void</span> mz_free(<span class='keyword'>void</span> *p)</td></tr>
<tr class="codeline" data-linenumber="1005"><td class="num" id="LN1005">1005</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1006"><td class="num" id="LN1006">1006</td><td class="line">  <span class='macro'>MZ_FREE(p)<span class='macro_popup'>free(p)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1007"><td class="num" id="LN1007">1007</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1008"><td class="num" id="LN1008">1008</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1009"><td class="num" id="LN1009">1009</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_ZLIB_APIS</span></td></tr>
<tr class="codeline" data-linenumber="1010"><td class="num" id="LN1010">1010</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1011"><td class="num" id="LN1011">1011</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *def_alloc_func(<span class='keyword'>void</span> *opaque, size_t items, size_t size) { (<span class='keyword'>void</span>)opaque, (<span class='keyword'>void</span>)items, (<span class='keyword'>void</span>)size; <span class='keyword'>return</span> <span class='macro'>MZ_MALLOC(items * size)<span class='macro_popup'>malloc(items * size)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1012"><td class="num" id="LN1012">1012</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> def_free_func(<span class='keyword'>void</span> *opaque, <span class='keyword'>void</span> *address) { (<span class='keyword'>void</span>)opaque, (<span class='keyword'>void</span>)address; <span class='macro'>MZ_FREE(address)<span class='macro_popup'>free(address)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1013"><td class="num" id="LN1013">1013</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> *def_realloc_func(<span class='keyword'>void</span> *opaque, <span class='keyword'>void</span> *address, size_t items, size_t size) { (<span class='keyword'>void</span>)opaque, (<span class='keyword'>void</span>)address, (<span class='keyword'>void</span>)items, (<span class='keyword'>void</span>)size; <span class='keyword'>return</span> <span class='macro'>MZ_REALLOC(address, items * size)<span class='macro_popup'>realloc(address, items * size)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1014"><td class="num" id="LN1014">1014</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1015"><td class="num" id="LN1015">1015</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>char</span> *mz_version(<span class='keyword'>void</span>)</td></tr>
<tr class="codeline" data-linenumber="1016"><td class="num" id="LN1016">1016</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1017"><td class="num" id="LN1017">1017</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_VERSION<span class='macro_popup'>"9.1.15"</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1018"><td class="num" id="LN1018">1018</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1019"><td class="num" id="LN1019">1019</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1020"><td class="num" id="LN1020">1020</td><td class="line"><span class='keyword'>int</span> mz_deflateInit(mz_streamp pStream, <span class='keyword'>int</span> level)</td></tr>
<tr class="codeline" data-linenumber="1021"><td class="num" id="LN1021">1021</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1022"><td class="num" id="LN1022">1022</td><td class="line">  <span class='keyword'>return</span> mz_deflateInit2(pStream, level, <span class='macro'>MZ_DEFLATED<span class='macro_popup'>8</span></span>, <span class='macro'>MZ_DEFAULT_WINDOW_BITS<span class='macro_popup'>15</span></span>, 9, MZ_DEFAULT_STRATEGY);</td></tr>
<tr class="codeline" data-linenumber="1023"><td class="num" id="LN1023">1023</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1024"><td class="num" id="LN1024">1024</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1025"><td class="num" id="LN1025">1025</td><td class="line"><span class='keyword'>int</span> mz_deflateInit2(mz_streamp pStream, <span class='keyword'>int</span> level, <span class='keyword'>int</span> method, <span class='keyword'>int</span> window_bits, <span class='keyword'>int</span> mem_level, <span class='keyword'>int</span> strategy)</td></tr>
<tr class="codeline" data-linenumber="1026"><td class="num" id="LN1026">1026</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1027"><td class="num" id="LN1027">1027</td><td class="line">  tdefl_compressor *pComp;</td></tr>
<tr class="codeline" data-linenumber="1028"><td class="num" id="LN1028">1028</td><td class="line">  mz_uint comp_flags = TDEFL_COMPUTE_ADLER32 | tdefl_create_comp_flags_from_zip_params(level, window_bits, strategy);</td></tr>
<tr class="codeline" data-linenumber="1029"><td class="num" id="LN1029">1029</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1030"><td class="num" id="LN1030">1030</td><td class="line">  <span class='keyword'>if</span> (!pStream) <span class='keyword'>return</span> MZ_STREAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1031"><td class="num" id="LN1031">1031</td><td class="line">  <span class='keyword'>if</span> ((method != <span class='macro'>MZ_DEFLATED<span class='macro_popup'>8</span></span>) || ((mem_level &lt; 1) || (mem_level &gt; 9)) || ((window_bits != <span class='macro'>MZ_DEFAULT_WINDOW_BITS<span class='macro_popup'>15</span></span>) &amp;&amp; (-window_bits != <span class='macro'>MZ_DEFAULT_WINDOW_BITS<span class='macro_popup'>15</span></span>))) <span class='keyword'>return</span> MZ_PARAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1032"><td class="num" id="LN1032">1032</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1033"><td class="num" id="LN1033">1033</td><td class="line">  pStream-&gt;data_type = 0;</td></tr>
<tr class="codeline" data-linenumber="1034"><td class="num" id="LN1034">1034</td><td class="line">  pStream-&gt;adler = <span class='macro'>MZ_ADLER32_INIT<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1035"><td class="num" id="LN1035">1035</td><td class="line">  pStream-&gt;msg = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1036"><td class="num" id="LN1036">1036</td><td class="line">  pStream-&gt;reserved = 0;</td></tr>
<tr class="codeline" data-linenumber="1037"><td class="num" id="LN1037">1037</td><td class="line">  pStream-&gt;total_in = 0;</td></tr>
<tr class="codeline" data-linenumber="1038"><td class="num" id="LN1038">1038</td><td class="line">  pStream-&gt;total_out = 0;</td></tr>
<tr class="codeline" data-linenumber="1039"><td class="num" id="LN1039">1039</td><td class="line">  <span class='keyword'>if</span> (!pStream-&gt;zalloc) pStream-&gt;zalloc = def_alloc_func;</td></tr>
<tr class="codeline" data-linenumber="1040"><td class="num" id="LN1040">1040</td><td class="line">  <span class='keyword'>if</span> (!pStream-&gt;zfree) pStream-&gt;zfree = def_free_func;</td></tr>
<tr class="codeline" data-linenumber="1041"><td class="num" id="LN1041">1041</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1042"><td class="num" id="LN1042">1042</td><td class="line">  pComp = (tdefl_compressor *)pStream-&gt;zalloc(pStream-&gt;opaque, 1, <span class='keyword'>sizeof</span>(tdefl_compressor));</td></tr>
<tr class="codeline" data-linenumber="1043"><td class="num" id="LN1043">1043</td><td class="line">  <span class='keyword'>if</span> (!pComp)</td></tr>
<tr class="codeline" data-linenumber="1044"><td class="num" id="LN1044">1044</td><td class="line">    <span class='keyword'>return</span> MZ_MEM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1045"><td class="num" id="LN1045">1045</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1046"><td class="num" id="LN1046">1046</td><td class="line">  pStream-&gt;state = (<span class='keyword'>struct</span> mz_internal_state *)pComp;</td></tr>
<tr class="codeline" data-linenumber="1047"><td class="num" id="LN1047">1047</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1048"><td class="num" id="LN1048">1048</td><td class="line">  <span class='keyword'>if</span> (tdefl_init(pComp, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, comp_flags) != TDEFL_STATUS_OKAY)</td></tr>
<tr class="codeline" data-linenumber="1049"><td class="num" id="LN1049">1049</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1050"><td class="num" id="LN1050">1050</td><td class="line">    mz_deflateEnd(pStream);</td></tr>
<tr class="codeline" data-linenumber="1051"><td class="num" id="LN1051">1051</td><td class="line">    <span class='keyword'>return</span> MZ_PARAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1052"><td class="num" id="LN1052">1052</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1053"><td class="num" id="LN1053">1053</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1054"><td class="num" id="LN1054">1054</td><td class="line">  <span class='keyword'>return</span> MZ_OK;</td></tr>
<tr class="codeline" data-linenumber="1055"><td class="num" id="LN1055">1055</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1056"><td class="num" id="LN1056">1056</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1057"><td class="num" id="LN1057">1057</td><td class="line"><span class='keyword'>int</span> mz_deflateReset(mz_streamp pStream)</td></tr>
<tr class="codeline" data-linenumber="1058"><td class="num" id="LN1058">1058</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1059"><td class="num" id="LN1059">1059</td><td class="line">  <span class='keyword'>if</span> ((!pStream) || (!pStream-&gt;state) || (!pStream-&gt;zalloc) || (!pStream-&gt;zfree)) <span class='keyword'>return</span> MZ_STREAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1060"><td class="num" id="LN1060">1060</td><td class="line">  pStream-&gt;total_in = pStream-&gt;total_out = 0;</td></tr>
<tr class="codeline" data-linenumber="1061"><td class="num" id="LN1061">1061</td><td class="line">  tdefl_init((tdefl_compressor*)pStream-&gt;state, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, ((tdefl_compressor*)pStream-&gt;state)-&gt;m_flags);</td></tr>
<tr class="codeline" data-linenumber="1062"><td class="num" id="LN1062">1062</td><td class="line">  <span class='keyword'>return</span> MZ_OK;</td></tr>
<tr class="codeline" data-linenumber="1063"><td class="num" id="LN1063">1063</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1064"><td class="num" id="LN1064">1064</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1065"><td class="num" id="LN1065">1065</td><td class="line"><span class='keyword'>int</span> mz_deflate(mz_streamp pStream, <span class='keyword'>int</span> flush)</td></tr>
<tr class="codeline" data-linenumber="1066"><td class="num" id="LN1066">1066</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1067"><td class="num" id="LN1067">1067</td><td class="line">  size_t in_bytes, out_bytes;</td></tr>
<tr class="codeline" data-linenumber="1068"><td class="num" id="LN1068">1068</td><td class="line">  mz_ulong orig_total_in, orig_total_out;</td></tr>
<tr class="codeline" data-linenumber="1069"><td class="num" id="LN1069">1069</td><td class="line">  <span class='keyword'>int</span> mz_status = MZ_OK;</td></tr>
<tr class="codeline" data-linenumber="1070"><td class="num" id="LN1070">1070</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1071"><td class="num" id="LN1071">1071</td><td class="line">  <span class='keyword'>if</span> ((!pStream) || (!pStream-&gt;state) || (flush &lt; 0) || (flush &gt; MZ_FINISH) || (!pStream-&gt;next_out)) <span class='keyword'>return</span> MZ_STREAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1072"><td class="num" id="LN1072">1072</td><td class="line">  <span class='keyword'>if</span> (!pStream-&gt;avail_out) <span class='keyword'>return</span> MZ_BUF_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1073"><td class="num" id="LN1073">1073</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1074"><td class="num" id="LN1074">1074</td><td class="line">  <span class='keyword'>if</span> (flush == MZ_PARTIAL_FLUSH) flush = MZ_SYNC_FLUSH;</td></tr>
<tr class="codeline" data-linenumber="1075"><td class="num" id="LN1075">1075</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1076"><td class="num" id="LN1076">1076</td><td class="line">  <span class='keyword'>if</span> (((tdefl_compressor*)pStream-&gt;state)-&gt;m_prev_return_status == TDEFL_STATUS_DONE)</td></tr>
<tr class="codeline" data-linenumber="1077"><td class="num" id="LN1077">1077</td><td class="line">    <span class='keyword'>return</span> (flush == MZ_FINISH) ? MZ_STREAM_END : MZ_BUF_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1078"><td class="num" id="LN1078">1078</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1079"><td class="num" id="LN1079">1079</td><td class="line">  orig_total_in = pStream-&gt;total_in; orig_total_out = pStream-&gt;total_out;</td></tr>
<tr class="codeline" data-linenumber="1080"><td class="num" id="LN1080">1080</td><td class="line">  <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="1081"><td class="num" id="LN1081">1081</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1082"><td class="num" id="LN1082">1082</td><td class="line">    tdefl_status defl_status;</td></tr>
<tr class="codeline" data-linenumber="1083"><td class="num" id="LN1083">1083</td><td class="line">    in_bytes = pStream-&gt;avail_in; out_bytes = pStream-&gt;avail_out;</td></tr>
<tr class="codeline" data-linenumber="1084"><td class="num" id="LN1084">1084</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1085"><td class="num" id="LN1085">1085</td><td class="line">    defl_status = tdefl_compress((tdefl_compressor*)pStream-&gt;state, pStream-&gt;next_in, &amp;in_bytes, pStream-&gt;next_out, &amp;out_bytes, (tdefl_flush)flush);</td></tr>
<tr class="codeline" data-linenumber="1086"><td class="num" id="LN1086">1086</td><td class="line">    pStream-&gt;next_in += (mz_uint)in_bytes; pStream-&gt;avail_in -= (mz_uint)in_bytes;</td></tr>
<tr class="codeline" data-linenumber="1087"><td class="num" id="LN1087">1087</td><td class="line">    pStream-&gt;total_in += (mz_uint)in_bytes; pStream-&gt;adler = tdefl_get_adler32((tdefl_compressor*)pStream-&gt;state);</td></tr>
<tr class="codeline" data-linenumber="1088"><td class="num" id="LN1088">1088</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1089"><td class="num" id="LN1089">1089</td><td class="line">    pStream-&gt;next_out += (mz_uint)out_bytes; pStream-&gt;avail_out -= (mz_uint)out_bytes;</td></tr>
<tr class="codeline" data-linenumber="1090"><td class="num" id="LN1090">1090</td><td class="line">    pStream-&gt;total_out += (mz_uint)out_bytes;</td></tr>
<tr class="codeline" data-linenumber="1091"><td class="num" id="LN1091">1091</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1092"><td class="num" id="LN1092">1092</td><td class="line">    <span class='keyword'>if</span> (defl_status &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="1093"><td class="num" id="LN1093">1093</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1094"><td class="num" id="LN1094">1094</td><td class="line">      mz_status = MZ_STREAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1095"><td class="num" id="LN1095">1095</td><td class="line">      <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1096"><td class="num" id="LN1096">1096</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1097"><td class="num" id="LN1097">1097</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (defl_status == TDEFL_STATUS_DONE)</td></tr>
<tr class="codeline" data-linenumber="1098"><td class="num" id="LN1098">1098</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1099"><td class="num" id="LN1099">1099</td><td class="line">      mz_status = MZ_STREAM_END;</td></tr>
<tr class="codeline" data-linenumber="1100"><td class="num" id="LN1100">1100</td><td class="line">      <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1101"><td class="num" id="LN1101">1101</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1102"><td class="num" id="LN1102">1102</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (!pStream-&gt;avail_out)</td></tr>
<tr class="codeline" data-linenumber="1103"><td class="num" id="LN1103">1103</td><td class="line">      <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1104"><td class="num" id="LN1104">1104</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> ((!pStream-&gt;avail_in) &amp;&amp; (flush != MZ_FINISH))</td></tr>
<tr class="codeline" data-linenumber="1105"><td class="num" id="LN1105">1105</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1106"><td class="num" id="LN1106">1106</td><td class="line">      <span class='keyword'>if</span> ((flush) || (pStream-&gt;total_in != orig_total_in) || (pStream-&gt;total_out != orig_total_out))</td></tr>
<tr class="codeline" data-linenumber="1107"><td class="num" id="LN1107">1107</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1108"><td class="num" id="LN1108">1108</td><td class="line">      <span class='keyword'>return</span> MZ_BUF_ERROR; <span class='comment'>// Can't make forward progress without some input.</span></td></tr>
<tr class="codeline" data-linenumber="1109"><td class="num" id="LN1109">1109</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1110"><td class="num" id="LN1110">1110</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1111"><td class="num" id="LN1111">1111</td><td class="line">  <span class='keyword'>return</span> mz_status;</td></tr>
<tr class="codeline" data-linenumber="1112"><td class="num" id="LN1112">1112</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1113"><td class="num" id="LN1113">1113</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1114"><td class="num" id="LN1114">1114</td><td class="line"><span class='keyword'>int</span> mz_deflateEnd(mz_streamp pStream)</td></tr>
<tr class="codeline" data-linenumber="1115"><td class="num" id="LN1115">1115</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1116"><td class="num" id="LN1116">1116</td><td class="line">  <span class='keyword'>if</span> (!pStream) <span class='keyword'>return</span> MZ_STREAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1117"><td class="num" id="LN1117">1117</td><td class="line">  <span class='keyword'>if</span> (pStream-&gt;state)</td></tr>
<tr class="codeline" data-linenumber="1118"><td class="num" id="LN1118">1118</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1119"><td class="num" id="LN1119">1119</td><td class="line">    pStream-&gt;zfree(pStream-&gt;opaque, pStream-&gt;state);</td></tr>
<tr class="codeline" data-linenumber="1120"><td class="num" id="LN1120">1120</td><td class="line">    pStream-&gt;state = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1121"><td class="num" id="LN1121">1121</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1122"><td class="num" id="LN1122">1122</td><td class="line">  <span class='keyword'>return</span> MZ_OK;</td></tr>
<tr class="codeline" data-linenumber="1123"><td class="num" id="LN1123">1123</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1124"><td class="num" id="LN1124">1124</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1125"><td class="num" id="LN1125">1125</td><td class="line">mz_ulong mz_deflateBound(mz_streamp pStream, mz_ulong source_len)</td></tr>
<tr class="codeline" data-linenumber="1126"><td class="num" id="LN1126">1126</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1127"><td class="num" id="LN1127">1127</td><td class="line">  (<span class='keyword'>void</span>)pStream;</td></tr>
<tr class="codeline" data-linenumber="1128"><td class="num" id="LN1128">1128</td><td class="line">  <span class='comment'>// This is really over conservative. (And lame, but it's actually pretty tricky to compute a true upper bound given the way tdefl's blocking works.)</span></td></tr>
<tr class="codeline" data-linenumber="1129"><td class="num" id="LN1129">1129</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_MAX(128 + (source_len * 110) / 100, 128 + source_len + ((source_len / (31 * 1024)) + 1) * 5)<span class='macro_popup'>(((128 + (source_len * 110) / 100)&gt;(128 + source_len + ((source_len<br> / (31 * 1024)) + 1) * 5))?(128 + (source_len * 110) / 100):(<br>128 + source_len + ((source_len / (31 * 1024)) + 1) * 5))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1130"><td class="num" id="LN1130">1130</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1131"><td class="num" id="LN1131">1131</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1132"><td class="num" id="LN1132">1132</td><td class="line"><span class='keyword'>int</span> mz_compress2(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pDest, mz_ulong *pDest_len, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pSource, mz_ulong source_len, <span class='keyword'>int</span> level)</td></tr>
<tr class="codeline" data-linenumber="1133"><td class="num" id="LN1133">1133</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1134"><td class="num" id="LN1134">1134</td><td class="line">  <span class='keyword'>int</span> status;</td></tr>
<tr class="codeline" data-linenumber="1135"><td class="num" id="LN1135">1135</td><td class="line">  mz_stream stream;</td></tr>
<tr class="codeline" data-linenumber="1136"><td class="num" id="LN1136">1136</td><td class="line">  memset(&amp;stream, 0, <span class='keyword'>sizeof</span>(stream));</td></tr>
<tr class="codeline" data-linenumber="1137"><td class="num" id="LN1137">1137</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1138"><td class="num" id="LN1138">1138</td><td class="line">  <span class='comment'>// In case mz_ulong is 64-bits (argh I hate longs).</span></td></tr>
<tr class="codeline" data-linenumber="1139"><td class="num" id="LN1139">1139</td><td class="line">  <span class='keyword'>if</span> ((source_len | *pDest_len) &gt; 0xFFFFFFFFU) <span class='keyword'>return</span> MZ_PARAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1140"><td class="num" id="LN1140">1140</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1141"><td class="num" id="LN1141">1141</td><td class="line">  stream.next_in = pSource;</td></tr>
<tr class="codeline" data-linenumber="1142"><td class="num" id="LN1142">1142</td><td class="line">  stream.avail_in = (mz_uint32)source_len;</td></tr>
<tr class="codeline" data-linenumber="1143"><td class="num" id="LN1143">1143</td><td class="line">  stream.next_out = pDest;</td></tr>
<tr class="codeline" data-linenumber="1144"><td class="num" id="LN1144">1144</td><td class="line">  stream.avail_out = (mz_uint32)*pDest_len;</td></tr>
<tr class="codeline" data-linenumber="1145"><td class="num" id="LN1145">1145</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1146"><td class="num" id="LN1146">1146</td><td class="line">  status = mz_deflateInit(&amp;stream, level);</td></tr>
<tr class="codeline" data-linenumber="1147"><td class="num" id="LN1147">1147</td><td class="line">  <span class='keyword'>if</span> (status != MZ_OK) <span class='keyword'>return</span> status;</td></tr>
<tr class="codeline" data-linenumber="1148"><td class="num" id="LN1148">1148</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1149"><td class="num" id="LN1149">1149</td><td class="line">  status = mz_deflate(&amp;stream, MZ_FINISH);</td></tr>
<tr class="codeline" data-linenumber="1150"><td class="num" id="LN1150">1150</td><td class="line">  <span class='keyword'>if</span> (status != MZ_STREAM_END)</td></tr>
<tr class="codeline" data-linenumber="1151"><td class="num" id="LN1151">1151</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1152"><td class="num" id="LN1152">1152</td><td class="line">    mz_deflateEnd(&amp;stream);</td></tr>
<tr class="codeline" data-linenumber="1153"><td class="num" id="LN1153">1153</td><td class="line">    <span class='keyword'>return</span> (status == MZ_OK) ? MZ_BUF_ERROR : status;</td></tr>
<tr class="codeline" data-linenumber="1154"><td class="num" id="LN1154">1154</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1155"><td class="num" id="LN1155">1155</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1156"><td class="num" id="LN1156">1156</td><td class="line">  *pDest_len = stream.total_out;</td></tr>
<tr class="codeline" data-linenumber="1157"><td class="num" id="LN1157">1157</td><td class="line">  <span class='keyword'>return</span> mz_deflateEnd(&amp;stream);</td></tr>
<tr class="codeline" data-linenumber="1158"><td class="num" id="LN1158">1158</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1159"><td class="num" id="LN1159">1159</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1160"><td class="num" id="LN1160">1160</td><td class="line"><span class='keyword'>int</span> mz_compress(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pDest, mz_ulong *pDest_len, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pSource, mz_ulong source_len)</td></tr>
<tr class="codeline" data-linenumber="1161"><td class="num" id="LN1161">1161</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1162"><td class="num" id="LN1162">1162</td><td class="line">  <span class='keyword'>return</span> mz_compress2(pDest, pDest_len, pSource, source_len, MZ_DEFAULT_COMPRESSION);</td></tr>
<tr class="codeline" data-linenumber="1163"><td class="num" id="LN1163">1163</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1164"><td class="num" id="LN1164">1164</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1165"><td class="num" id="LN1165">1165</td><td class="line">mz_ulong mz_compressBound(mz_ulong source_len)</td></tr>
<tr class="codeline" data-linenumber="1166"><td class="num" id="LN1166">1166</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1167"><td class="num" id="LN1167">1167</td><td class="line">  <span class='keyword'>return</span> mz_deflateBound(<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, source_len);</td></tr>
<tr class="codeline" data-linenumber="1168"><td class="num" id="LN1168">1168</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1169"><td class="num" id="LN1169">1169</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1170"><td class="num" id="LN1170">1170</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="1171"><td class="num" id="LN1171">1171</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1172"><td class="num" id="LN1172">1172</td><td class="line">  tinfl_decompressor m_decomp;</td></tr>
<tr class="codeline" data-linenumber="1173"><td class="num" id="LN1173">1173</td><td class="line">  mz_uint m_dict_ofs, m_dict_avail, m_first_call, m_has_flushed; <span class='keyword'>int</span> m_window_bits;</td></tr>
<tr class="codeline" data-linenumber="1174"><td class="num" id="LN1174">1174</td><td class="line">  mz_uint8 m_dict[<span class='macro'>TINFL_LZ_DICT_SIZE<span class='macro_popup'>32768</span></span>];</td></tr>
<tr class="codeline" data-linenumber="1175"><td class="num" id="LN1175">1175</td><td class="line">  tinfl_status m_last_status;</td></tr>
<tr class="codeline" data-linenumber="1176"><td class="num" id="LN1176">1176</td><td class="line">} inflate_state;</td></tr>
<tr class="codeline" data-linenumber="1177"><td class="num" id="LN1177">1177</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1178"><td class="num" id="LN1178">1178</td><td class="line"><span class='keyword'>int</span> mz_inflateInit2(mz_streamp pStream, <span class='keyword'>int</span> window_bits)</td></tr>
<tr class="codeline" data-linenumber="1179"><td class="num" id="LN1179">1179</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1180"><td class="num" id="LN1180">1180</td><td class="line">  inflate_state *pDecomp;</td></tr>
<tr class="codeline" data-linenumber="1181"><td class="num" id="LN1181">1181</td><td class="line">  <span class='keyword'>if</span> (!pStream) <span class='keyword'>return</span> MZ_STREAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1182"><td class="num" id="LN1182">1182</td><td class="line">  <span class='keyword'>if</span> ((window_bits != <span class='macro'>MZ_DEFAULT_WINDOW_BITS<span class='macro_popup'>15</span></span>) &amp;&amp; (-window_bits != <span class='macro'>MZ_DEFAULT_WINDOW_BITS<span class='macro_popup'>15</span></span>)) <span class='keyword'>return</span> MZ_PARAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1183"><td class="num" id="LN1183">1183</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1184"><td class="num" id="LN1184">1184</td><td class="line">  pStream-&gt;data_type = 0;</td></tr>
<tr class="codeline" data-linenumber="1185"><td class="num" id="LN1185">1185</td><td class="line">  pStream-&gt;adler = 0;</td></tr>
<tr class="codeline" data-linenumber="1186"><td class="num" id="LN1186">1186</td><td class="line">  pStream-&gt;msg = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1187"><td class="num" id="LN1187">1187</td><td class="line">  pStream-&gt;total_in = 0;</td></tr>
<tr class="codeline" data-linenumber="1188"><td class="num" id="LN1188">1188</td><td class="line">  pStream-&gt;total_out = 0;</td></tr>
<tr class="codeline" data-linenumber="1189"><td class="num" id="LN1189">1189</td><td class="line">  pStream-&gt;reserved = 0;</td></tr>
<tr class="codeline" data-linenumber="1190"><td class="num" id="LN1190">1190</td><td class="line">  <span class='keyword'>if</span> (!pStream-&gt;zalloc) pStream-&gt;zalloc = def_alloc_func;</td></tr>
<tr class="codeline" data-linenumber="1191"><td class="num" id="LN1191">1191</td><td class="line">  <span class='keyword'>if</span> (!pStream-&gt;zfree) pStream-&gt;zfree = def_free_func;</td></tr>
<tr class="codeline" data-linenumber="1192"><td class="num" id="LN1192">1192</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1193"><td class="num" id="LN1193">1193</td><td class="line">  pDecomp = (inflate_state*)pStream-&gt;zalloc(pStream-&gt;opaque, 1, <span class='keyword'>sizeof</span>(inflate_state));</td></tr>
<tr class="codeline" data-linenumber="1194"><td class="num" id="LN1194">1194</td><td class="line">  <span class='keyword'>if</span> (!pDecomp) <span class='keyword'>return</span> MZ_MEM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1195"><td class="num" id="LN1195">1195</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1196"><td class="num" id="LN1196">1196</td><td class="line">  pStream-&gt;state = (<span class='keyword'>struct</span> mz_internal_state *)pDecomp;</td></tr>
<tr class="codeline" data-linenumber="1197"><td class="num" id="LN1197">1197</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1198"><td class="num" id="LN1198">1198</td><td class="line">  <span class='macro'>tinfl_init(&amp;pDecomp-&gt;m_decomp)<span class='macro_popup'>do { (&amp;pDecomp-&gt;m_decomp)-&gt;m_state = 0; } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1199"><td class="num" id="LN1199">1199</td><td class="line">  pDecomp-&gt;m_dict_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="1200"><td class="num" id="LN1200">1200</td><td class="line">  pDecomp-&gt;m_dict_avail = 0;</td></tr>
<tr class="codeline" data-linenumber="1201"><td class="num" id="LN1201">1201</td><td class="line">  pDecomp-&gt;m_last_status = TINFL_STATUS_NEEDS_MORE_INPUT;</td></tr>
<tr class="codeline" data-linenumber="1202"><td class="num" id="LN1202">1202</td><td class="line">  pDecomp-&gt;m_first_call = 1;</td></tr>
<tr class="codeline" data-linenumber="1203"><td class="num" id="LN1203">1203</td><td class="line">  pDecomp-&gt;m_has_flushed = 0;</td></tr>
<tr class="codeline" data-linenumber="1204"><td class="num" id="LN1204">1204</td><td class="line">  pDecomp-&gt;m_window_bits = window_bits;</td></tr>
<tr class="codeline" data-linenumber="1205"><td class="num" id="LN1205">1205</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1206"><td class="num" id="LN1206">1206</td><td class="line">  <span class='keyword'>return</span> MZ_OK;</td></tr>
<tr class="codeline" data-linenumber="1207"><td class="num" id="LN1207">1207</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1208"><td class="num" id="LN1208">1208</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1209"><td class="num" id="LN1209">1209</td><td class="line"><span class='keyword'>int</span> mz_inflateInit(mz_streamp pStream)</td></tr>
<tr class="codeline" data-linenumber="1210"><td class="num" id="LN1210">1210</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1211"><td class="num" id="LN1211">1211</td><td class="line">   <span class='keyword'>return</span> mz_inflateInit2(pStream, <span class='macro'>MZ_DEFAULT_WINDOW_BITS<span class='macro_popup'>15</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1212"><td class="num" id="LN1212">1212</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1213"><td class="num" id="LN1213">1213</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1214"><td class="num" id="LN1214">1214</td><td class="line"><span class='keyword'>int</span> mz_inflate(mz_streamp pStream, <span class='keyword'>int</span> flush)</td></tr>
<tr class="codeline" data-linenumber="1215"><td class="num" id="LN1215">1215</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1216"><td class="num" id="LN1216">1216</td><td class="line">  inflate_state* pState;</td></tr>
<tr class="codeline" data-linenumber="1217"><td class="num" id="LN1217">1217</td><td class="line">  mz_uint n, first_call, decomp_flags = TINFL_FLAG_COMPUTE_ADLER32;</td></tr>
<tr class="codeline" data-linenumber="1218"><td class="num" id="LN1218">1218</td><td class="line">  size_t in_bytes, out_bytes, orig_avail_in;</td></tr>
<tr class="codeline" data-linenumber="1219"><td class="num" id="LN1219">1219</td><td class="line">  tinfl_status status;</td></tr>
<tr class="codeline" data-linenumber="1220"><td class="num" id="LN1220">1220</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1221"><td class="num" id="LN1221">1221</td><td class="line">  <span class='keyword'>if</span> ((!pStream) || (!pStream-&gt;state)) <span class='keyword'>return</span> MZ_STREAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1222"><td class="num" id="LN1222">1222</td><td class="line">  <span class='keyword'>if</span> (flush == MZ_PARTIAL_FLUSH) flush = MZ_SYNC_FLUSH;</td></tr>
<tr class="codeline" data-linenumber="1223"><td class="num" id="LN1223">1223</td><td class="line">  <span class='keyword'>if</span> ((flush) &amp;&amp; (flush != MZ_SYNC_FLUSH) &amp;&amp; (flush != MZ_FINISH)) <span class='keyword'>return</span> MZ_STREAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1224"><td class="num" id="LN1224">1224</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1225"><td class="num" id="LN1225">1225</td><td class="line">  pState = (inflate_state*)pStream-&gt;state;</td></tr>
<tr class="codeline" data-linenumber="1226"><td class="num" id="LN1226">1226</td><td class="line">  <span class='keyword'>if</span> (pState-&gt;m_window_bits &gt; 0) decomp_flags |= TINFL_FLAG_PARSE_ZLIB_HEADER;</td></tr>
<tr class="codeline" data-linenumber="1227"><td class="num" id="LN1227">1227</td><td class="line">  orig_avail_in = pStream-&gt;avail_in;</td></tr>
<tr class="codeline" data-linenumber="1228"><td class="num" id="LN1228">1228</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1229"><td class="num" id="LN1229">1229</td><td class="line">  first_call = pState-&gt;m_first_call; pState-&gt;m_first_call = 0;</td></tr>
<tr class="codeline" data-linenumber="1230"><td class="num" id="LN1230">1230</td><td class="line">  <span class='keyword'>if</span> (pState-&gt;m_last_status &lt; 0) <span class='keyword'>return</span> MZ_DATA_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1231"><td class="num" id="LN1231">1231</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1232"><td class="num" id="LN1232">1232</td><td class="line">  <span class='keyword'>if</span> (pState-&gt;m_has_flushed &amp;&amp; (flush != MZ_FINISH)) <span class='keyword'>return</span> MZ_STREAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1233"><td class="num" id="LN1233">1233</td><td class="line">  pState-&gt;m_has_flushed |= (flush == MZ_FINISH);</td></tr>
<tr class="codeline" data-linenumber="1234"><td class="num" id="LN1234">1234</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1235"><td class="num" id="LN1235">1235</td><td class="line">  <span class='keyword'>if</span> ((flush == MZ_FINISH) &amp;&amp; (first_call))</td></tr>
<tr class="codeline" data-linenumber="1236"><td class="num" id="LN1236">1236</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1237"><td class="num" id="LN1237">1237</td><td class="line">    <span class='comment'>// MZ_FINISH on the first call implies that the input and output buffers are large enough to hold the entire compressed/decompressed file.</span></td></tr>
<tr class="codeline" data-linenumber="1238"><td class="num" id="LN1238">1238</td><td class="line">    decomp_flags |= TINFL_FLAG_USING_NON_WRAPPING_OUTPUT_BUF;</td></tr>
<tr class="codeline" data-linenumber="1239"><td class="num" id="LN1239">1239</td><td class="line">    in_bytes = pStream-&gt;avail_in; out_bytes = pStream-&gt;avail_out;</td></tr>
<tr class="codeline" data-linenumber="1240"><td class="num" id="LN1240">1240</td><td class="line">    status = tinfl_decompress(&amp;pState-&gt;m_decomp, pStream-&gt;next_in, &amp;in_bytes, pStream-&gt;next_out, pStream-&gt;next_out, &amp;out_bytes, decomp_flags);</td></tr>
<tr class="codeline" data-linenumber="1241"><td class="num" id="LN1241">1241</td><td class="line">    pState-&gt;m_last_status = status;</td></tr>
<tr class="codeline" data-linenumber="1242"><td class="num" id="LN1242">1242</td><td class="line">    pStream-&gt;next_in += (mz_uint)in_bytes; pStream-&gt;avail_in -= (mz_uint)in_bytes; pStream-&gt;total_in += (mz_uint)in_bytes;</td></tr>
<tr class="codeline" data-linenumber="1243"><td class="num" id="LN1243">1243</td><td class="line">    pStream-&gt;adler = <span class='macro'>tinfl_get_adler32(&amp;pState-&gt;m_decomp)<span class='macro_popup'>(&amp;pState-&gt;m_decomp)-&gt;m_check_adler32</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1244"><td class="num" id="LN1244">1244</td><td class="line">    pStream-&gt;next_out += (mz_uint)out_bytes; pStream-&gt;avail_out -= (mz_uint)out_bytes; pStream-&gt;total_out += (mz_uint)out_bytes;</td></tr>
<tr class="codeline" data-linenumber="1245"><td class="num" id="LN1245">1245</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1246"><td class="num" id="LN1246">1246</td><td class="line">    <span class='keyword'>if</span> (status &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="1247"><td class="num" id="LN1247">1247</td><td class="line">      <span class='keyword'>return</span> MZ_DATA_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1248"><td class="num" id="LN1248">1248</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (status != TINFL_STATUS_DONE)</td></tr>
<tr class="codeline" data-linenumber="1249"><td class="num" id="LN1249">1249</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1250"><td class="num" id="LN1250">1250</td><td class="line">      pState-&gt;m_last_status = TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="1251"><td class="num" id="LN1251">1251</td><td class="line">      <span class='keyword'>return</span> MZ_BUF_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1252"><td class="num" id="LN1252">1252</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1253"><td class="num" id="LN1253">1253</td><td class="line">    <span class='keyword'>return</span> MZ_STREAM_END;</td></tr>
<tr class="codeline" data-linenumber="1254"><td class="num" id="LN1254">1254</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1255"><td class="num" id="LN1255">1255</td><td class="line">  <span class='comment'>// flush != MZ_FINISH then we must assume there's more input.</span></td></tr>
<tr class="codeline" data-linenumber="1256"><td class="num" id="LN1256">1256</td><td class="line">  <span class='keyword'>if</span> (flush != MZ_FINISH) decomp_flags |= TINFL_FLAG_HAS_MORE_INPUT;</td></tr>
<tr class="codeline" data-linenumber="1257"><td class="num" id="LN1257">1257</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1258"><td class="num" id="LN1258">1258</td><td class="line">  <span class='keyword'>if</span> (pState-&gt;m_dict_avail)</td></tr>
<tr class="codeline" data-linenumber="1259"><td class="num" id="LN1259">1259</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1260"><td class="num" id="LN1260">1260</td><td class="line">    n = <span class='macro'>MZ_MIN(pState-&gt;m_dict_avail, pStream-&gt;avail_out)<span class='macro_popup'>(((pState-&gt;m_dict_avail)&lt;(pStream-&gt;avail_out))?(pState<br>-&gt;m_dict_avail):(pStream-&gt;avail_out))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1261"><td class="num" id="LN1261">1261</td><td class="line">    memcpy(pStream-&gt;next_out, pState-&gt;m_dict + pState-&gt;m_dict_ofs, n);</td></tr>
<tr class="codeline" data-linenumber="1262"><td class="num" id="LN1262">1262</td><td class="line">    pStream-&gt;next_out += n; pStream-&gt;avail_out -= n; pStream-&gt;total_out += n;</td></tr>
<tr class="codeline" data-linenumber="1263"><td class="num" id="LN1263">1263</td><td class="line">    pState-&gt;m_dict_avail -= n; pState-&gt;m_dict_ofs = (pState-&gt;m_dict_ofs + n) &amp; (<span class='macro'>TINFL_LZ_DICT_SIZE<span class='macro_popup'>32768</span></span> - 1);</td></tr>
<tr class="codeline" data-linenumber="1264"><td class="num" id="LN1264">1264</td><td class="line">    <span class='keyword'>return</span> ((pState-&gt;m_last_status == TINFL_STATUS_DONE) &amp;&amp; (!pState-&gt;m_dict_avail)) ? MZ_STREAM_END : MZ_OK;</td></tr>
<tr class="codeline" data-linenumber="1265"><td class="num" id="LN1265">1265</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1266"><td class="num" id="LN1266">1266</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1267"><td class="num" id="LN1267">1267</td><td class="line">  <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="1268"><td class="num" id="LN1268">1268</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1269"><td class="num" id="LN1269">1269</td><td class="line">    in_bytes = pStream-&gt;avail_in;</td></tr>
<tr class="codeline" data-linenumber="1270"><td class="num" id="LN1270">1270</td><td class="line">    out_bytes = <span class='macro'>TINFL_LZ_DICT_SIZE<span class='macro_popup'>32768</span></span> - pState-&gt;m_dict_ofs;</td></tr>
<tr class="codeline" data-linenumber="1271"><td class="num" id="LN1271">1271</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1272"><td class="num" id="LN1272">1272</td><td class="line">    status = tinfl_decompress(&amp;pState-&gt;m_decomp, pStream-&gt;next_in, &amp;in_bytes, pState-&gt;m_dict, pState-&gt;m_dict + pState-&gt;m_dict_ofs, &amp;out_bytes, decomp_flags);</td></tr>
<tr class="codeline" data-linenumber="1273"><td class="num" id="LN1273">1273</td><td class="line">    pState-&gt;m_last_status = status;</td></tr>
<tr class="codeline" data-linenumber="1274"><td class="num" id="LN1274">1274</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1275"><td class="num" id="LN1275">1275</td><td class="line">    pStream-&gt;next_in += (mz_uint)in_bytes; pStream-&gt;avail_in -= (mz_uint)in_bytes;</td></tr>
<tr class="codeline" data-linenumber="1276"><td class="num" id="LN1276">1276</td><td class="line">    pStream-&gt;total_in += (mz_uint)in_bytes; pStream-&gt;adler = <span class='macro'>tinfl_get_adler32(&amp;pState-&gt;m_decomp)<span class='macro_popup'>(&amp;pState-&gt;m_decomp)-&gt;m_check_adler32</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1277"><td class="num" id="LN1277">1277</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1278"><td class="num" id="LN1278">1278</td><td class="line">    pState-&gt;m_dict_avail = (mz_uint)out_bytes;</td></tr>
<tr class="codeline" data-linenumber="1279"><td class="num" id="LN1279">1279</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1280"><td class="num" id="LN1280">1280</td><td class="line">    n = <span class='macro'>MZ_MIN(pState-&gt;m_dict_avail, pStream-&gt;avail_out)<span class='macro_popup'>(((pState-&gt;m_dict_avail)&lt;(pStream-&gt;avail_out))?(pState<br>-&gt;m_dict_avail):(pStream-&gt;avail_out))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1281"><td class="num" id="LN1281">1281</td><td class="line">    memcpy(pStream-&gt;next_out, pState-&gt;m_dict + pState-&gt;m_dict_ofs, n);</td></tr>
<tr class="codeline" data-linenumber="1282"><td class="num" id="LN1282">1282</td><td class="line">    pStream-&gt;next_out += n; pStream-&gt;avail_out -= n; pStream-&gt;total_out += n;</td></tr>
<tr class="codeline" data-linenumber="1283"><td class="num" id="LN1283">1283</td><td class="line">    pState-&gt;m_dict_avail -= n; pState-&gt;m_dict_ofs = (pState-&gt;m_dict_ofs + n) &amp; (<span class='macro'>TINFL_LZ_DICT_SIZE<span class='macro_popup'>32768</span></span> - 1);</td></tr>
<tr class="codeline" data-linenumber="1284"><td class="num" id="LN1284">1284</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1285"><td class="num" id="LN1285">1285</td><td class="line">    <span class='keyword'>if</span> (status &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="1286"><td class="num" id="LN1286">1286</td><td class="line">       <span class='keyword'>return</span> MZ_DATA_ERROR; <span class='comment'>// Stream is corrupted (there could be some uncompressed data left in the output dictionary - oh well).</span></td></tr>
<tr class="codeline" data-linenumber="1287"><td class="num" id="LN1287">1287</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> ((status == TINFL_STATUS_NEEDS_MORE_INPUT) &amp;&amp; (!orig_avail_in))</td></tr>
<tr class="codeline" data-linenumber="1288"><td class="num" id="LN1288">1288</td><td class="line">      <span class='keyword'>return</span> MZ_BUF_ERROR; <span class='comment'>// Signal caller that we can't make forward progress without supplying more input or by setting flush to MZ_FINISH.</span></td></tr>
<tr class="codeline" data-linenumber="1289"><td class="num" id="LN1289">1289</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (flush == MZ_FINISH)</td></tr>
<tr class="codeline" data-linenumber="1290"><td class="num" id="LN1290">1290</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1291"><td class="num" id="LN1291">1291</td><td class="line">       <span class='comment'>// The output buffer MUST be large to hold the remaining uncompressed data when flush==MZ_FINISH.</span></td></tr>
<tr class="codeline" data-linenumber="1292"><td class="num" id="LN1292">1292</td><td class="line">       <span class='keyword'>if</span> (status == TINFL_STATUS_DONE)</td></tr>
<tr class="codeline" data-linenumber="1293"><td class="num" id="LN1293">1293</td><td class="line">          <span class='keyword'>return</span> pState-&gt;m_dict_avail ? MZ_BUF_ERROR : MZ_STREAM_END;</td></tr>
<tr class="codeline" data-linenumber="1294"><td class="num" id="LN1294">1294</td><td class="line">       <span class='comment'>// status here must be TINFL_STATUS_HAS_MORE_OUTPUT, which means there's at least 1 more byte on the way. If there's no more room left in the output buffer then something is wrong.</span></td></tr>
<tr class="codeline" data-linenumber="1295"><td class="num" id="LN1295">1295</td><td class="line">       <span class='keyword'>else</span> <span class='keyword'>if</span> (!pStream-&gt;avail_out)</td></tr>
<tr class="codeline" data-linenumber="1296"><td class="num" id="LN1296">1296</td><td class="line">          <span class='keyword'>return</span> MZ_BUF_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1297"><td class="num" id="LN1297">1297</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1298"><td class="num" id="LN1298">1298</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> ((status == TINFL_STATUS_DONE) || (!pStream-&gt;avail_in) || (!pStream-&gt;avail_out) || (pState-&gt;m_dict_avail))</td></tr>
<tr class="codeline" data-linenumber="1299"><td class="num" id="LN1299">1299</td><td class="line">      <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1300"><td class="num" id="LN1300">1300</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1301"><td class="num" id="LN1301">1301</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1302"><td class="num" id="LN1302">1302</td><td class="line">  <span class='keyword'>return</span> ((status == TINFL_STATUS_DONE) &amp;&amp; (!pState-&gt;m_dict_avail)) ? MZ_STREAM_END : MZ_OK;</td></tr>
<tr class="codeline" data-linenumber="1303"><td class="num" id="LN1303">1303</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1304"><td class="num" id="LN1304">1304</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1305"><td class="num" id="LN1305">1305</td><td class="line"><span class='keyword'>int</span> mz_inflateEnd(mz_streamp pStream)</td></tr>
<tr class="codeline" data-linenumber="1306"><td class="num" id="LN1306">1306</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1307"><td class="num" id="LN1307">1307</td><td class="line">  <span class='keyword'>if</span> (!pStream)</td></tr>
<tr class="codeline" data-linenumber="1308"><td class="num" id="LN1308">1308</td><td class="line">    <span class='keyword'>return</span> MZ_STREAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1309"><td class="num" id="LN1309">1309</td><td class="line">  <span class='keyword'>if</span> (pStream-&gt;state)</td></tr>
<tr class="codeline" data-linenumber="1310"><td class="num" id="LN1310">1310</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1311"><td class="num" id="LN1311">1311</td><td class="line">    pStream-&gt;zfree(pStream-&gt;opaque, pStream-&gt;state);</td></tr>
<tr class="codeline" data-linenumber="1312"><td class="num" id="LN1312">1312</td><td class="line">    pStream-&gt;state = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1313"><td class="num" id="LN1313">1313</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1314"><td class="num" id="LN1314">1314</td><td class="line">  <span class='keyword'>return</span> MZ_OK;</td></tr>
<tr class="codeline" data-linenumber="1315"><td class="num" id="LN1315">1315</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1316"><td class="num" id="LN1316">1316</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1317"><td class="num" id="LN1317">1317</td><td class="line"><span class='keyword'>int</span> mz_uncompress(<span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pDest, mz_ulong *pDest_len, <span class='keyword'>const</span> <span class='keyword'>unsigned</span> <span class='keyword'>char</span> *pSource, mz_ulong source_len)</td></tr>
<tr class="codeline" data-linenumber="1318"><td class="num" id="LN1318">1318</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1319"><td class="num" id="LN1319">1319</td><td class="line">  mz_stream stream;</td></tr>
<tr class="codeline" data-linenumber="1320"><td class="num" id="LN1320">1320</td><td class="line">  <span class='keyword'>int</span> status;</td></tr>
<tr class="codeline" data-linenumber="1321"><td class="num" id="LN1321">1321</td><td class="line">  memset(&amp;stream, 0, <span class='keyword'>sizeof</span>(stream));</td></tr>
<tr class="codeline" data-linenumber="1322"><td class="num" id="LN1322">1322</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1323"><td class="num" id="LN1323">1323</td><td class="line">  <span class='comment'>// In case mz_ulong is 64-bits (argh I hate longs).</span></td></tr>
<tr class="codeline" data-linenumber="1324"><td class="num" id="LN1324">1324</td><td class="line">  <span class='keyword'>if</span> ((source_len | *pDest_len) &gt; 0xFFFFFFFFU) <span class='keyword'>return</span> MZ_PARAM_ERROR;</td></tr>
<tr class="codeline" data-linenumber="1325"><td class="num" id="LN1325">1325</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1326"><td class="num" id="LN1326">1326</td><td class="line">  stream.next_in = pSource;</td></tr>
<tr class="codeline" data-linenumber="1327"><td class="num" id="LN1327">1327</td><td class="line">  stream.avail_in = (mz_uint32)source_len;</td></tr>
<tr class="codeline" data-linenumber="1328"><td class="num" id="LN1328">1328</td><td class="line">  stream.next_out = pDest;</td></tr>
<tr class="codeline" data-linenumber="1329"><td class="num" id="LN1329">1329</td><td class="line">  stream.avail_out = (mz_uint32)*pDest_len;</td></tr>
<tr class="codeline" data-linenumber="1330"><td class="num" id="LN1330">1330</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1331"><td class="num" id="LN1331">1331</td><td class="line">  status = mz_inflateInit(&amp;stream);</td></tr>
<tr class="codeline" data-linenumber="1332"><td class="num" id="LN1332">1332</td><td class="line">  <span class='keyword'>if</span> (status != MZ_OK)</td></tr>
<tr class="codeline" data-linenumber="1333"><td class="num" id="LN1333">1333</td><td class="line">    <span class='keyword'>return</span> status;</td></tr>
<tr class="codeline" data-linenumber="1334"><td class="num" id="LN1334">1334</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1335"><td class="num" id="LN1335">1335</td><td class="line">  status = mz_inflate(&amp;stream, MZ_FINISH);</td></tr>
<tr class="codeline" data-linenumber="1336"><td class="num" id="LN1336">1336</td><td class="line">  <span class='keyword'>if</span> (status != MZ_STREAM_END)</td></tr>
<tr class="codeline" data-linenumber="1337"><td class="num" id="LN1337">1337</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1338"><td class="num" id="LN1338">1338</td><td class="line">    mz_inflateEnd(&amp;stream);</td></tr>
<tr class="codeline" data-linenumber="1339"><td class="num" id="LN1339">1339</td><td class="line">    <span class='keyword'>return</span> ((status == MZ_BUF_ERROR) &amp;&amp; (!stream.avail_in)) ? MZ_DATA_ERROR : status;</td></tr>
<tr class="codeline" data-linenumber="1340"><td class="num" id="LN1340">1340</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1341"><td class="num" id="LN1341">1341</td><td class="line">  *pDest_len = stream.total_out;</td></tr>
<tr class="codeline" data-linenumber="1342"><td class="num" id="LN1342">1342</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1343"><td class="num" id="LN1343">1343</td><td class="line">  <span class='keyword'>return</span> mz_inflateEnd(&amp;stream);</td></tr>
<tr class="codeline" data-linenumber="1344"><td class="num" id="LN1344">1344</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1345"><td class="num" id="LN1345">1345</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1346"><td class="num" id="LN1346">1346</td><td class="line"><span class='keyword'>const</span> <span class='keyword'>char</span> *mz_error(<span class='keyword'>int</span> err)</td></tr>
<tr class="codeline" data-linenumber="1347"><td class="num" id="LN1347">1347</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1348"><td class="num" id="LN1348">1348</td><td class="line">  <span class='keyword'>static</span> <span class='keyword'>struct</span> { <span class='keyword'>int</span> m_err; <span class='keyword'>const</span> <span class='keyword'>char</span> *m_pDesc; } s_error_descs[] =</td></tr>
<tr class="codeline" data-linenumber="1349"><td class="num" id="LN1349">1349</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1350"><td class="num" id="LN1350">1350</td><td class="line">    { MZ_OK, <span class='string_literal'>""</span> }, { MZ_STREAM_END, <span class='string_literal'>"stream end"</span> }, { MZ_NEED_DICT, <span class='string_literal'>"need dictionary"</span> }, { MZ_ERRNO, <span class='string_literal'>"file error"</span> }, { MZ_STREAM_ERROR, <span class='string_literal'>"stream error"</span> },</td></tr>
<tr class="codeline" data-linenumber="1351"><td class="num" id="LN1351">1351</td><td class="line">    { MZ_DATA_ERROR, <span class='string_literal'>"data error"</span> }, { MZ_MEM_ERROR, <span class='string_literal'>"out of memory"</span> }, { MZ_BUF_ERROR, <span class='string_literal'>"buf error"</span> }, { MZ_VERSION_ERROR, <span class='string_literal'>"version error"</span> }, { MZ_PARAM_ERROR, <span class='string_literal'>"parameter error"</span> }</td></tr>
<tr class="codeline" data-linenumber="1352"><td class="num" id="LN1352">1352</td><td class="line">  };</td></tr>
<tr class="codeline" data-linenumber="1353"><td class="num" id="LN1353">1353</td><td class="line">  mz_uint i; <span class='keyword'>for</span> (i = 0; i &lt; <span class='keyword'>sizeof</span>(s_error_descs) / <span class='keyword'>sizeof</span>(s_error_descs[0]); ++i) <span class='keyword'>if</span> (s_error_descs[i].m_err == err) <span class='keyword'>return</span> s_error_descs[i].m_pDesc;</td></tr>
<tr class="codeline" data-linenumber="1354"><td class="num" id="LN1354">1354</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1355"><td class="num" id="LN1355">1355</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1356"><td class="num" id="LN1356">1356</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1357"><td class="num" id="LN1357">1357</td><td class="line"><span class='directive'>#endif //MINIZ_NO_ZLIB_APIS</span></td></tr>
<tr class="codeline" data-linenumber="1358"><td class="num" id="LN1358">1358</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1359"><td class="num" id="LN1359">1359</td><td class="line"><span class='comment'>// ------------------- Low-level Decompression (completely independent from all compression API's)</span></td></tr>
<tr class="codeline" data-linenumber="1360"><td class="num" id="LN1360">1360</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1361"><td class="num" id="LN1361">1361</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_MEMCPY(d, s, l)<span class='macro_popup'>memcpy(d, s, l)</span></span> memcpy(d, s, l)</span></td></tr>
<tr class="codeline" data-linenumber="1362"><td class="num" id="LN1362">1362</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_MEMSET(p, c, l)<span class='macro_popup'>memset(p, c, l)</span></span> memset(p, c, l)</span></td></tr>
<tr class="codeline" data-linenumber="1363"><td class="num" id="LN1363">1363</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1364"><td class="num" id="LN1364">1364</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_CR_BEGIN<span class='macro_popup'>switch(r-&gt;m_state) { case 0:</span></span> switch(r-&gt;m_state) { case 0:</span></td></tr>
<tr class="codeline" data-linenumber="1365"><td class="num" id="LN1365">1365</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_CR_RETURN(state_index, result)<span class='macro_popup'>do { status = result; r-&gt;m_state = state_index; goto common_exit<br>; case state_index:; } while (0)</span></span> do { status = result; r-&gt;m_state = state_index; goto common_exit; case state_index:; } <span class='macro'>MZ_MACRO_END<span class='macro_popup'>while (0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1366"><td class="num" id="LN1366">1366</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_CR_RETURN_FOREVER(state_index, result)<span class='macro_popup'>do { for ( ; ; ) { do { status = result; r-&gt;m_state = state_index<br>; goto common_exit; case state_index:; } while (0); } } while<br> (0)</span></span> do { for ( ; ; ) { <span class='macro'>TINFL_CR_RETURN(state_index, result)<span class='macro_popup'>do { status = result; r-&gt;m_state = state_index; goto common_exit<br>; case state_index:; } while (0)</span></span>; } } <span class='macro'>MZ_MACRO_END<span class='macro_popup'>while (0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1367"><td class="num" id="LN1367">1367</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_CR_FINISH<span class='macro_popup'>}</span></span> }</span></td></tr>
<tr class="codeline" data-linenumber="1368"><td class="num" id="LN1368">1368</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1369"><td class="num" id="LN1369">1369</td><td class="line"><span class='comment'>// TODO: If the caller has indicated that there's no more input, and we attempt to read beyond the input buf, then something is wrong with the input because the inflator never</span></td></tr>
<tr class="codeline" data-linenumber="1370"><td class="num" id="LN1370">1370</td><td class="line"><span class='comment'>// reads ahead more than it needs to. Currently TINFL_GET_BYTE() pads the end of the stream with 0's in this scenario.</span></td></tr>
<tr class="codeline" data-linenumber="1371"><td class="num" id="LN1371">1371</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_GET_BYTE(state_index, c)<span class='macro_popup'>do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = state_index; goto common_exit; case state_index<br>:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur<br>++; break; } } else { c = 0; break; } } } else c = *pIn_buf_cur<br>++; } while (0)</span></span> do { \</span></td></tr>
<tr class="codeline" data-linenumber="1372"><td class="num" id="LN1372">1372</td><td class="line">  <span class='directive'>if (pIn_buf_cur &gt;= pIn_buf_end) { \</span></td></tr>
<tr class="codeline" data-linenumber="1373"><td class="num" id="LN1373">1373</td><td class="line">    <span class='directive'>for ( ; ; ) { \</span></td></tr>
<tr class="codeline" data-linenumber="1374"><td class="num" id="LN1374">1374</td><td class="line">      <span class='directive'>if (decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) { \</span></td></tr>
<tr class="codeline" data-linenumber="1375"><td class="num" id="LN1375">1375</td><td class="line">        <span class='directive'><span class='macro'>TINFL_CR_RETURN(state_index, TINFL_STATUS_NEEDS_MORE_INPUT)<span class='macro_popup'>do { status = TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state = state_index<br>; goto common_exit; case state_index:; } while (0)</span></span>; \</span></td></tr>
<tr class="codeline" data-linenumber="1376"><td class="num" id="LN1376">1376</td><td class="line">        <span class='directive'>if (pIn_buf_cur &lt; pIn_buf_end) { \</span></td></tr>
<tr class="codeline" data-linenumber="1377"><td class="num" id="LN1377">1377</td><td class="line">          <span class='directive'>c = *pIn_buf_cur++; \</span></td></tr>
<tr class="codeline" data-linenumber="1378"><td class="num" id="LN1378">1378</td><td class="line">          <span class='directive'>break; \</span></td></tr>
<tr class="codeline" data-linenumber="1379"><td class="num" id="LN1379">1379</td><td class="line">        <span class='directive'>} \</span></td></tr>
<tr class="codeline" data-linenumber="1380"><td class="num" id="LN1380">1380</td><td class="line">      <span class='directive'>} else { \</span></td></tr>
<tr class="codeline" data-linenumber="1381"><td class="num" id="LN1381">1381</td><td class="line">        <span class='directive'>c = 0; \</span></td></tr>
<tr class="codeline" data-linenumber="1382"><td class="num" id="LN1382">1382</td><td class="line">        <span class='directive'>break; \</span></td></tr>
<tr class="codeline" data-linenumber="1383"><td class="num" id="LN1383">1383</td><td class="line">      <span class='directive'>} \</span></td></tr>
<tr class="codeline" data-linenumber="1384"><td class="num" id="LN1384">1384</td><td class="line">    <span class='directive'>} \</span></td></tr>
<tr class="codeline" data-linenumber="1385"><td class="num" id="LN1385">1385</td><td class="line">  <span class='directive'>} else c = *pIn_buf_cur++; } <span class='macro'>MZ_MACRO_END<span class='macro_popup'>while (0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1386"><td class="num" id="LN1386">1386</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1387"><td class="num" id="LN1387">1387</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_NEED_BITS(state_index, n)<span class='macro_popup'>do { mz_uint c; do { if (pIn_buf_cur &gt;= pIn_buf_end) { for<br> ( ; ; ) { if (decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) {<br> do { status = TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state =<br> state_index; goto common_exit; case state_index:; } while (0<br>); if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur++; break<br>; } } else { c = 0; break; } } } else c = *pIn_buf_cur++; } while<br> (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits<br> += 8; } while (num_bits &lt; (mz_uint)(n))</span></span> do { mz_uint c; <span class='macro'>TINFL_GET_BYTE(state_index, c)<span class='macro_popup'>do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = state_index; goto common_exit; case state_index<br>:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur<br>++; break; } } else { c = 0; break; } } } else c = *pIn_buf_cur<br>++; } while (0)</span></span>; bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits += 8; } while (num_bits &lt; (mz_uint)(n))</span></td></tr>
<tr class="codeline" data-linenumber="1388"><td class="num" id="LN1388">1388</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_SKIP_BITS(state_index, n)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(n)) { do { mz_uint c; do { if<br> (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = state_index; goto common_exit; case state_index<br>:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur<br>++; break; } } else { c = 0; break; } } } else c = *pIn_buf_cur<br>++; } while (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits<br>); num_bits += 8; } while (num_bits &lt; (mz_uint)(n)); } bit_buf<br> &gt;&gt;= (n); num_bits -= (n); } while (0)</span></span> do { if (num_bits &lt; (mz_uint)(n)) { <span class='macro'>TINFL_NEED_BITS(state_index, n)<span class='macro_popup'>do { mz_uint c; do { if (pIn_buf_cur &gt;= pIn_buf_end) { for<br> ( ; ; ) { if (decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) {<br> do { status = TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state =<br> state_index; goto common_exit; case state_index:; } while (0<br>); if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur++; break<br>; } } else { c = 0; break; } } } else c = *pIn_buf_cur++; } while<br> (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits<br> += 8; } while (num_bits &lt; (mz_uint)(n))</span></span>; } bit_buf &gt;&gt;= (n); num_bits -= (n); } <span class='macro'>MZ_MACRO_END<span class='macro_popup'>while (0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1389"><td class="num" id="LN1389">1389</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_GET_BITS(state_index, b, n)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(n)) { do { mz_uint c; do { if<br> (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = state_index; goto common_exit; case state_index<br>:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur<br>++; break; } } else { c = 0; break; } } } else c = *pIn_buf_cur<br>++; } while (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits<br>); num_bits += 8; } while (num_bits &lt; (mz_uint)(n)); } b =<br> bit_buf &amp; ((1 &lt;&lt; (n)) - 1); bit_buf &gt;&gt;= (n);<br> num_bits -= (n); } while (0)</span></span> do { if (num_bits &lt; (mz_uint)(n)) { <span class='macro'>TINFL_NEED_BITS(state_index, n)<span class='macro_popup'>do { mz_uint c; do { if (pIn_buf_cur &gt;= pIn_buf_end) { for<br> ( ; ; ) { if (decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) {<br> do { status = TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state =<br> state_index; goto common_exit; case state_index:; } while (0<br>); if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur++; break<br>; } } else { c = 0; break; } } } else c = *pIn_buf_cur++; } while<br> (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits<br> += 8; } while (num_bits &lt; (mz_uint)(n))</span></span>; } b = bit_buf &amp; ((1 &lt;&lt; (n)) - 1); bit_buf &gt;&gt;= (n); num_bits -= (n); } <span class='macro'>MZ_MACRO_END<span class='macro_popup'>while (0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1390"><td class="num" id="LN1390">1390</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1391"><td class="num" id="LN1391">1391</td><td class="line"><span class='comment'>// TINFL_HUFF_BITBUF_FILL() is only used rarely, when the number of bytes remaining in the input buffer falls below 2.</span></td></tr>
<tr class="codeline" data-linenumber="1392"><td class="num" id="LN1392">1392</td><td class="line"><span class='comment'>// It reads just enough bytes from the input stream that are needed to decode the next Huffman code (and absolutely no more). It works by trying to fully decode a</span></td></tr>
<tr class="codeline" data-linenumber="1393"><td class="num" id="LN1393">1393</td><td class="line"><span class='comment'>// Huffman code by using whatever bits are currently present in the bit buffer. If this fails, it reads another byte, and tries again until it succeeds or until the</span></td></tr>
<tr class="codeline" data-linenumber="1394"><td class="num" id="LN1394">1394</td><td class="line"><span class='comment'>// bit buffer contains &gt;=15 bits (deflate's max. Huffman code size).</span></td></tr>
<tr class="codeline" data-linenumber="1395"><td class="num" id="LN1395">1395</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_HUFF_BITBUF_FILL(state_index, pHuff)<span class='macro_popup'>do { temp = (pHuff)-&gt;m_look_up[bit_buf &amp; (TINFL_FAST_LOOKUP_SIZE<br> - 1)]; if (temp &gt;= 0) { code_len = temp &gt;&gt; 9; if ((<br>code_len) &amp;&amp; (num_bits &gt;= code_len)) break; } else<br> if (num_bits &gt; TINFL_FAST_LOOKUP_BITS) { code_len = TINFL_FAST_LOOKUP_BITS<br>; do { temp = (pHuff)-&gt;m_tree[~temp + ((bit_buf &gt;&gt; code_len<br>++) &amp; 1)]; } while ((temp &lt; 0) &amp;&amp; (num_bits &gt;=<br> (code_len + 1))); if (temp &gt;= 0) break; } do { if (pIn_buf_cur<br> &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT<br>) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state<br> = state_index; goto common_exit; case state_index:; } while (<br>0); if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur++; break<br>; } } else { c = 0; break; } } } else c = *pIn_buf_cur++; } while<br> (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits<br> += 8; } while (num_bits &lt; 15);</span></span> \</span></td></tr>
<tr class="codeline" data-linenumber="1396"><td class="num" id="LN1396">1396</td><td class="line">  <span class='directive'>do { \</span></td></tr>
<tr class="codeline" data-linenumber="1397"><td class="num" id="LN1397">1397</td><td class="line">    <span class='directive'>temp = (pHuff)-&gt;m_look_up[bit_buf &amp; (TINFL_FAST_LOOKUP_SIZE - 1)]; \</span></td></tr>
<tr class="codeline" data-linenumber="1398"><td class="num" id="LN1398">1398</td><td class="line">    <span class='directive'>if (temp &gt;= 0) { \</span></td></tr>
<tr class="codeline" data-linenumber="1399"><td class="num" id="LN1399">1399</td><td class="line">      <span class='directive'>code_len = temp &gt;&gt; 9; \</span></td></tr>
<tr class="codeline" data-linenumber="1400"><td class="num" id="LN1400">1400</td><td class="line">      <span class='directive'>if ((code_len) &amp;&amp; (num_bits &gt;= code_len)) \</span></td></tr>
<tr class="codeline" data-linenumber="1401"><td class="num" id="LN1401">1401</td><td class="line">      <span class='directive'>break; \</span></td></tr>
<tr class="codeline" data-linenumber="1402"><td class="num" id="LN1402">1402</td><td class="line">    <span class='directive'>} else if (num_bits &gt; TINFL_FAST_LOOKUP_BITS) { \</span></td></tr>
<tr class="codeline" data-linenumber="1403"><td class="num" id="LN1403">1403</td><td class="line">       <span class='directive'>code_len = TINFL_FAST_LOOKUP_BITS; \</span></td></tr>
<tr class="codeline" data-linenumber="1404"><td class="num" id="LN1404">1404</td><td class="line">       <span class='directive'>do { \</span></td></tr>
<tr class="codeline" data-linenumber="1405"><td class="num" id="LN1405">1405</td><td class="line">          <span class='directive'>temp = (pHuff)-&gt;m_tree[~temp + ((bit_buf &gt;&gt; code_len++) &amp; 1)]; \</span></td></tr>
<tr class="codeline" data-linenumber="1406"><td class="num" id="LN1406">1406</td><td class="line">       <span class='directive'>} while ((temp &lt; 0) &amp;&amp; (num_bits &gt;= (code_len + 1))); if (temp &gt;= 0) break; \</span></td></tr>
<tr class="codeline" data-linenumber="1407"><td class="num" id="LN1407">1407</td><td class="line">    <span class='directive'>} <span class='macro'>TINFL_GET_BYTE(state_index, c)<span class='macro_popup'>do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = state_index; goto common_exit; case state_index<br>:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur<br>++; break; } } else { c = 0; break; } } } else c = *pIn_buf_cur<br>++; } while (0)</span></span>; bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits += 8; \</span></td></tr>
<tr class="codeline" data-linenumber="1408"><td class="num" id="LN1408">1408</td><td class="line">  <span class='directive'>} while (num_bits &lt; 15);</span></td></tr>
<tr class="codeline" data-linenumber="1409"><td class="num" id="LN1409">1409</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1410"><td class="num" id="LN1410">1410</td><td class="line"><span class='comment'>// TINFL_HUFF_DECODE() decodes the next Huffman coded symbol. It's more complex than you would initially expect because the zlib API expects the decompressor to never read</span></td></tr>
<tr class="codeline" data-linenumber="1411"><td class="num" id="LN1411">1411</td><td class="line"><span class='comment'>// beyond the final byte of the deflate stream. (In other words, when this macro wants to read another byte from the input, it REALLY needs another byte in order to fully</span></td></tr>
<tr class="codeline" data-linenumber="1412"><td class="num" id="LN1412">1412</td><td class="line"><span class='comment'>// decode the next Huffman code.) Handling this properly is particularly important on raw deflate (non-zlib) streams, which aren't followed by a byte aligned adler-32.</span></td></tr>
<tr class="codeline" data-linenumber="1413"><td class="num" id="LN1413">1413</td><td class="line"><span class='comment'>// The slow path is only executed at the very end of the input buffer.</span></td></tr>
<tr class="codeline" data-linenumber="1414"><td class="num" id="LN1414">1414</td><td class="line"><span class='directive'>#define <span class='macro'>TINFL_HUFF_DECODE(state_index, sym, pHuff)<span class='macro_popup'>do { int temp; mz_uint code_len, c; if (num_bits &lt; 15) { if<br> ((pIn_buf_end - pIn_buf_cur) &lt; 2) { do { temp = (pHuff)-&gt;<br>m_look_up[bit_buf &amp; (TINFL_FAST_LOOKUP_SIZE - 1)]; if (temp<br> &gt;= 0) { code_len = temp &gt;&gt; 9; if ((code_len) &amp;&amp;<br> (num_bits &gt;= code_len)) break; } else if (num_bits &gt; TINFL_FAST_LOOKUP_BITS<br>) { code_len = TINFL_FAST_LOOKUP_BITS; do { temp = (pHuff)-&gt;<br>m_tree[~temp + ((bit_buf &gt;&gt; code_len++) &amp; 1)]; } while<br> ((temp &lt; 0) &amp;&amp; (num_bits &gt;= (code_len + 1))); if<br> (temp &gt;= 0) break; } do { if (pIn_buf_cur &gt;= pIn_buf_end<br>) { for ( ; ; ) { if (decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT<br>) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state<br> = state_index; goto common_exit; case state_index:; } while (<br>0); if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur++; break<br>; } } else { c = 0; break; } } } else c = *pIn_buf_cur++; } while<br> (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits<br> += 8; } while (num_bits &lt; 15);; } else { bit_buf |= (((tinfl_bit_buf_t<br>)pIn_buf_cur[0]) &lt;&lt; num_bits) | (((tinfl_bit_buf_t)pIn_buf_cur<br>[1]) &lt;&lt; (num_bits + 8)); pIn_buf_cur += 2; num_bits += 16<br>; } } if ((temp = (pHuff)-&gt;m_look_up[bit_buf &amp; (TINFL_FAST_LOOKUP_SIZE<br> - 1)]) &gt;= 0) code_len = temp &gt;&gt; 9, temp &amp;= 511;<br> else { code_len = TINFL_FAST_LOOKUP_BITS; do { temp = (pHuff<br>)-&gt;m_tree[~temp + ((bit_buf &gt;&gt; code_len++) &amp; 1)]<br>; } while (temp &lt; 0); } sym = temp; bit_buf &gt;&gt;= code_len<br>; num_bits -= code_len; } while (0)</span></span> do { \</span></td></tr>
<tr class="codeline" data-linenumber="1415"><td class="num" id="LN1415">1415</td><td class="line">  <span class='directive'>int temp; mz_uint code_len, c; \</span></td></tr>
<tr class="codeline" data-linenumber="1416"><td class="num" id="LN1416">1416</td><td class="line">  <span class='directive'>if (num_bits &lt; 15) { \</span></td></tr>
<tr class="codeline" data-linenumber="1417"><td class="num" id="LN1417">1417</td><td class="line">    <span class='directive'>if ((pIn_buf_end - pIn_buf_cur) &lt; 2) { \</span></td></tr>
<tr class="codeline" data-linenumber="1418"><td class="num" id="LN1418">1418</td><td class="line">       <span class='directive'><span class='macro'>TINFL_HUFF_BITBUF_FILL(state_index, pHuff)<span class='macro_popup'>do { temp = (pHuff)-&gt;m_look_up[bit_buf &amp; (TINFL_FAST_LOOKUP_SIZE<br> - 1)]; if (temp &gt;= 0) { code_len = temp &gt;&gt; 9; if ((<br>code_len) &amp;&amp; (num_bits &gt;= code_len)) break; } else<br> if (num_bits &gt; TINFL_FAST_LOOKUP_BITS) { code_len = TINFL_FAST_LOOKUP_BITS<br>; do { temp = (pHuff)-&gt;m_tree[~temp + ((bit_buf &gt;&gt; code_len<br>++) &amp; 1)]; } while ((temp &lt; 0) &amp;&amp; (num_bits &gt;=<br> (code_len + 1))); if (temp &gt;= 0) break; } do { if (pIn_buf_cur<br> &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT<br>) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state<br> = state_index; goto common_exit; case state_index:; } while (<br>0); if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur++; break<br>; } } else { c = 0; break; } } } else c = *pIn_buf_cur++; } while<br> (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits<br> += 8; } while (num_bits &lt; 15);</span></span>; \</span></td></tr>
<tr class="codeline" data-linenumber="1419"><td class="num" id="LN1419">1419</td><td class="line">    <span class='directive'>} else { \</span></td></tr>
<tr class="codeline" data-linenumber="1420"><td class="num" id="LN1420">1420</td><td class="line">       <span class='directive'>bit_buf |= (((tinfl_bit_buf_t)pIn_buf_cur[0]) &lt;&lt; num_bits) | (((tinfl_bit_buf_t)pIn_buf_cur[1]) &lt;&lt; (num_bits + 8)); pIn_buf_cur += 2; num_bits += 16; \</span></td></tr>
<tr class="codeline" data-linenumber="1421"><td class="num" id="LN1421">1421</td><td class="line">    <span class='directive'>} \</span></td></tr>
<tr class="codeline" data-linenumber="1422"><td class="num" id="LN1422">1422</td><td class="line">  <span class='directive'>} \</span></td></tr>
<tr class="codeline" data-linenumber="1423"><td class="num" id="LN1423">1423</td><td class="line">  <span class='directive'>if ((temp = (pHuff)-&gt;m_look_up[bit_buf &amp; (TINFL_FAST_LOOKUP_SIZE - 1)]) &gt;= 0) \</span></td></tr>
<tr class="codeline" data-linenumber="1424"><td class="num" id="LN1424">1424</td><td class="line">    <span class='directive'>code_len = temp &gt;&gt; 9, temp &amp;= 511; \</span></td></tr>
<tr class="codeline" data-linenumber="1425"><td class="num" id="LN1425">1425</td><td class="line">  <span class='directive'>else { \</span></td></tr>
<tr class="codeline" data-linenumber="1426"><td class="num" id="LN1426">1426</td><td class="line">    <span class='directive'>code_len = TINFL_FAST_LOOKUP_BITS; do { temp = (pHuff)-&gt;m_tree[~temp + ((bit_buf &gt;&gt; code_len++) &amp; 1)]; } while (temp &lt; 0); \</span></td></tr>
<tr class="codeline" data-linenumber="1427"><td class="num" id="LN1427">1427</td><td class="line">  <span class='directive'>} sym = temp; bit_buf &gt;&gt;= code_len; num_bits -= code_len; } <span class='macro'>MZ_MACRO_END<span class='macro_popup'>while (0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1428"><td class="num" id="LN1428">1428</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1429"><td class="num" id="LN1429">1429</td><td class="line">tinfl_status tinfl_decompress(tinfl_decompressor *r, <span class='keyword'>const</span> mz_uint8 *pIn_buf_next, size_t *pIn_buf_size, mz_uint8 *pOut_buf_start, mz_uint8 *pOut_buf_next, size_t *pOut_buf_size, <span class='keyword'>const</span> mz_uint32 decomp_flags)</td></tr>
<tr class="codeline" data-linenumber="1430"><td class="num" id="LN1430">1430</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1431"><td class="num" id="LN1431">1431</td><td class="line">  <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> s_length_base[31] = { 3,4,5,6,7,8,9,10,11,13, 15,17,19,23,27,31,35,43,51,59, 67,83,99,115,131,163,195,227,258,0,0 };</td></tr>
<tr class="codeline" data-linenumber="1432"><td class="num" id="LN1432">1432</td><td class="line">  <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> s_length_extra[31]= { 0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0 };</td></tr>
<tr class="codeline" data-linenumber="1433"><td class="num" id="LN1433">1433</td><td class="line">  <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> s_dist_base[32] = { 1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193, 257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0};</td></tr>
<tr class="codeline" data-linenumber="1434"><td class="num" id="LN1434">1434</td><td class="line">  <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> s_dist_extra[32] = { 0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13};</td></tr>
<tr class="codeline" data-linenumber="1435"><td class="num" id="LN1435">1435</td><td class="line">  <span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint8 s_length_dezigzag[19] = { 16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15 };</td></tr>
<tr class="codeline" data-linenumber="1436"><td class="num" id="LN1436">1436</td><td class="line">  <span class='keyword'>static</span> <span class='keyword'>const</span> <span class='keyword'>int</span> s_min_table_sizes[3] = { 257, 1, 4 };</td></tr>
<tr class="codeline" data-linenumber="1437"><td class="num" id="LN1437">1437</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1438"><td class="num" id="LN1438">1438</td><td class="line">  tinfl_status status = TINFL_STATUS_FAILED; mz_uint32 num_bits, dist, counter, num_extra; tinfl_bit_buf_t bit_buf;</td></tr>
<tr class="codeline" data-linenumber="1439"><td class="num" id="LN1439">1439</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *pIn_buf_cur = pIn_buf_next, *<span class='keyword'>const</span> pIn_buf_end = pIn_buf_next + *pIn_buf_size;</td></tr>
<tr class="codeline" data-linenumber="1440"><td class="num" id="LN1440">1440</td><td class="line">  mz_uint8 *pOut_buf_cur = pOut_buf_next, *<span class='keyword'>const</span> pOut_buf_end = pOut_buf_next + *pOut_buf_size;</td></tr>
<tr class="codeline" data-linenumber="1441"><td class="num" id="LN1441">1441</td><td class="line">  size_t out_buf_size_mask = (decomp_flags &amp; TINFL_FLAG_USING_NON_WRAPPING_OUTPUT_BUF) ? (size_t)-1 : ((pOut_buf_next - pOut_buf_start) + *pOut_buf_size) - 1, dist_from_out_buf_start;</td></tr>
<tr class="codeline" data-linenumber="1442"><td class="num" id="LN1442">1442</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1443"><td class="num" id="LN1443">1443</td><td class="line">  <span class='comment'>// Ensure the output buffer's size is a power of 2, unless the output buffer is large enough to hold the entire output file (in which case it doesn't matter).</span></td></tr>
<tr class="codeline" data-linenumber="1444"><td class="num" id="LN1444">1444</td><td class="line">  <span class='keyword'>if</span> (((out_buf_size_mask + 1) &amp; out_buf_size_mask) || (pOut_buf_next &lt; pOut_buf_start)) { *pIn_buf_size = *pOut_buf_size = 0; <span class='keyword'>return</span> TINFL_STATUS_BAD_PARAM; }</td></tr>
<tr class="codeline" data-linenumber="1445"><td class="num" id="LN1445">1445</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1446"><td class="num" id="LN1446">1446</td><td class="line">  num_bits = r-&gt;m_num_bits; bit_buf = r-&gt;m_bit_buf; dist = r-&gt;m_dist; counter = r-&gt;m_counter; num_extra = r-&gt;m_num_extra; dist_from_out_buf_start = r-&gt;m_dist_from_out_buf_start;</td></tr>
<tr class="codeline" data-linenumber="1447"><td class="num" id="LN1447">1447</td><td class="line">  <span class='macro'>TINFL_CR_BEGIN<span class='macro_popup'>switch(r-&gt;m_state) { case 0:</span></span></td></tr>
<tr class="codeline" data-linenumber="1448"><td class="num" id="LN1448">1448</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1449"><td class="num" id="LN1449">1449</td><td class="line">  bit_buf = num_bits = dist = counter = num_extra = r-&gt;m_zhdr0 = r-&gt;m_zhdr1 = 0; r-&gt;m_z_adler32 = r-&gt;m_check_adler32 = 1;</td></tr>
<tr class="codeline" data-linenumber="1450"><td class="num" id="LN1450">1450</td><td class="line">  <span class='keyword'>if</span> (decomp_flags &amp; TINFL_FLAG_PARSE_ZLIB_HEADER)</td></tr>
<tr class="codeline" data-linenumber="1451"><td class="num" id="LN1451">1451</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1452"><td class="num" id="LN1452">1452</td><td class="line">    <span class='macro'>TINFL_GET_BYTE(1, r-&gt;m_zhdr0)<span class='macro_popup'>do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = 1; goto common_exit; case 1:; } while (0); if<br> (pIn_buf_cur &lt; pIn_buf_end) { r-&gt;m_zhdr0 = *pIn_buf_cur<br>++; break; } } else { r-&gt;m_zhdr0 = 0; break; } } } else r-&gt;<br>m_zhdr0 = *pIn_buf_cur++; } while (0)</span></span>; <span class='macro'>TINFL_GET_BYTE(2, r-&gt;m_zhdr1)<span class='macro_popup'>do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = 2; goto common_exit; case 2:; } while (0); if<br> (pIn_buf_cur &lt; pIn_buf_end) { r-&gt;m_zhdr1 = *pIn_buf_cur<br>++; break; } } else { r-&gt;m_zhdr1 = 0; break; } } } else r-&gt;<br>m_zhdr1 = *pIn_buf_cur++; } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1453"><td class="num" id="LN1453">1453</td><td class="line">    counter = (((r-&gt;m_zhdr0 * 256 + r-&gt;m_zhdr1) % 31 != 0) || (r-&gt;m_zhdr1 &amp; 32) || ((r-&gt;m_zhdr0 &amp; 15) != 8));</td></tr>
<tr class="codeline" data-linenumber="1454"><td class="num" id="LN1454">1454</td><td class="line">    <span class='keyword'>if</span> (!(decomp_flags &amp; TINFL_FLAG_USING_NON_WRAPPING_OUTPUT_BUF)) counter |= (((1U &lt;&lt; (8U + (r-&gt;m_zhdr0 &gt;&gt; 4))) &gt; 32768U) || ((out_buf_size_mask + 1) &lt; (size_t)(1U &lt;&lt; (8U + (r-&gt;m_zhdr0 &gt;&gt; 4)))));</td></tr>
<tr class="codeline" data-linenumber="1455"><td class="num" id="LN1455">1455</td><td class="line">    <span class='keyword'>if</span> (counter) { <span class='macro'>TINFL_CR_RETURN_FOREVER(36, TINFL_STATUS_FAILED)<span class='macro_popup'>do { for ( ; ; ) { do { status = TINFL_STATUS_FAILED; r-&gt;m_state<br> = 36; goto common_exit; case 36:; } while (0); } } while (0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1456"><td class="num" id="LN1456">1456</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1457"><td class="num" id="LN1457">1457</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1458"><td class="num" id="LN1458">1458</td><td class="line">  <span class='keyword'>do</span></td></tr>
<tr class="codeline" data-linenumber="1459"><td class="num" id="LN1459">1459</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1460"><td class="num" id="LN1460">1460</td><td class="line">    <span class='macro'>TINFL_GET_BITS(3, r-&gt;m_final, 3)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(3)) { do { mz_uint c; do { if<br> (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = 3; goto common_exit; case 3:; } while (0); if<br> (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur++; break; }<br> } else { c = 0; break; } } } else c = *pIn_buf_cur++; } while<br> (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits<br> += 8; } while (num_bits &lt; (mz_uint)(3)); } r-&gt;m_final =<br> bit_buf &amp; ((1 &lt;&lt; (3)) - 1); bit_buf &gt;&gt;= (3);<br> num_bits -= (3); } while (0)</span></span>; r-&gt;m_type = r-&gt;m_final &gt;&gt; 1;</td></tr>
<tr class="codeline" data-linenumber="1461"><td class="num" id="LN1461">1461</td><td class="line">    <span class='keyword'>if</span> (r-&gt;m_type == 0)</td></tr>
<tr class="codeline" data-linenumber="1462"><td class="num" id="LN1462">1462</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1463"><td class="num" id="LN1463">1463</td><td class="line">      <span class='macro'>TINFL_SKIP_BITS(5, num_bits &amp; 7)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(num_bits &amp; 7)) { do { mz_uint<br> c; do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if<br> (decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status<br> = TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state = 5; goto common_exit<br>; case 5:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c<br> = *pIn_buf_cur++; break; } } else { c = 0; break; } } } else<br> c = *pIn_buf_cur++; } while (0); bit_buf |= (((tinfl_bit_buf_t<br>)c) &lt;&lt; num_bits); num_bits += 8; } while (num_bits &lt;<br> (mz_uint)(num_bits &amp; 7)); } bit_buf &gt;&gt;= (num_bits &amp;<br> 7); num_bits -= (num_bits &amp; 7); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1464"><td class="num" id="LN1464">1464</td><td class="line">      <span class='keyword'>for</span> (counter = 0; counter &lt; 4; ++counter) { <span class='keyword'>if</span> (num_bits) <span class='macro'>TINFL_GET_BITS(6, r-&gt;m_raw_header[counter], 8)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(8)) { do { mz_uint c; do { if<br> (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = 6; goto common_exit; case 6:; } while (0); if<br> (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur++; break; }<br> } else { c = 0; break; } } } else c = *pIn_buf_cur++; } while<br> (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits<br> += 8; } while (num_bits &lt; (mz_uint)(8)); } r-&gt;m_raw_header<br>[counter] = bit_buf &amp; ((1 &lt;&lt; (8)) - 1); bit_buf &gt;&gt;=<br> (8); num_bits -= (8); } while (0)</span></span>; <span class='keyword'>else</span> <span class='macro'>TINFL_GET_BYTE(7, r-&gt;m_raw_header[counter])<span class='macro_popup'>do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = 7; goto common_exit; case 7:; } while (0); if<br> (pIn_buf_cur &lt; pIn_buf_end) { r-&gt;m_raw_header[counter]<br> = *pIn_buf_cur++; break; } } else { r-&gt;m_raw_header[counter<br>] = 0; break; } } } else r-&gt;m_raw_header[counter] = *pIn_buf_cur<br>++; } while (0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1465"><td class="num" id="LN1465">1465</td><td class="line">      <span class='keyword'>if</span> ((counter = (r-&gt;m_raw_header[0] | (r-&gt;m_raw_header[1] &lt;&lt; 8))) != (mz_uint)(0xFFFF ^ (r-&gt;m_raw_header[2] | (r-&gt;m_raw_header[3] &lt;&lt; 8)))) { <span class='macro'>TINFL_CR_RETURN_FOREVER(39, TINFL_STATUS_FAILED)<span class='macro_popup'>do { for ( ; ; ) { do { status = TINFL_STATUS_FAILED; r-&gt;m_state<br> = 39; goto common_exit; case 39:; } while (0); } } while (0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1466"><td class="num" id="LN1466">1466</td><td class="line">      <span class='keyword'>while</span> ((counter) &amp;&amp; (num_bits))</td></tr>
<tr class="codeline" data-linenumber="1467"><td class="num" id="LN1467">1467</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="1468"><td class="num" id="LN1468">1468</td><td class="line">        <span class='macro'>TINFL_GET_BITS(51, dist, 8)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(8)) { do { mz_uint c; do { if<br> (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = 51; goto common_exit; case 51:; } while (0)<br>; if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur++; break<br>; } } else { c = 0; break; } } } else c = *pIn_buf_cur++; } while<br> (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits<br> += 8; } while (num_bits &lt; (mz_uint)(8)); } dist = bit_buf<br> &amp; ((1 &lt;&lt; (8)) - 1); bit_buf &gt;&gt;= (8); num_bits<br> -= (8); } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1469"><td class="num" id="LN1469">1469</td><td class="line">        <span class='keyword'>while</span> (pOut_buf_cur &gt;= pOut_buf_end) { <span class='macro'>TINFL_CR_RETURN(52, TINFL_STATUS_HAS_MORE_OUTPUT)<span class='macro_popup'>do { status = TINFL_STATUS_HAS_MORE_OUTPUT; r-&gt;m_state = 52<br>; goto common_exit; case 52:; } while (0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1470"><td class="num" id="LN1470">1470</td><td class="line">        *pOut_buf_cur++ = (mz_uint8)dist;</td></tr>
<tr class="codeline" data-linenumber="1471"><td class="num" id="LN1471">1471</td><td class="line">        counter--;</td></tr>
<tr class="codeline" data-linenumber="1472"><td class="num" id="LN1472">1472</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1473"><td class="num" id="LN1473">1473</td><td class="line">      <span class='keyword'>while</span> (counter)</td></tr>
<tr class="codeline" data-linenumber="1474"><td class="num" id="LN1474">1474</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="1475"><td class="num" id="LN1475">1475</td><td class="line">        size_t n; <span class='keyword'>while</span> (pOut_buf_cur &gt;= pOut_buf_end) { <span class='macro'>TINFL_CR_RETURN(9, TINFL_STATUS_HAS_MORE_OUTPUT)<span class='macro_popup'>do { status = TINFL_STATUS_HAS_MORE_OUTPUT; r-&gt;m_state = 9<br>; goto common_exit; case 9:; } while (0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1476"><td class="num" id="LN1476">1476</td><td class="line">        <span class='keyword'>while</span> (pIn_buf_cur &gt;= pIn_buf_end)</td></tr>
<tr class="codeline" data-linenumber="1477"><td class="num" id="LN1477">1477</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1478"><td class="num" id="LN1478">1478</td><td class="line">          <span class='keyword'>if</span> (decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT)</td></tr>
<tr class="codeline" data-linenumber="1479"><td class="num" id="LN1479">1479</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="1480"><td class="num" id="LN1480">1480</td><td class="line">            <span class='macro'>TINFL_CR_RETURN(38, TINFL_STATUS_NEEDS_MORE_INPUT)<span class='macro_popup'>do { status = TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state = 38<br>; goto common_exit; case 38:; } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1481"><td class="num" id="LN1481">1481</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="1482"><td class="num" id="LN1482">1482</td><td class="line">          <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1483"><td class="num" id="LN1483">1483</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="1484"><td class="num" id="LN1484">1484</td><td class="line">            <span class='macro'>TINFL_CR_RETURN_FOREVER(40, TINFL_STATUS_FAILED)<span class='macro_popup'>do { for ( ; ; ) { do { status = TINFL_STATUS_FAILED; r-&gt;m_state<br> = 40; goto common_exit; case 40:; } while (0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1485"><td class="num" id="LN1485">1485</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="1486"><td class="num" id="LN1486">1486</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1487"><td class="num" id="LN1487">1487</td><td class="line">        n = <span class='macro'>MZ_MIN(MZ_MIN((size_t)(pOut_buf_end - pOut_buf_cur), (size_t)(pIn_buf_end - pIn_buf_cur)), counter)<span class='macro_popup'>(((((((size_t)(pOut_buf_end - pOut_buf_cur))&lt;((size_t)(pIn_buf_end<br> - pIn_buf_cur)))?((size_t)(pOut_buf_end - pOut_buf_cur)):((size_t<br>)(pIn_buf_end - pIn_buf_cur))))&lt;(counter))?(((((size_t)(pOut_buf_end<br> - pOut_buf_cur))&lt;((size_t)(pIn_buf_end - pIn_buf_cur)))?(<br>(size_t)(pOut_buf_end - pOut_buf_cur)):((size_t)(pIn_buf_end -<br> pIn_buf_cur)))):(counter))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1488"><td class="num" id="LN1488">1488</td><td class="line">        <span class='macro'>TINFL_MEMCPY(pOut_buf_cur, pIn_buf_cur, n)<span class='macro_popup'>memcpy(pOut_buf_cur, pIn_buf_cur, n)</span></span>; pIn_buf_cur += n; pOut_buf_cur += n; counter -= (mz_uint)n;</td></tr>
<tr class="codeline" data-linenumber="1489"><td class="num" id="LN1489">1489</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1490"><td class="num" id="LN1490">1490</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1491"><td class="num" id="LN1491">1491</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (r-&gt;m_type == 3)</td></tr>
<tr class="codeline" data-linenumber="1492"><td class="num" id="LN1492">1492</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1493"><td class="num" id="LN1493">1493</td><td class="line">      <span class='macro'>TINFL_CR_RETURN_FOREVER(10, TINFL_STATUS_FAILED)<span class='macro_popup'>do { for ( ; ; ) { do { status = TINFL_STATUS_FAILED; r-&gt;m_state<br> = 10; goto common_exit; case 10:; } while (0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1494"><td class="num" id="LN1494">1494</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1495"><td class="num" id="LN1495">1495</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1496"><td class="num" id="LN1496">1496</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1497"><td class="num" id="LN1497">1497</td><td class="line">      <span class='keyword'>if</span> (r-&gt;m_type == 1)</td></tr>
<tr class="codeline" data-linenumber="1498"><td class="num" id="LN1498">1498</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="1499"><td class="num" id="LN1499">1499</td><td class="line">        mz_uint8 *p = r-&gt;m_tables[0].m_code_size; mz_uint i;</td></tr>
<tr class="codeline" data-linenumber="1500"><td class="num" id="LN1500">1500</td><td class="line">        r-&gt;m_table_sizes[0] = 288; r-&gt;m_table_sizes[1] = 32; <span class='macro'>TINFL_MEMSET(r-&gt;m_tables[1].m_code_size, 5, 32)<span class='macro_popup'>memset(r-&gt;m_tables[1].m_code_size, 5, 32)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1501"><td class="num" id="LN1501">1501</td><td class="line">        <span class='keyword'>for</span> ( i = 0; i &lt;= 143; ++i) *p++ = 8; <span class='keyword'>for</span> ( ; i &lt;= 255; ++i) *p++ = 9; <span class='keyword'>for</span> ( ; i &lt;= 279; ++i) *p++ = 7; <span class='keyword'>for</span> ( ; i &lt;= 287; ++i) *p++ = 8;</td></tr>
<tr class="codeline" data-linenumber="1502"><td class="num" id="LN1502">1502</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1503"><td class="num" id="LN1503">1503</td><td class="line">      <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1504"><td class="num" id="LN1504">1504</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="1505"><td class="num" id="LN1505">1505</td><td class="line">        <span class='keyword'>for</span> (counter = 0; counter &lt; 3; counter++) { <span class='macro'>TINFL_GET_BITS(11, r-&gt;m_table_sizes[counter], <span class='string_literal'>"\05\05\04"</span>[counter])<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)("\05\05\04"[counter])) { do {<br> mz_uint c; do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ;<br> ; ) { if (decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) { do<br> { status = TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state = 11<br>; goto common_exit; case 11:; } while (0); if (pIn_buf_cur &lt;<br> pIn_buf_end) { c = *pIn_buf_cur++; break; } } else { c = 0; break<br>; } } } else c = *pIn_buf_cur++; } while (0); bit_buf |= (((tinfl_bit_buf_t<br>)c) &lt;&lt; num_bits); num_bits += 8; } while (num_bits &lt;<br> (mz_uint)("\05\05\04"[counter])); } r-&gt;m_table_sizes[counter<br>] = bit_buf &amp; ((1 &lt;&lt; ("\05\05\04"[counter])) - 1); bit_buf<br> &gt;&gt;= ("\05\05\04"[counter]); num_bits -= ("\05\05\04"[counter<br>]); } while (0)</span></span>; r-&gt;m_table_sizes[counter] += s_min_table_sizes[counter]; }</td></tr>
<tr class="codeline" data-linenumber="1506"><td class="num" id="LN1506">1506</td><td class="line">        <span class='macro'>MZ_CLEAR_OBJ(r-&gt;m_tables[2].m_code_size)<span class='macro_popup'>memset(&amp;(r-&gt;m_tables[2].m_code_size), 0, sizeof(r-&gt;<br>m_tables[2].m_code_size))</span></span>; <span class='keyword'>for</span> (counter = 0; counter &lt; r-&gt;m_table_sizes[2]; counter++) { mz_uint s; <span class='macro'>TINFL_GET_BITS(14, s, 3)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(3)) { do { mz_uint c; do { if<br> (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = 14; goto common_exit; case 14:; } while (0)<br>; if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur++; break<br>; } } else { c = 0; break; } } } else c = *pIn_buf_cur++; } while<br> (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits<br> += 8; } while (num_bits &lt; (mz_uint)(3)); } s = bit_buf &amp;<br> ((1 &lt;&lt; (3)) - 1); bit_buf &gt;&gt;= (3); num_bits -= (<br>3); } while (0)</span></span>; r-&gt;m_tables[2].m_code_size[s_length_dezigzag[counter]] = (mz_uint8)s; }</td></tr>
<tr class="codeline" data-linenumber="1507"><td class="num" id="LN1507">1507</td><td class="line">        r-&gt;m_table_sizes[2] = 19;</td></tr>
<tr class="codeline" data-linenumber="1508"><td class="num" id="LN1508">1508</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1509"><td class="num" id="LN1509">1509</td><td class="line">      <span class='keyword'>for</span> ( ; (<span class='keyword'>int</span>)r-&gt;m_type &gt;= 0; r-&gt;m_type--)</td></tr>
<tr class="codeline" data-linenumber="1510"><td class="num" id="LN1510">1510</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="1511"><td class="num" id="LN1511">1511</td><td class="line">        <span class='keyword'>int</span> tree_next, tree_cur; tinfl_huff_table *pTable;</td></tr>
<tr class="codeline" data-linenumber="1512"><td class="num" id="LN1512">1512</td><td class="line">        mz_uint i, j, used_syms, total, sym_index, next_code[17], total_syms[16]; pTable = &amp;r-&gt;m_tables[r-&gt;m_type]; <span class='macro'>MZ_CLEAR_OBJ(total_syms)<span class='macro_popup'>memset(&amp;(total_syms), 0, sizeof(total_syms))</span></span>; <span class='macro'>MZ_CLEAR_OBJ(pTable-&gt;m_look_up)<span class='macro_popup'>memset(&amp;(pTable-&gt;m_look_up), 0, sizeof(pTable-&gt;m_look_up<br>))</span></span>; <span class='macro'>MZ_CLEAR_OBJ(pTable-&gt;m_tree)<span class='macro_popup'>memset(&amp;(pTable-&gt;m_tree), 0, sizeof(pTable-&gt;m_tree)<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1513"><td class="num" id="LN1513">1513</td><td class="line">        <span class='keyword'>for</span> (i = 0; i &lt; r-&gt;m_table_sizes[r-&gt;m_type]; ++i) total_syms[pTable-&gt;m_code_size[i]]++;</td></tr>
<tr class="codeline" data-linenumber="1514"><td class="num" id="LN1514">1514</td><td class="line">        used_syms = 0, total = 0; next_code[0] = next_code[1] = 0;</td></tr>
<tr class="codeline" data-linenumber="1515"><td class="num" id="LN1515">1515</td><td class="line">        <span class='keyword'>for</span> (i = 1; i &lt;= 15; ++i) { used_syms += total_syms[i]; next_code[i + 1] = (total = ((total + total_syms[i]) &lt;&lt; 1)); }</td></tr>
<tr class="codeline" data-linenumber="1516"><td class="num" id="LN1516">1516</td><td class="line">        <span class='keyword'>if</span> ((65536 != total) &amp;&amp; (used_syms &gt; 1))</td></tr>
<tr class="codeline" data-linenumber="1517"><td class="num" id="LN1517">1517</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1518"><td class="num" id="LN1518">1518</td><td class="line">          <span class='macro'>TINFL_CR_RETURN_FOREVER(35, TINFL_STATUS_FAILED)<span class='macro_popup'>do { for ( ; ; ) { do { status = TINFL_STATUS_FAILED; r-&gt;m_state<br> = 35; goto common_exit; case 35:; } while (0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1519"><td class="num" id="LN1519">1519</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1520"><td class="num" id="LN1520">1520</td><td class="line">        <span class='keyword'>for</span> (tree_next = -1, sym_index = 0; sym_index &lt; r-&gt;m_table_sizes[r-&gt;m_type]; ++sym_index)</td></tr>
<tr class="codeline" data-linenumber="1521"><td class="num" id="LN1521">1521</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1522"><td class="num" id="LN1522">1522</td><td class="line">          mz_uint rev_code = 0, l, cur_code, code_size = pTable-&gt;m_code_size[sym_index]; <span class='keyword'>if</span> (!code_size) <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="1523"><td class="num" id="LN1523">1523</td><td class="line">          cur_code = next_code[code_size]++; <span class='keyword'>for</span> (l = code_size; l &gt; 0; l--, cur_code &gt;&gt;= 1) rev_code = (rev_code &lt;&lt; 1) | (cur_code &amp; 1);</td></tr>
<tr class="codeline" data-linenumber="1524"><td class="num" id="LN1524">1524</td><td class="line">          <span class='keyword'>if</span> (code_size &lt;= TINFL_FAST_LOOKUP_BITS) { mz_int16 k = (mz_int16)((code_size &lt;&lt; 9) | sym_index); <span class='keyword'>while</span> (rev_code &lt; TINFL_FAST_LOOKUP_SIZE) { pTable-&gt;m_look_up[rev_code] = k; rev_code += (1 &lt;&lt; code_size); } <span class='keyword'>continue</span>; }</td></tr>
<tr class="codeline" data-linenumber="1525"><td class="num" id="LN1525">1525</td><td class="line">          <span class='keyword'>if</span> (0 == (tree_cur = pTable-&gt;m_look_up[rev_code &amp; (TINFL_FAST_LOOKUP_SIZE - 1)])) { pTable-&gt;m_look_up[rev_code &amp; (TINFL_FAST_LOOKUP_SIZE - 1)] = (mz_int16)tree_next; tree_cur = tree_next; tree_next -= 2; }</td></tr>
<tr class="codeline" data-linenumber="1526"><td class="num" id="LN1526">1526</td><td class="line">          rev_code &gt;&gt;= (TINFL_FAST_LOOKUP_BITS - 1);</td></tr>
<tr class="codeline" data-linenumber="1527"><td class="num" id="LN1527">1527</td><td class="line">          <span class='keyword'>for</span> (j = code_size; j &gt; (TINFL_FAST_LOOKUP_BITS + 1); j--)</td></tr>
<tr class="codeline" data-linenumber="1528"><td class="num" id="LN1528">1528</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="1529"><td class="num" id="LN1529">1529</td><td class="line">            tree_cur -= ((rev_code &gt;&gt;= 1) &amp; 1);</td></tr>
<tr class="codeline" data-linenumber="1530"><td class="num" id="LN1530">1530</td><td class="line">            <span class='keyword'>if</span> (!pTable-&gt;m_tree[-tree_cur - 1]) { pTable-&gt;m_tree[-tree_cur - 1] = (mz_int16)tree_next; tree_cur = tree_next; tree_next -= 2; } <span class='keyword'>else</span> tree_cur = pTable-&gt;m_tree[-tree_cur - 1];</td></tr>
<tr class="codeline" data-linenumber="1531"><td class="num" id="LN1531">1531</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="1532"><td class="num" id="LN1532">1532</td><td class="line">          tree_cur -= ((rev_code &gt;&gt;= 1) &amp; 1); pTable-&gt;m_tree[-tree_cur - 1] = (mz_int16)sym_index;</td></tr>
<tr class="codeline" data-linenumber="1533"><td class="num" id="LN1533">1533</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1534"><td class="num" id="LN1534">1534</td><td class="line">        <span class='keyword'>if</span> (r-&gt;m_type == 2)</td></tr>
<tr class="codeline" data-linenumber="1535"><td class="num" id="LN1535">1535</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1536"><td class="num" id="LN1536">1536</td><td class="line">          <span class='keyword'>for</span> (counter = 0; counter &lt; (r-&gt;m_table_sizes[0] + r-&gt;m_table_sizes[1]); )</td></tr>
<tr class="codeline" data-linenumber="1537"><td class="num" id="LN1537">1537</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="1538"><td class="num" id="LN1538">1538</td><td class="line">            mz_uint s; <span class='macro'>TINFL_HUFF_DECODE(16, dist, &amp;r-&gt;m_tables[2])<span class='macro_popup'>do { int temp; mz_uint code_len, c; if (num_bits &lt; 15) { if<br> ((pIn_buf_end - pIn_buf_cur) &lt; 2) { do { temp = (&amp;r-&gt;<br>m_tables[2])-&gt;m_look_up[bit_buf &amp; (TINFL_FAST_LOOKUP_SIZE<br> - 1)]; if (temp &gt;= 0) { code_len = temp &gt;&gt; 9; if ((<br>code_len) &amp;&amp; (num_bits &gt;= code_len)) break; } else<br> if (num_bits &gt; TINFL_FAST_LOOKUP_BITS) { code_len = TINFL_FAST_LOOKUP_BITS<br>; do { temp = (&amp;r-&gt;m_tables[2])-&gt;m_tree[~temp + ((bit_buf<br> &gt;&gt; code_len++) &amp; 1)]; } while ((temp &lt; 0) &amp;&amp;<br> (num_bits &gt;= (code_len + 1))); if (temp &gt;= 0) break; }<br> do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (<br>decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status =<br> TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state = 16; goto common_exit<br>; case 16:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c<br> = *pIn_buf_cur++; break; } } else { c = 0; break; } } } else<br> c = *pIn_buf_cur++; } while (0); bit_buf |= (((tinfl_bit_buf_t<br>)c) &lt;&lt; num_bits); num_bits += 8; } while (num_bits &lt;<br> 15);; } else { bit_buf |= (((tinfl_bit_buf_t)pIn_buf_cur[0])<br> &lt;&lt; num_bits) | (((tinfl_bit_buf_t)pIn_buf_cur[1]) &lt;&lt;<br> (num_bits + 8)); pIn_buf_cur += 2; num_bits += 16; } } if ((<br>temp = (&amp;r-&gt;m_tables[2])-&gt;m_look_up[bit_buf &amp; (<br>TINFL_FAST_LOOKUP_SIZE - 1)]) &gt;= 0) code_len = temp &gt;&gt;<br> 9, temp &amp;= 511; else { code_len = TINFL_FAST_LOOKUP_BITS<br>; do { temp = (&amp;r-&gt;m_tables[2])-&gt;m_tree[~temp + ((bit_buf<br> &gt;&gt; code_len++) &amp; 1)]; } while (temp &lt; 0); } dist<br> = temp; bit_buf &gt;&gt;= code_len; num_bits -= code_len; } while<br> (0)</span></span>; <span class='keyword'>if</span> (dist &lt; 16) { r-&gt;m_len_codes[counter++] = (mz_uint8)dist; <span class='keyword'>continue</span>; }</td></tr>
<tr class="codeline" data-linenumber="1539"><td class="num" id="LN1539">1539</td><td class="line">            <span class='keyword'>if</span> ((dist == 16) &amp;&amp; (!counter))</td></tr>
<tr class="codeline" data-linenumber="1540"><td class="num" id="LN1540">1540</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1541"><td class="num" id="LN1541">1541</td><td class="line">              <span class='macro'>TINFL_CR_RETURN_FOREVER(17, TINFL_STATUS_FAILED)<span class='macro_popup'>do { for ( ; ; ) { do { status = TINFL_STATUS_FAILED; r-&gt;m_state<br> = 17; goto common_exit; case 17:; } while (0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1542"><td class="num" id="LN1542">1542</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1543"><td class="num" id="LN1543">1543</td><td class="line">            num_extra = <span class='string_literal'>"\02\03\07"</span>[dist - 16]; <span class='macro'>TINFL_GET_BITS(18, s, num_extra)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(num_extra)) { do { mz_uint c<br>; do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (<br>decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status =<br> TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state = 18; goto common_exit<br>; case 18:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c<br> = *pIn_buf_cur++; break; } } else { c = 0; break; } } } else<br> c = *pIn_buf_cur++; } while (0); bit_buf |= (((tinfl_bit_buf_t<br>)c) &lt;&lt; num_bits); num_bits += 8; } while (num_bits &lt;<br> (mz_uint)(num_extra)); } s = bit_buf &amp; ((1 &lt;&lt; (num_extra<br>)) - 1); bit_buf &gt;&gt;= (num_extra); num_bits -= (num_extra<br>); } while (0)</span></span>; s += <span class='string_literal'>"\03\03\013"</span>[dist - 16];</td></tr>
<tr class="codeline" data-linenumber="1544"><td class="num" id="LN1544">1544</td><td class="line">            <span class='macro'>TINFL_MEMSET(r-&gt;m_len_codes + counter, (dist == 16) ? r-&gt;m_len_codes[counter - 1] : 0, s)<span class='macro_popup'>memset(r-&gt;m_len_codes + counter, (dist == 16) ? r-&gt;m_len_codes<br>[counter - 1] : 0, s)</span></span>; counter += s;</td></tr>
<tr class="codeline" data-linenumber="1545"><td class="num" id="LN1545">1545</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="1546"><td class="num" id="LN1546">1546</td><td class="line">          <span class='keyword'>if</span> ((r-&gt;m_table_sizes[0] + r-&gt;m_table_sizes[1]) != counter)</td></tr>
<tr class="codeline" data-linenumber="1547"><td class="num" id="LN1547">1547</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="1548"><td class="num" id="LN1548">1548</td><td class="line">            <span class='macro'>TINFL_CR_RETURN_FOREVER(21, TINFL_STATUS_FAILED)<span class='macro_popup'>do { for ( ; ; ) { do { status = TINFL_STATUS_FAILED; r-&gt;m_state<br> = 21; goto common_exit; case 21:; } while (0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1549"><td class="num" id="LN1549">1549</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="1550"><td class="num" id="LN1550">1550</td><td class="line">          <span class='macro'>TINFL_MEMCPY(r-&gt;m_tables[0].m_code_size, r-&gt;m_len_codes, r-&gt;m_table_sizes[0])<span class='macro_popup'>memcpy(r-&gt;m_tables[0].m_code_size, r-&gt;m_len_codes, r-&gt;<br>m_table_sizes[0])</span></span>; <span class='macro'>TINFL_MEMCPY(r-&gt;m_tables[1].m_code_size, r-&gt;m_len_codes + r-&gt;m_table_sizes[0], r-&gt;m_table_sizes[1])<span class='macro_popup'>memcpy(r-&gt;m_tables[1].m_code_size, r-&gt;m_len_codes + r-&gt;<br>m_table_sizes[0], r-&gt;m_table_sizes[1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1551"><td class="num" id="LN1551">1551</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1552"><td class="num" id="LN1552">1552</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1553"><td class="num" id="LN1553">1553</td><td class="line">      <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="1554"><td class="num" id="LN1554">1554</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="1555"><td class="num" id="LN1555">1555</td><td class="line">        mz_uint8 *pSrc;</td></tr>
<tr class="codeline" data-linenumber="1556"><td class="num" id="LN1556">1556</td><td class="line">        <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="1557"><td class="num" id="LN1557">1557</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1558"><td class="num" id="LN1558">1558</td><td class="line">          <span class='keyword'>if</span> (((pIn_buf_end - pIn_buf_cur) &lt; 4) || ((pOut_buf_end - pOut_buf_cur) &lt; 2))</td></tr>
<tr class="codeline" data-linenumber="1559"><td class="num" id="LN1559">1559</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="1560"><td class="num" id="LN1560">1560</td><td class="line">            <span class='macro'>TINFL_HUFF_DECODE(23, counter, &amp;r-&gt;m_tables[0])<span class='macro_popup'>do { int temp; mz_uint code_len, c; if (num_bits &lt; 15) { if<br> ((pIn_buf_end - pIn_buf_cur) &lt; 2) { do { temp = (&amp;r-&gt;<br>m_tables[0])-&gt;m_look_up[bit_buf &amp; (TINFL_FAST_LOOKUP_SIZE<br> - 1)]; if (temp &gt;= 0) { code_len = temp &gt;&gt; 9; if ((<br>code_len) &amp;&amp; (num_bits &gt;= code_len)) break; } else<br> if (num_bits &gt; TINFL_FAST_LOOKUP_BITS) { code_len = TINFL_FAST_LOOKUP_BITS<br>; do { temp = (&amp;r-&gt;m_tables[0])-&gt;m_tree[~temp + ((bit_buf<br> &gt;&gt; code_len++) &amp; 1)]; } while ((temp &lt; 0) &amp;&amp;<br> (num_bits &gt;= (code_len + 1))); if (temp &gt;= 0) break; }<br> do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (<br>decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status =<br> TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state = 23; goto common_exit<br>; case 23:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c<br> = *pIn_buf_cur++; break; } } else { c = 0; break; } } } else<br> c = *pIn_buf_cur++; } while (0); bit_buf |= (((tinfl_bit_buf_t<br>)c) &lt;&lt; num_bits); num_bits += 8; } while (num_bits &lt;<br> 15);; } else { bit_buf |= (((tinfl_bit_buf_t)pIn_buf_cur[0])<br> &lt;&lt; num_bits) | (((tinfl_bit_buf_t)pIn_buf_cur[1]) &lt;&lt;<br> (num_bits + 8)); pIn_buf_cur += 2; num_bits += 16; } } if ((<br>temp = (&amp;r-&gt;m_tables[0])-&gt;m_look_up[bit_buf &amp; (<br>TINFL_FAST_LOOKUP_SIZE - 1)]) &gt;= 0) code_len = temp &gt;&gt;<br> 9, temp &amp;= 511; else { code_len = TINFL_FAST_LOOKUP_BITS<br>; do { temp = (&amp;r-&gt;m_tables[0])-&gt;m_tree[~temp + ((bit_buf<br> &gt;&gt; code_len++) &amp; 1)]; } while (temp &lt; 0); } counter<br> = temp; bit_buf &gt;&gt;= code_len; num_bits -= code_len; } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1561"><td class="num" id="LN1561">1561</td><td class="line">            <span class='keyword'>if</span> (counter &gt;= 256)</td></tr>
<tr class="codeline" data-linenumber="1562"><td class="num" id="LN1562">1562</td><td class="line">              <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1563"><td class="num" id="LN1563">1563</td><td class="line">            <span class='keyword'>while</span> (pOut_buf_cur &gt;= pOut_buf_end) { <span class='macro'>TINFL_CR_RETURN(24, TINFL_STATUS_HAS_MORE_OUTPUT)<span class='macro_popup'>do { status = TINFL_STATUS_HAS_MORE_OUTPUT; r-&gt;m_state = 24<br>; goto common_exit; case 24:; } while (0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1564"><td class="num" id="LN1564">1564</td><td class="line">            *pOut_buf_cur++ = (mz_uint8)counter;</td></tr>
<tr class="codeline" data-linenumber="1565"><td class="num" id="LN1565">1565</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="1566"><td class="num" id="LN1566">1566</td><td class="line">          <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1567"><td class="num" id="LN1567">1567</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="1568"><td class="num" id="LN1568">1568</td><td class="line">            <span class='keyword'>int</span> sym2; mz_uint code_len;</td></tr>
<tr class="codeline" data-linenumber="1569"><td class="num" id="LN1569">1569</td><td class="line"><span class='directive'>#if <span class='macro'>TINFL_USE_64BIT_BITBUF<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1570"><td class="num" id="LN1570">1570</td><td class="line">            <span class='keyword'>if</span> (num_bits &lt; 30) { bit_buf |= (((tinfl_bit_buf_t)<span class='macro'>MZ_READ_LE32(pIn_buf_cur)<span class='macro_popup'>*((const mz_uint32 *)(pIn_buf_cur))</span></span>) &lt;&lt; num_bits); pIn_buf_cur += 4; num_bits += 32; }</td></tr>
<tr class="codeline" data-linenumber="1571"><td class="num" id="LN1571">1571</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="1572"><td class="num" id="LN1572">1572</td><td class="line">            <span class='keyword'>if</span> (num_bits &lt; 15) { bit_buf |= (((tinfl_bit_buf_t)<span class='macro'>MZ_READ_LE16(pIn_buf_cur)<span class='macro_popup'>*((const mz_uint16 *)(pIn_buf_cur))</span></span>) &lt;&lt; num_bits); pIn_buf_cur += 2; num_bits += 16; }</td></tr>
<tr class="codeline" data-linenumber="1573"><td class="num" id="LN1573">1573</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1574"><td class="num" id="LN1574">1574</td><td class="line">            <span class='keyword'>if</span> ((sym2 = r-&gt;m_tables[0].m_look_up[bit_buf &amp; (TINFL_FAST_LOOKUP_SIZE - 1)]) &gt;= 0)</td></tr>
<tr class="codeline" data-linenumber="1575"><td class="num" id="LN1575">1575</td><td class="line">              code_len = sym2 &gt;&gt; 9;</td></tr>
<tr class="codeline" data-linenumber="1576"><td class="num" id="LN1576">1576</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1577"><td class="num" id="LN1577">1577</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1578"><td class="num" id="LN1578">1578</td><td class="line">              code_len = TINFL_FAST_LOOKUP_BITS; <span class='keyword'>do</span> { sym2 = r-&gt;m_tables[0].m_tree[~sym2 + ((bit_buf &gt;&gt; code_len++) &amp; 1)]; } <span class='keyword'>while</span> (sym2 &lt; 0);</td></tr>
<tr class="codeline" data-linenumber="1579"><td class="num" id="LN1579">1579</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1580"><td class="num" id="LN1580">1580</td><td class="line">            counter = sym2; bit_buf &gt;&gt;= code_len; num_bits -= code_len;</td></tr>
<tr class="codeline" data-linenumber="1581"><td class="num" id="LN1581">1581</td><td class="line">            <span class='keyword'>if</span> (counter &amp; 256)</td></tr>
<tr class="codeline" data-linenumber="1582"><td class="num" id="LN1582">1582</td><td class="line">              <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1583"><td class="num" id="LN1583">1583</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1584"><td class="num" id="LN1584">1584</td><td class="line"><span class='directive'>#if !<span class='macro'>TINFL_USE_64BIT_BITBUF<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1585"><td class="num" id="LN1585">1585</td><td class="line">            <span class='keyword'>if</span> (num_bits &lt; 15) { bit_buf |= (((tinfl_bit_buf_t)<span class='macro'>MZ_READ_LE16(pIn_buf_cur)<span class='macro_popup'>*((const mz_uint16 *)(pIn_buf_cur))</span></span>) &lt;&lt; num_bits); pIn_buf_cur += 2; num_bits += 16; }</td></tr>
<tr class="codeline" data-linenumber="1586"><td class="num" id="LN1586">1586</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1587"><td class="num" id="LN1587">1587</td><td class="line">            <span class='keyword'>if</span> ((sym2 = r-&gt;m_tables[0].m_look_up[bit_buf &amp; (TINFL_FAST_LOOKUP_SIZE - 1)]) &gt;= 0)</td></tr>
<tr class="codeline" data-linenumber="1588"><td class="num" id="LN1588">1588</td><td class="line">              code_len = sym2 &gt;&gt; 9;</td></tr>
<tr class="codeline" data-linenumber="1589"><td class="num" id="LN1589">1589</td><td class="line">            <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1590"><td class="num" id="LN1590">1590</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1591"><td class="num" id="LN1591">1591</td><td class="line">              code_len = TINFL_FAST_LOOKUP_BITS; <span class='keyword'>do</span> { sym2 = r-&gt;m_tables[0].m_tree[~sym2 + ((bit_buf &gt;&gt; code_len++) &amp; 1)]; } <span class='keyword'>while</span> (sym2 &lt; 0);</td></tr>
<tr class="codeline" data-linenumber="1592"><td class="num" id="LN1592">1592</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1593"><td class="num" id="LN1593">1593</td><td class="line">            bit_buf &gt;&gt;= code_len; num_bits -= code_len;</td></tr>
<tr class="codeline" data-linenumber="1594"><td class="num" id="LN1594">1594</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1595"><td class="num" id="LN1595">1595</td><td class="line">            pOut_buf_cur[0] = (mz_uint8)counter;</td></tr>
<tr class="codeline" data-linenumber="1596"><td class="num" id="LN1596">1596</td><td class="line">            <span class='keyword'>if</span> (sym2 &amp; 256)</td></tr>
<tr class="codeline" data-linenumber="1597"><td class="num" id="LN1597">1597</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1598"><td class="num" id="LN1598">1598</td><td class="line">              pOut_buf_cur++;</td></tr>
<tr class="codeline" data-linenumber="1599"><td class="num" id="LN1599">1599</td><td class="line">              counter = sym2;</td></tr>
<tr class="codeline" data-linenumber="1600"><td class="num" id="LN1600">1600</td><td class="line">              <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1601"><td class="num" id="LN1601">1601</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1602"><td class="num" id="LN1602">1602</td><td class="line">            pOut_buf_cur[1] = (mz_uint8)sym2;</td></tr>
<tr class="codeline" data-linenumber="1603"><td class="num" id="LN1603">1603</td><td class="line">            pOut_buf_cur += 2;</td></tr>
<tr class="codeline" data-linenumber="1604"><td class="num" id="LN1604">1604</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="1605"><td class="num" id="LN1605">1605</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1606"><td class="num" id="LN1606">1606</td><td class="line">        <span class='keyword'>if</span> ((counter &amp;= 511) == 256) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1607"><td class="num" id="LN1607">1607</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1608"><td class="num" id="LN1608">1608</td><td class="line">        num_extra = s_length_extra[counter - 257]; counter = s_length_base[counter - 257];</td></tr>
<tr class="codeline" data-linenumber="1609"><td class="num" id="LN1609">1609</td><td class="line">        <span class='keyword'>if</span> (num_extra) { mz_uint extra_bits; <span class='macro'>TINFL_GET_BITS(25, extra_bits, num_extra)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(num_extra)) { do { mz_uint c<br>; do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (<br>decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status =<br> TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state = 25; goto common_exit<br>; case 25:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c<br> = *pIn_buf_cur++; break; } } else { c = 0; break; } } } else<br> c = *pIn_buf_cur++; } while (0); bit_buf |= (((tinfl_bit_buf_t<br>)c) &lt;&lt; num_bits); num_bits += 8; } while (num_bits &lt;<br> (mz_uint)(num_extra)); } extra_bits = bit_buf &amp; ((1 &lt;&lt;<br> (num_extra)) - 1); bit_buf &gt;&gt;= (num_extra); num_bits -=<br> (num_extra); } while (0)</span></span>; counter += extra_bits; }</td></tr>
<tr class="codeline" data-linenumber="1610"><td class="num" id="LN1610">1610</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1611"><td class="num" id="LN1611">1611</td><td class="line">        <span class='macro'>TINFL_HUFF_DECODE(26, dist, &amp;r-&gt;m_tables[1])<span class='macro_popup'>do { int temp; mz_uint code_len, c; if (num_bits &lt; 15) { if<br> ((pIn_buf_end - pIn_buf_cur) &lt; 2) { do { temp = (&amp;r-&gt;<br>m_tables[1])-&gt;m_look_up[bit_buf &amp; (TINFL_FAST_LOOKUP_SIZE<br> - 1)]; if (temp &gt;= 0) { code_len = temp &gt;&gt; 9; if ((<br>code_len) &amp;&amp; (num_bits &gt;= code_len)) break; } else<br> if (num_bits &gt; TINFL_FAST_LOOKUP_BITS) { code_len = TINFL_FAST_LOOKUP_BITS<br>; do { temp = (&amp;r-&gt;m_tables[1])-&gt;m_tree[~temp + ((bit_buf<br> &gt;&gt; code_len++) &amp; 1)]; } while ((temp &lt; 0) &amp;&amp;<br> (num_bits &gt;= (code_len + 1))); if (temp &gt;= 0) break; }<br> do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (<br>decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status =<br> TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state = 26; goto common_exit<br>; case 26:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c<br> = *pIn_buf_cur++; break; } } else { c = 0; break; } } } else<br> c = *pIn_buf_cur++; } while (0); bit_buf |= (((tinfl_bit_buf_t<br>)c) &lt;&lt; num_bits); num_bits += 8; } while (num_bits &lt;<br> 15);; } else { bit_buf |= (((tinfl_bit_buf_t)pIn_buf_cur[0])<br> &lt;&lt; num_bits) | (((tinfl_bit_buf_t)pIn_buf_cur[1]) &lt;&lt;<br> (num_bits + 8)); pIn_buf_cur += 2; num_bits += 16; } } if ((<br>temp = (&amp;r-&gt;m_tables[1])-&gt;m_look_up[bit_buf &amp; (<br>TINFL_FAST_LOOKUP_SIZE - 1)]) &gt;= 0) code_len = temp &gt;&gt;<br> 9, temp &amp;= 511; else { code_len = TINFL_FAST_LOOKUP_BITS<br>; do { temp = (&amp;r-&gt;m_tables[1])-&gt;m_tree[~temp + ((bit_buf<br> &gt;&gt; code_len++) &amp; 1)]; } while (temp &lt; 0); } dist<br> = temp; bit_buf &gt;&gt;= code_len; num_bits -= code_len; } while<br> (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1612"><td class="num" id="LN1612">1612</td><td class="line">        num_extra = s_dist_extra[dist]; dist = s_dist_base[dist];</td></tr>
<tr class="codeline" data-linenumber="1613"><td class="num" id="LN1613">1613</td><td class="line">        <span class='keyword'>if</span> (num_extra) { mz_uint extra_bits; <span class='macro'>TINFL_GET_BITS(27, extra_bits, num_extra)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(num_extra)) { do { mz_uint c<br>; do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (<br>decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status =<br> TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state = 27; goto common_exit<br>; case 27:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c<br> = *pIn_buf_cur++; break; } } else { c = 0; break; } } } else<br> c = *pIn_buf_cur++; } while (0); bit_buf |= (((tinfl_bit_buf_t<br>)c) &lt;&lt; num_bits); num_bits += 8; } while (num_bits &lt;<br> (mz_uint)(num_extra)); } extra_bits = bit_buf &amp; ((1 &lt;&lt;<br> (num_extra)) - 1); bit_buf &gt;&gt;= (num_extra); num_bits -=<br> (num_extra); } while (0)</span></span>; dist += extra_bits; }</td></tr>
<tr class="codeline" data-linenumber="1614"><td class="num" id="LN1614">1614</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1615"><td class="num" id="LN1615">1615</td><td class="line">        dist_from_out_buf_start = pOut_buf_cur - pOut_buf_start;</td></tr>
<tr class="codeline" data-linenumber="1616"><td class="num" id="LN1616">1616</td><td class="line">        <span class='keyword'>if</span> ((dist &gt; dist_from_out_buf_start) &amp;&amp; (decomp_flags &amp; TINFL_FLAG_USING_NON_WRAPPING_OUTPUT_BUF))</td></tr>
<tr class="codeline" data-linenumber="1617"><td class="num" id="LN1617">1617</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1618"><td class="num" id="LN1618">1618</td><td class="line">          <span class='macro'>TINFL_CR_RETURN_FOREVER(37, TINFL_STATUS_FAILED)<span class='macro_popup'>do { for ( ; ; ) { do { status = TINFL_STATUS_FAILED; r-&gt;m_state<br> = 37; goto common_exit; case 37:; } while (0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1619"><td class="num" id="LN1619">1619</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1620"><td class="num" id="LN1620">1620</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1621"><td class="num" id="LN1621">1621</td><td class="line">        pSrc = pOut_buf_start + ((dist_from_out_buf_start - dist) &amp; out_buf_size_mask);</td></tr>
<tr class="codeline" data-linenumber="1622"><td class="num" id="LN1622">1622</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1623"><td class="num" id="LN1623">1623</td><td class="line">        <span class='keyword'>if</span> ((<span class='macro'>MZ_MAX(pOut_buf_cur, pSrc)<span class='macro_popup'>(((pOut_buf_cur)&gt;(pSrc))?(pOut_buf_cur):(pSrc))</span></span> + counter) &gt; pOut_buf_end)</td></tr>
<tr class="codeline" data-linenumber="1624"><td class="num" id="LN1624">1624</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1625"><td class="num" id="LN1625">1625</td><td class="line">          <span class='keyword'>while</span> (counter--)</td></tr>
<tr class="codeline" data-linenumber="1626"><td class="num" id="LN1626">1626</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="1627"><td class="num" id="LN1627">1627</td><td class="line">            <span class='keyword'>while</span> (pOut_buf_cur &gt;= pOut_buf_end) { <span class='macro'>TINFL_CR_RETURN(53, TINFL_STATUS_HAS_MORE_OUTPUT)<span class='macro_popup'>do { status = TINFL_STATUS_HAS_MORE_OUTPUT; r-&gt;m_state = 53<br>; goto common_exit; case 53:; } while (0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1628"><td class="num" id="LN1628">1628</td><td class="line">            *pOut_buf_cur++ = pOut_buf_start[(dist_from_out_buf_start++ - dist) &amp; out_buf_size_mask];</td></tr>
<tr class="codeline" data-linenumber="1629"><td class="num" id="LN1629">1629</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="1630"><td class="num" id="LN1630">1630</td><td class="line">          <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="1631"><td class="num" id="LN1631">1631</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1632"><td class="num" id="LN1632">1632</td><td class="line"><span class='directive'>#if <span class='macro'>MINIZ_USE_UNALIGNED_LOADS_AND_STORES<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1633"><td class="num" id="LN1633">1633</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span> ((counter &gt;= 9) &amp;&amp; (counter &lt;= dist))</td></tr>
<tr class="codeline" data-linenumber="1634"><td class="num" id="LN1634">1634</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1635"><td class="num" id="LN1635">1635</td><td class="line">          <span class='keyword'>const</span> mz_uint8 *pSrc_end = pSrc + (counter &amp; ~7);</td></tr>
<tr class="codeline" data-linenumber="1636"><td class="num" id="LN1636">1636</td><td class="line">          <span class='keyword'>do</span></td></tr>
<tr class="codeline" data-linenumber="1637"><td class="num" id="LN1637">1637</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="1638"><td class="num" id="LN1638">1638</td><td class="line">            ((mz_uint32 *)pOut_buf_cur)[0] = ((<span class='keyword'>const</span> mz_uint32 *)pSrc)[0];</td></tr>
<tr class="codeline" data-linenumber="1639"><td class="num" id="LN1639">1639</td><td class="line">            ((mz_uint32 *)pOut_buf_cur)[1] = ((<span class='keyword'>const</span> mz_uint32 *)pSrc)[1];</td></tr>
<tr class="codeline" data-linenumber="1640"><td class="num" id="LN1640">1640</td><td class="line">            pOut_buf_cur += 8;</td></tr>
<tr class="codeline" data-linenumber="1641"><td class="num" id="LN1641">1641</td><td class="line">          } <span class='keyword'>while</span> ((pSrc += 8) &lt; pSrc_end);</td></tr>
<tr class="codeline" data-linenumber="1642"><td class="num" id="LN1642">1642</td><td class="line">          <span class='keyword'>if</span> ((counter &amp;= 7) &lt; 3)</td></tr>
<tr class="codeline" data-linenumber="1643"><td class="num" id="LN1643">1643</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="1644"><td class="num" id="LN1644">1644</td><td class="line">            <span class='keyword'>if</span> (counter)</td></tr>
<tr class="codeline" data-linenumber="1645"><td class="num" id="LN1645">1645</td><td class="line">            {</td></tr>
<tr class="codeline" data-linenumber="1646"><td class="num" id="LN1646">1646</td><td class="line">              pOut_buf_cur[0] = pSrc[0];</td></tr>
<tr class="codeline" data-linenumber="1647"><td class="num" id="LN1647">1647</td><td class="line">              <span class='keyword'>if</span> (counter &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1648"><td class="num" id="LN1648">1648</td><td class="line">                pOut_buf_cur[1] = pSrc[1];</td></tr>
<tr class="codeline" data-linenumber="1649"><td class="num" id="LN1649">1649</td><td class="line">              pOut_buf_cur += counter;</td></tr>
<tr class="codeline" data-linenumber="1650"><td class="num" id="LN1650">1650</td><td class="line">            }</td></tr>
<tr class="codeline" data-linenumber="1651"><td class="num" id="LN1651">1651</td><td class="line">            <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="1652"><td class="num" id="LN1652">1652</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="1653"><td class="num" id="LN1653">1653</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1654"><td class="num" id="LN1654">1654</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="1655"><td class="num" id="LN1655">1655</td><td class="line">        <span class='keyword'>do</span></td></tr>
<tr class="codeline" data-linenumber="1656"><td class="num" id="LN1656">1656</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1657"><td class="num" id="LN1657">1657</td><td class="line">          pOut_buf_cur[0] = pSrc[0];</td></tr>
<tr class="codeline" data-linenumber="1658"><td class="num" id="LN1658">1658</td><td class="line">          pOut_buf_cur[1] = pSrc[1];</td></tr>
<tr class="codeline" data-linenumber="1659"><td class="num" id="LN1659">1659</td><td class="line">          pOut_buf_cur[2] = pSrc[2];</td></tr>
<tr class="codeline" data-linenumber="1660"><td class="num" id="LN1660">1660</td><td class="line">          pOut_buf_cur += 3; pSrc += 3;</td></tr>
<tr class="codeline" data-linenumber="1661"><td class="num" id="LN1661">1661</td><td class="line">        } <span class='keyword'>while</span> ((<span class='keyword'>int</span>)(counter -= 3) &gt; 2);</td></tr>
<tr class="codeline" data-linenumber="1662"><td class="num" id="LN1662">1662</td><td class="line">        <span class='keyword'>if</span> ((<span class='keyword'>int</span>)counter &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="1663"><td class="num" id="LN1663">1663</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="1664"><td class="num" id="LN1664">1664</td><td class="line">          pOut_buf_cur[0] = pSrc[0];</td></tr>
<tr class="codeline" data-linenumber="1665"><td class="num" id="LN1665">1665</td><td class="line">          <span class='keyword'>if</span> ((<span class='keyword'>int</span>)counter &gt; 1)</td></tr>
<tr class="codeline" data-linenumber="1666"><td class="num" id="LN1666">1666</td><td class="line">            pOut_buf_cur[1] = pSrc[1];</td></tr>
<tr class="codeline" data-linenumber="1667"><td class="num" id="LN1667">1667</td><td class="line">          pOut_buf_cur += counter;</td></tr>
<tr class="codeline" data-linenumber="1668"><td class="num" id="LN1668">1668</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="1669"><td class="num" id="LN1669">1669</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1670"><td class="num" id="LN1670">1670</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1671"><td class="num" id="LN1671">1671</td><td class="line">  } <span class='keyword'>while</span> (!(r-&gt;m_final &amp; 1));</td></tr>
<tr class="codeline" data-linenumber="1672"><td class="num" id="LN1672">1672</td><td class="line">  <span class='keyword'>if</span> (decomp_flags &amp; TINFL_FLAG_PARSE_ZLIB_HEADER)</td></tr>
<tr class="codeline" data-linenumber="1673"><td class="num" id="LN1673">1673</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1674"><td class="num" id="LN1674">1674</td><td class="line">    <span class='macro'>TINFL_SKIP_BITS(32, num_bits &amp; 7)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(num_bits &amp; 7)) { do { mz_uint<br> c; do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if<br> (decomp_flags &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status<br> = TINFL_STATUS_NEEDS_MORE_INPUT; r-&gt;m_state = 32; goto common_exit<br>; case 32:; } while (0); if (pIn_buf_cur &lt; pIn_buf_end) { c<br> = *pIn_buf_cur++; break; } } else { c = 0; break; } } } else<br> c = *pIn_buf_cur++; } while (0); bit_buf |= (((tinfl_bit_buf_t<br>)c) &lt;&lt; num_bits); num_bits += 8; } while (num_bits &lt;<br> (mz_uint)(num_bits &amp; 7)); } bit_buf &gt;&gt;= (num_bits &amp;<br> 7); num_bits -= (num_bits &amp; 7); } while (0)</span></span>; <span class='keyword'>for</span> (counter = 0; counter &lt; 4; ++counter) { mz_uint s; <span class='keyword'>if</span> (num_bits) <span class='macro'>TINFL_GET_BITS(41, s, 8)<span class='macro_popup'>do { if (num_bits &lt; (mz_uint)(8)) { do { mz_uint c; do { if<br> (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = 41; goto common_exit; case 41:; } while (0)<br>; if (pIn_buf_cur &lt; pIn_buf_end) { c = *pIn_buf_cur++; break<br>; } } else { c = 0; break; } } } else c = *pIn_buf_cur++; } while<br> (0); bit_buf |= (((tinfl_bit_buf_t)c) &lt;&lt; num_bits); num_bits<br> += 8; } while (num_bits &lt; (mz_uint)(8)); } s = bit_buf &amp;<br> ((1 &lt;&lt; (8)) - 1); bit_buf &gt;&gt;= (8); num_bits -= (<br>8); } while (0)</span></span>; <span class='keyword'>else</span> <span class='macro'>TINFL_GET_BYTE(42, s)<span class='macro_popup'>do { if (pIn_buf_cur &gt;= pIn_buf_end) { for ( ; ; ) { if (decomp_flags<br> &amp; TINFL_FLAG_HAS_MORE_INPUT) { do { status = TINFL_STATUS_NEEDS_MORE_INPUT<br>; r-&gt;m_state = 42; goto common_exit; case 42:; } while (0)<br>; if (pIn_buf_cur &lt; pIn_buf_end) { s = *pIn_buf_cur++; break<br>; } } else { s = 0; break; } } } else s = *pIn_buf_cur++; } while<br> (0)</span></span>; r-&gt;m_z_adler32 = (r-&gt;m_z_adler32 &lt;&lt; 8) | s; }</td></tr>
<tr class="codeline" data-linenumber="1675"><td class="num" id="LN1675">1675</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1676"><td class="num" id="LN1676">1676</td><td class="line">  <span class='macro'>TINFL_CR_RETURN_FOREVER(34, TINFL_STATUS_DONE)<span class='macro_popup'>do { for ( ; ; ) { do { status = TINFL_STATUS_DONE; r-&gt;m_state<br> = 34; goto common_exit; case 34:; } while (0); } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1677"><td class="num" id="LN1677">1677</td><td class="line">  <span class='macro'>TINFL_CR_FINISH<span class='macro_popup'>}</span></span></td></tr>
<tr class="codeline" data-linenumber="1678"><td class="num" id="LN1678">1678</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1679"><td class="num" id="LN1679">1679</td><td class="line">common_exit:</td></tr>
<tr class="codeline" data-linenumber="1680"><td class="num" id="LN1680">1680</td><td class="line">  r-&gt;m_num_bits = num_bits; r-&gt;m_bit_buf = bit_buf; r-&gt;m_dist = dist; r-&gt;m_counter = counter; r-&gt;m_num_extra = num_extra; r-&gt;m_dist_from_out_buf_start = dist_from_out_buf_start;</td></tr>
<tr class="codeline" data-linenumber="1681"><td class="num" id="LN1681">1681</td><td class="line">  *pIn_buf_size = pIn_buf_cur - pIn_buf_next; *pOut_buf_size = pOut_buf_cur - pOut_buf_next;</td></tr>
<tr class="codeline" data-linenumber="1682"><td class="num" id="LN1682">1682</td><td class="line">  <span class='keyword'>if</span> ((decomp_flags &amp; (TINFL_FLAG_PARSE_ZLIB_HEADER | TINFL_FLAG_COMPUTE_ADLER32)) &amp;&amp; (status &gt;= 0))</td></tr>
<tr class="codeline" data-linenumber="1683"><td class="num" id="LN1683">1683</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1684"><td class="num" id="LN1684">1684</td><td class="line">    <span class='keyword'>const</span> mz_uint8 *ptr = pOut_buf_next; size_t buf_len = *pOut_buf_size;</td></tr>
<tr class="codeline" data-linenumber="1685"><td class="num" id="LN1685">1685</td><td class="line">    mz_uint32 i, s1 = r-&gt;m_check_adler32 &amp; 0xffff, s2 = r-&gt;m_check_adler32 &gt;&gt; 16; size_t block_len = buf_len % 5552;</td></tr>
<tr class="codeline" data-linenumber="1686"><td class="num" id="LN1686">1686</td><td class="line">    <span class='keyword'>while</span> (buf_len)</td></tr>
<tr class="codeline" data-linenumber="1687"><td class="num" id="LN1687">1687</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1688"><td class="num" id="LN1688">1688</td><td class="line">      <span class='keyword'>for</span> (i = 0; i + 7 &lt; block_len; i += 8, ptr += 8)</td></tr>
<tr class="codeline" data-linenumber="1689"><td class="num" id="LN1689">1689</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="1690"><td class="num" id="LN1690">1690</td><td class="line">        s1 += ptr[0], s2 += s1; s1 += ptr[1], s2 += s1; s1 += ptr[2], s2 += s1; s1 += ptr[3], s2 += s1;</td></tr>
<tr class="codeline" data-linenumber="1691"><td class="num" id="LN1691">1691</td><td class="line">        s1 += ptr[4], s2 += s1; s1 += ptr[5], s2 += s1; s1 += ptr[6], s2 += s1; s1 += ptr[7], s2 += s1;</td></tr>
<tr class="codeline" data-linenumber="1692"><td class="num" id="LN1692">1692</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1693"><td class="num" id="LN1693">1693</td><td class="line">      <span class='keyword'>for</span> ( ; i &lt; block_len; ++i) s1 += *ptr++, s2 += s1;</td></tr>
<tr class="codeline" data-linenumber="1694"><td class="num" id="LN1694">1694</td><td class="line">      s1 %= 65521U, s2 %= 65521U; buf_len -= block_len; block_len = 5552;</td></tr>
<tr class="codeline" data-linenumber="1695"><td class="num" id="LN1695">1695</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1696"><td class="num" id="LN1696">1696</td><td class="line">    r-&gt;m_check_adler32 = (s2 &lt;&lt; 16) + s1; <span class='keyword'>if</span> ((status == TINFL_STATUS_DONE) &amp;&amp; (decomp_flags &amp; TINFL_FLAG_PARSE_ZLIB_HEADER) &amp;&amp; (r-&gt;m_check_adler32 != r-&gt;m_z_adler32)) status = TINFL_STATUS_ADLER32_MISMATCH;</td></tr>
<tr class="codeline" data-linenumber="1697"><td class="num" id="LN1697">1697</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1698"><td class="num" id="LN1698">1698</td><td class="line">  <span class='keyword'>return</span> status;</td></tr>
<tr class="codeline" data-linenumber="1699"><td class="num" id="LN1699">1699</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1700"><td class="num" id="LN1700">1700</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1701"><td class="num" id="LN1701">1701</td><td class="line"><span class='comment'>// Higher level helper functions.</span></td></tr>
<tr class="codeline" data-linenumber="1702"><td class="num" id="LN1702">1702</td><td class="line"><span class='keyword'>void</span> *tinfl_decompress_mem_to_heap(<span class='keyword'>const</span> <span class='keyword'>void</span> *pSrc_buf, size_t src_buf_len, size_t *pOut_len, <span class='keyword'>int</span> flags)</td></tr>
<tr class="codeline" data-linenumber="1703"><td class="num" id="LN1703">1703</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1704"><td class="num" id="LN1704">1704</td><td class="line">  tinfl_decompressor decomp; <span class='keyword'>void</span> *pBuf = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, *pNew_buf; size_t src_buf_ofs = 0, out_buf_capacity = 0;</td></tr>
<tr class="codeline" data-linenumber="1705"><td class="num" id="LN1705">1705</td><td class="line">  *pOut_len = 0;</td></tr>
<tr class="codeline" data-linenumber="1706"><td class="num" id="LN1706">1706</td><td class="line">  <span class='macro'>tinfl_init(&amp;decomp)<span class='macro_popup'>do { (&amp;decomp)-&gt;m_state = 0; } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1707"><td class="num" id="LN1707">1707</td><td class="line">  <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="1708"><td class="num" id="LN1708">1708</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1709"><td class="num" id="LN1709">1709</td><td class="line">    size_t src_buf_size = src_buf_len - src_buf_ofs, dst_buf_size = out_buf_capacity - *pOut_len, new_out_buf_capacity;</td></tr>
<tr class="codeline" data-linenumber="1710"><td class="num" id="LN1710">1710</td><td class="line">    tinfl_status status = tinfl_decompress(&amp;decomp, (<span class='keyword'>const</span> mz_uint8*)pSrc_buf + src_buf_ofs, &amp;src_buf_size, (mz_uint8*)pBuf, pBuf ? (mz_uint8*)pBuf + *pOut_len : <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, &amp;dst_buf_size,</td></tr>
<tr class="codeline" data-linenumber="1711"><td class="num" id="LN1711">1711</td><td class="line">      (flags &amp; ~TINFL_FLAG_HAS_MORE_INPUT) | TINFL_FLAG_USING_NON_WRAPPING_OUTPUT_BUF);</td></tr>
<tr class="codeline" data-linenumber="1712"><td class="num" id="LN1712">1712</td><td class="line">    <span class='keyword'>if</span> ((status &lt; 0) || (status == TINFL_STATUS_NEEDS_MORE_INPUT))</td></tr>
<tr class="codeline" data-linenumber="1713"><td class="num" id="LN1713">1713</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1714"><td class="num" id="LN1714">1714</td><td class="line">      <span class='macro'>MZ_FREE(pBuf)<span class='macro_popup'>free(pBuf)</span></span>; *pOut_len = 0; <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1715"><td class="num" id="LN1715">1715</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1716"><td class="num" id="LN1716">1716</td><td class="line">    src_buf_ofs += src_buf_size;</td></tr>
<tr class="codeline" data-linenumber="1717"><td class="num" id="LN1717">1717</td><td class="line">    *pOut_len += dst_buf_size;</td></tr>
<tr class="codeline" data-linenumber="1718"><td class="num" id="LN1718">1718</td><td class="line">    <span class='keyword'>if</span> (status == TINFL_STATUS_DONE) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1719"><td class="num" id="LN1719">1719</td><td class="line">    new_out_buf_capacity = out_buf_capacity * 2; <span class='keyword'>if</span> (new_out_buf_capacity &lt; 128) new_out_buf_capacity = 128;</td></tr>
<tr class="codeline" data-linenumber="1720"><td class="num" id="LN1720">1720</td><td class="line">    pNew_buf = <span class='macro'>MZ_REALLOC(pBuf, new_out_buf_capacity)<span class='macro_popup'>realloc(pBuf, new_out_buf_capacity)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1721"><td class="num" id="LN1721">1721</td><td class="line">    <span class='keyword'>if</span> (!pNew_buf)</td></tr>
<tr class="codeline" data-linenumber="1722"><td class="num" id="LN1722">1722</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1723"><td class="num" id="LN1723">1723</td><td class="line">      <span class='macro'>MZ_FREE(pBuf)<span class='macro_popup'>free(pBuf)</span></span>; *pOut_len = 0; <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1724"><td class="num" id="LN1724">1724</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1725"><td class="num" id="LN1725">1725</td><td class="line">    pBuf = pNew_buf; out_buf_capacity = new_out_buf_capacity;</td></tr>
<tr class="codeline" data-linenumber="1726"><td class="num" id="LN1726">1726</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1727"><td class="num" id="LN1727">1727</td><td class="line">  <span class='keyword'>return</span> pBuf;</td></tr>
<tr class="codeline" data-linenumber="1728"><td class="num" id="LN1728">1728</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1729"><td class="num" id="LN1729">1729</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1730"><td class="num" id="LN1730">1730</td><td class="line">size_t tinfl_decompress_mem_to_mem(<span class='keyword'>void</span> *pOut_buf, size_t out_buf_len, <span class='keyword'>const</span> <span class='keyword'>void</span> *pSrc_buf, size_t src_buf_len, <span class='keyword'>int</span> flags)</td></tr>
<tr class="codeline" data-linenumber="1731"><td class="num" id="LN1731">1731</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1732"><td class="num" id="LN1732">1732</td><td class="line">  tinfl_decompressor decomp; tinfl_status status; <span class='macro'>tinfl_init(&amp;decomp)<span class='macro_popup'>do { (&amp;decomp)-&gt;m_state = 0; } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1733"><td class="num" id="LN1733">1733</td><td class="line">  status = tinfl_decompress(&amp;decomp, (<span class='keyword'>const</span> mz_uint8*)pSrc_buf, &amp;src_buf_len, (mz_uint8*)pOut_buf, (mz_uint8*)pOut_buf, &amp;out_buf_len, (flags &amp; ~TINFL_FLAG_HAS_MORE_INPUT) | TINFL_FLAG_USING_NON_WRAPPING_OUTPUT_BUF);</td></tr>
<tr class="codeline" data-linenumber="1734"><td class="num" id="LN1734">1734</td><td class="line">  <span class='keyword'>return</span> (status != TINFL_STATUS_DONE) ? <span class='macro'>TINFL_DECOMPRESS_MEM_TO_MEM_FAILED<span class='macro_popup'>((size_t)(-1))</span></span> : out_buf_len;</td></tr>
<tr class="codeline" data-linenumber="1735"><td class="num" id="LN1735">1735</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1736"><td class="num" id="LN1736">1736</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1737"><td class="num" id="LN1737">1737</td><td class="line"><span class='keyword'>int</span> tinfl_decompress_mem_to_callback(<span class='keyword'>const</span> <span class='keyword'>void</span> *pIn_buf, size_t *pIn_buf_size, tinfl_put_buf_func_ptr pPut_buf_func, <span class='keyword'>void</span> *pPut_buf_user, <span class='keyword'>int</span> flags)</td></tr>
<tr class="codeline" data-linenumber="1738"><td class="num" id="LN1738">1738</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1739"><td class="num" id="LN1739">1739</td><td class="line">  <span class='keyword'>int</span> result = 0;</td></tr>
<tr class="codeline" data-linenumber="1740"><td class="num" id="LN1740">1740</td><td class="line">  tinfl_decompressor decomp;</td></tr>
<tr class="codeline" data-linenumber="1741"><td class="num" id="LN1741">1741</td><td class="line">  mz_uint8 *pDict = (mz_uint8*)<span class='macro'>MZ_MALLOC(TINFL_LZ_DICT_SIZE)<span class='macro_popup'>malloc(32768)</span></span>; size_t in_buf_ofs = 0, dict_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="1742"><td class="num" id="LN1742">1742</td><td class="line">  <span class='keyword'>if</span> (!pDict)</td></tr>
<tr class="codeline" data-linenumber="1743"><td class="num" id="LN1743">1743</td><td class="line">    <span class='keyword'>return</span> TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="1744"><td class="num" id="LN1744">1744</td><td class="line">  <span class='macro'>tinfl_init(&amp;decomp)<span class='macro_popup'>do { (&amp;decomp)-&gt;m_state = 0; } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1745"><td class="num" id="LN1745">1745</td><td class="line">  <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="1746"><td class="num" id="LN1746">1746</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1747"><td class="num" id="LN1747">1747</td><td class="line">    size_t in_buf_size = *pIn_buf_size - in_buf_ofs, dst_buf_size = <span class='macro'>TINFL_LZ_DICT_SIZE<span class='macro_popup'>32768</span></span> - dict_ofs;</td></tr>
<tr class="codeline" data-linenumber="1748"><td class="num" id="LN1748">1748</td><td class="line">    tinfl_status status = tinfl_decompress(&amp;decomp, (<span class='keyword'>const</span> mz_uint8*)pIn_buf + in_buf_ofs, &amp;in_buf_size, pDict, pDict + dict_ofs, &amp;dst_buf_size,</td></tr>
<tr class="codeline" data-linenumber="1749"><td class="num" id="LN1749">1749</td><td class="line">      (flags &amp; ~(TINFL_FLAG_HAS_MORE_INPUT | TINFL_FLAG_USING_NON_WRAPPING_OUTPUT_BUF)));</td></tr>
<tr class="codeline" data-linenumber="1750"><td class="num" id="LN1750">1750</td><td class="line">    in_buf_ofs += in_buf_size;</td></tr>
<tr class="codeline" data-linenumber="1751"><td class="num" id="LN1751">1751</td><td class="line">    <span class='keyword'>if</span> ((dst_buf_size) &amp;&amp; (!(*pPut_buf_func)(pDict + dict_ofs, (<span class='keyword'>int</span>)dst_buf_size, pPut_buf_user)))</td></tr>
<tr class="codeline" data-linenumber="1752"><td class="num" id="LN1752">1752</td><td class="line">      <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1753"><td class="num" id="LN1753">1753</td><td class="line">    <span class='keyword'>if</span> (status != TINFL_STATUS_HAS_MORE_OUTPUT)</td></tr>
<tr class="codeline" data-linenumber="1754"><td class="num" id="LN1754">1754</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1755"><td class="num" id="LN1755">1755</td><td class="line">      result = (status == TINFL_STATUS_DONE);</td></tr>
<tr class="codeline" data-linenumber="1756"><td class="num" id="LN1756">1756</td><td class="line">      <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1757"><td class="num" id="LN1757">1757</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1758"><td class="num" id="LN1758">1758</td><td class="line">    dict_ofs = (dict_ofs + dst_buf_size) &amp; (<span class='macro'>TINFL_LZ_DICT_SIZE<span class='macro_popup'>32768</span></span> - 1);</td></tr>
<tr class="codeline" data-linenumber="1759"><td class="num" id="LN1759">1759</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1760"><td class="num" id="LN1760">1760</td><td class="line">  <span class='macro'>MZ_FREE(pDict)<span class='macro_popup'>free(pDict)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1761"><td class="num" id="LN1761">1761</td><td class="line">  *pIn_buf_size = in_buf_ofs;</td></tr>
<tr class="codeline" data-linenumber="1762"><td class="num" id="LN1762">1762</td><td class="line">  <span class='keyword'>return</span> result;</td></tr>
<tr class="codeline" data-linenumber="1763"><td class="num" id="LN1763">1763</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1764"><td class="num" id="LN1764">1764</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1765"><td class="num" id="LN1765">1765</td><td class="line"><span class='comment'>// ------------------- Low-level Compression (independent from all decompression API's)</span></td></tr>
<tr class="codeline" data-linenumber="1766"><td class="num" id="LN1766">1766</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1767"><td class="num" id="LN1767">1767</td><td class="line"><span class='comment'>// Purposely making these tables static for faster init and thread safety.</span></td></tr>
<tr class="codeline" data-linenumber="1768"><td class="num" id="LN1768">1768</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint16 s_tdefl_len_sym[256] = {</td></tr>
<tr class="codeline" data-linenumber="1769"><td class="num" id="LN1769">1769</td><td class="line">  257,258,259,260,261,262,263,264,265,265,266,266,267,267,268,268,269,269,269,269,270,270,270,270,271,271,271,271,272,272,272,272,</td></tr>
<tr class="codeline" data-linenumber="1770"><td class="num" id="LN1770">1770</td><td class="line">  273,273,273,273,273,273,273,273,274,274,274,274,274,274,274,274,275,275,275,275,275,275,275,275,276,276,276,276,276,276,276,276,</td></tr>
<tr class="codeline" data-linenumber="1771"><td class="num" id="LN1771">1771</td><td class="line">  277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,277,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,278,</td></tr>
<tr class="codeline" data-linenumber="1772"><td class="num" id="LN1772">1772</td><td class="line">  279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,279,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,280,</td></tr>
<tr class="codeline" data-linenumber="1773"><td class="num" id="LN1773">1773</td><td class="line">  281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,281,</td></tr>
<tr class="codeline" data-linenumber="1774"><td class="num" id="LN1774">1774</td><td class="line">  282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,282,</td></tr>
<tr class="codeline" data-linenumber="1775"><td class="num" id="LN1775">1775</td><td class="line">  283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,283,</td></tr>
<tr class="codeline" data-linenumber="1776"><td class="num" id="LN1776">1776</td><td class="line">  284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,284,285 };</td></tr>
<tr class="codeline" data-linenumber="1777"><td class="num" id="LN1777">1777</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1778"><td class="num" id="LN1778">1778</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint8 s_tdefl_len_extra[256] = {</td></tr>
<tr class="codeline" data-linenumber="1779"><td class="num" id="LN1779">1779</td><td class="line">  0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,</td></tr>
<tr class="codeline" data-linenumber="1780"><td class="num" id="LN1780">1780</td><td class="line">  4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,</td></tr>
<tr class="codeline" data-linenumber="1781"><td class="num" id="LN1781">1781</td><td class="line">  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,</td></tr>
<tr class="codeline" data-linenumber="1782"><td class="num" id="LN1782">1782</td><td class="line">  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,0 };</td></tr>
<tr class="codeline" data-linenumber="1783"><td class="num" id="LN1783">1783</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1784"><td class="num" id="LN1784">1784</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint8 s_tdefl_small_dist_sym[512] = {</td></tr>
<tr class="codeline" data-linenumber="1785"><td class="num" id="LN1785">1785</td><td class="line">  0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,</td></tr>
<tr class="codeline" data-linenumber="1786"><td class="num" id="LN1786">1786</td><td class="line">  11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,</td></tr>
<tr class="codeline" data-linenumber="1787"><td class="num" id="LN1787">1787</td><td class="line">  13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,</td></tr>
<tr class="codeline" data-linenumber="1788"><td class="num" id="LN1788">1788</td><td class="line">  14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,</td></tr>
<tr class="codeline" data-linenumber="1789"><td class="num" id="LN1789">1789</td><td class="line">  14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,</td></tr>
<tr class="codeline" data-linenumber="1790"><td class="num" id="LN1790">1790</td><td class="line">  15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,16,16,</td></tr>
<tr class="codeline" data-linenumber="1791"><td class="num" id="LN1791">1791</td><td class="line">  16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,</td></tr>
<tr class="codeline" data-linenumber="1792"><td class="num" id="LN1792">1792</td><td class="line">  16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,</td></tr>
<tr class="codeline" data-linenumber="1793"><td class="num" id="LN1793">1793</td><td class="line">  16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,17,17,17,</td></tr>
<tr class="codeline" data-linenumber="1794"><td class="num" id="LN1794">1794</td><td class="line">  17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,</td></tr>
<tr class="codeline" data-linenumber="1795"><td class="num" id="LN1795">1795</td><td class="line">  17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,</td></tr>
<tr class="codeline" data-linenumber="1796"><td class="num" id="LN1796">1796</td><td class="line">  17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17 };</td></tr>
<tr class="codeline" data-linenumber="1797"><td class="num" id="LN1797">1797</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1798"><td class="num" id="LN1798">1798</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint8 s_tdefl_small_dist_extra[512] = {</td></tr>
<tr class="codeline" data-linenumber="1799"><td class="num" id="LN1799">1799</td><td class="line">  0,0,0,0,1,1,1,1,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,</td></tr>
<tr class="codeline" data-linenumber="1800"><td class="num" id="LN1800">1800</td><td class="line">  5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,</td></tr>
<tr class="codeline" data-linenumber="1801"><td class="num" id="LN1801">1801</td><td class="line">  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,</td></tr>
<tr class="codeline" data-linenumber="1802"><td class="num" id="LN1802">1802</td><td class="line">  6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,</td></tr>
<tr class="codeline" data-linenumber="1803"><td class="num" id="LN1803">1803</td><td class="line">  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,</td></tr>
<tr class="codeline" data-linenumber="1804"><td class="num" id="LN1804">1804</td><td class="line">  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,</td></tr>
<tr class="codeline" data-linenumber="1805"><td class="num" id="LN1805">1805</td><td class="line">  7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,</td></tr>
<tr class="codeline" data-linenumber="1806"><td class="num" id="LN1806">1806</td><td class="line">  7,7,7,7,7,7,7,7 };</td></tr>
<tr class="codeline" data-linenumber="1807"><td class="num" id="LN1807">1807</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1808"><td class="num" id="LN1808">1808</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint8 s_tdefl_large_dist_sym[128] = {</td></tr>
<tr class="codeline" data-linenumber="1809"><td class="num" id="LN1809">1809</td><td class="line">  0,0,18,19,20,20,21,21,22,22,22,22,23,23,23,23,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,</td></tr>
<tr class="codeline" data-linenumber="1810"><td class="num" id="LN1810">1810</td><td class="line">  26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,</td></tr>
<tr class="codeline" data-linenumber="1811"><td class="num" id="LN1811">1811</td><td class="line">  28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29 };</td></tr>
<tr class="codeline" data-linenumber="1812"><td class="num" id="LN1812">1812</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1813"><td class="num" id="LN1813">1813</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint8 s_tdefl_large_dist_extra[128] = {</td></tr>
<tr class="codeline" data-linenumber="1814"><td class="num" id="LN1814">1814</td><td class="line">  0,0,8,8,9,9,9,9,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,</td></tr>
<tr class="codeline" data-linenumber="1815"><td class="num" id="LN1815">1815</td><td class="line">  12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,</td></tr>
<tr class="codeline" data-linenumber="1816"><td class="num" id="LN1816">1816</td><td class="line">  13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13 };</td></tr>
<tr class="codeline" data-linenumber="1817"><td class="num" id="LN1817">1817</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1818"><td class="num" id="LN1818">1818</td><td class="line"><span class='comment'>// Radix sorts tdefl_sym_freq[] array by 16-bit key m_key. Returns ptr to sorted values.</span></td></tr>
<tr class="codeline" data-linenumber="1819"><td class="num" id="LN1819">1819</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span> { mz_uint16 m_key, m_sym_index; } tdefl_sym_freq;</td></tr>
<tr class="codeline" data-linenumber="1820"><td class="num" id="LN1820">1820</td><td class="line"><span class='keyword'>static</span> tdefl_sym_freq* tdefl_radix_sort_syms(mz_uint num_syms, tdefl_sym_freq* pSyms0, tdefl_sym_freq* pSyms1)</td></tr>
<tr class="codeline" data-linenumber="1821"><td class="num" id="LN1821">1821</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1822"><td class="num" id="LN1822">1822</td><td class="line">  mz_uint32 total_passes = 2, pass_shift, pass, i, hist[256 * 2]; tdefl_sym_freq* pCur_syms = pSyms0, *pNew_syms = pSyms1; <span class='macro'>MZ_CLEAR_OBJ(hist)<span class='macro_popup'>memset(&amp;(hist), 0, sizeof(hist))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1823"><td class="num" id="LN1823">1823</td><td class="line">  <span class='keyword'>for</span> (i = 0; i &lt; num_syms; i++) { mz_uint freq = pSyms0[i].m_key; hist[freq &amp; 0xFF]++; hist[256 + ((freq &gt;&gt; 8) &amp; 0xFF)]++; }</td></tr>
<tr class="codeline" data-linenumber="1824"><td class="num" id="LN1824">1824</td><td class="line">  <span class='keyword'>while</span> ((total_passes &gt; 1) &amp;&amp; (num_syms == hist[(total_passes - 1) * 256])) total_passes--;</td></tr>
<tr class="codeline" data-linenumber="1825"><td class="num" id="LN1825">1825</td><td class="line">  <span class='keyword'>for</span> (pass_shift = 0, pass = 0; pass &lt; total_passes; pass++, pass_shift += 8)</td></tr>
<tr class="codeline" data-linenumber="1826"><td class="num" id="LN1826">1826</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1827"><td class="num" id="LN1827">1827</td><td class="line">    <span class='keyword'>const</span> mz_uint32* pHist = &amp;hist[pass &lt;&lt; 8];</td></tr>
<tr class="codeline" data-linenumber="1828"><td class="num" id="LN1828">1828</td><td class="line">    mz_uint offsets[256], cur_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="1829"><td class="num" id="LN1829">1829</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; 256; i++) { offsets[i] = cur_ofs; cur_ofs += pHist[i]; }</td></tr>
<tr class="codeline" data-linenumber="1830"><td class="num" id="LN1830">1830</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; num_syms; i++) pNew_syms[offsets[(pCur_syms[i].m_key &gt;&gt; pass_shift) &amp; 0xFF]++] = pCur_syms[i];</td></tr>
<tr class="codeline" data-linenumber="1831"><td class="num" id="LN1831">1831</td><td class="line">    { tdefl_sym_freq* t = pCur_syms; pCur_syms = pNew_syms; pNew_syms = t; }</td></tr>
<tr class="codeline" data-linenumber="1832"><td class="num" id="LN1832">1832</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1833"><td class="num" id="LN1833">1833</td><td class="line">  <span class='keyword'>return</span> pCur_syms;</td></tr>
<tr class="codeline" data-linenumber="1834"><td class="num" id="LN1834">1834</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1835"><td class="num" id="LN1835">1835</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1836"><td class="num" id="LN1836">1836</td><td class="line"><span class='comment'>// tdefl_calculate_minimum_redundancy() originally written by: Alistair Moffat, alistair@cs.mu.oz.au, Jyrki Katajainen, jyrki@diku.dk, November 1996.</span></td></tr>
<tr class="codeline" data-linenumber="1837"><td class="num" id="LN1837">1837</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> tdefl_calculate_minimum_redundancy(tdefl_sym_freq *A, <span class='keyword'>int</span> n)</td></tr>
<tr class="codeline" data-linenumber="1838"><td class="num" id="LN1838">1838</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1839"><td class="num" id="LN1839">1839</td><td class="line">  <span class='keyword'>int</span> root, leaf, next, avbl, used, dpth;</td></tr>
<tr class="codeline" data-linenumber="1840"><td class="num" id="LN1840">1840</td><td class="line">  <span class='keyword'>if</span> (n==0) <span class='keyword'>return</span>; <span class='keyword'>else</span> <span class='keyword'>if</span> (n==1) { A[0].m_key = 1; <span class='keyword'>return</span>; }</td></tr>
<tr class="codeline" data-linenumber="1841"><td class="num" id="LN1841">1841</td><td class="line">  A[0].m_key += A[1].m_key; root = 0; leaf = 2;</td></tr>
<tr class="codeline" data-linenumber="1842"><td class="num" id="LN1842">1842</td><td class="line">  <span class='keyword'>for</span> (next=1; next &lt; n-1; next++)</td></tr>
<tr class="codeline" data-linenumber="1843"><td class="num" id="LN1843">1843</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1844"><td class="num" id="LN1844">1844</td><td class="line">    <span class='keyword'>if</span> (leaf&gt;=n || A[root].m_key&lt;A[leaf].m_key) { A[next].m_key = A[root].m_key; A[root++].m_key = (mz_uint16)next; } <span class='keyword'>else</span> A[next].m_key = A[leaf++].m_key;</td></tr>
<tr class="codeline" data-linenumber="1845"><td class="num" id="LN1845">1845</td><td class="line">    <span class='keyword'>if</span> (leaf&gt;=n || (root&lt;next &amp;&amp; A[root].m_key&lt;A[leaf].m_key)) { A[next].m_key = (mz_uint16)(A[next].m_key + A[root].m_key); A[root++].m_key = (mz_uint16)next; } <span class='keyword'>else</span> A[next].m_key = (mz_uint16)(A[next].m_key + A[leaf++].m_key);</td></tr>
<tr class="codeline" data-linenumber="1846"><td class="num" id="LN1846">1846</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1847"><td class="num" id="LN1847">1847</td><td class="line">  A[n-2].m_key = 0; <span class='keyword'>for</span> (next=n-3; next&gt;=0; next--) A[next].m_key = A[A[next].m_key].m_key+1;</td></tr>
<tr class="codeline" data-linenumber="1848"><td class="num" id="LN1848">1848</td><td class="line">  avbl = 1; used = dpth = 0; root = n-2; next = n-1;</td></tr>
<tr class="codeline" data-linenumber="1849"><td class="num" id="LN1849">1849</td><td class="line">  <span class='keyword'>while</span> (avbl&gt;0)</td></tr>
<tr class="codeline" data-linenumber="1850"><td class="num" id="LN1850">1850</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1851"><td class="num" id="LN1851">1851</td><td class="line">    <span class='keyword'>while</span> (root&gt;=0 &amp;&amp; (<span class='keyword'>int</span>)A[root].m_key==dpth) { used++; root--; }</td></tr>
<tr class="codeline" data-linenumber="1852"><td class="num" id="LN1852">1852</td><td class="line">    <span class='keyword'>while</span> (avbl&gt;used) { A[next--].m_key = (mz_uint16)(dpth); avbl--; }</td></tr>
<tr class="codeline" data-linenumber="1853"><td class="num" id="LN1853">1853</td><td class="line">    avbl = 2*used; dpth++; used = 0;</td></tr>
<tr class="codeline" data-linenumber="1854"><td class="num" id="LN1854">1854</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1855"><td class="num" id="LN1855">1855</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1856"><td class="num" id="LN1856">1856</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1857"><td class="num" id="LN1857">1857</td><td class="line"><span class='comment'>// Limits canonical Huffman code table's max code size.</span></td></tr>
<tr class="codeline" data-linenumber="1858"><td class="num" id="LN1858">1858</td><td class="line"><span class='keyword'>enum</span> { TDEFL_MAX_SUPPORTED_HUFF_CODESIZE = 32 };</td></tr>
<tr class="codeline" data-linenumber="1859"><td class="num" id="LN1859">1859</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> tdefl_huffman_enforce_max_code_size(<span class='keyword'>int</span> *pNum_codes, <span class='keyword'>int</span> code_list_len, <span class='keyword'>int</span> max_code_size)</td></tr>
<tr class="codeline" data-linenumber="1860"><td class="num" id="LN1860">1860</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1861"><td class="num" id="LN1861">1861</td><td class="line">  <span class='keyword'>int</span> i; mz_uint32 total = 0; <span class='keyword'>if</span> (code_list_len &lt;= 1) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="1862"><td class="num" id="LN1862">1862</td><td class="line">  <span class='keyword'>for</span> (i = max_code_size + 1; i &lt;= TDEFL_MAX_SUPPORTED_HUFF_CODESIZE; i++) pNum_codes[max_code_size] += pNum_codes[i];</td></tr>
<tr class="codeline" data-linenumber="1863"><td class="num" id="LN1863">1863</td><td class="line">  <span class='keyword'>for</span> (i = max_code_size; i &gt; 0; i--) total += (((mz_uint32)pNum_codes[i]) &lt;&lt; (max_code_size - i));</td></tr>
<tr class="codeline" data-linenumber="1864"><td class="num" id="LN1864">1864</td><td class="line">  <span class='keyword'>while</span> (total != (1UL &lt;&lt; max_code_size))</td></tr>
<tr class="codeline" data-linenumber="1865"><td class="num" id="LN1865">1865</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1866"><td class="num" id="LN1866">1866</td><td class="line">    pNum_codes[max_code_size]--;</td></tr>
<tr class="codeline" data-linenumber="1867"><td class="num" id="LN1867">1867</td><td class="line">    <span class='keyword'>for</span> (i = max_code_size - 1; i &gt; 0; i--) <span class='keyword'>if</span> (pNum_codes[i]) { pNum_codes[i]--; pNum_codes[i + 1] += 2; <span class='keyword'>break</span>; }</td></tr>
<tr class="codeline" data-linenumber="1868"><td class="num" id="LN1868">1868</td><td class="line">    total--;</td></tr>
<tr class="codeline" data-linenumber="1869"><td class="num" id="LN1869">1869</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1870"><td class="num" id="LN1870">1870</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1871"><td class="num" id="LN1871">1871</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1872"><td class="num" id="LN1872">1872</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> tdefl_optimize_huffman_table(tdefl_compressor *d, <span class='keyword'>int</span> table_num, <span class='keyword'>int</span> table_len, <span class='keyword'>int</span> code_size_limit, <span class='keyword'>int</span> static_table)</td></tr>
<tr class="codeline" data-linenumber="1873"><td class="num" id="LN1873">1873</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1874"><td class="num" id="LN1874">1874</td><td class="line">  <span class='keyword'>int</span> i, j, l, num_codes[1 + TDEFL_MAX_SUPPORTED_HUFF_CODESIZE]; mz_uint next_code[TDEFL_MAX_SUPPORTED_HUFF_CODESIZE + 1]; <span class='macro'>MZ_CLEAR_OBJ(num_codes)<span class='macro_popup'>memset(&amp;(num_codes), 0, sizeof(num_codes))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1875"><td class="num" id="LN1875">1875</td><td class="line">  <span class='keyword'>if</span> (static_table)</td></tr>
<tr class="codeline" data-linenumber="1876"><td class="num" id="LN1876">1876</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1877"><td class="num" id="LN1877">1877</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; table_len; i++) num_codes[d-&gt;m_huff_code_sizes[table_num][i]]++;</td></tr>
<tr class="codeline" data-linenumber="1878"><td class="num" id="LN1878">1878</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1879"><td class="num" id="LN1879">1879</td><td class="line">  <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1880"><td class="num" id="LN1880">1880</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1881"><td class="num" id="LN1881">1881</td><td class="line">    tdefl_sym_freq syms0[TDEFL_MAX_HUFF_SYMBOLS], syms1[TDEFL_MAX_HUFF_SYMBOLS], *pSyms;</td></tr>
<tr class="codeline" data-linenumber="1882"><td class="num" id="LN1882">1882</td><td class="line">    <span class='keyword'>int</span> num_used_syms = 0;</td></tr>
<tr class="codeline" data-linenumber="1883"><td class="num" id="LN1883">1883</td><td class="line">    <span class='keyword'>const</span> mz_uint16 *pSym_count = &amp;d-&gt;m_huff_count[table_num][0];</td></tr>
<tr class="codeline" data-linenumber="1884"><td class="num" id="LN1884">1884</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; table_len; i++) <span class='keyword'>if</span> (pSym_count[i]) { syms0[num_used_syms].m_key = (mz_uint16)pSym_count[i]; syms0[num_used_syms++].m_sym_index = (mz_uint16)i; }</td></tr>
<tr class="codeline" data-linenumber="1885"><td class="num" id="LN1885">1885</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1886"><td class="num" id="LN1886">1886</td><td class="line">    pSyms = tdefl_radix_sort_syms(num_used_syms, syms0, syms1); tdefl_calculate_minimum_redundancy(pSyms, num_used_syms);</td></tr>
<tr class="codeline" data-linenumber="1887"><td class="num" id="LN1887">1887</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1888"><td class="num" id="LN1888">1888</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; num_used_syms; i++) num_codes[pSyms[i].m_key]++;</td></tr>
<tr class="codeline" data-linenumber="1889"><td class="num" id="LN1889">1889</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1890"><td class="num" id="LN1890">1890</td><td class="line">    tdefl_huffman_enforce_max_code_size(num_codes, num_used_syms, code_size_limit);</td></tr>
<tr class="codeline" data-linenumber="1891"><td class="num" id="LN1891">1891</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1892"><td class="num" id="LN1892">1892</td><td class="line">    <span class='macro'>MZ_CLEAR_OBJ(d-&gt;m_huff_code_sizes[table_num])<span class='macro_popup'>memset(&amp;(d-&gt;m_huff_code_sizes[table_num]), 0, sizeof(d<br>-&gt;m_huff_code_sizes[table_num]))</span></span>; <span class='macro'>MZ_CLEAR_OBJ(d-&gt;m_huff_codes[table_num])<span class='macro_popup'>memset(&amp;(d-&gt;m_huff_codes[table_num]), 0, sizeof(d-&gt;<br>m_huff_codes[table_num]))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1893"><td class="num" id="LN1893">1893</td><td class="line">    <span class='keyword'>for</span> (i = 1, j = num_used_syms; i &lt;= code_size_limit; i++)</td></tr>
<tr class="codeline" data-linenumber="1894"><td class="num" id="LN1894">1894</td><td class="line">      <span class='keyword'>for</span> (l = num_codes[i]; l &gt; 0; l--) d-&gt;m_huff_code_sizes[table_num][pSyms[--j].m_sym_index] = (mz_uint8)(i);</td></tr>
<tr class="codeline" data-linenumber="1895"><td class="num" id="LN1895">1895</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1896"><td class="num" id="LN1896">1896</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1897"><td class="num" id="LN1897">1897</td><td class="line">  next_code[1] = 0; <span class='keyword'>for</span> (j = 0, i = 2; i &lt;= code_size_limit; i++) next_code[i] = j = ((j + num_codes[i - 1]) &lt;&lt; 1);</td></tr>
<tr class="codeline" data-linenumber="1898"><td class="num" id="LN1898">1898</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1899"><td class="num" id="LN1899">1899</td><td class="line">  <span class='keyword'>for</span> (i = 0; i &lt; table_len; i++)</td></tr>
<tr class="codeline" data-linenumber="1900"><td class="num" id="LN1900">1900</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1901"><td class="num" id="LN1901">1901</td><td class="line">    mz_uint rev_code = 0, code, code_size; <span class='keyword'>if</span> ((code_size = d-&gt;m_huff_code_sizes[table_num][i]) == 0) <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="1902"><td class="num" id="LN1902">1902</td><td class="line">    code = next_code[code_size]++; <span class='keyword'>for</span> (l = code_size; l &gt; 0; l--, code &gt;&gt;= 1) rev_code = (rev_code &lt;&lt; 1) | (code &amp; 1);</td></tr>
<tr class="codeline" data-linenumber="1903"><td class="num" id="LN1903">1903</td><td class="line">    d-&gt;m_huff_codes[table_num][i] = (mz_uint16)rev_code;</td></tr>
<tr class="codeline" data-linenumber="1904"><td class="num" id="LN1904">1904</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1905"><td class="num" id="LN1905">1905</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1906"><td class="num" id="LN1906">1906</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1907"><td class="num" id="LN1907">1907</td><td class="line"><span class='directive'>#define <span class='macro'>TDEFL_PUT_BITS(b, l)<span class='macro_popup'>do { mz_uint bits = b; mz_uint len = l; ((void) sizeof ((bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if<br> (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail (<br>"bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 1907, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span> do { \</span></td></tr>
<tr class="codeline" data-linenumber="1908"><td class="num" id="LN1908">1908</td><td class="line">  <span class='directive'>mz_uint bits = b; mz_uint len = l; <span class='macro'>MZ_ASSERT(bits &lt;= ((1U &lt;&lt; len) - 1U))<span class='macro_popup'>((void) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0<br>), __extension__ ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U)) ;<br> else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 1908, __extension__ __PRETTY_FUNCTION__); }))</span></span>; \</span></td></tr>
<tr class="codeline" data-linenumber="1909"><td class="num" id="LN1909">1909</td><td class="line">  <span class='directive'>d-&gt;m_bit_buffer |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; \</span></td></tr>
<tr class="codeline" data-linenumber="1910"><td class="num" id="LN1910">1910</td><td class="line">  <span class='directive'>while (d-&gt;m_bits_in &gt;= 8) { \</span></td></tr>
<tr class="codeline" data-linenumber="1911"><td class="num" id="LN1911">1911</td><td class="line">    <span class='directive'>if (d-&gt;m_pOutput_buf &lt; d-&gt;m_pOutput_buf_end) \</span></td></tr>
<tr class="codeline" data-linenumber="1912"><td class="num" id="LN1912">1912</td><td class="line">      <span class='directive'>*d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;m_bit_buffer); \</span></td></tr>
<tr class="codeline" data-linenumber="1913"><td class="num" id="LN1913">1913</td><td class="line">      <span class='directive'>d-&gt;m_bit_buffer &gt;&gt;= 8; \</span></td></tr>
<tr class="codeline" data-linenumber="1914"><td class="num" id="LN1914">1914</td><td class="line">      <span class='directive'>d-&gt;m_bits_in -= 8; \</span></td></tr>
<tr class="codeline" data-linenumber="1915"><td class="num" id="LN1915">1915</td><td class="line">  <span class='directive'>} \</span></td></tr>
<tr class="codeline" data-linenumber="1916"><td class="num" id="LN1916">1916</td><td class="line"><span class='directive'>} <span class='macro'>MZ_MACRO_END<span class='macro_popup'>while (0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="1917"><td class="num" id="LN1917">1917</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1918"><td class="num" id="LN1918">1918</td><td class="line"><span class='directive'>#define <span class='macro'>TDEFL_RLE_PREV_CODE_SIZE()<span class='macro_popup'>{ if (rle_repeat_count) { if (rle_repeat_count &lt; 3) { d-&gt;<br>m_huff_count[2][prev_code_size] = (mz_uint16)(d-&gt;m_huff_count<br>[2][prev_code_size] + rle_repeat_count); while (rle_repeat_count<br>--) packed_code_sizes[num_packed_code_sizes++] = prev_code_size<br>; } else { d-&gt;m_huff_count[2][16] = (mz_uint16)(d-&gt;m_huff_count<br>[2][16] + 1); packed_code_sizes[num_packed_code_sizes++] = 16<br>; packed_code_sizes[num_packed_code_sizes++] = (mz_uint8)(rle_repeat_count<br> - 3); } rle_repeat_count = 0; } }</span></span> { if (rle_repeat_count) { \</span></td></tr>
<tr class="codeline" data-linenumber="1919"><td class="num" id="LN1919">1919</td><td class="line">  <span class='directive'>if (rle_repeat_count &lt; 3) { \</span></td></tr>
<tr class="codeline" data-linenumber="1920"><td class="num" id="LN1920">1920</td><td class="line">    <span class='directive'>d-&gt;m_huff_count[2][prev_code_size] = (mz_uint16)(d-&gt;m_huff_count[2][prev_code_size] + rle_repeat_count); \</span></td></tr>
<tr class="codeline" data-linenumber="1921"><td class="num" id="LN1921">1921</td><td class="line">    <span class='directive'>while (rle_repeat_count--) packed_code_sizes[num_packed_code_sizes++] = prev_code_size; \</span></td></tr>
<tr class="codeline" data-linenumber="1922"><td class="num" id="LN1922">1922</td><td class="line">  <span class='directive'>} else { \</span></td></tr>
<tr class="codeline" data-linenumber="1923"><td class="num" id="LN1923">1923</td><td class="line">    <span class='directive'>d-&gt;m_huff_count[2][16] = (mz_uint16)(d-&gt;m_huff_count[2][16] + 1); packed_code_sizes[num_packed_code_sizes++] = 16; packed_code_sizes[num_packed_code_sizes++] = (mz_uint8)(rle_repeat_count - 3); \</span></td></tr>
<tr class="codeline" data-linenumber="1924"><td class="num" id="LN1924">1924</td><td class="line"><span class='directive'>} rle_repeat_count = 0; } }</span></td></tr>
<tr class="codeline" data-linenumber="1925"><td class="num" id="LN1925">1925</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1926"><td class="num" id="LN1926">1926</td><td class="line"><span class='directive'>#define <span class='macro'>TDEFL_RLE_ZERO_CODE_SIZE()<span class='macro_popup'>{ if (rle_z_count) { if (rle_z_count &lt; 3) { d-&gt;m_huff_count<br>[2][0] = (mz_uint16)(d-&gt;m_huff_count[2][0] + rle_z_count);<br> while (rle_z_count--) packed_code_sizes[num_packed_code_sizes<br>++] = 0; } else if (rle_z_count &lt;= 10) { d-&gt;m_huff_count<br>[2][17] = (mz_uint16)(d-&gt;m_huff_count[2][17] + 1); packed_code_sizes<br>[num_packed_code_sizes++] = 17; packed_code_sizes[num_packed_code_sizes<br>++] = (mz_uint8)(rle_z_count - 3); } else { d-&gt;m_huff_count<br>[2][18] = (mz_uint16)(d-&gt;m_huff_count[2][18] + 1); packed_code_sizes<br>[num_packed_code_sizes++] = 18; packed_code_sizes[num_packed_code_sizes<br>++] = (mz_uint8)(rle_z_count - 11); } rle_z_count = 0; } }</span></span> { if (rle_z_count) { \</span></td></tr>
<tr class="codeline" data-linenumber="1927"><td class="num" id="LN1927">1927</td><td class="line">  <span class='directive'>if (rle_z_count &lt; 3) { \</span></td></tr>
<tr class="codeline" data-linenumber="1928"><td class="num" id="LN1928">1928</td><td class="line">    <span class='directive'>d-&gt;m_huff_count[2][0] = (mz_uint16)(d-&gt;m_huff_count[2][0] + rle_z_count); while (rle_z_count--) packed_code_sizes[num_packed_code_sizes++] = 0; \</span></td></tr>
<tr class="codeline" data-linenumber="1929"><td class="num" id="LN1929">1929</td><td class="line">  <span class='directive'>} else if (rle_z_count &lt;= 10) { \</span></td></tr>
<tr class="codeline" data-linenumber="1930"><td class="num" id="LN1930">1930</td><td class="line">    <span class='directive'>d-&gt;m_huff_count[2][17] = (mz_uint16)(d-&gt;m_huff_count[2][17] + 1); packed_code_sizes[num_packed_code_sizes++] = 17; packed_code_sizes[num_packed_code_sizes++] = (mz_uint8)(rle_z_count - 3); \</span></td></tr>
<tr class="codeline" data-linenumber="1931"><td class="num" id="LN1931">1931</td><td class="line">  <span class='directive'>} else { \</span></td></tr>
<tr class="codeline" data-linenumber="1932"><td class="num" id="LN1932">1932</td><td class="line">    <span class='directive'>d-&gt;m_huff_count[2][18] = (mz_uint16)(d-&gt;m_huff_count[2][18] + 1); packed_code_sizes[num_packed_code_sizes++] = 18; packed_code_sizes[num_packed_code_sizes++] = (mz_uint8)(rle_z_count - 11); \</span></td></tr>
<tr class="codeline" data-linenumber="1933"><td class="num" id="LN1933">1933</td><td class="line"><span class='directive'>} rle_z_count = 0; } }</span></td></tr>
<tr class="codeline" data-linenumber="1934"><td class="num" id="LN1934">1934</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1935"><td class="num" id="LN1935">1935</td><td class="line"><span class='keyword'>static</span> mz_uint8 s_tdefl_packed_code_size_syms_swizzle[] = { 16, 17, 18, 0, 8, 7, 9, 6, 10, 5, 11, 4, 12, 3, 13, 2, 14, 1, 15 };</td></tr>
<tr class="codeline" data-linenumber="1936"><td class="num" id="LN1936">1936</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1937"><td class="num" id="LN1937">1937</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> tdefl_start_dynamic_block(tdefl_compressor *d)</td></tr>
<tr class="codeline" data-linenumber="1938"><td class="num" id="LN1938">1938</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="1939"><td class="num" id="LN1939">1939</td><td class="line">  <span class='keyword'>int</span> num_lit_codes, num_dist_codes, num_bit_lengths; mz_uint i, total_code_sizes_to_pack, num_packed_code_sizes, rle_z_count, rle_repeat_count, packed_code_sizes_index;</td></tr>
<tr class="codeline" data-linenumber="1940"><td class="num" id="LN1940">1940</td><td class="line">  mz_uint8 code_sizes_to_pack[TDEFL_MAX_HUFF_SYMBOLS_0 + TDEFL_MAX_HUFF_SYMBOLS_1], packed_code_sizes[TDEFL_MAX_HUFF_SYMBOLS_0 + TDEFL_MAX_HUFF_SYMBOLS_1], prev_code_size = 0xFF;</td></tr>
<tr class="codeline" data-linenumber="1941"><td class="num" id="LN1941">1941</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1942"><td class="num" id="LN1942">1942</td><td class="line">  d-&gt;m_huff_count[0][256] = 1;</td></tr>
<tr class="codeline" data-linenumber="1943"><td class="num" id="LN1943">1943</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1944"><td class="num" id="LN1944">1944</td><td class="line">  tdefl_optimize_huffman_table(d, 0, TDEFL_MAX_HUFF_SYMBOLS_0, 15, <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1945"><td class="num" id="LN1945">1945</td><td class="line">  tdefl_optimize_huffman_table(d, 1, TDEFL_MAX_HUFF_SYMBOLS_1, 15, <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1946"><td class="num" id="LN1946">1946</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1947"><td class="num" id="LN1947">1947</td><td class="line">  <span class='keyword'>for</span> (num_lit_codes = 286; num_lit_codes &gt; 257; num_lit_codes--) <span class='keyword'>if</span> (d-&gt;m_huff_code_sizes[0][num_lit_codes - 1]) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1948"><td class="num" id="LN1948">1948</td><td class="line">  <span class='keyword'>for</span> (num_dist_codes = 30; num_dist_codes &gt; 1; num_dist_codes--) <span class='keyword'>if</span> (d-&gt;m_huff_code_sizes[1][num_dist_codes - 1]) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1949"><td class="num" id="LN1949">1949</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1950"><td class="num" id="LN1950">1950</td><td class="line">  memcpy(code_sizes_to_pack, &amp;d-&gt;m_huff_code_sizes[0][0], num_lit_codes);</td></tr>
<tr class="codeline" data-linenumber="1951"><td class="num" id="LN1951">1951</td><td class="line">  memcpy(code_sizes_to_pack + num_lit_codes, &amp;d-&gt;m_huff_code_sizes[1][0], num_dist_codes);</td></tr>
<tr class="codeline" data-linenumber="1952"><td class="num" id="LN1952">1952</td><td class="line">  total_code_sizes_to_pack = num_lit_codes + num_dist_codes; num_packed_code_sizes = 0; rle_z_count = 0; rle_repeat_count = 0;</td></tr>
<tr class="codeline" data-linenumber="1953"><td class="num" id="LN1953">1953</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1954"><td class="num" id="LN1954">1954</td><td class="line">  memset(&amp;d-&gt;m_huff_count[2][0], 0, <span class='keyword'>sizeof</span>(d-&gt;m_huff_count[2][0]) * TDEFL_MAX_HUFF_SYMBOLS_2);</td></tr>
<tr class="codeline" data-linenumber="1955"><td class="num" id="LN1955">1955</td><td class="line">  <span class='keyword'>for</span> (i = 0; i &lt; total_code_sizes_to_pack; i++)</td></tr>
<tr class="codeline" data-linenumber="1956"><td class="num" id="LN1956">1956</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1957"><td class="num" id="LN1957">1957</td><td class="line">    mz_uint8 code_size = code_sizes_to_pack[i];</td></tr>
<tr class="codeline" data-linenumber="1958"><td class="num" id="LN1958">1958</td><td class="line">    <span class='keyword'>if</span> (!code_size)</td></tr>
<tr class="codeline" data-linenumber="1959"><td class="num" id="LN1959">1959</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1960"><td class="num" id="LN1960">1960</td><td class="line">      <span class='macro'>TDEFL_RLE_PREV_CODE_SIZE()<span class='macro_popup'>{ if (rle_repeat_count) { if (rle_repeat_count &lt; 3) { d-&gt;<br>m_huff_count[2][prev_code_size] = (mz_uint16)(d-&gt;m_huff_count<br>[2][prev_code_size] + rle_repeat_count); while (rle_repeat_count<br>--) packed_code_sizes[num_packed_code_sizes++] = prev_code_size<br>; } else { d-&gt;m_huff_count[2][16] = (mz_uint16)(d-&gt;m_huff_count<br>[2][16] + 1); packed_code_sizes[num_packed_code_sizes++] = 16<br>; packed_code_sizes[num_packed_code_sizes++] = (mz_uint8)(rle_repeat_count<br> - 3); } rle_repeat_count = 0; } }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1961"><td class="num" id="LN1961">1961</td><td class="line">      <span class='keyword'>if</span> (++rle_z_count == 138) { <span class='macro'>TDEFL_RLE_ZERO_CODE_SIZE()<span class='macro_popup'>{ if (rle_z_count) { if (rle_z_count &lt; 3) { d-&gt;m_huff_count<br>[2][0] = (mz_uint16)(d-&gt;m_huff_count[2][0] + rle_z_count);<br> while (rle_z_count--) packed_code_sizes[num_packed_code_sizes<br>++] = 0; } else if (rle_z_count &lt;= 10) { d-&gt;m_huff_count<br>[2][17] = (mz_uint16)(d-&gt;m_huff_count[2][17] + 1); packed_code_sizes<br>[num_packed_code_sizes++] = 17; packed_code_sizes[num_packed_code_sizes<br>++] = (mz_uint8)(rle_z_count - 3); } else { d-&gt;m_huff_count<br>[2][18] = (mz_uint16)(d-&gt;m_huff_count[2][18] + 1); packed_code_sizes<br>[num_packed_code_sizes++] = 18; packed_code_sizes[num_packed_code_sizes<br>++] = (mz_uint8)(rle_z_count - 11); } rle_z_count = 0; } }</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1962"><td class="num" id="LN1962">1962</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1963"><td class="num" id="LN1963">1963</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="1964"><td class="num" id="LN1964">1964</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="1965"><td class="num" id="LN1965">1965</td><td class="line">      <span class='macro'>TDEFL_RLE_ZERO_CODE_SIZE()<span class='macro_popup'>{ if (rle_z_count) { if (rle_z_count &lt; 3) { d-&gt;m_huff_count<br>[2][0] = (mz_uint16)(d-&gt;m_huff_count[2][0] + rle_z_count);<br> while (rle_z_count--) packed_code_sizes[num_packed_code_sizes<br>++] = 0; } else if (rle_z_count &lt;= 10) { d-&gt;m_huff_count<br>[2][17] = (mz_uint16)(d-&gt;m_huff_count[2][17] + 1); packed_code_sizes<br>[num_packed_code_sizes++] = 17; packed_code_sizes[num_packed_code_sizes<br>++] = (mz_uint8)(rle_z_count - 3); } else { d-&gt;m_huff_count<br>[2][18] = (mz_uint16)(d-&gt;m_huff_count[2][18] + 1); packed_code_sizes<br>[num_packed_code_sizes++] = 18; packed_code_sizes[num_packed_code_sizes<br>++] = (mz_uint8)(rle_z_count - 11); } rle_z_count = 0; } }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1966"><td class="num" id="LN1966">1966</td><td class="line">      <span class='keyword'>if</span> (code_size != prev_code_size)</td></tr>
<tr class="codeline" data-linenumber="1967"><td class="num" id="LN1967">1967</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="1968"><td class="num" id="LN1968">1968</td><td class="line">        <span class='macro'>TDEFL_RLE_PREV_CODE_SIZE()<span class='macro_popup'>{ if (rle_repeat_count) { if (rle_repeat_count &lt; 3) { d-&gt;<br>m_huff_count[2][prev_code_size] = (mz_uint16)(d-&gt;m_huff_count<br>[2][prev_code_size] + rle_repeat_count); while (rle_repeat_count<br>--) packed_code_sizes[num_packed_code_sizes++] = prev_code_size<br>; } else { d-&gt;m_huff_count[2][16] = (mz_uint16)(d-&gt;m_huff_count<br>[2][16] + 1); packed_code_sizes[num_packed_code_sizes++] = 16<br>; packed_code_sizes[num_packed_code_sizes++] = (mz_uint8)(rle_repeat_count<br> - 3); } rle_repeat_count = 0; } }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1969"><td class="num" id="LN1969">1969</td><td class="line">        d-&gt;m_huff_count[2][code_size] = (mz_uint16)(d-&gt;m_huff_count[2][code_size] + 1); packed_code_sizes[num_packed_code_sizes++] = code_size;</td></tr>
<tr class="codeline" data-linenumber="1970"><td class="num" id="LN1970">1970</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1971"><td class="num" id="LN1971">1971</td><td class="line">      <span class='keyword'>else</span> <span class='keyword'>if</span> (++rle_repeat_count == 6)</td></tr>
<tr class="codeline" data-linenumber="1972"><td class="num" id="LN1972">1972</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="1973"><td class="num" id="LN1973">1973</td><td class="line">        <span class='macro'>TDEFL_RLE_PREV_CODE_SIZE()<span class='macro_popup'>{ if (rle_repeat_count) { if (rle_repeat_count &lt; 3) { d-&gt;<br>m_huff_count[2][prev_code_size] = (mz_uint16)(d-&gt;m_huff_count<br>[2][prev_code_size] + rle_repeat_count); while (rle_repeat_count<br>--) packed_code_sizes[num_packed_code_sizes++] = prev_code_size<br>; } else { d-&gt;m_huff_count[2][16] = (mz_uint16)(d-&gt;m_huff_count<br>[2][16] + 1); packed_code_sizes[num_packed_code_sizes++] = 16<br>; packed_code_sizes[num_packed_code_sizes++] = (mz_uint8)(rle_repeat_count<br> - 3); } rle_repeat_count = 0; } }</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1974"><td class="num" id="LN1974">1974</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="1975"><td class="num" id="LN1975">1975</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="1976"><td class="num" id="LN1976">1976</td><td class="line">    prev_code_size = code_size;</td></tr>
<tr class="codeline" data-linenumber="1977"><td class="num" id="LN1977">1977</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1978"><td class="num" id="LN1978">1978</td><td class="line">  <span class='keyword'>if</span> (rle_repeat_count) { <span class='macro'>TDEFL_RLE_PREV_CODE_SIZE()<span class='macro_popup'>{ if (rle_repeat_count) { if (rle_repeat_count &lt; 3) { d-&gt;<br>m_huff_count[2][prev_code_size] = (mz_uint16)(d-&gt;m_huff_count<br>[2][prev_code_size] + rle_repeat_count); while (rle_repeat_count<br>--) packed_code_sizes[num_packed_code_sizes++] = prev_code_size<br>; } else { d-&gt;m_huff_count[2][16] = (mz_uint16)(d-&gt;m_huff_count<br>[2][16] + 1); packed_code_sizes[num_packed_code_sizes++] = 16<br>; packed_code_sizes[num_packed_code_sizes++] = (mz_uint8)(rle_repeat_count<br> - 3); } rle_repeat_count = 0; } }</span></span>; } <span class='keyword'>else</span> { <span class='macro'>TDEFL_RLE_ZERO_CODE_SIZE()<span class='macro_popup'>{ if (rle_z_count) { if (rle_z_count &lt; 3) { d-&gt;m_huff_count<br>[2][0] = (mz_uint16)(d-&gt;m_huff_count[2][0] + rle_z_count);<br> while (rle_z_count--) packed_code_sizes[num_packed_code_sizes<br>++] = 0; } else if (rle_z_count &lt;= 10) { d-&gt;m_huff_count<br>[2][17] = (mz_uint16)(d-&gt;m_huff_count[2][17] + 1); packed_code_sizes<br>[num_packed_code_sizes++] = 17; packed_code_sizes[num_packed_code_sizes<br>++] = (mz_uint8)(rle_z_count - 3); } else { d-&gt;m_huff_count<br>[2][18] = (mz_uint16)(d-&gt;m_huff_count[2][18] + 1); packed_code_sizes<br>[num_packed_code_sizes++] = 18; packed_code_sizes[num_packed_code_sizes<br>++] = (mz_uint8)(rle_z_count - 11); } rle_z_count = 0; } }</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="1979"><td class="num" id="LN1979">1979</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1980"><td class="num" id="LN1980">1980</td><td class="line">  tdefl_optimize_huffman_table(d, 2, TDEFL_MAX_HUFF_SYMBOLS_2, 7, <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="1981"><td class="num" id="LN1981">1981</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1982"><td class="num" id="LN1982">1982</td><td class="line">  <span class='macro'>TDEFL_PUT_BITS(2, 2)<span class='macro_popup'>do { mz_uint bits = 2; mz_uint len = 2; ((void) sizeof ((bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if<br> (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail (<br>"bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 1982, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1983"><td class="num" id="LN1983">1983</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1984"><td class="num" id="LN1984">1984</td><td class="line">  <span class='macro'>TDEFL_PUT_BITS(num_lit_codes - 257, 5)<span class='macro_popup'>do { mz_uint bits = num_lit_codes - 257; mz_uint len = 5; ((void<br>) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__<br> ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail<br> ("bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 1984, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1985"><td class="num" id="LN1985">1985</td><td class="line">  <span class='macro'>TDEFL_PUT_BITS(num_dist_codes - 1, 5)<span class='macro_popup'>do { mz_uint bits = num_dist_codes - 1; mz_uint len = 5; ((void<br>) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__<br> ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail<br> ("bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 1985, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1986"><td class="num" id="LN1986">1986</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1987"><td class="num" id="LN1987">1987</td><td class="line">  <span class='keyword'>for</span> (num_bit_lengths = 18; num_bit_lengths &gt;= 0; num_bit_lengths--) <span class='keyword'>if</span> (d-&gt;m_huff_code_sizes[2][s_tdefl_packed_code_size_syms_swizzle[num_bit_lengths]]) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="1988"><td class="num" id="LN1988">1988</td><td class="line">  num_bit_lengths = <span class='macro'>MZ_MAX(4, (num_bit_lengths + 1))<span class='macro_popup'>(((4)&gt;((num_bit_lengths + 1)))?(4):((num_bit_lengths + 1))<br>)</span></span>; <span class='macro'>TDEFL_PUT_BITS(num_bit_lengths - 4, 4)<span class='macro_popup'>do { mz_uint bits = num_bit_lengths - 4; mz_uint len = 4; ((void<br>) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__<br> ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail<br> ("bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 1988, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1989"><td class="num" id="LN1989">1989</td><td class="line">  <span class='keyword'>for</span> (i = 0; (<span class='keyword'>int</span>)i &lt; num_bit_lengths; i++) <span class='macro'>TDEFL_PUT_BITS(d-&gt;m_huff_code_sizes[2][s_tdefl_packed_code_size_syms_swizzle[i]], 3)<span class='macro_popup'>do { mz_uint bits = d-&gt;m_huff_code_sizes[2][s_tdefl_packed_code_size_syms_swizzle<br>[i]]; mz_uint len = 3; ((void) sizeof ((bits &lt;= ((1U &lt;&lt;<br> len) - 1U)) ? 1 : 0), __extension__ ({ if (bits &lt;= ((1U &lt;&lt;<br> len) - 1U)) ; else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 1989, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1990"><td class="num" id="LN1990">1990</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1991"><td class="num" id="LN1991">1991</td><td class="line">  <span class='keyword'>for</span> (packed_code_sizes_index = 0; packed_code_sizes_index &lt; num_packed_code_sizes; )</td></tr>
<tr class="codeline" data-linenumber="1992"><td class="num" id="LN1992">1992</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="1993"><td class="num" id="LN1993">1993</td><td class="line">    mz_uint code = packed_code_sizes[packed_code_sizes_index++]; <span class='macro'>MZ_ASSERT(code &lt; TDEFL_MAX_HUFF_SYMBOLS_2)<span class='macro_popup'>((void) sizeof ((code &lt; TDEFL_MAX_HUFF_SYMBOLS_2) ? 1 : 0)<br>, __extension__ ({ if (code &lt; TDEFL_MAX_HUFF_SYMBOLS_2) ; else<br> __assert_fail ("code &lt; TDEFL_MAX_HUFF_SYMBOLS_2", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 1993, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1994"><td class="num" id="LN1994">1994</td><td class="line">    <span class='macro'>TDEFL_PUT_BITS(d-&gt;m_huff_codes[2][code], d-&gt;m_huff_code_sizes[2][code])<span class='macro_popup'>do { mz_uint bits = d-&gt;m_huff_codes[2][code]; mz_uint len =<br> d-&gt;m_huff_code_sizes[2][code]; ((void) sizeof ((bits &lt;=<br> ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if (bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 1994, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1995"><td class="num" id="LN1995">1995</td><td class="line">    <span class='keyword'>if</span> (code &gt;= 16) <span class='macro'>TDEFL_PUT_BITS(packed_code_sizes[packed_code_sizes_index++], <span class='string_literal'>"\02\03\07"</span>[code - 16])<span class='macro_popup'>do { mz_uint bits = packed_code_sizes[packed_code_sizes_index<br>++]; mz_uint len = "\02\03\07"[code - 16]; ((void) sizeof ((bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if<br> (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail (<br>"bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 1995, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="1996"><td class="num" id="LN1996">1996</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="1997"><td class="num" id="LN1997">1997</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="1998"><td class="num" id="LN1998">1998</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="1999"><td class="num" id="LN1999">1999</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> tdefl_start_static_block(tdefl_compressor *d)</td></tr>
<tr class="codeline" data-linenumber="2000"><td class="num" id="LN2000">2000</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2001"><td class="num" id="LN2001">2001</td><td class="line">  mz_uint i;</td></tr>
<tr class="codeline" data-linenumber="2002"><td class="num" id="LN2002">2002</td><td class="line">  mz_uint8 *p = &amp;d-&gt;m_huff_code_sizes[0][0];</td></tr>
<tr class="codeline" data-linenumber="2003"><td class="num" id="LN2003">2003</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2004"><td class="num" id="LN2004">2004</td><td class="line">  <span class='keyword'>for</span> (i = 0; i &lt;= 143; ++i) *p++ = 8;</td></tr>
<tr class="codeline" data-linenumber="2005"><td class="num" id="LN2005">2005</td><td class="line">  <span class='keyword'>for</span> ( ; i &lt;= 255; ++i) *p++ = 9;</td></tr>
<tr class="codeline" data-linenumber="2006"><td class="num" id="LN2006">2006</td><td class="line">  <span class='keyword'>for</span> ( ; i &lt;= 279; ++i) *p++ = 7;</td></tr>
<tr class="codeline" data-linenumber="2007"><td class="num" id="LN2007">2007</td><td class="line">  <span class='keyword'>for</span> ( ; i &lt;= 287; ++i) *p++ = 8;</td></tr>
<tr class="codeline" data-linenumber="2008"><td class="num" id="LN2008">2008</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2009"><td class="num" id="LN2009">2009</td><td class="line">  memset(d-&gt;m_huff_code_sizes[1], 5, 32);</td></tr>
<tr class="codeline" data-linenumber="2010"><td class="num" id="LN2010">2010</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2011"><td class="num" id="LN2011">2011</td><td class="line">  tdefl_optimize_huffman_table(d, 0, 288, 15, <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2012"><td class="num" id="LN2012">2012</td><td class="line">  tdefl_optimize_huffman_table(d, 1, 32, 15, <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2013"><td class="num" id="LN2013">2013</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2014"><td class="num" id="LN2014">2014</td><td class="line">  <span class='macro'>TDEFL_PUT_BITS(1, 2)<span class='macro_popup'>do { mz_uint bits = 1; mz_uint len = 2; ((void) sizeof ((bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if<br> (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail (<br>"bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2014, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2015"><td class="num" id="LN2015">2015</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2016"><td class="num" id="LN2016">2016</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2017"><td class="num" id="LN2017">2017</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint mz_bitmasks[17] = { 0x0000, 0x0001, 0x0003, 0x0007, 0x000F, 0x001F, 0x003F, 0x007F, 0x00FF, 0x01FF, 0x03FF, 0x07FF, 0x0FFF, 0x1FFF, 0x3FFF, 0x7FFF, 0xFFFF };</td></tr>
<tr class="codeline" data-linenumber="2018"><td class="num" id="LN2018">2018</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2019"><td class="num" id="LN2019">2019</td><td class="line"><span class='directive'>#if <span class='macro'>MINIZ_USE_UNALIGNED_LOADS_AND_STORES<span class='macro_popup'>1</span></span> &amp;&amp; <span class='macro'>MINIZ_LITTLE_ENDIAN<span class='macro_popup'>1</span></span> &amp;&amp; <span class='macro'>MINIZ_HAS_64BIT_REGISTERS<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2020"><td class="num" id="LN2020">2020</td><td class="line"><span class='keyword'>static</span> mz_bool tdefl_compress_lz_codes(tdefl_compressor *d)</td></tr>
<tr class="codeline" data-linenumber="2021"><td class="num" id="LN2021">2021</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2022"><td class="num" id="LN2022">2022</td><td class="line">  mz_uint flags;</td></tr>
<tr class="codeline" data-linenumber="2023"><td class="num" id="LN2023">2023</td><td class="line">  mz_uint8 *pLZ_codes;</td></tr>
<tr class="codeline" data-linenumber="2024"><td class="num" id="LN2024">2024</td><td class="line">  mz_uint8 *pOutput_buf = d-&gt;m_pOutput_buf;</td></tr>
<tr class="codeline" data-linenumber="2025"><td class="num" id="LN2025">2025</td><td class="line">  mz_uint8 *pLZ_code_buf_end = d-&gt;m_pLZ_code_buf;</td></tr>
<tr class="codeline" data-linenumber="2026"><td class="num" id="LN2026">2026</td><td class="line">  mz_uint64 bit_buffer = d-&gt;m_bit_buffer;</td></tr>
<tr class="codeline" data-linenumber="2027"><td class="num" id="LN2027">2027</td><td class="line">  mz_uint bits_in = d-&gt;m_bits_in;</td></tr>
<tr class="codeline" data-linenumber="2028"><td class="num" id="LN2028">2028</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2029"><td class="num" id="LN2029">2029</td><td class="line"><span class='directive'>#define TDEFL_PUT_BITS_FAST(b, l) { bit_buffer |= (((mz_uint64)(b)) &lt;&lt; bits_in); bits_in += (l); }</span></td></tr>
<tr class="codeline" data-linenumber="2030"><td class="num" id="LN2030">2030</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2031"><td class="num" id="LN2031">2031</td><td class="line">  flags = 1;</td></tr>
<tr class="codeline" data-linenumber="2032"><td class="num" id="LN2032">2032</td><td class="line">  <span class='keyword'>for</span> (pLZ_codes = d-&gt;m_lz_code_buf; pLZ_codes &lt; pLZ_code_buf_end; flags &gt;&gt;= 1)</td></tr>
<tr class="codeline" data-linenumber="2033"><td class="num" id="LN2033">2033</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2034"><td class="num" id="LN2034">2034</td><td class="line">    <span class='keyword'>if</span> (flags == 1)</td></tr>
<tr class="codeline" data-linenumber="2035"><td class="num" id="LN2035">2035</td><td class="line">      flags = *pLZ_codes++ | 0x100;</td></tr>
<tr class="codeline" data-linenumber="2036"><td class="num" id="LN2036">2036</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2037"><td class="num" id="LN2037">2037</td><td class="line">    <span class='keyword'>if</span> (flags &amp; 1)</td></tr>
<tr class="codeline" data-linenumber="2038"><td class="num" id="LN2038">2038</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2039"><td class="num" id="LN2039">2039</td><td class="line">      mz_uint s0, s1, n0, n1, sym, num_extra_bits;</td></tr>
<tr class="codeline" data-linenumber="2040"><td class="num" id="LN2040">2040</td><td class="line">      mz_uint match_len = pLZ_codes[0], match_dist = *(<span class='keyword'>const</span> mz_uint16 *)(pLZ_codes + 1); pLZ_codes += 3;</td></tr>
<tr class="codeline" data-linenumber="2041"><td class="num" id="LN2041">2041</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2042"><td class="num" id="LN2042">2042</td><td class="line">      <span class='macro'>MZ_ASSERT(d-&gt;m_huff_code_sizes[0][s_tdefl_len_sym[match_len]])<span class='macro_popup'>((void) sizeof ((d-&gt;m_huff_code_sizes[0][s_tdefl_len_sym[match_len<br>]]) ? 1 : 0), __extension__ ({ if (d-&gt;m_huff_code_sizes[0]<br>[s_tdefl_len_sym[match_len]]) ; else __assert_fail ("d-&gt;m_huff_code_sizes[0][s_tdefl_len_sym[match_len]]"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2042, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2043"><td class="num" id="LN2043">2043</td><td class="line">      TDEFL_PUT_BITS_FAST(d-&gt;m_huff_codes[0][s_tdefl_len_sym[match_len]], d-&gt;m_huff_code_sizes[0][s_tdefl_len_sym[match_len]]);</td></tr>
<tr class="codeline" data-linenumber="2044"><td class="num" id="LN2044">2044</td><td class="line">      TDEFL_PUT_BITS_FAST(match_len &amp; mz_bitmasks[s_tdefl_len_extra[match_len]], s_tdefl_len_extra[match_len]);</td></tr>
<tr class="codeline" data-linenumber="2045"><td class="num" id="LN2045">2045</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2046"><td class="num" id="LN2046">2046</td><td class="line">      <span class='comment'>// This sequence coaxes MSVC into using cmov's vs. jmp's.</span></td></tr>
<tr class="codeline" data-linenumber="2047"><td class="num" id="LN2047">2047</td><td class="line">      s0 = s_tdefl_small_dist_sym[match_dist &amp; 511];</td></tr>
<tr class="codeline" data-linenumber="2048"><td class="num" id="LN2048">2048</td><td class="line">      n0 = s_tdefl_small_dist_extra[match_dist &amp; 511];</td></tr>
<tr class="codeline" data-linenumber="2049"><td class="num" id="LN2049">2049</td><td class="line">      s1 = s_tdefl_large_dist_sym[match_dist &gt;&gt; 8];</td></tr>
<tr class="codeline" data-linenumber="2050"><td class="num" id="LN2050">2050</td><td class="line">      n1 = s_tdefl_large_dist_extra[match_dist &gt;&gt; 8];</td></tr>
<tr class="codeline" data-linenumber="2051"><td class="num" id="LN2051">2051</td><td class="line">      sym = (match_dist &lt; 512) ? s0 : s1;</td></tr>
<tr class="codeline" data-linenumber="2052"><td class="num" id="LN2052">2052</td><td class="line">      num_extra_bits = (match_dist &lt; 512) ? n0 : n1;</td></tr>
<tr class="codeline" data-linenumber="2053"><td class="num" id="LN2053">2053</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2054"><td class="num" id="LN2054">2054</td><td class="line">      <span class='macro'>MZ_ASSERT(d-&gt;m_huff_code_sizes[1][sym])<span class='macro_popup'>((void) sizeof ((d-&gt;m_huff_code_sizes[1][sym]) ? 1 : 0), __extension__<br> ({ if (d-&gt;m_huff_code_sizes[1][sym]) ; else __assert_fail<br> ("d-&gt;m_huff_code_sizes[1][sym]", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2054, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2055"><td class="num" id="LN2055">2055</td><td class="line">      TDEFL_PUT_BITS_FAST(d-&gt;m_huff_codes[1][sym], d-&gt;m_huff_code_sizes[1][sym]);</td></tr>
<tr class="codeline" data-linenumber="2056"><td class="num" id="LN2056">2056</td><td class="line">      TDEFL_PUT_BITS_FAST(match_dist &amp; mz_bitmasks[num_extra_bits], num_extra_bits);</td></tr>
<tr class="codeline" data-linenumber="2057"><td class="num" id="LN2057">2057</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2058"><td class="num" id="LN2058">2058</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2059"><td class="num" id="LN2059">2059</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2060"><td class="num" id="LN2060">2060</td><td class="line">      mz_uint lit = *pLZ_codes++;</td></tr>
<tr class="codeline" data-linenumber="2061"><td class="num" id="LN2061">2061</td><td class="line">      <span class='macro'>MZ_ASSERT(d-&gt;m_huff_code_sizes[0][lit])<span class='macro_popup'>((void) sizeof ((d-&gt;m_huff_code_sizes[0][lit]) ? 1 : 0), __extension__<br> ({ if (d-&gt;m_huff_code_sizes[0][lit]) ; else __assert_fail<br> ("d-&gt;m_huff_code_sizes[0][lit]", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2061, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2062"><td class="num" id="LN2062">2062</td><td class="line">      TDEFL_PUT_BITS_FAST(d-&gt;m_huff_codes[0][lit], d-&gt;m_huff_code_sizes[0][lit]);</td></tr>
<tr class="codeline" data-linenumber="2063"><td class="num" id="LN2063">2063</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2064"><td class="num" id="LN2064">2064</td><td class="line">      <span class='keyword'>if</span> (((flags &amp; 2) == 0) &amp;&amp; (pLZ_codes &lt; pLZ_code_buf_end))</td></tr>
<tr class="codeline" data-linenumber="2065"><td class="num" id="LN2065">2065</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2066"><td class="num" id="LN2066">2066</td><td class="line">        flags &gt;&gt;= 1;</td></tr>
<tr class="codeline" data-linenumber="2067"><td class="num" id="LN2067">2067</td><td class="line">        lit = *pLZ_codes++;</td></tr>
<tr class="codeline" data-linenumber="2068"><td class="num" id="LN2068">2068</td><td class="line">        <span class='macro'>MZ_ASSERT(d-&gt;m_huff_code_sizes[0][lit])<span class='macro_popup'>((void) sizeof ((d-&gt;m_huff_code_sizes[0][lit]) ? 1 : 0), __extension__<br> ({ if (d-&gt;m_huff_code_sizes[0][lit]) ; else __assert_fail<br> ("d-&gt;m_huff_code_sizes[0][lit]", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2068, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2069"><td class="num" id="LN2069">2069</td><td class="line">        TDEFL_PUT_BITS_FAST(d-&gt;m_huff_codes[0][lit], d-&gt;m_huff_code_sizes[0][lit]);</td></tr>
<tr class="codeline" data-linenumber="2070"><td class="num" id="LN2070">2070</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2071"><td class="num" id="LN2071">2071</td><td class="line">        <span class='keyword'>if</span> (((flags &amp; 2) == 0) &amp;&amp; (pLZ_codes &lt; pLZ_code_buf_end))</td></tr>
<tr class="codeline" data-linenumber="2072"><td class="num" id="LN2072">2072</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2073"><td class="num" id="LN2073">2073</td><td class="line">          flags &gt;&gt;= 1;</td></tr>
<tr class="codeline" data-linenumber="2074"><td class="num" id="LN2074">2074</td><td class="line">          lit = *pLZ_codes++;</td></tr>
<tr class="codeline" data-linenumber="2075"><td class="num" id="LN2075">2075</td><td class="line">          <span class='macro'>MZ_ASSERT(d-&gt;m_huff_code_sizes[0][lit])<span class='macro_popup'>((void) sizeof ((d-&gt;m_huff_code_sizes[0][lit]) ? 1 : 0), __extension__<br> ({ if (d-&gt;m_huff_code_sizes[0][lit]) ; else __assert_fail<br> ("d-&gt;m_huff_code_sizes[0][lit]", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2075, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2076"><td class="num" id="LN2076">2076</td><td class="line">          TDEFL_PUT_BITS_FAST(d-&gt;m_huff_codes[0][lit], d-&gt;m_huff_code_sizes[0][lit]);</td></tr>
<tr class="codeline" data-linenumber="2077"><td class="num" id="LN2077">2077</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2078"><td class="num" id="LN2078">2078</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2079"><td class="num" id="LN2079">2079</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2080"><td class="num" id="LN2080">2080</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2081"><td class="num" id="LN2081">2081</td><td class="line">    <span class='keyword'>if</span> (pOutput_buf &gt;= d-&gt;m_pOutput_buf_end)</td></tr>
<tr class="codeline" data-linenumber="2082"><td class="num" id="LN2082">2082</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2083"><td class="num" id="LN2083">2083</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2084"><td class="num" id="LN2084">2084</td><td class="line">    *(mz_uint64*)pOutput_buf = bit_buffer;</td></tr>
<tr class="codeline" data-linenumber="2085"><td class="num" id="LN2085">2085</td><td class="line">    pOutput_buf += (bits_in &gt;&gt; 3);</td></tr>
<tr class="codeline" data-linenumber="2086"><td class="num" id="LN2086">2086</td><td class="line">    bit_buffer &gt;&gt;= (bits_in &amp; ~7);</td></tr>
<tr class="codeline" data-linenumber="2087"><td class="num" id="LN2087">2087</td><td class="line">    bits_in &amp;= 7;</td></tr>
<tr class="codeline" data-linenumber="2088"><td class="num" id="LN2088">2088</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2089"><td class="num" id="LN2089">2089</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2090"><td class="num" id="LN2090">2090</td><td class="line"><span class='directive'>#undef TDEFL_PUT_BITS_FAST</span></td></tr>
<tr class="codeline" data-linenumber="2091"><td class="num" id="LN2091">2091</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2092"><td class="num" id="LN2092">2092</td><td class="line">  d-&gt;m_pOutput_buf = pOutput_buf;</td></tr>
<tr class="codeline" data-linenumber="2093"><td class="num" id="LN2093">2093</td><td class="line">  d-&gt;m_bits_in = 0;</td></tr>
<tr class="codeline" data-linenumber="2094"><td class="num" id="LN2094">2094</td><td class="line">  d-&gt;m_bit_buffer = 0;</td></tr>
<tr class="codeline" data-linenumber="2095"><td class="num" id="LN2095">2095</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2096"><td class="num" id="LN2096">2096</td><td class="line">  <span class='keyword'>while</span> (bits_in)</td></tr>
<tr class="codeline" data-linenumber="2097"><td class="num" id="LN2097">2097</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2098"><td class="num" id="LN2098">2098</td><td class="line">    mz_uint32 n = <span class='macro'>MZ_MIN(bits_in, 16)<span class='macro_popup'>(((bits_in)&lt;(16))?(bits_in):(16))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2099"><td class="num" id="LN2099">2099</td><td class="line">    <span class='macro'>TDEFL_PUT_BITS((mz_uint)bit_buffer &amp; mz_bitmasks[n], n)<span class='macro_popup'>do { mz_uint bits = (mz_uint)bit_buffer &amp; mz_bitmasks[n];<br> mz_uint len = n; ((void) sizeof ((bits &lt;= ((1U &lt;&lt; len<br>) - 1U)) ? 1 : 0), __extension__ ({ if (bits &lt;= ((1U &lt;&lt;<br> len) - 1U)) ; else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2099, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2100"><td class="num" id="LN2100">2100</td><td class="line">    bit_buffer &gt;&gt;= n;</td></tr>
<tr class="codeline" data-linenumber="2101"><td class="num" id="LN2101">2101</td><td class="line">    bits_in -= n;</td></tr>
<tr class="codeline" data-linenumber="2102"><td class="num" id="LN2102">2102</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2103"><td class="num" id="LN2103">2103</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2104"><td class="num" id="LN2104">2104</td><td class="line">  <span class='macro'>TDEFL_PUT_BITS(d-&gt;m_huff_codes[0][256], d-&gt;m_huff_code_sizes[0][256])<span class='macro_popup'>do { mz_uint bits = d-&gt;m_huff_codes[0][256]; mz_uint len =<br> d-&gt;m_huff_code_sizes[0][256]; ((void) sizeof ((bits &lt;=<br> ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if (bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2104, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2105"><td class="num" id="LN2105">2105</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2106"><td class="num" id="LN2106">2106</td><td class="line">  <span class='keyword'>return</span> (d-&gt;m_pOutput_buf &lt; d-&gt;m_pOutput_buf_end);</td></tr>
<tr class="codeline" data-linenumber="2107"><td class="num" id="LN2107">2107</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2108"><td class="num" id="LN2108">2108</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2109"><td class="num" id="LN2109">2109</td><td class="line"><span class='keyword'>static</span> mz_bool tdefl_compress_lz_codes(tdefl_compressor *d)</td></tr>
<tr class="codeline" data-linenumber="2110"><td class="num" id="LN2110">2110</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2111"><td class="num" id="LN2111">2111</td><td class="line">  mz_uint flags;</td></tr>
<tr class="codeline" data-linenumber="2112"><td class="num" id="LN2112">2112</td><td class="line">  mz_uint8 *pLZ_codes;</td></tr>
<tr class="codeline" data-linenumber="2113"><td class="num" id="LN2113">2113</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2114"><td class="num" id="LN2114">2114</td><td class="line">  flags = 1;</td></tr>
<tr class="codeline" data-linenumber="2115"><td class="num" id="LN2115">2115</td><td class="line">  <span class='keyword'>for</span> (pLZ_codes = d-&gt;m_lz_code_buf; pLZ_codes &lt; d-&gt;m_pLZ_code_buf; flags &gt;&gt;= 1)</td></tr>
<tr class="codeline" data-linenumber="2116"><td class="num" id="LN2116">2116</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2117"><td class="num" id="LN2117">2117</td><td class="line">    <span class='keyword'>if</span> (flags == 1)</td></tr>
<tr class="codeline" data-linenumber="2118"><td class="num" id="LN2118">2118</td><td class="line">      flags = *pLZ_codes++ | 0x100;</td></tr>
<tr class="codeline" data-linenumber="2119"><td class="num" id="LN2119">2119</td><td class="line">    <span class='keyword'>if</span> (flags &amp; 1)</td></tr>
<tr class="codeline" data-linenumber="2120"><td class="num" id="LN2120">2120</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2121"><td class="num" id="LN2121">2121</td><td class="line">      mz_uint sym, num_extra_bits;</td></tr>
<tr class="codeline" data-linenumber="2122"><td class="num" id="LN2122">2122</td><td class="line">      mz_uint match_len = pLZ_codes[0], match_dist = (pLZ_codes[1] | (pLZ_codes[2] &lt;&lt; 8)); pLZ_codes += 3;</td></tr>
<tr class="codeline" data-linenumber="2123"><td class="num" id="LN2123">2123</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2124"><td class="num" id="LN2124">2124</td><td class="line">      <span class='macro'>MZ_ASSERT(d-&gt;m_huff_code_sizes[0][s_tdefl_len_sym[match_len]])<span class='macro_popup'>((void) sizeof ((d-&gt;m_huff_code_sizes[0][s_tdefl_len_sym[match_len<br>]]) ? 1 : 0), __extension__ ({ if (d-&gt;m_huff_code_sizes[0]<br>[s_tdefl_len_sym[match_len]]) ; else __assert_fail ("d-&gt;m_huff_code_sizes[0][s_tdefl_len_sym[match_len]]"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2124, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2125"><td class="num" id="LN2125">2125</td><td class="line">      <span class='macro'>TDEFL_PUT_BITS(d-&gt;m_huff_codes[0][s_tdefl_len_sym[match_len]], d-&gt;m_huff_code_sizes[0][s_tdefl_len_sym[match_len]])<span class='macro_popup'>do { mz_uint bits = d-&gt;m_huff_codes[0][s_tdefl_len_sym[match_len<br>]]; mz_uint len = d-&gt;m_huff_code_sizes[0][s_tdefl_len_sym[<br>match_len]]; ((void) sizeof ((bits &lt;= ((1U &lt;&lt; len) -<br> 1U)) ? 1 : 0), __extension__ ({ if (bits &lt;= ((1U &lt;&lt;<br> len) - 1U)) ; else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2125, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2126"><td class="num" id="LN2126">2126</td><td class="line">      <span class='macro'>TDEFL_PUT_BITS(match_len &amp; mz_bitmasks[s_tdefl_len_extra[match_len]], s_tdefl_len_extra[match_len])<span class='macro_popup'>do { mz_uint bits = match_len &amp; mz_bitmasks[s_tdefl_len_extra<br>[match_len]]; mz_uint len = s_tdefl_len_extra[match_len]; ((void<br>) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__<br> ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail<br> ("bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2126, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2127"><td class="num" id="LN2127">2127</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2128"><td class="num" id="LN2128">2128</td><td class="line">      <span class='keyword'>if</span> (match_dist &lt; 512)</td></tr>
<tr class="codeline" data-linenumber="2129"><td class="num" id="LN2129">2129</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2130"><td class="num" id="LN2130">2130</td><td class="line">        sym = s_tdefl_small_dist_sym[match_dist]; num_extra_bits = s_tdefl_small_dist_extra[match_dist];</td></tr>
<tr class="codeline" data-linenumber="2131"><td class="num" id="LN2131">2131</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2132"><td class="num" id="LN2132">2132</td><td class="line">      <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2133"><td class="num" id="LN2133">2133</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2134"><td class="num" id="LN2134">2134</td><td class="line">        sym = s_tdefl_large_dist_sym[match_dist &gt;&gt; 8]; num_extra_bits = s_tdefl_large_dist_extra[match_dist &gt;&gt; 8];</td></tr>
<tr class="codeline" data-linenumber="2135"><td class="num" id="LN2135">2135</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2136"><td class="num" id="LN2136">2136</td><td class="line">      <span class='macro'>MZ_ASSERT(d-&gt;m_huff_code_sizes[1][sym])<span class='macro_popup'>((void) sizeof ((d-&gt;m_huff_code_sizes[1][sym]) ? 1 : 0), __extension__<br> ({ if (d-&gt;m_huff_code_sizes[1][sym]) ; else __assert_fail<br> ("d-&gt;m_huff_code_sizes[1][sym]", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2136, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2137"><td class="num" id="LN2137">2137</td><td class="line">      <span class='macro'>TDEFL_PUT_BITS(d-&gt;m_huff_codes[1][sym], d-&gt;m_huff_code_sizes[1][sym])<span class='macro_popup'>do { mz_uint bits = d-&gt;m_huff_codes[1][sym]; mz_uint len =<br> d-&gt;m_huff_code_sizes[1][sym]; ((void) sizeof ((bits &lt;=<br> ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if (bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2137, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2138"><td class="num" id="LN2138">2138</td><td class="line">      <span class='macro'>TDEFL_PUT_BITS(match_dist &amp; mz_bitmasks[num_extra_bits], num_extra_bits)<span class='macro_popup'>do { mz_uint bits = match_dist &amp; mz_bitmasks[num_extra_bits<br>]; mz_uint len = num_extra_bits; ((void) sizeof ((bits &lt;= (<br>(1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if (bits &lt;=<br> ((1U &lt;&lt; len) - 1U)) ; else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2138, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2139"><td class="num" id="LN2139">2139</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2140"><td class="num" id="LN2140">2140</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2141"><td class="num" id="LN2141">2141</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2142"><td class="num" id="LN2142">2142</td><td class="line">      mz_uint lit = *pLZ_codes++;</td></tr>
<tr class="codeline" data-linenumber="2143"><td class="num" id="LN2143">2143</td><td class="line">      <span class='macro'>MZ_ASSERT(d-&gt;m_huff_code_sizes[0][lit])<span class='macro_popup'>((void) sizeof ((d-&gt;m_huff_code_sizes[0][lit]) ? 1 : 0), __extension__<br> ({ if (d-&gt;m_huff_code_sizes[0][lit]) ; else __assert_fail<br> ("d-&gt;m_huff_code_sizes[0][lit]", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2143, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2144"><td class="num" id="LN2144">2144</td><td class="line">      <span class='macro'>TDEFL_PUT_BITS(d-&gt;m_huff_codes[0][lit], d-&gt;m_huff_code_sizes[0][lit])<span class='macro_popup'>do { mz_uint bits = d-&gt;m_huff_codes[0][lit]; mz_uint len =<br> d-&gt;m_huff_code_sizes[0][lit]; ((void) sizeof ((bits &lt;=<br> ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if (bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2144, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2145"><td class="num" id="LN2145">2145</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2146"><td class="num" id="LN2146">2146</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2147"><td class="num" id="LN2147">2147</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2148"><td class="num" id="LN2148">2148</td><td class="line">  <span class='macro'>TDEFL_PUT_BITS(d-&gt;m_huff_codes[0][256], d-&gt;m_huff_code_sizes[0][256])<span class='macro_popup'>do { mz_uint bits = d-&gt;m_huff_codes[0][256]; mz_uint len =<br> d-&gt;m_huff_code_sizes[0][256]; ((void) sizeof ((bits &lt;=<br> ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if (bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2148, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2149"><td class="num" id="LN2149">2149</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2150"><td class="num" id="LN2150">2150</td><td class="line">  <span class='keyword'>return</span> (d-&gt;m_pOutput_buf &lt; d-&gt;m_pOutput_buf_end);</td></tr>
<tr class="codeline" data-linenumber="2151"><td class="num" id="LN2151">2151</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2152"><td class="num" id="LN2152">2152</td><td class="line"><span class='directive'>#endif // MINIZ_USE_UNALIGNED_LOADS_AND_STORES &amp;&amp; MINIZ_LITTLE_ENDIAN &amp;&amp; MINIZ_HAS_64BIT_REGISTERS</span></td></tr>
<tr class="codeline" data-linenumber="2153"><td class="num" id="LN2153">2153</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2154"><td class="num" id="LN2154">2154</td><td class="line"><span class='keyword'>static</span> mz_bool tdefl_compress_block(tdefl_compressor *d, mz_bool static_block)</td></tr>
<tr class="codeline" data-linenumber="2155"><td class="num" id="LN2155">2155</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2156"><td class="num" id="LN2156">2156</td><td class="line">  <span class='keyword'>if</span> (static_block)</td></tr>
<tr class="codeline" data-linenumber="2157"><td class="num" id="LN2157">2157</td><td class="line">    tdefl_start_static_block(d);</td></tr>
<tr class="codeline" data-linenumber="2158"><td class="num" id="LN2158">2158</td><td class="line">  <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2159"><td class="num" id="LN2159">2159</td><td class="line">    tdefl_start_dynamic_block(d);</td></tr>
<tr class="codeline" data-linenumber="2160"><td class="num" id="LN2160">2160</td><td class="line">  <span class='keyword'>return</span> tdefl_compress_lz_codes(d);</td></tr>
<tr class="codeline" data-linenumber="2161"><td class="num" id="LN2161">2161</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2162"><td class="num" id="LN2162">2162</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2163"><td class="num" id="LN2163">2163</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> tdefl_flush_block(tdefl_compressor *d, <span class='keyword'>int</span> flush)</td></tr>
<tr class="codeline" data-linenumber="2164"><td class="num" id="LN2164">2164</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2165"><td class="num" id="LN2165">2165</td><td class="line">  mz_uint saved_bit_buf, saved_bits_in;</td></tr>
<tr class="codeline" data-linenumber="2166"><td class="num" id="LN2166">2166</td><td class="line">  mz_uint8 *pSaved_output_buf;</td></tr>
<tr class="codeline" data-linenumber="2167"><td class="num" id="LN2167">2167</td><td class="line">  mz_bool comp_block_succeeded = <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2168"><td class="num" id="LN2168">2168</td><td class="line">  <span class='keyword'>int</span> n, use_raw_block = ((d-&gt;m_flags &amp; TDEFL_FORCE_ALL_RAW_BLOCKS) != 0) &amp;&amp; (d-&gt;m_lookahead_pos - d-&gt;m_lz_code_buf_dict_pos) &lt;= d-&gt;m_dict_size;</td></tr>
<tr class="codeline" data-linenumber="2169"><td class="num" id="LN2169">2169</td><td class="line">  mz_uint8 *pOutput_buf_start = ((d-&gt;m_pPut_buf_func == <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) &amp;&amp; ((*d-&gt;m_pOut_buf_size - d-&gt;m_out_buf_ofs) &gt;= TDEFL_OUT_BUF_SIZE)) ? ((mz_uint8 *)d-&gt;m_pOut_buf + d-&gt;m_out_buf_ofs) : d-&gt;m_output_buf;</td></tr>
<tr class="codeline" data-linenumber="2170"><td class="num" id="LN2170">2170</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2171"><td class="num" id="LN2171">2171</td><td class="line">  d-&gt;m_pOutput_buf = pOutput_buf_start;</td></tr>
<tr class="codeline" data-linenumber="2172"><td class="num" id="LN2172">2172</td><td class="line">  d-&gt;m_pOutput_buf_end = d-&gt;m_pOutput_buf + TDEFL_OUT_BUF_SIZE - 16;</td></tr>
<tr class="codeline" data-linenumber="2173"><td class="num" id="LN2173">2173</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2174"><td class="num" id="LN2174">2174</td><td class="line">  <span class='macro'>MZ_ASSERT(!d-&gt;m_output_flush_remaining)<span class='macro_popup'>((void) sizeof ((!d-&gt;m_output_flush_remaining) ? 1 : 0), __extension__<br> ({ if (!d-&gt;m_output_flush_remaining) ; else __assert_fail<br> ("!d-&gt;m_output_flush_remaining", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2174, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2175"><td class="num" id="LN2175">2175</td><td class="line">  d-&gt;m_output_flush_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="2176"><td class="num" id="LN2176">2176</td><td class="line">  d-&gt;m_output_flush_remaining = 0;</td></tr>
<tr class="codeline" data-linenumber="2177"><td class="num" id="LN2177">2177</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2178"><td class="num" id="LN2178">2178</td><td class="line">  *d-&gt;m_pLZ_flags = (mz_uint8)(*d-&gt;m_pLZ_flags &gt;&gt; d-&gt;m_num_flags_left);</td></tr>
<tr class="codeline" data-linenumber="2179"><td class="num" id="LN2179">2179</td><td class="line">  d-&gt;m_pLZ_code_buf -= (d-&gt;m_num_flags_left == 8);</td></tr>
<tr class="codeline" data-linenumber="2180"><td class="num" id="LN2180">2180</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2181"><td class="num" id="LN2181">2181</td><td class="line">  <span class='keyword'>if</span> ((d-&gt;m_flags &amp; TDEFL_WRITE_ZLIB_HEADER) &amp;&amp; (!d-&gt;m_block_index))</td></tr>
<tr class="codeline" data-linenumber="2182"><td class="num" id="LN2182">2182</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2183"><td class="num" id="LN2183">2183</td><td class="line">    <span class='macro'>TDEFL_PUT_BITS(0x78, 8)<span class='macro_popup'>do { mz_uint bits = 0x78; mz_uint len = 8; ((void) sizeof ((bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if<br> (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail (<br>"bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2183, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>; <span class='macro'>TDEFL_PUT_BITS(0x01, 8)<span class='macro_popup'>do { mz_uint bits = 0x01; mz_uint len = 8; ((void) sizeof ((bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if<br> (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail (<br>"bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2183, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2184"><td class="num" id="LN2184">2184</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2185"><td class="num" id="LN2185">2185</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2186"><td class="num" id="LN2186">2186</td><td class="line">  <span class='macro'>TDEFL_PUT_BITS(flush == TDEFL_FINISH, 1)<span class='macro_popup'>do { mz_uint bits = flush == TDEFL_FINISH; mz_uint len = 1; (<br>(void) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0)<br>, __extension__ ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U)) ;<br> else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2186, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2187"><td class="num" id="LN2187">2187</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2188"><td class="num" id="LN2188">2188</td><td class="line">  pSaved_output_buf = d-&gt;m_pOutput_buf; saved_bit_buf = d-&gt;m_bit_buffer; saved_bits_in = d-&gt;m_bits_in;</td></tr>
<tr class="codeline" data-linenumber="2189"><td class="num" id="LN2189">2189</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2190"><td class="num" id="LN2190">2190</td><td class="line">  <span class='keyword'>if</span> (!use_raw_block)</td></tr>
<tr class="codeline" data-linenumber="2191"><td class="num" id="LN2191">2191</td><td class="line">    comp_block_succeeded = tdefl_compress_block(d, (d-&gt;m_flags &amp; TDEFL_FORCE_ALL_STATIC_BLOCKS) || (d-&gt;m_total_lz_bytes &lt; 48));</td></tr>
<tr class="codeline" data-linenumber="2192"><td class="num" id="LN2192">2192</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2193"><td class="num" id="LN2193">2193</td><td class="line">  <span class='comment'>// If the block gets expanded, forget the current contents of the output buffer and send a raw block instead.</span></td></tr>
<tr class="codeline" data-linenumber="2194"><td class="num" id="LN2194">2194</td><td class="line">  <span class='keyword'>if</span> ( ((use_raw_block) || ((d-&gt;m_total_lz_bytes) &amp;&amp; ((d-&gt;m_pOutput_buf - pSaved_output_buf + 1U) &gt;= d-&gt;m_total_lz_bytes))) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2195"><td class="num" id="LN2195">2195</td><td class="line">       ((d-&gt;m_lookahead_pos - d-&gt;m_lz_code_buf_dict_pos) &lt;= d-&gt;m_dict_size) )</td></tr>
<tr class="codeline" data-linenumber="2196"><td class="num" id="LN2196">2196</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2197"><td class="num" id="LN2197">2197</td><td class="line">    mz_uint i; d-&gt;m_pOutput_buf = pSaved_output_buf; d-&gt;m_bit_buffer = saved_bit_buf, d-&gt;m_bits_in = saved_bits_in;</td></tr>
<tr class="codeline" data-linenumber="2198"><td class="num" id="LN2198">2198</td><td class="line">    <span class='macro'>TDEFL_PUT_BITS(0, 2)<span class='macro_popup'>do { mz_uint bits = 0; mz_uint len = 2; ((void) sizeof ((bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if<br> (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail (<br>"bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2198, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2199"><td class="num" id="LN2199">2199</td><td class="line">    <span class='keyword'>if</span> (d-&gt;m_bits_in) { <span class='macro'>TDEFL_PUT_BITS(0, 8 - d-&gt;m_bits_in)<span class='macro_popup'>do { mz_uint bits = 0; mz_uint len = 8 - d-&gt;m_bits_in; ((void<br>) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__<br> ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail<br> ("bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2199, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="2200"><td class="num" id="LN2200">2200</td><td class="line">    <span class='keyword'>for</span> (i = 2; i; --i, d-&gt;m_total_lz_bytes ^= 0xFFFF)</td></tr>
<tr class="codeline" data-linenumber="2201"><td class="num" id="LN2201">2201</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2202"><td class="num" id="LN2202">2202</td><td class="line">      <span class='macro'>TDEFL_PUT_BITS(d-&gt;m_total_lz_bytes &amp; 0xFFFF, 16)<span class='macro_popup'>do { mz_uint bits = d-&gt;m_total_lz_bytes &amp; 0xFFFF; mz_uint<br> len = 16; ((void) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U<br>)) ? 1 : 0), __extension__ ({ if (bits &lt;= ((1U &lt;&lt; len<br>) - 1U)) ; else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2202, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2203"><td class="num" id="LN2203">2203</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2204"><td class="num" id="LN2204">2204</td><td class="line">    <span class='keyword'>for</span> (i = 0; i &lt; d-&gt;m_total_lz_bytes; ++i)</td></tr>
<tr class="codeline" data-linenumber="2205"><td class="num" id="LN2205">2205</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2206"><td class="num" id="LN2206">2206</td><td class="line">      <span class='macro'>TDEFL_PUT_BITS(d-&gt;m_dict[(d-&gt;m_lz_code_buf_dict_pos + i) &amp; TDEFL_LZ_DICT_SIZE_MASK], 8)<span class='macro_popup'>do { mz_uint bits = d-&gt;m_dict[(d-&gt;m_lz_code_buf_dict_pos<br> + i) &amp; TDEFL_LZ_DICT_SIZE_MASK]; mz_uint len = 8; ((void<br>) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__<br> ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail<br> ("bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2206, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2207"><td class="num" id="LN2207">2207</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2208"><td class="num" id="LN2208">2208</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2209"><td class="num" id="LN2209">2209</td><td class="line">  <span class='comment'>// Check for the extremely unlikely (if not impossible) case of the compressed block not fitting into the output buffer when using dynamic codes.</span></td></tr>
<tr class="codeline" data-linenumber="2210"><td class="num" id="LN2210">2210</td><td class="line">  <span class='keyword'>else</span> <span class='keyword'>if</span> (!comp_block_succeeded)</td></tr>
<tr class="codeline" data-linenumber="2211"><td class="num" id="LN2211">2211</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2212"><td class="num" id="LN2212">2212</td><td class="line">    d-&gt;m_pOutput_buf = pSaved_output_buf; d-&gt;m_bit_buffer = saved_bit_buf, d-&gt;m_bits_in = saved_bits_in;</td></tr>
<tr class="codeline" data-linenumber="2213"><td class="num" id="LN2213">2213</td><td class="line">    tdefl_compress_block(d, <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2214"><td class="num" id="LN2214">2214</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2215"><td class="num" id="LN2215">2215</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2216"><td class="num" id="LN2216">2216</td><td class="line">  <span class='keyword'>if</span> (flush)</td></tr>
<tr class="codeline" data-linenumber="2217"><td class="num" id="LN2217">2217</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2218"><td class="num" id="LN2218">2218</td><td class="line">    <span class='keyword'>if</span> (flush == TDEFL_FINISH)</td></tr>
<tr class="codeline" data-linenumber="2219"><td class="num" id="LN2219">2219</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2220"><td class="num" id="LN2220">2220</td><td class="line">      <span class='keyword'>if</span> (d-&gt;m_bits_in) { <span class='macro'>TDEFL_PUT_BITS(0, 8 - d-&gt;m_bits_in)<span class='macro_popup'>do { mz_uint bits = 0; mz_uint len = 8 - d-&gt;m_bits_in; ((void<br>) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__<br> ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail<br> ("bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2220, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="2221"><td class="num" id="LN2221">2221</td><td class="line">      <span class='keyword'>if</span> (d-&gt;m_flags &amp; TDEFL_WRITE_ZLIB_HEADER) { mz_uint i, a = d-&gt;m_adler32; <span class='keyword'>for</span> (i = 0; i &lt; 4; i++) { <span class='macro'>TDEFL_PUT_BITS((a &gt;&gt; 24) &amp; 0xFF, 8)<span class='macro_popup'>do { mz_uint bits = (a &gt;&gt; 24) &amp; 0xFF; mz_uint len =<br> 8; ((void) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1<br> : 0), __extension__ ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U<br>)) ; else __assert_fail ("bits &lt;= ((1U &lt;&lt; len) - 1U)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2221, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>; a &lt;&lt;= 8; } }</td></tr>
<tr class="codeline" data-linenumber="2222"><td class="num" id="LN2222">2222</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2223"><td class="num" id="LN2223">2223</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2224"><td class="num" id="LN2224">2224</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2225"><td class="num" id="LN2225">2225</td><td class="line">      mz_uint i, z = 0; <span class='macro'>TDEFL_PUT_BITS(0, 3)<span class='macro_popup'>do { mz_uint bits = 0; mz_uint len = 3; ((void) sizeof ((bits<br> &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__ ({ if<br> (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail (<br>"bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2225, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>; <span class='keyword'>if</span> (d-&gt;m_bits_in) { <span class='macro'>TDEFL_PUT_BITS(0, 8 - d-&gt;m_bits_in)<span class='macro_popup'>do { mz_uint bits = 0; mz_uint len = 8 - d-&gt;m_bits_in; ((void<br>) sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__<br> ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail<br> ("bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2225, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>; } <span class='keyword'>for</span> (i = 2; i; --i, z ^= 0xFFFF) { <span class='macro'>TDEFL_PUT_BITS(z &amp; 0xFFFF, 16)<span class='macro_popup'>do { mz_uint bits = z &amp; 0xFFFF; mz_uint len = 16; ((void)<br> sizeof ((bits &lt;= ((1U &lt;&lt; len) - 1U)) ? 1 : 0), __extension__<br> ({ if (bits &lt;= ((1U &lt;&lt; len) - 1U)) ; else __assert_fail<br> ("bits &lt;= ((1U &lt;&lt; len) - 1U)", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2225, __extension__ __PRETTY_FUNCTION__); })); d-&gt;m_bit_buffer<br> |= (bits &lt;&lt; d-&gt;m_bits_in); d-&gt;m_bits_in += len; while<br> (d-&gt;m_bits_in &gt;= 8) { if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) *d-&gt;m_pOutput_buf++ = (mz_uint8)(d-&gt;<br>m_bit_buffer); d-&gt;m_bit_buffer &gt;&gt;= 8; d-&gt;m_bits_in<br> -= 8; } } while (0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="2226"><td class="num" id="LN2226">2226</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2227"><td class="num" id="LN2227">2227</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2228"><td class="num" id="LN2228">2228</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2229"><td class="num" id="LN2229">2229</td><td class="line">  <span class='macro'>MZ_ASSERT(d-&gt;m_pOutput_buf &lt; d-&gt;m_pOutput_buf_end)<span class='macro_popup'>((void) sizeof ((d-&gt;m_pOutput_buf &lt; d-&gt;m_pOutput_buf_end<br>) ? 1 : 0), __extension__ ({ if (d-&gt;m_pOutput_buf &lt; d-&gt;<br>m_pOutput_buf_end) ; else __assert_fail ("d-&gt;m_pOutput_buf &lt; d-&gt;m_pOutput_buf_end"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2229, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2230"><td class="num" id="LN2230">2230</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2231"><td class="num" id="LN2231">2231</td><td class="line">  memset(&amp;d-&gt;m_huff_count[0][0], 0, <span class='keyword'>sizeof</span>(d-&gt;m_huff_count[0][0]) * TDEFL_MAX_HUFF_SYMBOLS_0);</td></tr>
<tr class="codeline" data-linenumber="2232"><td class="num" id="LN2232">2232</td><td class="line">  memset(&amp;d-&gt;m_huff_count[1][0], 0, <span class='keyword'>sizeof</span>(d-&gt;m_huff_count[1][0]) * TDEFL_MAX_HUFF_SYMBOLS_1);</td></tr>
<tr class="codeline" data-linenumber="2233"><td class="num" id="LN2233">2233</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2234"><td class="num" id="LN2234">2234</td><td class="line">  d-&gt;m_pLZ_code_buf = d-&gt;m_lz_code_buf + 1; d-&gt;m_pLZ_flags = d-&gt;m_lz_code_buf; d-&gt;m_num_flags_left = 8; d-&gt;m_lz_code_buf_dict_pos += d-&gt;m_total_lz_bytes; d-&gt;m_total_lz_bytes = 0; d-&gt;m_block_index++;</td></tr>
<tr class="codeline" data-linenumber="2235"><td class="num" id="LN2235">2235</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2236"><td class="num" id="LN2236">2236</td><td class="line">  <span class='keyword'>if</span> ((n = (<span class='keyword'>int</span>)(d-&gt;m_pOutput_buf - pOutput_buf_start)) != 0)</td></tr>
<tr class="codeline" data-linenumber="2237"><td class="num" id="LN2237">2237</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2238"><td class="num" id="LN2238">2238</td><td class="line">    <span class='keyword'>if</span> (d-&gt;m_pPut_buf_func)</td></tr>
<tr class="codeline" data-linenumber="2239"><td class="num" id="LN2239">2239</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2240"><td class="num" id="LN2240">2240</td><td class="line">      *d-&gt;m_pIn_buf_size = d-&gt;m_pSrc - (<span class='keyword'>const</span> mz_uint8 *)d-&gt;m_pIn_buf;</td></tr>
<tr class="codeline" data-linenumber="2241"><td class="num" id="LN2241">2241</td><td class="line">      <span class='keyword'>if</span> (!(*d-&gt;m_pPut_buf_func)(d-&gt;m_output_buf, n, d-&gt;m_pPut_buf_user))</td></tr>
<tr class="codeline" data-linenumber="2242"><td class="num" id="LN2242">2242</td><td class="line">        <span class='keyword'>return</span> (d-&gt;m_prev_return_status = TDEFL_STATUS_PUT_BUF_FAILED);</td></tr>
<tr class="codeline" data-linenumber="2243"><td class="num" id="LN2243">2243</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2244"><td class="num" id="LN2244">2244</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (pOutput_buf_start == d-&gt;m_output_buf)</td></tr>
<tr class="codeline" data-linenumber="2245"><td class="num" id="LN2245">2245</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2246"><td class="num" id="LN2246">2246</td><td class="line">      <span class='keyword'>int</span> bytes_to_copy = (<span class='keyword'>int</span>)<span class='macro'>MZ_MIN((size_t)n, (size_t)(*d-&gt;m_pOut_buf_size - d-&gt;m_out_buf_ofs))<span class='macro_popup'>((((size_t)n)&lt;((size_t)(*d-&gt;m_pOut_buf_size - d-&gt;m_out_buf_ofs<br>)))?((size_t)n):((size_t)(*d-&gt;m_pOut_buf_size - d-&gt;m_out_buf_ofs<br>)))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2247"><td class="num" id="LN2247">2247</td><td class="line">      memcpy((mz_uint8 *)d-&gt;m_pOut_buf + d-&gt;m_out_buf_ofs, d-&gt;m_output_buf, bytes_to_copy);</td></tr>
<tr class="codeline" data-linenumber="2248"><td class="num" id="LN2248">2248</td><td class="line">      d-&gt;m_out_buf_ofs += bytes_to_copy;</td></tr>
<tr class="codeline" data-linenumber="2249"><td class="num" id="LN2249">2249</td><td class="line">      <span class='keyword'>if</span> ((n -= bytes_to_copy) != 0)</td></tr>
<tr class="codeline" data-linenumber="2250"><td class="num" id="LN2250">2250</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2251"><td class="num" id="LN2251">2251</td><td class="line">        d-&gt;m_output_flush_ofs = bytes_to_copy;</td></tr>
<tr class="codeline" data-linenumber="2252"><td class="num" id="LN2252">2252</td><td class="line">        d-&gt;m_output_flush_remaining = n;</td></tr>
<tr class="codeline" data-linenumber="2253"><td class="num" id="LN2253">2253</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2254"><td class="num" id="LN2254">2254</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2255"><td class="num" id="LN2255">2255</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2256"><td class="num" id="LN2256">2256</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2257"><td class="num" id="LN2257">2257</td><td class="line">      d-&gt;m_out_buf_ofs += n;</td></tr>
<tr class="codeline" data-linenumber="2258"><td class="num" id="LN2258">2258</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2259"><td class="num" id="LN2259">2259</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2260"><td class="num" id="LN2260">2260</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2261"><td class="num" id="LN2261">2261</td><td class="line">  <span class='keyword'>return</span> d-&gt;m_output_flush_remaining;</td></tr>
<tr class="codeline" data-linenumber="2262"><td class="num" id="LN2262">2262</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2263"><td class="num" id="LN2263">2263</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2264"><td class="num" id="LN2264">2264</td><td class="line"><span class='directive'>#if <span class='macro'>MINIZ_USE_UNALIGNED_LOADS_AND_STORES<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2265"><td class="num" id="LN2265">2265</td><td class="line"><span class='directive'>#define <span class='macro'>TDEFL_READ_UNALIGNED_WORD(p)<span class='macro_popup'>*(const mz_uint16*)(p)</span></span> *(const mz_uint16*)(p)</span></td></tr>
<tr class="codeline" data-linenumber="2266"><td class="num" id="LN2266">2266</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> <span class='keyword'>void</span> tdefl_find_match(tdefl_compressor *d, mz_uint lookahead_pos, mz_uint max_dist, mz_uint max_match_len, mz_uint *pMatch_dist, mz_uint *pMatch_len)</td></tr>
<tr class="codeline" data-linenumber="2267"><td class="num" id="LN2267">2267</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2268"><td class="num" id="LN2268">2268</td><td class="line">  mz_uint dist, pos = lookahead_pos &amp; TDEFL_LZ_DICT_SIZE_MASK, match_len = *pMatch_len, probe_pos = pos, next_probe_pos, probe_len;</td></tr>
<tr class="codeline" data-linenumber="2269"><td class="num" id="LN2269">2269</td><td class="line">  mz_uint num_probes_left = d-&gt;m_max_probes[match_len &gt;= 32];</td></tr>
<tr class="codeline" data-linenumber="2270"><td class="num" id="LN2270">2270</td><td class="line">  <span class='keyword'>const</span> mz_uint16 *s = (<span class='keyword'>const</span> mz_uint16*)(d-&gt;m_dict + pos), *p, *q;</td></tr>
<tr class="codeline" data-linenumber="2271"><td class="num" id="LN2271">2271</td><td class="line">  mz_uint16 c01 = <span class='macro'>TDEFL_READ_UNALIGNED_WORD(&amp;d-&gt;m_dict[pos + match_len - 1])<span class='macro_popup'>*(const mz_uint16*)(&amp;d-&gt;m_dict[pos + match_len - 1])</span></span>, s01 = <span class='macro'>TDEFL_READ_UNALIGNED_WORD(s)<span class='macro_popup'>*(const mz_uint16*)(s)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2272"><td class="num" id="LN2272">2272</td><td class="line">  <span class='macro'>MZ_ASSERT(max_match_len &lt;= TDEFL_MAX_MATCH_LEN)<span class='macro_popup'>((void) sizeof ((max_match_len &lt;= TDEFL_MAX_MATCH_LEN) ? 1<br> : 0), __extension__ ({ if (max_match_len &lt;= TDEFL_MAX_MATCH_LEN<br>) ; else __assert_fail ("max_match_len &lt;= TDEFL_MAX_MATCH_LEN"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2272, __extension__ __PRETTY_FUNCTION__); }))</span></span>; <span class='keyword'>if</span> (max_match_len &lt;= match_len) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2273"><td class="num" id="LN2273">2273</td><td class="line">  <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="2274"><td class="num" id="LN2274">2274</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2275"><td class="num" id="LN2275">2275</td><td class="line">    <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="2276"><td class="num" id="LN2276">2276</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2277"><td class="num" id="LN2277">2277</td><td class="line">      <span class='keyword'>if</span> (--num_probes_left == 0) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2278"><td class="num" id="LN2278">2278</td><td class="line">      <span class='directive'>#define <span class='macro'>TDEFL_PROBE<span class='macro_popup'>next_probe_pos = d-&gt;m_next[probe_pos]; if ((!next_probe_pos<br>) || ((dist = (mz_uint16)(lookahead_pos - next_probe_pos)) &gt;<br> max_dist)) return; probe_pos = next_probe_pos &amp; TDEFL_LZ_DICT_SIZE_MASK<br>; if (*(const mz_uint16*)(&amp;d-&gt;m_dict[probe_pos + match_len<br> - 1]) == c01) break;</span></span> \</span></td></tr>
<tr class="codeline" data-linenumber="2279"><td class="num" id="LN2279">2279</td><td class="line">        <span class='directive'>next_probe_pos = d-&gt;m_next[probe_pos]; \</span></td></tr>
<tr class="codeline" data-linenumber="2280"><td class="num" id="LN2280">2280</td><td class="line">        <span class='directive'>if ((!next_probe_pos) || ((dist = (mz_uint16)(lookahead_pos - next_probe_pos)) &gt; max_dist)) return; \</span></td></tr>
<tr class="codeline" data-linenumber="2281"><td class="num" id="LN2281">2281</td><td class="line">        <span class='directive'>probe_pos = next_probe_pos &amp; TDEFL_LZ_DICT_SIZE_MASK; \</span></td></tr>
<tr class="codeline" data-linenumber="2282"><td class="num" id="LN2282">2282</td><td class="line">        <span class='directive'>if (<span class='macro'>TDEFL_READ_UNALIGNED_WORD(&amp;d-&gt;m_dict[probe_pos + match_len - 1])<span class='macro_popup'>*(const mz_uint16*)(&amp;d-&gt;m_dict[probe_pos + match_len -<br> 1])</span></span> == c01) break;</span></td></tr>
<tr class="codeline" data-linenumber="2283"><td class="num" id="LN2283">2283</td><td class="line">      <span class='macro'>TDEFL_PROBE<span class='macro_popup'>next_probe_pos = d-&gt;m_next[probe_pos]; if ((!next_probe_pos<br>) || ((dist = (mz_uint16)(lookahead_pos - next_probe_pos)) &gt;<br> max_dist)) return; probe_pos = next_probe_pos &amp; TDEFL_LZ_DICT_SIZE_MASK<br>; if (*(const mz_uint16*)(&amp;d-&gt;m_dict[probe_pos + match_len<br> - 1]) == c01) break;</span></span>; <span class='macro'>TDEFL_PROBE<span class='macro_popup'>next_probe_pos = d-&gt;m_next[probe_pos]; if ((!next_probe_pos<br>) || ((dist = (mz_uint16)(lookahead_pos - next_probe_pos)) &gt;<br> max_dist)) return; probe_pos = next_probe_pos &amp; TDEFL_LZ_DICT_SIZE_MASK<br>; if (*(const mz_uint16*)(&amp;d-&gt;m_dict[probe_pos + match_len<br> - 1]) == c01) break;</span></span>; <span class='macro'>TDEFL_PROBE<span class='macro_popup'>next_probe_pos = d-&gt;m_next[probe_pos]; if ((!next_probe_pos<br>) || ((dist = (mz_uint16)(lookahead_pos - next_probe_pos)) &gt;<br> max_dist)) return; probe_pos = next_probe_pos &amp; TDEFL_LZ_DICT_SIZE_MASK<br>; if (*(const mz_uint16*)(&amp;d-&gt;m_dict[probe_pos + match_len<br> - 1]) == c01) break;</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2284"><td class="num" id="LN2284">2284</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2285"><td class="num" id="LN2285">2285</td><td class="line">    <span class='keyword'>if</span> (!dist) <span class='keyword'>break</span>; q = (<span class='keyword'>const</span> mz_uint16*)(d-&gt;m_dict + probe_pos); <span class='keyword'>if</span> (<span class='macro'>TDEFL_READ_UNALIGNED_WORD(q)<span class='macro_popup'>*(const mz_uint16*)(q)</span></span> != s01) <span class='keyword'>continue</span>; p = s; probe_len = 32;</td></tr>
<tr class="codeline" data-linenumber="2286"><td class="num" id="LN2286">2286</td><td class="line">    <span class='keyword'>do</span> { } <span class='keyword'>while</span> ( (<span class='macro'>TDEFL_READ_UNALIGNED_WORD(++p)<span class='macro_popup'>*(const mz_uint16*)(++p)</span></span> == <span class='macro'>TDEFL_READ_UNALIGNED_WORD(++q)<span class='macro_popup'>*(const mz_uint16*)(++q)</span></span>) &amp;&amp; (<span class='macro'>TDEFL_READ_UNALIGNED_WORD(++p)<span class='macro_popup'>*(const mz_uint16*)(++p)</span></span> == <span class='macro'>TDEFL_READ_UNALIGNED_WORD(++q)<span class='macro_popup'>*(const mz_uint16*)(++q)</span></span>) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2287"><td class="num" id="LN2287">2287</td><td class="line">                   (<span class='macro'>TDEFL_READ_UNALIGNED_WORD(++p)<span class='macro_popup'>*(const mz_uint16*)(++p)</span></span> == <span class='macro'>TDEFL_READ_UNALIGNED_WORD(++q)<span class='macro_popup'>*(const mz_uint16*)(++q)</span></span>) &amp;&amp; (<span class='macro'>TDEFL_READ_UNALIGNED_WORD(++p)<span class='macro_popup'>*(const mz_uint16*)(++p)</span></span> == <span class='macro'>TDEFL_READ_UNALIGNED_WORD(++q)<span class='macro_popup'>*(const mz_uint16*)(++q)</span></span>) &amp;&amp; (--probe_len &gt; 0) );</td></tr>
<tr class="codeline" data-linenumber="2288"><td class="num" id="LN2288">2288</td><td class="line">    <span class='keyword'>if</span> (!probe_len)</td></tr>
<tr class="codeline" data-linenumber="2289"><td class="num" id="LN2289">2289</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2290"><td class="num" id="LN2290">2290</td><td class="line">      *pMatch_dist = dist; *pMatch_len = <span class='macro'>MZ_MIN(max_match_len, TDEFL_MAX_MATCH_LEN)<span class='macro_popup'>(((max_match_len)&lt;(TDEFL_MAX_MATCH_LEN))?(max_match_len):(<br>TDEFL_MAX_MATCH_LEN))</span></span>; <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2291"><td class="num" id="LN2291">2291</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2292"><td class="num" id="LN2292">2292</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> ((probe_len = ((mz_uint)(p - s) * 2) + (mz_uint)(*(<span class='keyword'>const</span> mz_uint8*)p == *(<span class='keyword'>const</span> mz_uint8*)q)) &gt; match_len)</td></tr>
<tr class="codeline" data-linenumber="2293"><td class="num" id="LN2293">2293</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2294"><td class="num" id="LN2294">2294</td><td class="line">      *pMatch_dist = dist; <span class='keyword'>if</span> ((*pMatch_len = match_len = <span class='macro'>MZ_MIN(max_match_len, probe_len)<span class='macro_popup'>(((max_match_len)&lt;(probe_len))?(max_match_len):(probe_len)<br>)</span></span>) == max_match_len) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2295"><td class="num" id="LN2295">2295</td><td class="line">      c01 = <span class='macro'>TDEFL_READ_UNALIGNED_WORD(&amp;d-&gt;m_dict[pos + match_len - 1])<span class='macro_popup'>*(const mz_uint16*)(&amp;d-&gt;m_dict[pos + match_len - 1])</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2296"><td class="num" id="LN2296">2296</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2297"><td class="num" id="LN2297">2297</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2298"><td class="num" id="LN2298">2298</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2299"><td class="num" id="LN2299">2299</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2300"><td class="num" id="LN2300">2300</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> <span class='keyword'>void</span> tdefl_find_match(tdefl_compressor *d, mz_uint lookahead_pos, mz_uint max_dist, mz_uint max_match_len, mz_uint *pMatch_dist, mz_uint *pMatch_len)</td></tr>
<tr class="codeline" data-linenumber="2301"><td class="num" id="LN2301">2301</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2302"><td class="num" id="LN2302">2302</td><td class="line">  mz_uint dist, pos = lookahead_pos &amp; TDEFL_LZ_DICT_SIZE_MASK, match_len = *pMatch_len, probe_pos = pos, next_probe_pos, probe_len;</td></tr>
<tr class="codeline" data-linenumber="2303"><td class="num" id="LN2303">2303</td><td class="line">  mz_uint num_probes_left = d-&gt;m_max_probes[match_len &gt;= 32];</td></tr>
<tr class="codeline" data-linenumber="2304"><td class="num" id="LN2304">2304</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *s = d-&gt;m_dict + pos, *p, *q;</td></tr>
<tr class="codeline" data-linenumber="2305"><td class="num" id="LN2305">2305</td><td class="line">  mz_uint8 c0 = d-&gt;m_dict[pos + match_len], c1 = d-&gt;m_dict[pos + match_len - 1];</td></tr>
<tr class="codeline" data-linenumber="2306"><td class="num" id="LN2306">2306</td><td class="line">  <span class='macro'>MZ_ASSERT(max_match_len &lt;= TDEFL_MAX_MATCH_LEN)<span class='macro_popup'>((void) sizeof ((max_match_len &lt;= TDEFL_MAX_MATCH_LEN) ? 1<br> : 0), __extension__ ({ if (max_match_len &lt;= TDEFL_MAX_MATCH_LEN<br>) ; else __assert_fail ("max_match_len &lt;= TDEFL_MAX_MATCH_LEN"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2306, __extension__ __PRETTY_FUNCTION__); }))</span></span>; <span class='keyword'>if</span> (max_match_len &lt;= match_len) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2307"><td class="num" id="LN2307">2307</td><td class="line">  <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="2308"><td class="num" id="LN2308">2308</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2309"><td class="num" id="LN2309">2309</td><td class="line">    <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="2310"><td class="num" id="LN2310">2310</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2311"><td class="num" id="LN2311">2311</td><td class="line">      <span class='keyword'>if</span> (--num_probes_left == 0) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2312"><td class="num" id="LN2312">2312</td><td class="line">      <span class='directive'>#define <span class='macro'>TDEFL_PROBE<span class='macro_popup'>next_probe_pos = d-&gt;m_next[probe_pos]; if ((!next_probe_pos<br>) || ((dist = (mz_uint16)(lookahead_pos - next_probe_pos)) &gt;<br> max_dist)) return; probe_pos = next_probe_pos &amp; TDEFL_LZ_DICT_SIZE_MASK<br>; if (*(const mz_uint16*)(&amp;d-&gt;m_dict[probe_pos + match_len<br> - 1]) == c01) break;</span></span> \</span></td></tr>
<tr class="codeline" data-linenumber="2313"><td class="num" id="LN2313">2313</td><td class="line">        <span class='directive'>next_probe_pos = d-&gt;m_next[probe_pos]; \</span></td></tr>
<tr class="codeline" data-linenumber="2314"><td class="num" id="LN2314">2314</td><td class="line">        <span class='directive'>if ((!next_probe_pos) || ((dist = (mz_uint16)(lookahead_pos - next_probe_pos)) &gt; max_dist)) return; \</span></td></tr>
<tr class="codeline" data-linenumber="2315"><td class="num" id="LN2315">2315</td><td class="line">        <span class='directive'>probe_pos = next_probe_pos &amp; TDEFL_LZ_DICT_SIZE_MASK; \</span></td></tr>
<tr class="codeline" data-linenumber="2316"><td class="num" id="LN2316">2316</td><td class="line">        <span class='directive'>if ((d-&gt;m_dict[probe_pos + match_len] == c0) &amp;&amp; (d-&gt;m_dict[probe_pos + match_len - 1] == c1)) break;</span></td></tr>
<tr class="codeline" data-linenumber="2317"><td class="num" id="LN2317">2317</td><td class="line">      <span class='macro'>TDEFL_PROBE<span class='macro_popup'>next_probe_pos = d-&gt;m_next[probe_pos]; if ((!next_probe_pos<br>) || ((dist = (mz_uint16)(lookahead_pos - next_probe_pos)) &gt;<br> max_dist)) return; probe_pos = next_probe_pos &amp; TDEFL_LZ_DICT_SIZE_MASK<br>; if (*(const mz_uint16*)(&amp;d-&gt;m_dict[probe_pos + match_len<br> - 1]) == c01) break;</span></span>; <span class='macro'>TDEFL_PROBE<span class='macro_popup'>next_probe_pos = d-&gt;m_next[probe_pos]; if ((!next_probe_pos<br>) || ((dist = (mz_uint16)(lookahead_pos - next_probe_pos)) &gt;<br> max_dist)) return; probe_pos = next_probe_pos &amp; TDEFL_LZ_DICT_SIZE_MASK<br>; if (*(const mz_uint16*)(&amp;d-&gt;m_dict[probe_pos + match_len<br> - 1]) == c01) break;</span></span>; <span class='macro'>TDEFL_PROBE<span class='macro_popup'>next_probe_pos = d-&gt;m_next[probe_pos]; if ((!next_probe_pos<br>) || ((dist = (mz_uint16)(lookahead_pos - next_probe_pos)) &gt;<br> max_dist)) return; probe_pos = next_probe_pos &amp; TDEFL_LZ_DICT_SIZE_MASK<br>; if (*(const mz_uint16*)(&amp;d-&gt;m_dict[probe_pos + match_len<br> - 1]) == c01) break;</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2318"><td class="num" id="LN2318">2318</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2319"><td class="num" id="LN2319">2319</td><td class="line">    <span class='keyword'>if</span> (!dist) <span class='keyword'>break</span>; p = s; q = d-&gt;m_dict + probe_pos; <span class='keyword'>for</span> (probe_len = 0; probe_len &lt; max_match_len; probe_len++) <span class='keyword'>if</span> (*p++ != *q++) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2320"><td class="num" id="LN2320">2320</td><td class="line">    <span class='keyword'>if</span> (probe_len &gt; match_len)</td></tr>
<tr class="codeline" data-linenumber="2321"><td class="num" id="LN2321">2321</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2322"><td class="num" id="LN2322">2322</td><td class="line">      *pMatch_dist = dist; <span class='keyword'>if</span> ((*pMatch_len = match_len = probe_len) == max_match_len) <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="2323"><td class="num" id="LN2323">2323</td><td class="line">      c0 = d-&gt;m_dict[pos + match_len]; c1 = d-&gt;m_dict[pos + match_len - 1];</td></tr>
<tr class="codeline" data-linenumber="2324"><td class="num" id="LN2324">2324</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2325"><td class="num" id="LN2325">2325</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2326"><td class="num" id="LN2326">2326</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2327"><td class="num" id="LN2327">2327</td><td class="line"><span class='directive'>#endif // #if MINIZ_USE_UNALIGNED_LOADS_AND_STORES</span></td></tr>
<tr class="codeline" data-linenumber="2328"><td class="num" id="LN2328">2328</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2329"><td class="num" id="LN2329">2329</td><td class="line"><span class='directive'>#if <span class='macro'>MINIZ_USE_UNALIGNED_LOADS_AND_STORES<span class='macro_popup'>1</span></span> &amp;&amp; <span class='macro'>MINIZ_LITTLE_ENDIAN<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2330"><td class="num" id="LN2330">2330</td><td class="line"><span class='keyword'>static</span> mz_bool tdefl_compress_fast(tdefl_compressor *d)</td></tr>
<tr class="codeline" data-linenumber="2331"><td class="num" id="LN2331">2331</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2332"><td class="num" id="LN2332">2332</td><td class="line">  <span class='comment'>// Faster, minimally featured LZRW1-style match+parse loop with better register utilization. Intended for applications where raw throughput is valued more highly than ratio.</span></td></tr>
<tr class="codeline" data-linenumber="2333"><td class="num" id="LN2333">2333</td><td class="line">  mz_uint lookahead_pos = d-&gt;m_lookahead_pos, lookahead_size = d-&gt;m_lookahead_size, dict_size = d-&gt;m_dict_size, total_lz_bytes = d-&gt;m_total_lz_bytes, num_flags_left = d-&gt;m_num_flags_left;</td></tr>
<tr class="codeline" data-linenumber="2334"><td class="num" id="LN2334">2334</td><td class="line">  mz_uint8 *pLZ_code_buf = d-&gt;m_pLZ_code_buf, *pLZ_flags = d-&gt;m_pLZ_flags;</td></tr>
<tr class="codeline" data-linenumber="2335"><td class="num" id="LN2335">2335</td><td class="line">  mz_uint cur_pos = lookahead_pos &amp; TDEFL_LZ_DICT_SIZE_MASK;</td></tr>
<tr class="codeline" data-linenumber="2336"><td class="num" id="LN2336">2336</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2337"><td class="num" id="LN2337">2337</td><td class="line">  <span class='keyword'>while</span> ((d-&gt;m_src_buf_left) || ((d-&gt;m_flush) &amp;&amp; (lookahead_size)))</td></tr>
<tr class="codeline" data-linenumber="2338"><td class="num" id="LN2338">2338</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2339"><td class="num" id="LN2339">2339</td><td class="line">    <span class='keyword'>const</span> mz_uint TDEFL_COMP_FAST_LOOKAHEAD_SIZE = 4096;</td></tr>
<tr class="codeline" data-linenumber="2340"><td class="num" id="LN2340">2340</td><td class="line">    mz_uint dst_pos = (lookahead_pos + lookahead_size) &amp; TDEFL_LZ_DICT_SIZE_MASK;</td></tr>
<tr class="codeline" data-linenumber="2341"><td class="num" id="LN2341">2341</td><td class="line">    mz_uint num_bytes_to_process = (mz_uint)<span class='macro'>MZ_MIN(d-&gt;m_src_buf_left, TDEFL_COMP_FAST_LOOKAHEAD_SIZE - lookahead_size)<span class='macro_popup'>(((d-&gt;m_src_buf_left)&lt;(TDEFL_COMP_FAST_LOOKAHEAD_SIZE -<br> lookahead_size))?(d-&gt;m_src_buf_left):(TDEFL_COMP_FAST_LOOKAHEAD_SIZE<br> - lookahead_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2342"><td class="num" id="LN2342">2342</td><td class="line">    d-&gt;m_src_buf_left -= num_bytes_to_process;</td></tr>
<tr class="codeline" data-linenumber="2343"><td class="num" id="LN2343">2343</td><td class="line">    lookahead_size += num_bytes_to_process;</td></tr>
<tr class="codeline" data-linenumber="2344"><td class="num" id="LN2344">2344</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2345"><td class="num" id="LN2345">2345</td><td class="line">    <span class='keyword'>while</span> (num_bytes_to_process)</td></tr>
<tr class="codeline" data-linenumber="2346"><td class="num" id="LN2346">2346</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2347"><td class="num" id="LN2347">2347</td><td class="line">      mz_uint32 n = <span class='macro'>MZ_MIN(TDEFL_LZ_DICT_SIZE - dst_pos, num_bytes_to_process)<span class='macro_popup'>(((TDEFL_LZ_DICT_SIZE - dst_pos)&lt;(num_bytes_to_process))?(<br>TDEFL_LZ_DICT_SIZE - dst_pos):(num_bytes_to_process))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2348"><td class="num" id="LN2348">2348</td><td class="line">      memcpy(d-&gt;m_dict + dst_pos, d-&gt;m_pSrc, n);</td></tr>
<tr class="codeline" data-linenumber="2349"><td class="num" id="LN2349">2349</td><td class="line">      <span class='keyword'>if</span> (dst_pos &lt; (TDEFL_MAX_MATCH_LEN - 1))</td></tr>
<tr class="codeline" data-linenumber="2350"><td class="num" id="LN2350">2350</td><td class="line">        memcpy(d-&gt;m_dict + TDEFL_LZ_DICT_SIZE + dst_pos, d-&gt;m_pSrc, <span class='macro'>MZ_MIN(n, (TDEFL_MAX_MATCH_LEN - 1) - dst_pos)<span class='macro_popup'>(((n)&lt;((TDEFL_MAX_MATCH_LEN - 1) - dst_pos))?(n):((TDEFL_MAX_MATCH_LEN<br> - 1) - dst_pos))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2351"><td class="num" id="LN2351">2351</td><td class="line">      d-&gt;m_pSrc += n;</td></tr>
<tr class="codeline" data-linenumber="2352"><td class="num" id="LN2352">2352</td><td class="line">      dst_pos = (dst_pos + n) &amp; TDEFL_LZ_DICT_SIZE_MASK;</td></tr>
<tr class="codeline" data-linenumber="2353"><td class="num" id="LN2353">2353</td><td class="line">      num_bytes_to_process -= n;</td></tr>
<tr class="codeline" data-linenumber="2354"><td class="num" id="LN2354">2354</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2355"><td class="num" id="LN2355">2355</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2356"><td class="num" id="LN2356">2356</td><td class="line">    dict_size = <span class='macro'>MZ_MIN(TDEFL_LZ_DICT_SIZE - lookahead_size, dict_size)<span class='macro_popup'>(((TDEFL_LZ_DICT_SIZE - lookahead_size)&lt;(dict_size))?(TDEFL_LZ_DICT_SIZE<br> - lookahead_size):(dict_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2357"><td class="num" id="LN2357">2357</td><td class="line">    <span class='keyword'>if</span> ((!d-&gt;m_flush) &amp;&amp; (lookahead_size &lt; TDEFL_COMP_FAST_LOOKAHEAD_SIZE)) <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2358"><td class="num" id="LN2358">2358</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2359"><td class="num" id="LN2359">2359</td><td class="line">    <span class='keyword'>while</span> (lookahead_size &gt;= 4)</td></tr>
<tr class="codeline" data-linenumber="2360"><td class="num" id="LN2360">2360</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2361"><td class="num" id="LN2361">2361</td><td class="line">      mz_uint cur_match_dist, cur_match_len = 1;</td></tr>
<tr class="codeline" data-linenumber="2362"><td class="num" id="LN2362">2362</td><td class="line">      mz_uint8 *pCur_dict = d-&gt;m_dict + cur_pos;</td></tr>
<tr class="codeline" data-linenumber="2363"><td class="num" id="LN2363">2363</td><td class="line">      mz_uint first_trigram = (*(<span class='keyword'>const</span> mz_uint32 *)pCur_dict) &amp; 0xFFFFFF;</td></tr>
<tr class="codeline" data-linenumber="2364"><td class="num" id="LN2364">2364</td><td class="line">      mz_uint hash = (first_trigram ^ (first_trigram &gt;&gt; (24 - (TDEFL_LZ_HASH_BITS - 8)))) &amp; TDEFL_LEVEL1_HASH_SIZE_MASK;</td></tr>
<tr class="codeline" data-linenumber="2365"><td class="num" id="LN2365">2365</td><td class="line">      mz_uint probe_pos = d-&gt;m_hash[hash];</td></tr>
<tr class="codeline" data-linenumber="2366"><td class="num" id="LN2366">2366</td><td class="line">      d-&gt;m_hash[hash] = (mz_uint16)lookahead_pos;</td></tr>
<tr class="codeline" data-linenumber="2367"><td class="num" id="LN2367">2367</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2368"><td class="num" id="LN2368">2368</td><td class="line">      <span class='keyword'>if</span> (((cur_match_dist = (mz_uint16)(lookahead_pos - probe_pos)) &lt;= dict_size) &amp;&amp; ((*(<span class='keyword'>const</span> mz_uint32 *)(d-&gt;m_dict + (probe_pos &amp;= TDEFL_LZ_DICT_SIZE_MASK)) &amp; 0xFFFFFF) == first_trigram))</td></tr>
<tr class="codeline" data-linenumber="2369"><td class="num" id="LN2369">2369</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2370"><td class="num" id="LN2370">2370</td><td class="line">        <span class='keyword'>const</span> mz_uint16 *p = (<span class='keyword'>const</span> mz_uint16 *)pCur_dict;</td></tr>
<tr class="codeline" data-linenumber="2371"><td class="num" id="LN2371">2371</td><td class="line">        <span class='keyword'>const</span> mz_uint16 *q = (<span class='keyword'>const</span> mz_uint16 *)(d-&gt;m_dict + probe_pos);</td></tr>
<tr class="codeline" data-linenumber="2372"><td class="num" id="LN2372">2372</td><td class="line">        mz_uint32 probe_len = 32;</td></tr>
<tr class="codeline" data-linenumber="2373"><td class="num" id="LN2373">2373</td><td class="line">        <span class='keyword'>do</span> { } <span class='keyword'>while</span> ( (<span class='macro'>TDEFL_READ_UNALIGNED_WORD(++p)<span class='macro_popup'>*(const mz_uint16*)(++p)</span></span> == <span class='macro'>TDEFL_READ_UNALIGNED_WORD(++q)<span class='macro_popup'>*(const mz_uint16*)(++q)</span></span>) &amp;&amp; (<span class='macro'>TDEFL_READ_UNALIGNED_WORD(++p)<span class='macro_popup'>*(const mz_uint16*)(++p)</span></span> == <span class='macro'>TDEFL_READ_UNALIGNED_WORD(++q)<span class='macro_popup'>*(const mz_uint16*)(++q)</span></span>) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2374"><td class="num" id="LN2374">2374</td><td class="line">          (<span class='macro'>TDEFL_READ_UNALIGNED_WORD(++p)<span class='macro_popup'>*(const mz_uint16*)(++p)</span></span> == <span class='macro'>TDEFL_READ_UNALIGNED_WORD(++q)<span class='macro_popup'>*(const mz_uint16*)(++q)</span></span>) &amp;&amp; (<span class='macro'>TDEFL_READ_UNALIGNED_WORD(++p)<span class='macro_popup'>*(const mz_uint16*)(++p)</span></span> == <span class='macro'>TDEFL_READ_UNALIGNED_WORD(++q)<span class='macro_popup'>*(const mz_uint16*)(++q)</span></span>) &amp;&amp; (--probe_len &gt; 0) );</td></tr>
<tr class="codeline" data-linenumber="2375"><td class="num" id="LN2375">2375</td><td class="line">        cur_match_len = ((mz_uint)(p - (<span class='keyword'>const</span> mz_uint16 *)pCur_dict) * 2) + (mz_uint)(*(<span class='keyword'>const</span> mz_uint8 *)p == *(<span class='keyword'>const</span> mz_uint8 *)q);</td></tr>
<tr class="codeline" data-linenumber="2376"><td class="num" id="LN2376">2376</td><td class="line">        <span class='keyword'>if</span> (!probe_len)</td></tr>
<tr class="codeline" data-linenumber="2377"><td class="num" id="LN2377">2377</td><td class="line">          cur_match_len = cur_match_dist ? TDEFL_MAX_MATCH_LEN : 0;</td></tr>
<tr class="codeline" data-linenumber="2378"><td class="num" id="LN2378">2378</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2379"><td class="num" id="LN2379">2379</td><td class="line">        <span class='keyword'>if</span> ((cur_match_len &lt; TDEFL_MIN_MATCH_LEN) || ((cur_match_len == TDEFL_MIN_MATCH_LEN) &amp;&amp; (cur_match_dist &gt;= 8U*1024U)))</td></tr>
<tr class="codeline" data-linenumber="2380"><td class="num" id="LN2380">2380</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2381"><td class="num" id="LN2381">2381</td><td class="line">          cur_match_len = 1;</td></tr>
<tr class="codeline" data-linenumber="2382"><td class="num" id="LN2382">2382</td><td class="line">          *pLZ_code_buf++ = (mz_uint8)first_trigram;</td></tr>
<tr class="codeline" data-linenumber="2383"><td class="num" id="LN2383">2383</td><td class="line">          *pLZ_flags = (mz_uint8)(*pLZ_flags &gt;&gt; 1);</td></tr>
<tr class="codeline" data-linenumber="2384"><td class="num" id="LN2384">2384</td><td class="line">          d-&gt;m_huff_count[0][(mz_uint8)first_trigram]++;</td></tr>
<tr class="codeline" data-linenumber="2385"><td class="num" id="LN2385">2385</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2386"><td class="num" id="LN2386">2386</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2387"><td class="num" id="LN2387">2387</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2388"><td class="num" id="LN2388">2388</td><td class="line">          mz_uint32 s0, s1;</td></tr>
<tr class="codeline" data-linenumber="2389"><td class="num" id="LN2389">2389</td><td class="line">          cur_match_len = <span class='macro'>MZ_MIN(cur_match_len, lookahead_size)<span class='macro_popup'>(((cur_match_len)&lt;(lookahead_size))?(cur_match_len):(lookahead_size<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2390"><td class="num" id="LN2390">2390</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2391"><td class="num" id="LN2391">2391</td><td class="line">          <span class='macro'>MZ_ASSERT((cur_match_len &gt;= TDEFL_MIN_MATCH_LEN) &amp;&amp; (cur_match_dist &gt;= 1) &amp;&amp; (cur_match_dist &lt;= TDEFL_LZ_DICT_SIZE))<span class='macro_popup'>((void) sizeof (((cur_match_len &gt;= TDEFL_MIN_MATCH_LEN) &amp;&amp;<br> (cur_match_dist &gt;= 1) &amp;&amp; (cur_match_dist &lt;= TDEFL_LZ_DICT_SIZE<br>)) ? 1 : 0), __extension__ ({ if ((cur_match_len &gt;= TDEFL_MIN_MATCH_LEN<br>) &amp;&amp; (cur_match_dist &gt;= 1) &amp;&amp; (cur_match_dist<br> &lt;= TDEFL_LZ_DICT_SIZE)) ; else __assert_fail ("(cur_match_len &gt;= TDEFL_MIN_MATCH_LEN) &amp;&amp; (cur_match_dist &gt;= 1) &amp;&amp; (cur_match_dist &lt;= TDEFL_LZ_DICT_SIZE)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2391, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2392"><td class="num" id="LN2392">2392</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2393"><td class="num" id="LN2393">2393</td><td class="line">          cur_match_dist--;</td></tr>
<tr class="codeline" data-linenumber="2394"><td class="num" id="LN2394">2394</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2395"><td class="num" id="LN2395">2395</td><td class="line">          pLZ_code_buf[0] = (mz_uint8)(cur_match_len - TDEFL_MIN_MATCH_LEN);</td></tr>
<tr class="codeline" data-linenumber="2396"><td class="num" id="LN2396">2396</td><td class="line">          *(mz_uint16 *)(&amp;pLZ_code_buf[1]) = (mz_uint16)cur_match_dist;</td></tr>
<tr class="codeline" data-linenumber="2397"><td class="num" id="LN2397">2397</td><td class="line">          pLZ_code_buf += 3;</td></tr>
<tr class="codeline" data-linenumber="2398"><td class="num" id="LN2398">2398</td><td class="line">          *pLZ_flags = (mz_uint8)((*pLZ_flags &gt;&gt; 1) | 0x80);</td></tr>
<tr class="codeline" data-linenumber="2399"><td class="num" id="LN2399">2399</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2400"><td class="num" id="LN2400">2400</td><td class="line">          s0 = s_tdefl_small_dist_sym[cur_match_dist &amp; 511];</td></tr>
<tr class="codeline" data-linenumber="2401"><td class="num" id="LN2401">2401</td><td class="line">          s1 = s_tdefl_large_dist_sym[cur_match_dist &gt;&gt; 8];</td></tr>
<tr class="codeline" data-linenumber="2402"><td class="num" id="LN2402">2402</td><td class="line">          d-&gt;m_huff_count[1][(cur_match_dist &lt; 512) ? s0 : s1]++;</td></tr>
<tr class="codeline" data-linenumber="2403"><td class="num" id="LN2403">2403</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2404"><td class="num" id="LN2404">2404</td><td class="line">          d-&gt;m_huff_count[0][s_tdefl_len_sym[cur_match_len - TDEFL_MIN_MATCH_LEN]]++;</td></tr>
<tr class="codeline" data-linenumber="2405"><td class="num" id="LN2405">2405</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2406"><td class="num" id="LN2406">2406</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2407"><td class="num" id="LN2407">2407</td><td class="line">      <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2408"><td class="num" id="LN2408">2408</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2409"><td class="num" id="LN2409">2409</td><td class="line">        *pLZ_code_buf++ = (mz_uint8)first_trigram;</td></tr>
<tr class="codeline" data-linenumber="2410"><td class="num" id="LN2410">2410</td><td class="line">        *pLZ_flags = (mz_uint8)(*pLZ_flags &gt;&gt; 1);</td></tr>
<tr class="codeline" data-linenumber="2411"><td class="num" id="LN2411">2411</td><td class="line">        d-&gt;m_huff_count[0][(mz_uint8)first_trigram]++;</td></tr>
<tr class="codeline" data-linenumber="2412"><td class="num" id="LN2412">2412</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2413"><td class="num" id="LN2413">2413</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2414"><td class="num" id="LN2414">2414</td><td class="line">      <span class='keyword'>if</span> (--num_flags_left == 0) { num_flags_left = 8; pLZ_flags = pLZ_code_buf++; }</td></tr>
<tr class="codeline" data-linenumber="2415"><td class="num" id="LN2415">2415</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2416"><td class="num" id="LN2416">2416</td><td class="line">      total_lz_bytes += cur_match_len;</td></tr>
<tr class="codeline" data-linenumber="2417"><td class="num" id="LN2417">2417</td><td class="line">      lookahead_pos += cur_match_len;</td></tr>
<tr class="codeline" data-linenumber="2418"><td class="num" id="LN2418">2418</td><td class="line">      dict_size = <span class='macro'>MZ_MIN(dict_size + cur_match_len, TDEFL_LZ_DICT_SIZE)<span class='macro_popup'>(((dict_size + cur_match_len)&lt;(TDEFL_LZ_DICT_SIZE))?(dict_size<br> + cur_match_len):(TDEFL_LZ_DICT_SIZE))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2419"><td class="num" id="LN2419">2419</td><td class="line">      cur_pos = (cur_pos + cur_match_len) &amp; TDEFL_LZ_DICT_SIZE_MASK;</td></tr>
<tr class="codeline" data-linenumber="2420"><td class="num" id="LN2420">2420</td><td class="line">      <span class='macro'>MZ_ASSERT(lookahead_size &gt;= cur_match_len)<span class='macro_popup'>((void) sizeof ((lookahead_size &gt;= cur_match_len) ? 1 : 0)<br>, __extension__ ({ if (lookahead_size &gt;= cur_match_len) ; else<br> __assert_fail ("lookahead_size &gt;= cur_match_len", "/work/repo/external/CppMicroServices/third_party/miniz.c"<br>, 2420, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2421"><td class="num" id="LN2421">2421</td><td class="line">      lookahead_size -= cur_match_len;</td></tr>
<tr class="codeline" data-linenumber="2422"><td class="num" id="LN2422">2422</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2423"><td class="num" id="LN2423">2423</td><td class="line">      <span class='keyword'>if</span> (pLZ_code_buf &gt; &amp;d-&gt;m_lz_code_buf[TDEFL_LZ_CODE_BUF_SIZE - 8])</td></tr>
<tr class="codeline" data-linenumber="2424"><td class="num" id="LN2424">2424</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2425"><td class="num" id="LN2425">2425</td><td class="line">        <span class='keyword'>int</span> n;</td></tr>
<tr class="codeline" data-linenumber="2426"><td class="num" id="LN2426">2426</td><td class="line">        d-&gt;m_lookahead_pos = lookahead_pos; d-&gt;m_lookahead_size = lookahead_size; d-&gt;m_dict_size = dict_size;</td></tr>
<tr class="codeline" data-linenumber="2427"><td class="num" id="LN2427">2427</td><td class="line">        d-&gt;m_total_lz_bytes = total_lz_bytes; d-&gt;m_pLZ_code_buf = pLZ_code_buf; d-&gt;m_pLZ_flags = pLZ_flags; d-&gt;m_num_flags_left = num_flags_left;</td></tr>
<tr class="codeline" data-linenumber="2428"><td class="num" id="LN2428">2428</td><td class="line">        <span class='keyword'>if</span> ((n = tdefl_flush_block(d, 0)) != 0)</td></tr>
<tr class="codeline" data-linenumber="2429"><td class="num" id="LN2429">2429</td><td class="line">          <span class='keyword'>return</span> (n &lt; 0) ? <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span> : <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2430"><td class="num" id="LN2430">2430</td><td class="line">        total_lz_bytes = d-&gt;m_total_lz_bytes; pLZ_code_buf = d-&gt;m_pLZ_code_buf; pLZ_flags = d-&gt;m_pLZ_flags; num_flags_left = d-&gt;m_num_flags_left;</td></tr>
<tr class="codeline" data-linenumber="2431"><td class="num" id="LN2431">2431</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2432"><td class="num" id="LN2432">2432</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2433"><td class="num" id="LN2433">2433</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2434"><td class="num" id="LN2434">2434</td><td class="line">    <span class='keyword'>while</span> (lookahead_size)</td></tr>
<tr class="codeline" data-linenumber="2435"><td class="num" id="LN2435">2435</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2436"><td class="num" id="LN2436">2436</td><td class="line">      mz_uint8 lit = d-&gt;m_dict[cur_pos];</td></tr>
<tr class="codeline" data-linenumber="2437"><td class="num" id="LN2437">2437</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2438"><td class="num" id="LN2438">2438</td><td class="line">      total_lz_bytes++;</td></tr>
<tr class="codeline" data-linenumber="2439"><td class="num" id="LN2439">2439</td><td class="line">      *pLZ_code_buf++ = lit;</td></tr>
<tr class="codeline" data-linenumber="2440"><td class="num" id="LN2440">2440</td><td class="line">      *pLZ_flags = (mz_uint8)(*pLZ_flags &gt;&gt; 1);</td></tr>
<tr class="codeline" data-linenumber="2441"><td class="num" id="LN2441">2441</td><td class="line">      <span class='keyword'>if</span> (--num_flags_left == 0) { num_flags_left = 8; pLZ_flags = pLZ_code_buf++; }</td></tr>
<tr class="codeline" data-linenumber="2442"><td class="num" id="LN2442">2442</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2443"><td class="num" id="LN2443">2443</td><td class="line">      d-&gt;m_huff_count[0][lit]++;</td></tr>
<tr class="codeline" data-linenumber="2444"><td class="num" id="LN2444">2444</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2445"><td class="num" id="LN2445">2445</td><td class="line">      lookahead_pos++;</td></tr>
<tr class="codeline" data-linenumber="2446"><td class="num" id="LN2446">2446</td><td class="line">      dict_size = <span class='macro'>MZ_MIN(dict_size + 1, TDEFL_LZ_DICT_SIZE)<span class='macro_popup'>(((dict_size + 1)&lt;(TDEFL_LZ_DICT_SIZE))?(dict_size + 1):(TDEFL_LZ_DICT_SIZE<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2447"><td class="num" id="LN2447">2447</td><td class="line">      cur_pos = (cur_pos + 1) &amp; TDEFL_LZ_DICT_SIZE_MASK;</td></tr>
<tr class="codeline" data-linenumber="2448"><td class="num" id="LN2448">2448</td><td class="line">      lookahead_size--;</td></tr>
<tr class="codeline" data-linenumber="2449"><td class="num" id="LN2449">2449</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2450"><td class="num" id="LN2450">2450</td><td class="line">      <span class='keyword'>if</span> (pLZ_code_buf &gt; &amp;d-&gt;m_lz_code_buf[TDEFL_LZ_CODE_BUF_SIZE - 8])</td></tr>
<tr class="codeline" data-linenumber="2451"><td class="num" id="LN2451">2451</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2452"><td class="num" id="LN2452">2452</td><td class="line">        <span class='keyword'>int</span> n;</td></tr>
<tr class="codeline" data-linenumber="2453"><td class="num" id="LN2453">2453</td><td class="line">        d-&gt;m_lookahead_pos = lookahead_pos; d-&gt;m_lookahead_size = lookahead_size; d-&gt;m_dict_size = dict_size;</td></tr>
<tr class="codeline" data-linenumber="2454"><td class="num" id="LN2454">2454</td><td class="line">        d-&gt;m_total_lz_bytes = total_lz_bytes; d-&gt;m_pLZ_code_buf = pLZ_code_buf; d-&gt;m_pLZ_flags = pLZ_flags; d-&gt;m_num_flags_left = num_flags_left;</td></tr>
<tr class="codeline" data-linenumber="2455"><td class="num" id="LN2455">2455</td><td class="line">        <span class='keyword'>if</span> ((n = tdefl_flush_block(d, 0)) != 0)</td></tr>
<tr class="codeline" data-linenumber="2456"><td class="num" id="LN2456">2456</td><td class="line">          <span class='keyword'>return</span> (n &lt; 0) ? <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span> : <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2457"><td class="num" id="LN2457">2457</td><td class="line">        total_lz_bytes = d-&gt;m_total_lz_bytes; pLZ_code_buf = d-&gt;m_pLZ_code_buf; pLZ_flags = d-&gt;m_pLZ_flags; num_flags_left = d-&gt;m_num_flags_left;</td></tr>
<tr class="codeline" data-linenumber="2458"><td class="num" id="LN2458">2458</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2459"><td class="num" id="LN2459">2459</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2460"><td class="num" id="LN2460">2460</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2461"><td class="num" id="LN2461">2461</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2462"><td class="num" id="LN2462">2462</td><td class="line">  d-&gt;m_lookahead_pos = lookahead_pos; d-&gt;m_lookahead_size = lookahead_size; d-&gt;m_dict_size = dict_size;</td></tr>
<tr class="codeline" data-linenumber="2463"><td class="num" id="LN2463">2463</td><td class="line">  d-&gt;m_total_lz_bytes = total_lz_bytes; d-&gt;m_pLZ_code_buf = pLZ_code_buf; d-&gt;m_pLZ_flags = pLZ_flags; d-&gt;m_num_flags_left = num_flags_left;</td></tr>
<tr class="codeline" data-linenumber="2464"><td class="num" id="LN2464">2464</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2465"><td class="num" id="LN2465">2465</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2466"><td class="num" id="LN2466">2466</td><td class="line"><span class='directive'>#endif // MINIZ_USE_UNALIGNED_LOADS_AND_STORES &amp;&amp; MINIZ_LITTLE_ENDIAN</span></td></tr>
<tr class="codeline" data-linenumber="2467"><td class="num" id="LN2467">2467</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2468"><td class="num" id="LN2468">2468</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> <span class='keyword'>void</span> tdefl_record_literal(tdefl_compressor *d, mz_uint8 lit)</td></tr>
<tr class="codeline" data-linenumber="2469"><td class="num" id="LN2469">2469</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2470"><td class="num" id="LN2470">2470</td><td class="line">  d-&gt;m_total_lz_bytes++;</td></tr>
<tr class="codeline" data-linenumber="2471"><td class="num" id="LN2471">2471</td><td class="line">  *d-&gt;m_pLZ_code_buf++ = lit;</td></tr>
<tr class="codeline" data-linenumber="2472"><td class="num" id="LN2472">2472</td><td class="line">  *d-&gt;m_pLZ_flags = (mz_uint8)(*d-&gt;m_pLZ_flags &gt;&gt; 1); <span class='keyword'>if</span> (--d-&gt;m_num_flags_left == 0) { d-&gt;m_num_flags_left = 8; d-&gt;m_pLZ_flags = d-&gt;m_pLZ_code_buf++; }</td></tr>
<tr class="codeline" data-linenumber="2473"><td class="num" id="LN2473">2473</td><td class="line">  d-&gt;m_huff_count[0][lit]++;</td></tr>
<tr class="codeline" data-linenumber="2474"><td class="num" id="LN2474">2474</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2475"><td class="num" id="LN2475">2475</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2476"><td class="num" id="LN2476">2476</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> <span class='keyword'>void</span> tdefl_record_match(tdefl_compressor *d, mz_uint match_len, mz_uint match_dist)</td></tr>
<tr class="codeline" data-linenumber="2477"><td class="num" id="LN2477">2477</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2478"><td class="num" id="LN2478">2478</td><td class="line">  mz_uint32 s0, s1;</td></tr>
<tr class="codeline" data-linenumber="2479"><td class="num" id="LN2479">2479</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2480"><td class="num" id="LN2480">2480</td><td class="line">  <span class='macro'>MZ_ASSERT((match_len &gt;= TDEFL_MIN_MATCH_LEN) &amp;&amp; (match_dist &gt;= 1) &amp;&amp; (match_dist &lt;= TDEFL_LZ_DICT_SIZE))<span class='macro_popup'>((void) sizeof (((match_len &gt;= TDEFL_MIN_MATCH_LEN) &amp;&amp;<br> (match_dist &gt;= 1) &amp;&amp; (match_dist &lt;= TDEFL_LZ_DICT_SIZE<br>)) ? 1 : 0), __extension__ ({ if ((match_len &gt;= TDEFL_MIN_MATCH_LEN<br>) &amp;&amp; (match_dist &gt;= 1) &amp;&amp; (match_dist &lt;=<br> TDEFL_LZ_DICT_SIZE)) ; else __assert_fail ("(match_len &gt;= TDEFL_MIN_MATCH_LEN) &amp;&amp; (match_dist &gt;= 1) &amp;&amp; (match_dist &lt;= TDEFL_LZ_DICT_SIZE)"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2480, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2481"><td class="num" id="LN2481">2481</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2482"><td class="num" id="LN2482">2482</td><td class="line">  d-&gt;m_total_lz_bytes += match_len;</td></tr>
<tr class="codeline" data-linenumber="2483"><td class="num" id="LN2483">2483</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2484"><td class="num" id="LN2484">2484</td><td class="line">  d-&gt;m_pLZ_code_buf[0] = (mz_uint8)(match_len - TDEFL_MIN_MATCH_LEN);</td></tr>
<tr class="codeline" data-linenumber="2485"><td class="num" id="LN2485">2485</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2486"><td class="num" id="LN2486">2486</td><td class="line">  match_dist -= 1;</td></tr>
<tr class="codeline" data-linenumber="2487"><td class="num" id="LN2487">2487</td><td class="line">  d-&gt;m_pLZ_code_buf[1] = (mz_uint8)(match_dist &amp; 0xFF);</td></tr>
<tr class="codeline" data-linenumber="2488"><td class="num" id="LN2488">2488</td><td class="line">  d-&gt;m_pLZ_code_buf[2] = (mz_uint8)(match_dist &gt;&gt; 8); d-&gt;m_pLZ_code_buf += 3;</td></tr>
<tr class="codeline" data-linenumber="2489"><td class="num" id="LN2489">2489</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2490"><td class="num" id="LN2490">2490</td><td class="line">  *d-&gt;m_pLZ_flags = (mz_uint8)((*d-&gt;m_pLZ_flags &gt;&gt; 1) | 0x80); <span class='keyword'>if</span> (--d-&gt;m_num_flags_left == 0) { d-&gt;m_num_flags_left = 8; d-&gt;m_pLZ_flags = d-&gt;m_pLZ_code_buf++; }</td></tr>
<tr class="codeline" data-linenumber="2491"><td class="num" id="LN2491">2491</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2492"><td class="num" id="LN2492">2492</td><td class="line">  s0 = s_tdefl_small_dist_sym[match_dist &amp; 511]; s1 = s_tdefl_large_dist_sym[(match_dist &gt;&gt; 8) &amp; 127];</td></tr>
<tr class="codeline" data-linenumber="2493"><td class="num" id="LN2493">2493</td><td class="line">  d-&gt;m_huff_count[1][(match_dist &lt; 512) ? s0 : s1]++;</td></tr>
<tr class="codeline" data-linenumber="2494"><td class="num" id="LN2494">2494</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2495"><td class="num" id="LN2495">2495</td><td class="line">  <span class='keyword'>if</span> (match_len &gt;= TDEFL_MIN_MATCH_LEN) d-&gt;m_huff_count[0][s_tdefl_len_sym[match_len - TDEFL_MIN_MATCH_LEN]]++;</td></tr>
<tr class="codeline" data-linenumber="2496"><td class="num" id="LN2496">2496</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2497"><td class="num" id="LN2497">2497</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2498"><td class="num" id="LN2498">2498</td><td class="line"><span class='keyword'>static</span> mz_bool tdefl_compress_normal(tdefl_compressor *d)</td></tr>
<tr class="codeline" data-linenumber="2499"><td class="num" id="LN2499">2499</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2500"><td class="num" id="LN2500">2500</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *pSrc = d-&gt;m_pSrc; size_t src_buf_left = d-&gt;m_src_buf_left;</td></tr>
<tr class="codeline" data-linenumber="2501"><td class="num" id="LN2501">2501</td><td class="line">  tdefl_flush flush = d-&gt;m_flush;</td></tr>
<tr class="codeline" data-linenumber="2502"><td class="num" id="LN2502">2502</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2503"><td class="num" id="LN2503">2503</td><td class="line">  <span class='keyword'>while</span> ((src_buf_left) || ((flush) &amp;&amp; (d-&gt;m_lookahead_size)))</td></tr>
<tr class="codeline" data-linenumber="2504"><td class="num" id="LN2504">2504</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2505"><td class="num" id="LN2505">2505</td><td class="line">    mz_uint len_to_move, cur_match_dist, cur_match_len, cur_pos;</td></tr>
<tr class="codeline" data-linenumber="2506"><td class="num" id="LN2506">2506</td><td class="line">    <span class='comment'>// Update dictionary and hash chains. Keeps the lookahead size equal to TDEFL_MAX_MATCH_LEN.</span></td></tr>
<tr class="codeline" data-linenumber="2507"><td class="num" id="LN2507">2507</td><td class="line">    <span class='keyword'>if</span> ((d-&gt;m_lookahead_size + d-&gt;m_dict_size) &gt;= (TDEFL_MIN_MATCH_LEN - 1))</td></tr>
<tr class="codeline" data-linenumber="2508"><td class="num" id="LN2508">2508</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2509"><td class="num" id="LN2509">2509</td><td class="line">      mz_uint dst_pos = (d-&gt;m_lookahead_pos + d-&gt;m_lookahead_size) &amp; TDEFL_LZ_DICT_SIZE_MASK, ins_pos = d-&gt;m_lookahead_pos + d-&gt;m_lookahead_size - 2;</td></tr>
<tr class="codeline" data-linenumber="2510"><td class="num" id="LN2510">2510</td><td class="line">      mz_uint hash = (d-&gt;m_dict[ins_pos &amp; TDEFL_LZ_DICT_SIZE_MASK] &lt;&lt; TDEFL_LZ_HASH_SHIFT) ^ d-&gt;m_dict[(ins_pos + 1) &amp; TDEFL_LZ_DICT_SIZE_MASK];</td></tr>
<tr class="codeline" data-linenumber="2511"><td class="num" id="LN2511">2511</td><td class="line">      mz_uint num_bytes_to_process = (mz_uint)<span class='macro'>MZ_MIN(src_buf_left, TDEFL_MAX_MATCH_LEN - d-&gt;m_lookahead_size)<span class='macro_popup'>(((src_buf_left)&lt;(TDEFL_MAX_MATCH_LEN - d-&gt;m_lookahead_size<br>))?(src_buf_left):(TDEFL_MAX_MATCH_LEN - d-&gt;m_lookahead_size<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2512"><td class="num" id="LN2512">2512</td><td class="line">      <span class='keyword'>const</span> mz_uint8 *pSrc_end = pSrc + num_bytes_to_process;</td></tr>
<tr class="codeline" data-linenumber="2513"><td class="num" id="LN2513">2513</td><td class="line">      src_buf_left -= num_bytes_to_process;</td></tr>
<tr class="codeline" data-linenumber="2514"><td class="num" id="LN2514">2514</td><td class="line">      d-&gt;m_lookahead_size += num_bytes_to_process;</td></tr>
<tr class="codeline" data-linenumber="2515"><td class="num" id="LN2515">2515</td><td class="line">      <span class='keyword'>while</span> (pSrc != pSrc_end)</td></tr>
<tr class="codeline" data-linenumber="2516"><td class="num" id="LN2516">2516</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2517"><td class="num" id="LN2517">2517</td><td class="line">        mz_uint8 c = *pSrc++; d-&gt;m_dict[dst_pos] = c; <span class='keyword'>if</span> (dst_pos &lt; (TDEFL_MAX_MATCH_LEN - 1)) d-&gt;m_dict[TDEFL_LZ_DICT_SIZE + dst_pos] = c;</td></tr>
<tr class="codeline" data-linenumber="2518"><td class="num" id="LN2518">2518</td><td class="line">        hash = ((hash &lt;&lt; TDEFL_LZ_HASH_SHIFT) ^ c) &amp; (TDEFL_LZ_HASH_SIZE - 1);</td></tr>
<tr class="codeline" data-linenumber="2519"><td class="num" id="LN2519">2519</td><td class="line">        d-&gt;m_next[ins_pos &amp; TDEFL_LZ_DICT_SIZE_MASK] = d-&gt;m_hash[hash]; d-&gt;m_hash[hash] = (mz_uint16)(ins_pos);</td></tr>
<tr class="codeline" data-linenumber="2520"><td class="num" id="LN2520">2520</td><td class="line">        dst_pos = (dst_pos + 1) &amp; TDEFL_LZ_DICT_SIZE_MASK; ins_pos++;</td></tr>
<tr class="codeline" data-linenumber="2521"><td class="num" id="LN2521">2521</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2522"><td class="num" id="LN2522">2522</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2523"><td class="num" id="LN2523">2523</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2524"><td class="num" id="LN2524">2524</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2525"><td class="num" id="LN2525">2525</td><td class="line">      <span class='keyword'>while</span> ((src_buf_left) &amp;&amp; (d-&gt;m_lookahead_size &lt; TDEFL_MAX_MATCH_LEN))</td></tr>
<tr class="codeline" data-linenumber="2526"><td class="num" id="LN2526">2526</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2527"><td class="num" id="LN2527">2527</td><td class="line">        mz_uint8 c = *pSrc++;</td></tr>
<tr class="codeline" data-linenumber="2528"><td class="num" id="LN2528">2528</td><td class="line">        mz_uint dst_pos = (d-&gt;m_lookahead_pos + d-&gt;m_lookahead_size) &amp; TDEFL_LZ_DICT_SIZE_MASK;</td></tr>
<tr class="codeline" data-linenumber="2529"><td class="num" id="LN2529">2529</td><td class="line">        src_buf_left--;</td></tr>
<tr class="codeline" data-linenumber="2530"><td class="num" id="LN2530">2530</td><td class="line">        d-&gt;m_dict[dst_pos] = c;</td></tr>
<tr class="codeline" data-linenumber="2531"><td class="num" id="LN2531">2531</td><td class="line">        <span class='keyword'>if</span> (dst_pos &lt; (TDEFL_MAX_MATCH_LEN - 1))</td></tr>
<tr class="codeline" data-linenumber="2532"><td class="num" id="LN2532">2532</td><td class="line">          d-&gt;m_dict[TDEFL_LZ_DICT_SIZE + dst_pos] = c;</td></tr>
<tr class="codeline" data-linenumber="2533"><td class="num" id="LN2533">2533</td><td class="line">        <span class='keyword'>if</span> ((++d-&gt;m_lookahead_size + d-&gt;m_dict_size) &gt;= TDEFL_MIN_MATCH_LEN)</td></tr>
<tr class="codeline" data-linenumber="2534"><td class="num" id="LN2534">2534</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2535"><td class="num" id="LN2535">2535</td><td class="line">          mz_uint ins_pos = d-&gt;m_lookahead_pos + (d-&gt;m_lookahead_size - 1) - 2;</td></tr>
<tr class="codeline" data-linenumber="2536"><td class="num" id="LN2536">2536</td><td class="line">          mz_uint hash = ((d-&gt;m_dict[ins_pos &amp; TDEFL_LZ_DICT_SIZE_MASK] &lt;&lt; (TDEFL_LZ_HASH_SHIFT * 2)) ^ (d-&gt;m_dict[(ins_pos + 1) &amp; TDEFL_LZ_DICT_SIZE_MASK] &lt;&lt; TDEFL_LZ_HASH_SHIFT) ^ c) &amp; (TDEFL_LZ_HASH_SIZE - 1);</td></tr>
<tr class="codeline" data-linenumber="2537"><td class="num" id="LN2537">2537</td><td class="line">          d-&gt;m_next[ins_pos &amp; TDEFL_LZ_DICT_SIZE_MASK] = d-&gt;m_hash[hash]; d-&gt;m_hash[hash] = (mz_uint16)(ins_pos);</td></tr>
<tr class="codeline" data-linenumber="2538"><td class="num" id="LN2538">2538</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2539"><td class="num" id="LN2539">2539</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2540"><td class="num" id="LN2540">2540</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2541"><td class="num" id="LN2541">2541</td><td class="line">    d-&gt;m_dict_size = <span class='macro'>MZ_MIN(TDEFL_LZ_DICT_SIZE - d-&gt;m_lookahead_size, d-&gt;m_dict_size)<span class='macro_popup'>(((TDEFL_LZ_DICT_SIZE - d-&gt;m_lookahead_size)&lt;(d-&gt;m_dict_size<br>))?(TDEFL_LZ_DICT_SIZE - d-&gt;m_lookahead_size):(d-&gt;m_dict_size<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2542"><td class="num" id="LN2542">2542</td><td class="line">    <span class='keyword'>if</span> ((!flush) &amp;&amp; (d-&gt;m_lookahead_size &lt; TDEFL_MAX_MATCH_LEN))</td></tr>
<tr class="codeline" data-linenumber="2543"><td class="num" id="LN2543">2543</td><td class="line">      <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="2544"><td class="num" id="LN2544">2544</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2545"><td class="num" id="LN2545">2545</td><td class="line">    <span class='comment'>// Simple lazy/greedy parsing state machine.</span></td></tr>
<tr class="codeline" data-linenumber="2546"><td class="num" id="LN2546">2546</td><td class="line">    len_to_move = 1; cur_match_dist = 0; cur_match_len = d-&gt;m_saved_match_len ? d-&gt;m_saved_match_len : (TDEFL_MIN_MATCH_LEN - 1); cur_pos = d-&gt;m_lookahead_pos &amp; TDEFL_LZ_DICT_SIZE_MASK;</td></tr>
<tr class="codeline" data-linenumber="2547"><td class="num" id="LN2547">2547</td><td class="line">    <span class='keyword'>if</span> (d-&gt;m_flags &amp; (TDEFL_RLE_MATCHES | TDEFL_FORCE_ALL_RAW_BLOCKS))</td></tr>
<tr class="codeline" data-linenumber="2548"><td class="num" id="LN2548">2548</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2549"><td class="num" id="LN2549">2549</td><td class="line">      <span class='keyword'>if</span> ((d-&gt;m_dict_size) &amp;&amp; (!(d-&gt;m_flags &amp; TDEFL_FORCE_ALL_RAW_BLOCKS)))</td></tr>
<tr class="codeline" data-linenumber="2550"><td class="num" id="LN2550">2550</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2551"><td class="num" id="LN2551">2551</td><td class="line">        mz_uint8 c = d-&gt;m_dict[(cur_pos - 1) &amp; TDEFL_LZ_DICT_SIZE_MASK];</td></tr>
<tr class="codeline" data-linenumber="2552"><td class="num" id="LN2552">2552</td><td class="line">        cur_match_len = 0; <span class='keyword'>while</span> (cur_match_len &lt; d-&gt;m_lookahead_size) { <span class='keyword'>if</span> (d-&gt;m_dict[cur_pos + cur_match_len] != c) <span class='keyword'>break</span>; cur_match_len++; }</td></tr>
<tr class="codeline" data-linenumber="2553"><td class="num" id="LN2553">2553</td><td class="line">        <span class='keyword'>if</span> (cur_match_len &lt; TDEFL_MIN_MATCH_LEN) cur_match_len = 0; <span class='keyword'>else</span> cur_match_dist = 1;</td></tr>
<tr class="codeline" data-linenumber="2554"><td class="num" id="LN2554">2554</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2555"><td class="num" id="LN2555">2555</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2556"><td class="num" id="LN2556">2556</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2557"><td class="num" id="LN2557">2557</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2558"><td class="num" id="LN2558">2558</td><td class="line">      tdefl_find_match(d, d-&gt;m_lookahead_pos, d-&gt;m_dict_size, d-&gt;m_lookahead_size, &amp;cur_match_dist, &amp;cur_match_len);</td></tr>
<tr class="codeline" data-linenumber="2559"><td class="num" id="LN2559">2559</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2560"><td class="num" id="LN2560">2560</td><td class="line">    <span class='keyword'>if</span> (((cur_match_len == TDEFL_MIN_MATCH_LEN) &amp;&amp; (cur_match_dist &gt;= 8U*1024U)) || (cur_pos == cur_match_dist) || ((d-&gt;m_flags &amp; TDEFL_FILTER_MATCHES) &amp;&amp; (cur_match_len &lt;= 5)))</td></tr>
<tr class="codeline" data-linenumber="2561"><td class="num" id="LN2561">2561</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2562"><td class="num" id="LN2562">2562</td><td class="line">      cur_match_dist = cur_match_len = 0;</td></tr>
<tr class="codeline" data-linenumber="2563"><td class="num" id="LN2563">2563</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2564"><td class="num" id="LN2564">2564</td><td class="line">    <span class='keyword'>if</span> (d-&gt;m_saved_match_len)</td></tr>
<tr class="codeline" data-linenumber="2565"><td class="num" id="LN2565">2565</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2566"><td class="num" id="LN2566">2566</td><td class="line">      <span class='keyword'>if</span> (cur_match_len &gt; d-&gt;m_saved_match_len)</td></tr>
<tr class="codeline" data-linenumber="2567"><td class="num" id="LN2567">2567</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2568"><td class="num" id="LN2568">2568</td><td class="line">        tdefl_record_literal(d, (mz_uint8)d-&gt;m_saved_lit);</td></tr>
<tr class="codeline" data-linenumber="2569"><td class="num" id="LN2569">2569</td><td class="line">        <span class='keyword'>if</span> (cur_match_len &gt;= 128)</td></tr>
<tr class="codeline" data-linenumber="2570"><td class="num" id="LN2570">2570</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2571"><td class="num" id="LN2571">2571</td><td class="line">          tdefl_record_match(d, cur_match_len, cur_match_dist);</td></tr>
<tr class="codeline" data-linenumber="2572"><td class="num" id="LN2572">2572</td><td class="line">          d-&gt;m_saved_match_len = 0; len_to_move = cur_match_len;</td></tr>
<tr class="codeline" data-linenumber="2573"><td class="num" id="LN2573">2573</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2574"><td class="num" id="LN2574">2574</td><td class="line">        <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2575"><td class="num" id="LN2575">2575</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2576"><td class="num" id="LN2576">2576</td><td class="line">          d-&gt;m_saved_lit = d-&gt;m_dict[cur_pos]; d-&gt;m_saved_match_dist = cur_match_dist; d-&gt;m_saved_match_len = cur_match_len;</td></tr>
<tr class="codeline" data-linenumber="2577"><td class="num" id="LN2577">2577</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2578"><td class="num" id="LN2578">2578</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2579"><td class="num" id="LN2579">2579</td><td class="line">      <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2580"><td class="num" id="LN2580">2580</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2581"><td class="num" id="LN2581">2581</td><td class="line">        tdefl_record_match(d, d-&gt;m_saved_match_len, d-&gt;m_saved_match_dist);</td></tr>
<tr class="codeline" data-linenumber="2582"><td class="num" id="LN2582">2582</td><td class="line">        len_to_move = d-&gt;m_saved_match_len - 1; d-&gt;m_saved_match_len = 0;</td></tr>
<tr class="codeline" data-linenumber="2583"><td class="num" id="LN2583">2583</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2584"><td class="num" id="LN2584">2584</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2585"><td class="num" id="LN2585">2585</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (!cur_match_dist)</td></tr>
<tr class="codeline" data-linenumber="2586"><td class="num" id="LN2586">2586</td><td class="line">      tdefl_record_literal(d, d-&gt;m_dict[<span class='macro'>MZ_MIN(cur_pos, <span class='keyword'>sizeof</span>(d-&gt;m_dict) - 1)<span class='macro_popup'>(((cur_pos)&lt;(sizeof(d-&gt;m_dict) - 1))?(cur_pos):(sizeof(<br>d-&gt;m_dict) - 1))</span></span>]);</td></tr>
<tr class="codeline" data-linenumber="2587"><td class="num" id="LN2587">2587</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> ((d-&gt;m_greedy_parsing) || (d-&gt;m_flags &amp; TDEFL_RLE_MATCHES) || (cur_match_len &gt;= 128))</td></tr>
<tr class="codeline" data-linenumber="2588"><td class="num" id="LN2588">2588</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2589"><td class="num" id="LN2589">2589</td><td class="line">      tdefl_record_match(d, cur_match_len, cur_match_dist);</td></tr>
<tr class="codeline" data-linenumber="2590"><td class="num" id="LN2590">2590</td><td class="line">      len_to_move = cur_match_len;</td></tr>
<tr class="codeline" data-linenumber="2591"><td class="num" id="LN2591">2591</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2592"><td class="num" id="LN2592">2592</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2593"><td class="num" id="LN2593">2593</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2594"><td class="num" id="LN2594">2594</td><td class="line">      d-&gt;m_saved_lit = d-&gt;m_dict[<span class='macro'>MZ_MIN(cur_pos, <span class='keyword'>sizeof</span>(d-&gt;m_dict) - 1)<span class='macro_popup'>(((cur_pos)&lt;(sizeof(d-&gt;m_dict) - 1))?(cur_pos):(sizeof(<br>d-&gt;m_dict) - 1))</span></span>]; d-&gt;m_saved_match_dist = cur_match_dist; d-&gt;m_saved_match_len = cur_match_len;</td></tr>
<tr class="codeline" data-linenumber="2595"><td class="num" id="LN2595">2595</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2596"><td class="num" id="LN2596">2596</td><td class="line">    <span class='comment'>// Move the lookahead forward by len_to_move bytes.</span></td></tr>
<tr class="codeline" data-linenumber="2597"><td class="num" id="LN2597">2597</td><td class="line">    d-&gt;m_lookahead_pos += len_to_move;</td></tr>
<tr class="codeline" data-linenumber="2598"><td class="num" id="LN2598">2598</td><td class="line">    <span class='macro'>MZ_ASSERT(d-&gt;m_lookahead_size &gt;= len_to_move)<span class='macro_popup'>((void) sizeof ((d-&gt;m_lookahead_size &gt;= len_to_move) ? 1<br> : 0), __extension__ ({ if (d-&gt;m_lookahead_size &gt;= len_to_move<br>) ; else __assert_fail ("d-&gt;m_lookahead_size &gt;= len_to_move"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2598, __extension__ __PRETTY_FUNCTION__); }))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2599"><td class="num" id="LN2599">2599</td><td class="line">    d-&gt;m_lookahead_size -= len_to_move;</td></tr>
<tr class="codeline" data-linenumber="2600"><td class="num" id="LN2600">2600</td><td class="line">    d-&gt;m_dict_size = <span class='macro'>MZ_MIN(d-&gt;m_dict_size + len_to_move, TDEFL_LZ_DICT_SIZE)<span class='macro_popup'>(((d-&gt;m_dict_size + len_to_move)&lt;(TDEFL_LZ_DICT_SIZE))?<br>(d-&gt;m_dict_size + len_to_move):(TDEFL_LZ_DICT_SIZE))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2601"><td class="num" id="LN2601">2601</td><td class="line">    <span class='comment'>// Check if it's time to flush the current LZ codes to the internal output buffer.</span></td></tr>
<tr class="codeline" data-linenumber="2602"><td class="num" id="LN2602">2602</td><td class="line">    <span class='keyword'>if</span> ( (d-&gt;m_pLZ_code_buf &gt; &amp;d-&gt;m_lz_code_buf[TDEFL_LZ_CODE_BUF_SIZE - 8]) ||</td></tr>
<tr class="codeline" data-linenumber="2603"><td class="num" id="LN2603">2603</td><td class="line">         ( (d-&gt;m_total_lz_bytes &gt; 31*1024) &amp;&amp; (((((mz_uint)(d-&gt;m_pLZ_code_buf - d-&gt;m_lz_code_buf) * 115) &gt;&gt; 7) &gt;= d-&gt;m_total_lz_bytes) || (d-&gt;m_flags &amp; TDEFL_FORCE_ALL_RAW_BLOCKS))) )</td></tr>
<tr class="codeline" data-linenumber="2604"><td class="num" id="LN2604">2604</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2605"><td class="num" id="LN2605">2605</td><td class="line">      <span class='keyword'>int</span> n;</td></tr>
<tr class="codeline" data-linenumber="2606"><td class="num" id="LN2606">2606</td><td class="line">      d-&gt;m_pSrc = pSrc; d-&gt;m_src_buf_left = src_buf_left;</td></tr>
<tr class="codeline" data-linenumber="2607"><td class="num" id="LN2607">2607</td><td class="line">      <span class='keyword'>if</span> ((n = tdefl_flush_block(d, 0)) != 0)</td></tr>
<tr class="codeline" data-linenumber="2608"><td class="num" id="LN2608">2608</td><td class="line">        <span class='keyword'>return</span> (n &lt; 0) ? <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span> : <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2609"><td class="num" id="LN2609">2609</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2610"><td class="num" id="LN2610">2610</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2611"><td class="num" id="LN2611">2611</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2612"><td class="num" id="LN2612">2612</td><td class="line">  d-&gt;m_pSrc = pSrc; d-&gt;m_src_buf_left = src_buf_left;</td></tr>
<tr class="codeline" data-linenumber="2613"><td class="num" id="LN2613">2613</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2614"><td class="num" id="LN2614">2614</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2615"><td class="num" id="LN2615">2615</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2616"><td class="num" id="LN2616">2616</td><td class="line"><span class='keyword'>static</span> tdefl_status tdefl_flush_output_buffer(tdefl_compressor *d)</td></tr>
<tr class="codeline" data-linenumber="2617"><td class="num" id="LN2617">2617</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2618"><td class="num" id="LN2618">2618</td><td class="line">  <span class='keyword'>if</span> (d-&gt;m_pIn_buf_size)</td></tr>
<tr class="codeline" data-linenumber="2619"><td class="num" id="LN2619">2619</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2620"><td class="num" id="LN2620">2620</td><td class="line">    *d-&gt;m_pIn_buf_size = d-&gt;m_pSrc - (<span class='keyword'>const</span> mz_uint8 *)d-&gt;m_pIn_buf;</td></tr>
<tr class="codeline" data-linenumber="2621"><td class="num" id="LN2621">2621</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2622"><td class="num" id="LN2622">2622</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2623"><td class="num" id="LN2623">2623</td><td class="line">  <span class='keyword'>if</span> (d-&gt;m_pOut_buf_size)</td></tr>
<tr class="codeline" data-linenumber="2624"><td class="num" id="LN2624">2624</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2625"><td class="num" id="LN2625">2625</td><td class="line">    size_t n = <span class='macro'>MZ_MIN(*d-&gt;m_pOut_buf_size - d-&gt;m_out_buf_ofs, d-&gt;m_output_flush_remaining)<span class='macro_popup'>(((*d-&gt;m_pOut_buf_size - d-&gt;m_out_buf_ofs)&lt;(d-&gt;m_output_flush_remaining<br>))?(*d-&gt;m_pOut_buf_size - d-&gt;m_out_buf_ofs):(d-&gt;m_output_flush_remaining<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2626"><td class="num" id="LN2626">2626</td><td class="line">    memcpy((mz_uint8 *)d-&gt;m_pOut_buf + d-&gt;m_out_buf_ofs, d-&gt;m_output_buf + d-&gt;m_output_flush_ofs, n);</td></tr>
<tr class="codeline" data-linenumber="2627"><td class="num" id="LN2627">2627</td><td class="line">    d-&gt;m_output_flush_ofs += (mz_uint)n;</td></tr>
<tr class="codeline" data-linenumber="2628"><td class="num" id="LN2628">2628</td><td class="line">    d-&gt;m_output_flush_remaining -= (mz_uint)n;</td></tr>
<tr class="codeline" data-linenumber="2629"><td class="num" id="LN2629">2629</td><td class="line">    d-&gt;m_out_buf_ofs += n;</td></tr>
<tr class="codeline" data-linenumber="2630"><td class="num" id="LN2630">2630</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2631"><td class="num" id="LN2631">2631</td><td class="line">    *d-&gt;m_pOut_buf_size = d-&gt;m_out_buf_ofs;</td></tr>
<tr class="codeline" data-linenumber="2632"><td class="num" id="LN2632">2632</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2633"><td class="num" id="LN2633">2633</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2634"><td class="num" id="LN2634">2634</td><td class="line">  <span class='keyword'>return</span> (d-&gt;m_finished &amp;&amp; !d-&gt;m_output_flush_remaining) ? TDEFL_STATUS_DONE : TDEFL_STATUS_OKAY;</td></tr>
<tr class="codeline" data-linenumber="2635"><td class="num" id="LN2635">2635</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2636"><td class="num" id="LN2636">2636</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2637"><td class="num" id="LN2637">2637</td><td class="line">tdefl_status tdefl_compress(tdefl_compressor *d, <span class='keyword'>const</span> <span class='keyword'>void</span> *pIn_buf, size_t *pIn_buf_size, <span class='keyword'>void</span> *pOut_buf, size_t *pOut_buf_size, tdefl_flush flush)</td></tr>
<tr class="codeline" data-linenumber="2638"><td class="num" id="LN2638">2638</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2639"><td class="num" id="LN2639">2639</td><td class="line">  <span class='keyword'>if</span> (!d)</td></tr>
<tr class="codeline" data-linenumber="2640"><td class="num" id="LN2640">2640</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2641"><td class="num" id="LN2641">2641</td><td class="line">    <span class='keyword'>if</span> (pIn_buf_size) *pIn_buf_size = 0;</td></tr>
<tr class="codeline" data-linenumber="2642"><td class="num" id="LN2642">2642</td><td class="line">    <span class='keyword'>if</span> (pOut_buf_size) *pOut_buf_size = 0;</td></tr>
<tr class="codeline" data-linenumber="2643"><td class="num" id="LN2643">2643</td><td class="line">    <span class='keyword'>return</span> TDEFL_STATUS_BAD_PARAM;</td></tr>
<tr class="codeline" data-linenumber="2644"><td class="num" id="LN2644">2644</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2645"><td class="num" id="LN2645">2645</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2646"><td class="num" id="LN2646">2646</td><td class="line">  d-&gt;m_pIn_buf = pIn_buf; d-&gt;m_pIn_buf_size = pIn_buf_size;</td></tr>
<tr class="codeline" data-linenumber="2647"><td class="num" id="LN2647">2647</td><td class="line">  d-&gt;m_pOut_buf = pOut_buf; d-&gt;m_pOut_buf_size = pOut_buf_size;</td></tr>
<tr class="codeline" data-linenumber="2648"><td class="num" id="LN2648">2648</td><td class="line">  d-&gt;m_pSrc = (<span class='keyword'>const</span> mz_uint8 *)(pIn_buf); d-&gt;m_src_buf_left = pIn_buf_size ? *pIn_buf_size : 0;</td></tr>
<tr class="codeline" data-linenumber="2649"><td class="num" id="LN2649">2649</td><td class="line">  d-&gt;m_out_buf_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="2650"><td class="num" id="LN2650">2650</td><td class="line">  d-&gt;m_flush = flush;</td></tr>
<tr class="codeline" data-linenumber="2651"><td class="num" id="LN2651">2651</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2652"><td class="num" id="LN2652">2652</td><td class="line">  <span class='keyword'>if</span> ( ((d-&gt;m_pPut_buf_func != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) == ((pOut_buf != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) || (pOut_buf_size != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>))) || (d-&gt;m_prev_return_status != TDEFL_STATUS_OKAY) ||</td></tr>
<tr class="codeline" data-linenumber="2653"><td class="num" id="LN2653">2653</td><td class="line">        (d-&gt;m_wants_to_finish &amp;&amp; (flush != TDEFL_FINISH)) || (pIn_buf_size &amp;&amp; *pIn_buf_size &amp;&amp; !pIn_buf) || (pOut_buf_size &amp;&amp; *pOut_buf_size &amp;&amp; !pOut_buf) )</td></tr>
<tr class="codeline" data-linenumber="2654"><td class="num" id="LN2654">2654</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2655"><td class="num" id="LN2655">2655</td><td class="line">    <span class='keyword'>if</span> (pIn_buf_size) *pIn_buf_size = 0;</td></tr>
<tr class="codeline" data-linenumber="2656"><td class="num" id="LN2656">2656</td><td class="line">    <span class='keyword'>if</span> (pOut_buf_size) *pOut_buf_size = 0;</td></tr>
<tr class="codeline" data-linenumber="2657"><td class="num" id="LN2657">2657</td><td class="line">    <span class='keyword'>return</span> (d-&gt;m_prev_return_status = TDEFL_STATUS_BAD_PARAM);</td></tr>
<tr class="codeline" data-linenumber="2658"><td class="num" id="LN2658">2658</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2659"><td class="num" id="LN2659">2659</td><td class="line">  d-&gt;m_wants_to_finish |= (flush == TDEFL_FINISH);</td></tr>
<tr class="codeline" data-linenumber="2660"><td class="num" id="LN2660">2660</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2661"><td class="num" id="LN2661">2661</td><td class="line">  <span class='keyword'>if</span> ((d-&gt;m_output_flush_remaining) || (d-&gt;m_finished))</td></tr>
<tr class="codeline" data-linenumber="2662"><td class="num" id="LN2662">2662</td><td class="line">    <span class='keyword'>return</span> (d-&gt;m_prev_return_status = tdefl_flush_output_buffer(d));</td></tr>
<tr class="codeline" data-linenumber="2663"><td class="num" id="LN2663">2663</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2664"><td class="num" id="LN2664">2664</td><td class="line"><span class='directive'>#if <span class='macro'>MINIZ_USE_UNALIGNED_LOADS_AND_STORES<span class='macro_popup'>1</span></span> &amp;&amp; <span class='macro'>MINIZ_LITTLE_ENDIAN<span class='macro_popup'>1</span></span></span></td></tr>
<tr class="codeline" data-linenumber="2665"><td class="num" id="LN2665">2665</td><td class="line">  <span class='keyword'>if</span> (((d-&gt;m_flags &amp; TDEFL_MAX_PROBES_MASK) == 1) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2666"><td class="num" id="LN2666">2666</td><td class="line">      ((d-&gt;m_flags &amp; TDEFL_GREEDY_PARSING_FLAG) != 0) &amp;&amp;</td></tr>
<tr class="codeline" data-linenumber="2667"><td class="num" id="LN2667">2667</td><td class="line">      ((d-&gt;m_flags &amp; (TDEFL_FILTER_MATCHES | TDEFL_FORCE_ALL_RAW_BLOCKS | TDEFL_RLE_MATCHES)) == 0))</td></tr>
<tr class="codeline" data-linenumber="2668"><td class="num" id="LN2668">2668</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2669"><td class="num" id="LN2669">2669</td><td class="line">    <span class='keyword'>if</span> (!tdefl_compress_fast(d))</td></tr>
<tr class="codeline" data-linenumber="2670"><td class="num" id="LN2670">2670</td><td class="line">      <span class='keyword'>return</span> d-&gt;m_prev_return_status;</td></tr>
<tr class="codeline" data-linenumber="2671"><td class="num" id="LN2671">2671</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2672"><td class="num" id="LN2672">2672</td><td class="line">  <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="2673"><td class="num" id="LN2673">2673</td><td class="line"><span class='directive'>#endif // #if MINIZ_USE_UNALIGNED_LOADS_AND_STORES &amp;&amp; MINIZ_LITTLE_ENDIAN</span></td></tr>
<tr class="codeline" data-linenumber="2674"><td class="num" id="LN2674">2674</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2675"><td class="num" id="LN2675">2675</td><td class="line">    <span class='keyword'>if</span> (!tdefl_compress_normal(d))</td></tr>
<tr class="codeline" data-linenumber="2676"><td class="num" id="LN2676">2676</td><td class="line">      <span class='keyword'>return</span> d-&gt;m_prev_return_status;</td></tr>
<tr class="codeline" data-linenumber="2677"><td class="num" id="LN2677">2677</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2678"><td class="num" id="LN2678">2678</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2679"><td class="num" id="LN2679">2679</td><td class="line">  <span class='keyword'>if</span> ((d-&gt;m_flags &amp; (TDEFL_WRITE_ZLIB_HEADER | TDEFL_COMPUTE_ADLER32)) &amp;&amp; (pIn_buf))</td></tr>
<tr class="codeline" data-linenumber="2680"><td class="num" id="LN2680">2680</td><td class="line">    d-&gt;m_adler32 = (mz_uint32)mz_adler32(d-&gt;m_adler32, (<span class='keyword'>const</span> mz_uint8 *)pIn_buf, d-&gt;m_pSrc - (<span class='keyword'>const</span> mz_uint8 *)pIn_buf);</td></tr>
<tr class="codeline" data-linenumber="2681"><td class="num" id="LN2681">2681</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2682"><td class="num" id="LN2682">2682</td><td class="line">  <span class='keyword'>if</span> ((flush) &amp;&amp; (!d-&gt;m_lookahead_size) &amp;&amp; (!d-&gt;m_src_buf_left) &amp;&amp; (!d-&gt;m_output_flush_remaining))</td></tr>
<tr class="codeline" data-linenumber="2683"><td class="num" id="LN2683">2683</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2684"><td class="num" id="LN2684">2684</td><td class="line">    <span class='keyword'>if</span> (tdefl_flush_block(d, flush) &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="2685"><td class="num" id="LN2685">2685</td><td class="line">      <span class='keyword'>return</span> d-&gt;m_prev_return_status;</td></tr>
<tr class="codeline" data-linenumber="2686"><td class="num" id="LN2686">2686</td><td class="line">    d-&gt;m_finished = (flush == TDEFL_FINISH);</td></tr>
<tr class="codeline" data-linenumber="2687"><td class="num" id="LN2687">2687</td><td class="line">    <span class='keyword'>if</span> (flush == TDEFL_FULL_FLUSH) { <span class='macro'>MZ_CLEAR_OBJ(d-&gt;m_hash)<span class='macro_popup'>memset(&amp;(d-&gt;m_hash), 0, sizeof(d-&gt;m_hash))</span></span>; <span class='macro'>MZ_CLEAR_OBJ(d-&gt;m_next)<span class='macro_popup'>memset(&amp;(d-&gt;m_next), 0, sizeof(d-&gt;m_next))</span></span>; d-&gt;m_dict_size = 0; }</td></tr>
<tr class="codeline" data-linenumber="2688"><td class="num" id="LN2688">2688</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2689"><td class="num" id="LN2689">2689</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2690"><td class="num" id="LN2690">2690</td><td class="line">  <span class='keyword'>return</span> (d-&gt;m_prev_return_status = tdefl_flush_output_buffer(d));</td></tr>
<tr class="codeline" data-linenumber="2691"><td class="num" id="LN2691">2691</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2692"><td class="num" id="LN2692">2692</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2693"><td class="num" id="LN2693">2693</td><td class="line">tdefl_status tdefl_compress_buffer(tdefl_compressor *d, <span class='keyword'>const</span> <span class='keyword'>void</span> *pIn_buf, size_t in_buf_size, tdefl_flush flush)</td></tr>
<tr class="codeline" data-linenumber="2694"><td class="num" id="LN2694">2694</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2695"><td class="num" id="LN2695">2695</td><td class="line">  <span class='macro'>MZ_ASSERT(d-&gt;m_pPut_buf_func)<span class='macro_popup'>((void) sizeof ((d-&gt;m_pPut_buf_func) ? 1 : 0), __extension__<br> ({ if (d-&gt;m_pPut_buf_func) ; else __assert_fail ("d-&gt;m_pPut_buf_func"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 2695, __extension__ __PRETTY_FUNCTION__); }))</span></span>; <span class='keyword'>return</span> tdefl_compress(d, pIn_buf, &amp;in_buf_size, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, flush);</td></tr>
<tr class="codeline" data-linenumber="2696"><td class="num" id="LN2696">2696</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2697"><td class="num" id="LN2697">2697</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2698"><td class="num" id="LN2698">2698</td><td class="line">tdefl_status tdefl_init(tdefl_compressor *d, tdefl_put_buf_func_ptr pPut_buf_func, <span class='keyword'>void</span> *pPut_buf_user, <span class='keyword'>int</span> flags)</td></tr>
<tr class="codeline" data-linenumber="2699"><td class="num" id="LN2699">2699</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2700"><td class="num" id="LN2700">2700</td><td class="line">  d-&gt;m_pPut_buf_func = pPut_buf_func; d-&gt;m_pPut_buf_user = pPut_buf_user;</td></tr>
<tr class="codeline" data-linenumber="2701"><td class="num" id="LN2701">2701</td><td class="line">  d-&gt;m_flags = (mz_uint)(flags); d-&gt;m_max_probes[0] = 1 + ((flags &amp; 0xFFF) + 2) / 3; d-&gt;m_greedy_parsing = (flags &amp; TDEFL_GREEDY_PARSING_FLAG) != 0;</td></tr>
<tr class="codeline" data-linenumber="2702"><td class="num" id="LN2702">2702</td><td class="line">  d-&gt;m_max_probes[1] = 1 + (((flags &amp; 0xFFF) &gt;&gt; 2) + 2) / 3;</td></tr>
<tr class="codeline" data-linenumber="2703"><td class="num" id="LN2703">2703</td><td class="line">  <span class='keyword'>if</span> (!(flags &amp; TDEFL_NONDETERMINISTIC_PARSING_FLAG)) <span class='macro'>MZ_CLEAR_OBJ(d-&gt;m_hash)<span class='macro_popup'>memset(&amp;(d-&gt;m_hash), 0, sizeof(d-&gt;m_hash))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2704"><td class="num" id="LN2704">2704</td><td class="line">  d-&gt;m_lookahead_pos = d-&gt;m_lookahead_size = d-&gt;m_dict_size = d-&gt;m_total_lz_bytes = d-&gt;m_lz_code_buf_dict_pos = d-&gt;m_bits_in = 0;</td></tr>
<tr class="codeline" data-linenumber="2705"><td class="num" id="LN2705">2705</td><td class="line">  d-&gt;m_output_flush_ofs = d-&gt;m_output_flush_remaining = d-&gt;m_finished = d-&gt;m_block_index = d-&gt;m_bit_buffer = d-&gt;m_wants_to_finish = 0;</td></tr>
<tr class="codeline" data-linenumber="2706"><td class="num" id="LN2706">2706</td><td class="line">  d-&gt;m_pLZ_code_buf = d-&gt;m_lz_code_buf + 1; d-&gt;m_pLZ_flags = d-&gt;m_lz_code_buf; d-&gt;m_num_flags_left = 8;</td></tr>
<tr class="codeline" data-linenumber="2707"><td class="num" id="LN2707">2707</td><td class="line">  d-&gt;m_pOutput_buf = d-&gt;m_output_buf; d-&gt;m_pOutput_buf_end = d-&gt;m_output_buf; d-&gt;m_prev_return_status = TDEFL_STATUS_OKAY;</td></tr>
<tr class="codeline" data-linenumber="2708"><td class="num" id="LN2708">2708</td><td class="line">  d-&gt;m_saved_match_dist = d-&gt;m_saved_match_len = d-&gt;m_saved_lit = 0; d-&gt;m_adler32 = 1;</td></tr>
<tr class="codeline" data-linenumber="2709"><td class="num" id="LN2709">2709</td><td class="line">  d-&gt;m_pIn_buf = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; d-&gt;m_pOut_buf = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2710"><td class="num" id="LN2710">2710</td><td class="line">  d-&gt;m_pIn_buf_size = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; d-&gt;m_pOut_buf_size = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2711"><td class="num" id="LN2711">2711</td><td class="line">  d-&gt;m_flush = TDEFL_NO_FLUSH; d-&gt;m_pSrc = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; d-&gt;m_src_buf_left = 0; d-&gt;m_out_buf_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="2712"><td class="num" id="LN2712">2712</td><td class="line">  memset(&amp;d-&gt;m_huff_count[0][0], 0, <span class='keyword'>sizeof</span>(d-&gt;m_huff_count[0][0]) * TDEFL_MAX_HUFF_SYMBOLS_0);</td></tr>
<tr class="codeline" data-linenumber="2713"><td class="num" id="LN2713">2713</td><td class="line">  memset(&amp;d-&gt;m_huff_count[1][0], 0, <span class='keyword'>sizeof</span>(d-&gt;m_huff_count[1][0]) * TDEFL_MAX_HUFF_SYMBOLS_1);</td></tr>
<tr class="codeline" data-linenumber="2714"><td class="num" id="LN2714">2714</td><td class="line">  <span class='keyword'>return</span> TDEFL_STATUS_OKAY;</td></tr>
<tr class="codeline" data-linenumber="2715"><td class="num" id="LN2715">2715</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2716"><td class="num" id="LN2716">2716</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2717"><td class="num" id="LN2717">2717</td><td class="line">tdefl_status tdefl_get_prev_return_status(tdefl_compressor *d)</td></tr>
<tr class="codeline" data-linenumber="2718"><td class="num" id="LN2718">2718</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2719"><td class="num" id="LN2719">2719</td><td class="line">  <span class='keyword'>return</span> d-&gt;m_prev_return_status;</td></tr>
<tr class="codeline" data-linenumber="2720"><td class="num" id="LN2720">2720</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2721"><td class="num" id="LN2721">2721</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2722"><td class="num" id="LN2722">2722</td><td class="line">mz_uint32 tdefl_get_adler32(tdefl_compressor *d)</td></tr>
<tr class="codeline" data-linenumber="2723"><td class="num" id="LN2723">2723</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2724"><td class="num" id="LN2724">2724</td><td class="line">  <span class='keyword'>return</span> d-&gt;m_adler32;</td></tr>
<tr class="codeline" data-linenumber="2725"><td class="num" id="LN2725">2725</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2726"><td class="num" id="LN2726">2726</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2727"><td class="num" id="LN2727">2727</td><td class="line">mz_bool tdefl_compress_mem_to_output(<span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t buf_len, tdefl_put_buf_func_ptr pPut_buf_func, <span class='keyword'>void</span> *pPut_buf_user, <span class='keyword'>int</span> flags)</td></tr>
<tr class="codeline" data-linenumber="2728"><td class="num" id="LN2728">2728</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2729"><td class="num" id="LN2729">2729</td><td class="line">  tdefl_compressor *pComp; mz_bool succeeded; <span class='keyword'>if</span> (((buf_len) &amp;&amp; (!pBuf)) || (!pPut_buf_func)) <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2730"><td class="num" id="LN2730">2730</td><td class="line">  pComp = (tdefl_compressor*)<span class='macro'>MZ_MALLOC(<span class='keyword'>sizeof</span>(tdefl_compressor))<span class='macro_popup'>malloc(sizeof(tdefl_compressor))</span></span>; <span class='keyword'>if</span> (!pComp) <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2731"><td class="num" id="LN2731">2731</td><td class="line">  succeeded = (tdefl_init(pComp, pPut_buf_func, pPut_buf_user, flags) == TDEFL_STATUS_OKAY);</td></tr>
<tr class="codeline" data-linenumber="2732"><td class="num" id="LN2732">2732</td><td class="line">  succeeded = succeeded &amp;&amp; (tdefl_compress_buffer(pComp, pBuf, buf_len, TDEFL_FINISH) == TDEFL_STATUS_DONE);</td></tr>
<tr class="codeline" data-linenumber="2733"><td class="num" id="LN2733">2733</td><td class="line">  <span class='macro'>MZ_FREE(pComp)<span class='macro_popup'>free(pComp)</span></span>; <span class='keyword'>return</span> succeeded;</td></tr>
<tr class="codeline" data-linenumber="2734"><td class="num" id="LN2734">2734</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2735"><td class="num" id="LN2735">2735</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2736"><td class="num" id="LN2736">2736</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="2737"><td class="num" id="LN2737">2737</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2738"><td class="num" id="LN2738">2738</td><td class="line">  size_t m_size, m_capacity;</td></tr>
<tr class="codeline" data-linenumber="2739"><td class="num" id="LN2739">2739</td><td class="line">  mz_uint8 *m_pBuf;</td></tr>
<tr class="codeline" data-linenumber="2740"><td class="num" id="LN2740">2740</td><td class="line">  mz_bool m_expandable;</td></tr>
<tr class="codeline" data-linenumber="2741"><td class="num" id="LN2741">2741</td><td class="line">} tdefl_output_buffer;</td></tr>
<tr class="codeline" data-linenumber="2742"><td class="num" id="LN2742">2742</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2743"><td class="num" id="LN2743">2743</td><td class="line"><span class='keyword'>static</span> mz_bool tdefl_output_buffer_putter(<span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, <span class='keyword'>int</span> len, <span class='keyword'>void</span> *pUser)</td></tr>
<tr class="codeline" data-linenumber="2744"><td class="num" id="LN2744">2744</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2745"><td class="num" id="LN2745">2745</td><td class="line">  tdefl_output_buffer *p = (tdefl_output_buffer *)pUser;</td></tr>
<tr class="codeline" data-linenumber="2746"><td class="num" id="LN2746">2746</td><td class="line">  size_t new_size = p-&gt;m_size + len;</td></tr>
<tr class="codeline" data-linenumber="2747"><td class="num" id="LN2747">2747</td><td class="line">  <span class='keyword'>if</span> (new_size &gt; p-&gt;m_capacity)</td></tr>
<tr class="codeline" data-linenumber="2748"><td class="num" id="LN2748">2748</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2749"><td class="num" id="LN2749">2749</td><td class="line">    size_t new_capacity = p-&gt;m_capacity; mz_uint8 *pNew_buf; <span class='keyword'>if</span> (!p-&gt;m_expandable) <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2750"><td class="num" id="LN2750">2750</td><td class="line">    <span class='keyword'>do</span> { new_capacity = <span class='macro'>MZ_MAX(128U, new_capacity &lt;&lt; 1U)<span class='macro_popup'>(((128U)&gt;(new_capacity &lt;&lt; 1U))?(128U):(new_capacity &lt;&lt;<br> 1U))</span></span>; } <span class='keyword'>while</span> (new_size &gt; new_capacity);</td></tr>
<tr class="codeline" data-linenumber="2751"><td class="num" id="LN2751">2751</td><td class="line">    pNew_buf = (mz_uint8*)<span class='macro'>MZ_REALLOC(p-&gt;m_pBuf, new_capacity)<span class='macro_popup'>realloc(p-&gt;m_pBuf, new_capacity)</span></span>; <span class='keyword'>if</span> (!pNew_buf) <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2752"><td class="num" id="LN2752">2752</td><td class="line">    p-&gt;m_pBuf = pNew_buf; p-&gt;m_capacity = new_capacity;</td></tr>
<tr class="codeline" data-linenumber="2753"><td class="num" id="LN2753">2753</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2754"><td class="num" id="LN2754">2754</td><td class="line">  memcpy((mz_uint8*)p-&gt;m_pBuf + p-&gt;m_size, pBuf, len); p-&gt;m_size = new_size;</td></tr>
<tr class="codeline" data-linenumber="2755"><td class="num" id="LN2755">2755</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2756"><td class="num" id="LN2756">2756</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2757"><td class="num" id="LN2757">2757</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2758"><td class="num" id="LN2758">2758</td><td class="line"><span class='keyword'>void</span> *tdefl_compress_mem_to_heap(<span class='keyword'>const</span> <span class='keyword'>void</span> *pSrc_buf, size_t src_buf_len, size_t *pOut_len, <span class='keyword'>int</span> flags)</td></tr>
<tr class="codeline" data-linenumber="2759"><td class="num" id="LN2759">2759</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2760"><td class="num" id="LN2760">2760</td><td class="line">  tdefl_output_buffer out_buf; <span class='macro'>MZ_CLEAR_OBJ(out_buf)<span class='macro_popup'>memset(&amp;(out_buf), 0, sizeof(out_buf))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2761"><td class="num" id="LN2761">2761</td><td class="line">  <span class='keyword'>if</span> (!pOut_len) <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>; <span class='keyword'>else</span> *pOut_len = 0;</td></tr>
<tr class="codeline" data-linenumber="2762"><td class="num" id="LN2762">2762</td><td class="line">  out_buf.m_expandable = <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2763"><td class="num" id="LN2763">2763</td><td class="line">  <span class='keyword'>if</span> (!tdefl_compress_mem_to_output(pSrc_buf, src_buf_len, tdefl_output_buffer_putter, &amp;out_buf, flags)) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2764"><td class="num" id="LN2764">2764</td><td class="line">  *pOut_len = out_buf.m_size; <span class='keyword'>return</span> out_buf.m_pBuf;</td></tr>
<tr class="codeline" data-linenumber="2765"><td class="num" id="LN2765">2765</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2766"><td class="num" id="LN2766">2766</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2767"><td class="num" id="LN2767">2767</td><td class="line">size_t tdefl_compress_mem_to_mem(<span class='keyword'>void</span> *pOut_buf, size_t out_buf_len, <span class='keyword'>const</span> <span class='keyword'>void</span> *pSrc_buf, size_t src_buf_len, <span class='keyword'>int</span> flags)</td></tr>
<tr class="codeline" data-linenumber="2768"><td class="num" id="LN2768">2768</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2769"><td class="num" id="LN2769">2769</td><td class="line">  tdefl_output_buffer out_buf; <span class='macro'>MZ_CLEAR_OBJ(out_buf)<span class='macro_popup'>memset(&amp;(out_buf), 0, sizeof(out_buf))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2770"><td class="num" id="LN2770">2770</td><td class="line">  <span class='keyword'>if</span> (!pOut_buf) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2771"><td class="num" id="LN2771">2771</td><td class="line">  out_buf.m_pBuf = (mz_uint8*)pOut_buf; out_buf.m_capacity = out_buf_len;</td></tr>
<tr class="codeline" data-linenumber="2772"><td class="num" id="LN2772">2772</td><td class="line">  <span class='keyword'>if</span> (!tdefl_compress_mem_to_output(pSrc_buf, src_buf_len, tdefl_output_buffer_putter, &amp;out_buf, flags)) <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="2773"><td class="num" id="LN2773">2773</td><td class="line">  <span class='keyword'>return</span> out_buf.m_size;</td></tr>
<tr class="codeline" data-linenumber="2774"><td class="num" id="LN2774">2774</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2775"><td class="num" id="LN2775">2775</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2776"><td class="num" id="LN2776">2776</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_ZLIB_APIS</span></td></tr>
<tr class="codeline" data-linenumber="2777"><td class="num" id="LN2777">2777</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint s_tdefl_num_probes[11] = { 0, 1, 6, 32,  16, 32, 128, 256,  512, 768, 1500 };</td></tr>
<tr class="codeline" data-linenumber="2778"><td class="num" id="LN2778">2778</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2779"><td class="num" id="LN2779">2779</td><td class="line"><span class='comment'>// level may actually range from [0,10] (10 is a "hidden" max level, where we want a bit more compression and it's fine if throughput to fall off a cliff on some files).</span></td></tr>
<tr class="codeline" data-linenumber="2780"><td class="num" id="LN2780">2780</td><td class="line">mz_uint tdefl_create_comp_flags_from_zip_params(<span class='keyword'>int</span> level, <span class='keyword'>int</span> window_bits, <span class='keyword'>int</span> strategy)</td></tr>
<tr class="codeline" data-linenumber="2781"><td class="num" id="LN2781">2781</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2782"><td class="num" id="LN2782">2782</td><td class="line">  mz_uint comp_flags = s_tdefl_num_probes[(level &gt;= 0) ? <span class='macro'>MZ_MIN(10, level)<span class='macro_popup'>(((10)&lt;(level))?(10):(level))</span></span> : MZ_DEFAULT_LEVEL] | ((level &lt;= 3) ? TDEFL_GREEDY_PARSING_FLAG : 0);</td></tr>
<tr class="codeline" data-linenumber="2783"><td class="num" id="LN2783">2783</td><td class="line">  <span class='keyword'>if</span> (window_bits &gt; 0) comp_flags |= TDEFL_WRITE_ZLIB_HEADER;</td></tr>
<tr class="codeline" data-linenumber="2784"><td class="num" id="LN2784">2784</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2785"><td class="num" id="LN2785">2785</td><td class="line">  <span class='keyword'>if</span> (!level) comp_flags |= TDEFL_FORCE_ALL_RAW_BLOCKS;</td></tr>
<tr class="codeline" data-linenumber="2786"><td class="num" id="LN2786">2786</td><td class="line">  <span class='keyword'>else</span> <span class='keyword'>if</span> (strategy == MZ_FILTERED) comp_flags |= TDEFL_FILTER_MATCHES;</td></tr>
<tr class="codeline" data-linenumber="2787"><td class="num" id="LN2787">2787</td><td class="line">  <span class='keyword'>else</span> <span class='keyword'>if</span> (strategy == MZ_HUFFMAN_ONLY) comp_flags &amp;= ~TDEFL_MAX_PROBES_MASK;</td></tr>
<tr class="codeline" data-linenumber="2788"><td class="num" id="LN2788">2788</td><td class="line">  <span class='keyword'>else</span> <span class='keyword'>if</span> (strategy == MZ_FIXED) comp_flags |= TDEFL_FORCE_ALL_STATIC_BLOCKS;</td></tr>
<tr class="codeline" data-linenumber="2789"><td class="num" id="LN2789">2789</td><td class="line">  <span class='keyword'>else</span> <span class='keyword'>if</span> (strategy == MZ_RLE) comp_flags |= TDEFL_RLE_MATCHES;</td></tr>
<tr class="codeline" data-linenumber="2790"><td class="num" id="LN2790">2790</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2791"><td class="num" id="LN2791">2791</td><td class="line">  <span class='keyword'>return</span> comp_flags;</td></tr>
<tr class="codeline" data-linenumber="2792"><td class="num" id="LN2792">2792</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2793"><td class="num" id="LN2793">2793</td><td class="line"><span class='directive'>#endif //MINIZ_NO_ZLIB_APIS</span></td></tr>
<tr class="codeline" data-linenumber="2794"><td class="num" id="LN2794">2794</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2795"><td class="num" id="LN2795">2795</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="2796"><td class="num" id="LN2796">2796</td><td class="line"><span class='directive'>#pragma warning (push)</span></td></tr>
<tr class="codeline" data-linenumber="2797"><td class="num" id="LN2797">2797</td><td class="line"><span class='directive'>#pragma warning (disable:4204) // nonstandard extension used : non-constant aggregate initializer (also supported by GNU C and C99, so no big deal)</span></td></tr>
<tr class="codeline" data-linenumber="2798"><td class="num" id="LN2798">2798</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2799"><td class="num" id="LN2799">2799</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2800"><td class="num" id="LN2800">2800</td><td class="line"><span class='comment'>// Simple PNG writer function by Alex Evans, 2011. Released into the public domain: https://gist.github.com/908299, more context at</span></td></tr>
<tr class="codeline" data-linenumber="2801"><td class="num" id="LN2801">2801</td><td class="line"><span class='comment'>// http://altdevblogaday.org/2011/04/06/a-smaller-jpg-encoder/.</span></td></tr>
<tr class="codeline" data-linenumber="2802"><td class="num" id="LN2802">2802</td><td class="line"><span class='comment'>// This is actually a modification of Alex's original code so PNG files generated by this function pass pngcheck.</span></td></tr>
<tr class="codeline" data-linenumber="2803"><td class="num" id="LN2803">2803</td><td class="line"><span class='keyword'>void</span> *tdefl_write_image_to_png_file_in_memory_ex(<span class='keyword'>const</span> <span class='keyword'>void</span> *pImage, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> num_chans, size_t *pLen_out, mz_uint level, mz_bool flip)</td></tr>
<tr class="codeline" data-linenumber="2804"><td class="num" id="LN2804">2804</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2805"><td class="num" id="LN2805">2805</td><td class="line">  <span class='comment'>// Using a local copy of this array here in case MINIZ_NO_ZLIB_APIS was defined.</span></td></tr>
<tr class="codeline" data-linenumber="2806"><td class="num" id="LN2806">2806</td><td class="line">  <span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint s_tdefl_png_num_probes[11] = { 0, 1, 6, 32,  16, 32, 128, 256,  512, 768, 1500 };</td></tr>
<tr class="codeline" data-linenumber="2807"><td class="num" id="LN2807">2807</td><td class="line">  tdefl_compressor *pComp = (tdefl_compressor *)<span class='macro'>MZ_MALLOC(<span class='keyword'>sizeof</span>(tdefl_compressor))<span class='macro_popup'>malloc(sizeof(tdefl_compressor))</span></span>; tdefl_output_buffer out_buf; <span class='keyword'>int</span> i, bpl = w * num_chans, y, z; mz_uint32 c; *pLen_out = 0;</td></tr>
<tr class="codeline" data-linenumber="2808"><td class="num" id="LN2808">2808</td><td class="line">  <span class='keyword'>if</span> (!pComp) <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2809"><td class="num" id="LN2809">2809</td><td class="line">  <span class='macro'>MZ_CLEAR_OBJ(out_buf)<span class='macro_popup'>memset(&amp;(out_buf), 0, sizeof(out_buf))</span></span>; out_buf.m_expandable = <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>; out_buf.m_capacity = 57+<span class='macro'>MZ_MAX(64, (1+bpl)*h)<span class='macro_popup'>(((64)&gt;((1+bpl)*h))?(64):((1+bpl)*h))</span></span>; <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (out_buf.m_pBuf = (mz_uint8*)<span class='macro'>MZ_MALLOC(out_buf.m_capacity)<span class='macro_popup'>malloc(out_buf.m_capacity)</span></span>)) { <span class='macro'>MZ_FREE(pComp)<span class='macro_popup'>free(pComp)</span></span>; <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="2810"><td class="num" id="LN2810">2810</td><td class="line">  <span class='comment'>// write dummy header</span></td></tr>
<tr class="codeline" data-linenumber="2811"><td class="num" id="LN2811">2811</td><td class="line">  <span class='keyword'>for</span> (z = 41; z; --z) tdefl_output_buffer_putter(&amp;z, 1, &amp;out_buf);</td></tr>
<tr class="codeline" data-linenumber="2812"><td class="num" id="LN2812">2812</td><td class="line">  <span class='comment'>// compress image data</span></td></tr>
<tr class="codeline" data-linenumber="2813"><td class="num" id="LN2813">2813</td><td class="line">  tdefl_init(pComp, tdefl_output_buffer_putter, &amp;out_buf, s_tdefl_png_num_probes[<span class='macro'>MZ_MIN(10, level)<span class='macro_popup'>(((10)&lt;(level))?(10):(level))</span></span>] | TDEFL_WRITE_ZLIB_HEADER);</td></tr>
<tr class="codeline" data-linenumber="2814"><td class="num" id="LN2814">2814</td><td class="line">  <span class='keyword'>for</span> (y = 0; y &lt; h; ++y) { tdefl_compress_buffer(pComp, &amp;z, 1, TDEFL_NO_FLUSH); tdefl_compress_buffer(pComp, (mz_uint8*)pImage + (flip ? (h - 1 - y) : y) * bpl, bpl, TDEFL_NO_FLUSH); }</td></tr>
<tr class="codeline" data-linenumber="2815"><td class="num" id="LN2815">2815</td><td class="line">  <span class='keyword'>if</span> (tdefl_compress_buffer(pComp, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0, TDEFL_FINISH) != TDEFL_STATUS_DONE) { <span class='macro'>MZ_FREE(pComp)<span class='macro_popup'>free(pComp)</span></span>; <span class='macro'>MZ_FREE(out_buf.m_pBuf)<span class='macro_popup'>free(out_buf.m_pBuf)</span></span>; <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="2816"><td class="num" id="LN2816">2816</td><td class="line">  <span class='comment'>// write real header</span></td></tr>
<tr class="codeline" data-linenumber="2817"><td class="num" id="LN2817">2817</td><td class="line">  *pLen_out = out_buf.m_size-41;</td></tr>
<tr class="codeline" data-linenumber="2818"><td class="num" id="LN2818">2818</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="2819"><td class="num" id="LN2819">2819</td><td class="line">    <span class='keyword'>static</span> <span class='keyword'>const</span> mz_uint8 chans[] = {0x00, 0x00, 0x04, 0x02, 0x06};</td></tr>
<tr class="codeline" data-linenumber="2820"><td class="num" id="LN2820">2820</td><td class="line">    mz_uint8 pnghdr[41]={0x89,0x50,0x4e,0x47,0x0d,0x0a,0x1a,0x0a,0x00,0x00,0x00,0x0d,0x49,0x48,0x44,0x52,</td></tr>
<tr class="codeline" data-linenumber="2821"><td class="num" id="LN2821">2821</td><td class="line">      0,0,(mz_uint8)(w&gt;&gt;8),(mz_uint8)w,0,0,(mz_uint8)(h&gt;&gt;8),(mz_uint8)h,8,chans[num_chans],0,0,0,0,0,0,0,</td></tr>
<tr class="codeline" data-linenumber="2822"><td class="num" id="LN2822">2822</td><td class="line">      (mz_uint8)(*pLen_out&gt;&gt;24),(mz_uint8)(*pLen_out&gt;&gt;16),(mz_uint8)(*pLen_out&gt;&gt;8),(mz_uint8)*pLen_out,0x49,0x44,0x41,0x54};</td></tr>
<tr class="codeline" data-linenumber="2823"><td class="num" id="LN2823">2823</td><td class="line">    c=(mz_uint32)mz_crc32(<span class='macro'>MZ_CRC32_INIT<span class='macro_popup'>(0)</span></span>,pnghdr+12,17); <span class='keyword'>for</span> (i=0; i&lt;4; ++i, c&lt;&lt;=8) ((mz_uint8*)(pnghdr+29))[i]=(mz_uint8)(c&gt;&gt;24);</td></tr>
<tr class="codeline" data-linenumber="2824"><td class="num" id="LN2824">2824</td><td class="line">    memcpy(out_buf.m_pBuf, pnghdr, 41);</td></tr>
<tr class="codeline" data-linenumber="2825"><td class="num" id="LN2825">2825</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="2826"><td class="num" id="LN2826">2826</td><td class="line">  <span class='comment'>// write footer (IDAT CRC-32, followed by IEND chunk)</span></td></tr>
<tr class="codeline" data-linenumber="2827"><td class="num" id="LN2827">2827</td><td class="line">  <span class='keyword'>if</span> (!tdefl_output_buffer_putter(<span class='string_literal'>"\0\0\0\0\0\0\0\0\x49\x45\x4e\x44\xae\x42\x60\x82"</span>, 16, &amp;out_buf)) { *pLen_out = 0; <span class='macro'>MZ_FREE(pComp)<span class='macro_popup'>free(pComp)</span></span>; <span class='macro'>MZ_FREE(out_buf.m_pBuf)<span class='macro_popup'>free(out_buf.m_pBuf)</span></span>; <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="2828"><td class="num" id="LN2828">2828</td><td class="line">  c = (mz_uint32)mz_crc32(<span class='macro'>MZ_CRC32_INIT<span class='macro_popup'>(0)</span></span>,out_buf.m_pBuf+41-4, *pLen_out+4); <span class='keyword'>for</span> (i=0; i&lt;4; ++i, c&lt;&lt;=8) (out_buf.m_pBuf+out_buf.m_size-16)[i] = (mz_uint8)(c &gt;&gt; 24);</td></tr>
<tr class="codeline" data-linenumber="2829"><td class="num" id="LN2829">2829</td><td class="line">  <span class='comment'>// compute final size of file, grab compressed data buffer and return</span></td></tr>
<tr class="codeline" data-linenumber="2830"><td class="num" id="LN2830">2830</td><td class="line">  *pLen_out += 57; <span class='macro'>MZ_FREE(pComp)<span class='macro_popup'>free(pComp)</span></span>; <span class='keyword'>return</span> out_buf.m_pBuf;</td></tr>
<tr class="codeline" data-linenumber="2831"><td class="num" id="LN2831">2831</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2832"><td class="num" id="LN2832">2832</td><td class="line"><span class='keyword'>void</span> *tdefl_write_image_to_png_file_in_memory(<span class='keyword'>const</span> <span class='keyword'>void</span> *pImage, <span class='keyword'>int</span> w, <span class='keyword'>int</span> h, <span class='keyword'>int</span> num_chans, size_t *pLen_out)</td></tr>
<tr class="codeline" data-linenumber="2833"><td class="num" id="LN2833">2833</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2834"><td class="num" id="LN2834">2834</td><td class="line">  <span class='comment'>// Level 6 corresponds to TDEFL_DEFAULT_MAX_PROBES or MZ_DEFAULT_LEVEL (but we can't depend on MZ_DEFAULT_LEVEL being available in case the zlib API's where #defined out)</span></td></tr>
<tr class="codeline" data-linenumber="2835"><td class="num" id="LN2835">2835</td><td class="line">  <span class='keyword'>return</span> tdefl_write_image_to_png_file_in_memory_ex(pImage, w, h, num_chans, pLen_out, 6, <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="2836"><td class="num" id="LN2836">2836</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="2837"><td class="num" id="LN2837">2837</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2838"><td class="num" id="LN2838">2838</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="2839"><td class="num" id="LN2839">2839</td><td class="line"><span class='directive'>#pragma warning (pop)</span></td></tr>
<tr class="codeline" data-linenumber="2840"><td class="num" id="LN2840">2840</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2841"><td class="num" id="LN2841">2841</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2842"><td class="num" id="LN2842">2842</td><td class="line"><span class='comment'>// ------------------- .ZIP archive reading</span></td></tr>
<tr class="codeline" data-linenumber="2843"><td class="num" id="LN2843">2843</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2844"><td class="num" id="LN2844">2844</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_ARCHIVE_APIS</span></td></tr>
<tr class="codeline" data-linenumber="2845"><td class="num" id="LN2845">2845</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2846"><td class="num" id="LN2846">2846</td><td class="line"><span class='directive'>#ifdef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="2847"><td class="num" id="LN2847">2847</td><td class="line">  <span class='directive'>#define <span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span> void *</span></td></tr>
<tr class="codeline" data-linenumber="2848"><td class="num" id="LN2848">2848</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2849"><td class="num" id="LN2849">2849</td><td class="line">  <span class='directive'>#include &lt;stdio.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="2850"><td class="num" id="LN2850">2850</td><td class="line">  <span class='directive'>#include &lt;sys/stat.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="2851"><td class="num" id="LN2851">2851</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2852"><td class="num" id="LN2852">2852</td><td class="line">  <span class='directive'>#if defined(_MSC_VER) || defined(__MINGW64__)</span></td></tr>
<tr class="codeline" data-linenumber="2853"><td class="num" id="LN2853">2853</td><td class="line">    <span class='directive'>#include &lt;Windows.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="2854"><td class="num" id="LN2854">2854</td><td class="line">    <span class='directive'>#include &lt;stringapiset.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="2855"><td class="num" id="LN2855">2855</td><td class="line">    <span class='directive'>#include &lt;wchar.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="2856"><td class="num" id="LN2856">2856</td><td class="line">    </td></tr>
<tr class="codeline" data-linenumber="2857"><td class="num" id="LN2857">2857</td><td class="line">    <span class='comment'>// return NULL if inStr is NULL or if the conversion failed</span></td></tr>
<tr class="codeline" data-linenumber="2858"><td class="num" id="LN2858">2858</td><td class="line">    <span class='comment'>// The string returned is allocated using 'malloc' and hence should be de-allocated using 'free'.</span></td></tr>
<tr class="codeline" data-linenumber="2859"><td class="num" id="LN2859">2859</td><td class="line">    <span class='keyword'>static</span> wchar_t* utf8_to_wchar(<span class='keyword'>const</span> <span class='keyword'>char</span>* inStr)</td></tr>
<tr class="codeline" data-linenumber="2860"><td class="num" id="LN2860">2860</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2861"><td class="num" id="LN2861">2861</td><td class="line">      wchar_t* wstr = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2862"><td class="num" id="LN2862">2862</td><td class="line">      <span class='keyword'>if</span> (inStr)</td></tr>
<tr class="codeline" data-linenumber="2863"><td class="num" id="LN2863">2863</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2864"><td class="num" id="LN2864">2864</td><td class="line">        <span class='keyword'>int</span> wchars_count = MultiByteToWideChar(CP_UTF8, 0, inStr, -1, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="2865"><td class="num" id="LN2865">2865</td><td class="line">        <span class='keyword'>if</span> (wchars_count &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="2866"><td class="num" id="LN2866">2866</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2867"><td class="num" id="LN2867">2867</td><td class="line">          wstr = <span class='macro'>MZ_MALLOC(<span class='keyword'>sizeof</span>(wchar_t)*(wchars_count))<span class='macro_popup'>malloc(sizeof(wchar_t)*(wchars_count))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2868"><td class="num" id="LN2868">2868</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2869"><td class="num" id="LN2869">2869</td><td class="line">        <span class='keyword'>if</span> ((wstr != <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>) &amp;&amp; (MultiByteToWideChar(CP_UTF8, 0, inStr, -1, wstr, wchars_count) == 0))</td></tr>
<tr class="codeline" data-linenumber="2870"><td class="num" id="LN2870">2870</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="2871"><td class="num" id="LN2871">2871</td><td class="line">          <span class='macro'>MZ_FREE(wstr)<span class='macro_popup'>free(wstr)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2872"><td class="num" id="LN2872">2872</td><td class="line">          wstr = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2873"><td class="num" id="LN2873">2873</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="2874"><td class="num" id="LN2874">2874</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2875"><td class="num" id="LN2875">2875</td><td class="line">      <span class='keyword'>return</span> wstr;</td></tr>
<tr class="codeline" data-linenumber="2876"><td class="num" id="LN2876">2876</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2877"><td class="num" id="LN2877">2877</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2878"><td class="num" id="LN2878">2878</td><td class="line">    <span class='keyword'>static</span> FILE *mz_fopen(<span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, <span class='keyword'>const</span> <span class='keyword'>char</span> *pMode)</td></tr>
<tr class="codeline" data-linenumber="2879"><td class="num" id="LN2879">2879</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2880"><td class="num" id="LN2880">2880</td><td class="line">      FILE* pFile = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2881"><td class="num" id="LN2881">2881</td><td class="line">      wchar_t* pFilenameW = utf8_to_wchar(pFilename);</td></tr>
<tr class="codeline" data-linenumber="2882"><td class="num" id="LN2882">2882</td><td class="line">      wchar_t* pModeW = utf8_to_wchar(pMode);</td></tr>
<tr class="codeline" data-linenumber="2883"><td class="num" id="LN2883">2883</td><td class="line">     (<span class='keyword'>void</span>)_wfopen_s(&amp;pFile, pFilenameW, pModeW);</td></tr>
<tr class="codeline" data-linenumber="2884"><td class="num" id="LN2884">2884</td><td class="line">      <span class='macro'>MZ_FREE(pFilenameW)<span class='macro_popup'>free(pFilenameW)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2885"><td class="num" id="LN2885">2885</td><td class="line">      <span class='macro'>MZ_FREE(pModeW)<span class='macro_popup'>free(pModeW)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2886"><td class="num" id="LN2886">2886</td><td class="line">      <span class='keyword'>return</span> pFile;</td></tr>
<tr class="codeline" data-linenumber="2887"><td class="num" id="LN2887">2887</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2888"><td class="num" id="LN2888">2888</td><td class="line">    </td></tr>
<tr class="codeline" data-linenumber="2889"><td class="num" id="LN2889">2889</td><td class="line">    <span class='keyword'>static</span> FILE *mz_freopen(<span class='keyword'>const</span> <span class='keyword'>char</span> *pPath, <span class='keyword'>const</span> <span class='keyword'>char</span> *pMode, FILE *pStream)</td></tr>
<tr class="codeline" data-linenumber="2890"><td class="num" id="LN2890">2890</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="2891"><td class="num" id="LN2891">2891</td><td class="line">      FILE* pFile = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2892"><td class="num" id="LN2892">2892</td><td class="line">      wchar_t* pFilenameW = utf8_to_wchar(pPath);</td></tr>
<tr class="codeline" data-linenumber="2893"><td class="num" id="LN2893">2893</td><td class="line">      wchar_t* pModeW = utf8_to_wchar(pMode);</td></tr>
<tr class="codeline" data-linenumber="2894"><td class="num" id="LN2894">2894</td><td class="line">      <span class='keyword'>if</span> (_wfreopen_s(&amp;pFile, pFilenameW, pModeW, pStream))</td></tr>
<tr class="codeline" data-linenumber="2895"><td class="num" id="LN2895">2895</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="2896"><td class="num" id="LN2896">2896</td><td class="line">        pFile = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2897"><td class="num" id="LN2897">2897</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="2898"><td class="num" id="LN2898">2898</td><td class="line">      <span class='macro'>MZ_FREE(pFilenameW)<span class='macro_popup'>free(pFilenameW)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2899"><td class="num" id="LN2899">2899</td><td class="line">      <span class='macro'>MZ_FREE(pModeW)<span class='macro_popup'>free(pModeW)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="2900"><td class="num" id="LN2900">2900</td><td class="line">      <span class='keyword'>return</span> pFile;</td></tr>
<tr class="codeline" data-linenumber="2901"><td class="num" id="LN2901">2901</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="2902"><td class="num" id="LN2902">2902</td><td class="line">    <span class='directive'>#ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="2903"><td class="num" id="LN2903">2903</td><td class="line">      <span class='directive'>#include &lt;sys/utime.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="2904"><td class="num" id="LN2904">2904</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2905"><td class="num" id="LN2905">2905</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span> FILE</span></td></tr>
<tr class="codeline" data-linenumber="2906"><td class="num" id="LN2906">2906</td><td class="line">    <span class='directive'>#define MZ_FOPEN mz_fopen</span></td></tr>
<tr class="codeline" data-linenumber="2907"><td class="num" id="LN2907">2907</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span> fclose</span></td></tr>
<tr class="codeline" data-linenumber="2908"><td class="num" id="LN2908">2908</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FREAD<span class='macro_popup'>fread</span></span> fread</span></td></tr>
<tr class="codeline" data-linenumber="2909"><td class="num" id="LN2909">2909</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FWRITE<span class='macro_popup'>fwrite</span></span> fwrite</span></td></tr>
<tr class="codeline" data-linenumber="2910"><td class="num" id="LN2910">2910</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FTELL64<span class='macro_popup'>ftello</span></span> _ftelli64</span></td></tr>
<tr class="codeline" data-linenumber="2911"><td class="num" id="LN2911">2911</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FSEEK64<span class='macro_popup'>fseeko</span></span> _fseeki64</span></td></tr>
<tr class="codeline" data-linenumber="2912"><td class="num" id="LN2912">2912</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE_STAT_STRUCT<span class='macro_popup'>stat</span></span> _stat</span></td></tr>
<tr class="codeline" data-linenumber="2913"><td class="num" id="LN2913">2913</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE_STAT<span class='macro_popup'>stat</span></span> _stat</span></td></tr>
<tr class="codeline" data-linenumber="2914"><td class="num" id="LN2914">2914</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FFLUSH<span class='macro_popup'>fflush</span></span> fflush</span></td></tr>
<tr class="codeline" data-linenumber="2915"><td class="num" id="LN2915">2915</td><td class="line">    <span class='directive'>#define MZ_FREOPEN mz_freopen</span></td></tr>
<tr class="codeline" data-linenumber="2916"><td class="num" id="LN2916">2916</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_DELETE_FILE<span class='macro_popup'>remove</span></span> remove</span></td></tr>
<tr class="codeline" data-linenumber="2917"><td class="num" id="LN2917">2917</td><td class="line">  <span class='directive'>#elif defined(__MINGW32__)</span></td></tr>
<tr class="codeline" data-linenumber="2918"><td class="num" id="LN2918">2918</td><td class="line">    <span class='directive'>#ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="2919"><td class="num" id="LN2919">2919</td><td class="line">      <span class='directive'>#include &lt;sys/utime.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="2920"><td class="num" id="LN2920">2920</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2921"><td class="num" id="LN2921">2921</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span> FILE</span></td></tr>
<tr class="codeline" data-linenumber="2922"><td class="num" id="LN2922">2922</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FOPEN(f, m)<span class='macro_popup'>fopen(f, m)</span></span> fopen(f, m)</span></td></tr>
<tr class="codeline" data-linenumber="2923"><td class="num" id="LN2923">2923</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span> fclose</span></td></tr>
<tr class="codeline" data-linenumber="2924"><td class="num" id="LN2924">2924</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FREAD<span class='macro_popup'>fread</span></span> fread</span></td></tr>
<tr class="codeline" data-linenumber="2925"><td class="num" id="LN2925">2925</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FWRITE<span class='macro_popup'>fwrite</span></span> fwrite</span></td></tr>
<tr class="codeline" data-linenumber="2926"><td class="num" id="LN2926">2926</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FTELL64<span class='macro_popup'>ftello</span></span> ftello64</span></td></tr>
<tr class="codeline" data-linenumber="2927"><td class="num" id="LN2927">2927</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FSEEK64<span class='macro_popup'>fseeko</span></span> fseeko64</span></td></tr>
<tr class="codeline" data-linenumber="2928"><td class="num" id="LN2928">2928</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE_STAT_STRUCT<span class='macro_popup'>stat</span></span> _stat</span></td></tr>
<tr class="codeline" data-linenumber="2929"><td class="num" id="LN2929">2929</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE_STAT<span class='macro_popup'>stat</span></span> _stat</span></td></tr>
<tr class="codeline" data-linenumber="2930"><td class="num" id="LN2930">2930</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FFLUSH<span class='macro_popup'>fflush</span></span> fflush</span></td></tr>
<tr class="codeline" data-linenumber="2931"><td class="num" id="LN2931">2931</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FREOPEN(f, m, s)<span class='macro_popup'>freopen(f, m, s)</span></span> freopen(f, m, s)</span></td></tr>
<tr class="codeline" data-linenumber="2932"><td class="num" id="LN2932">2932</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_DELETE_FILE<span class='macro_popup'>remove</span></span> remove</span></td></tr>
<tr class="codeline" data-linenumber="2933"><td class="num" id="LN2933">2933</td><td class="line">  <span class='directive'>#elif defined(__TINYC__)</span></td></tr>
<tr class="codeline" data-linenumber="2934"><td class="num" id="LN2934">2934</td><td class="line">    <span class='directive'>#ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="2935"><td class="num" id="LN2935">2935</td><td class="line">      <span class='directive'>#include &lt;sys/utime.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="2936"><td class="num" id="LN2936">2936</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2937"><td class="num" id="LN2937">2937</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span> FILE</span></td></tr>
<tr class="codeline" data-linenumber="2938"><td class="num" id="LN2938">2938</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FOPEN(f, m)<span class='macro_popup'>fopen(f, m)</span></span> fopen(f, m)</span></td></tr>
<tr class="codeline" data-linenumber="2939"><td class="num" id="LN2939">2939</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span> fclose</span></td></tr>
<tr class="codeline" data-linenumber="2940"><td class="num" id="LN2940">2940</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FREAD<span class='macro_popup'>fread</span></span> fread</span></td></tr>
<tr class="codeline" data-linenumber="2941"><td class="num" id="LN2941">2941</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FWRITE<span class='macro_popup'>fwrite</span></span> fwrite</span></td></tr>
<tr class="codeline" data-linenumber="2942"><td class="num" id="LN2942">2942</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FTELL64<span class='macro_popup'>ftello</span></span> ftell</span></td></tr>
<tr class="codeline" data-linenumber="2943"><td class="num" id="LN2943">2943</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FSEEK64<span class='macro_popup'>fseeko</span></span> fseek</span></td></tr>
<tr class="codeline" data-linenumber="2944"><td class="num" id="LN2944">2944</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE_STAT_STRUCT<span class='macro_popup'>stat</span></span> stat</span></td></tr>
<tr class="codeline" data-linenumber="2945"><td class="num" id="LN2945">2945</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE_STAT<span class='macro_popup'>stat</span></span> stat</span></td></tr>
<tr class="codeline" data-linenumber="2946"><td class="num" id="LN2946">2946</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FFLUSH<span class='macro_popup'>fflush</span></span> fflush</span></td></tr>
<tr class="codeline" data-linenumber="2947"><td class="num" id="LN2947">2947</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FREOPEN(f, m, s)<span class='macro_popup'>freopen(f, m, s)</span></span> freopen(f, m, s)</span></td></tr>
<tr class="codeline" data-linenumber="2948"><td class="num" id="LN2948">2948</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_DELETE_FILE<span class='macro_popup'>remove</span></span> remove</span></td></tr>
<tr class="codeline" data-linenumber="2949"><td class="num" id="LN2949">2949</td><td class="line">  <span class='directive'>#elif defined(<span class='macro'>__GNUC__<span class='macro_popup'>4</span></span>) &amp;&amp; _LARGEFILE64_SOURCE</span></td></tr>
<tr class="codeline" data-linenumber="2950"><td class="num" id="LN2950">2950</td><td class="line">    <span class='directive'>#ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="2951"><td class="num" id="LN2951">2951</td><td class="line">      <span class='directive'>#include &lt;utime.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="2952"><td class="num" id="LN2952">2952</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2953"><td class="num" id="LN2953">2953</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span> FILE</span></td></tr>
<tr class="codeline" data-linenumber="2954"><td class="num" id="LN2954">2954</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FOPEN(f, m)<span class='macro_popup'>fopen(f, m)</span></span> fopen64(f, m)</span></td></tr>
<tr class="codeline" data-linenumber="2955"><td class="num" id="LN2955">2955</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span> fclose</span></td></tr>
<tr class="codeline" data-linenumber="2956"><td class="num" id="LN2956">2956</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FREAD<span class='macro_popup'>fread</span></span> fread</span></td></tr>
<tr class="codeline" data-linenumber="2957"><td class="num" id="LN2957">2957</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FWRITE<span class='macro_popup'>fwrite</span></span> fwrite</span></td></tr>
<tr class="codeline" data-linenumber="2958"><td class="num" id="LN2958">2958</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FTELL64<span class='macro_popup'>ftello</span></span> ftello64</span></td></tr>
<tr class="codeline" data-linenumber="2959"><td class="num" id="LN2959">2959</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FSEEK64<span class='macro_popup'>fseeko</span></span> fseeko64</span></td></tr>
<tr class="codeline" data-linenumber="2960"><td class="num" id="LN2960">2960</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE_STAT_STRUCT<span class='macro_popup'>stat</span></span> stat64</span></td></tr>
<tr class="codeline" data-linenumber="2961"><td class="num" id="LN2961">2961</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE_STAT<span class='macro_popup'>stat</span></span> stat64</span></td></tr>
<tr class="codeline" data-linenumber="2962"><td class="num" id="LN2962">2962</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FFLUSH<span class='macro_popup'>fflush</span></span> fflush</span></td></tr>
<tr class="codeline" data-linenumber="2963"><td class="num" id="LN2963">2963</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FREOPEN(p, m, s)<span class='macro_popup'>freopen(p, m, s)</span></span> freopen64(p, m, s)</span></td></tr>
<tr class="codeline" data-linenumber="2964"><td class="num" id="LN2964">2964</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_DELETE_FILE<span class='macro_popup'>remove</span></span> remove</span></td></tr>
<tr class="codeline" data-linenumber="2965"><td class="num" id="LN2965">2965</td><td class="line">  <span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="2966"><td class="num" id="LN2966">2966</td><td class="line">    <span class='directive'>#ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="2967"><td class="num" id="LN2967">2967</td><td class="line">      <span class='directive'>#include &lt;utime.h&gt;</span></td></tr>
<tr class="codeline" data-linenumber="2968"><td class="num" id="LN2968">2968</td><td class="line">    <span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="2969"><td class="num" id="LN2969">2969</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span> FILE</span></td></tr>
<tr class="codeline" data-linenumber="2970"><td class="num" id="LN2970">2970</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FOPEN(f, m)<span class='macro_popup'>fopen(f, m)</span></span> fopen(f, m)</span></td></tr>
<tr class="codeline" data-linenumber="2971"><td class="num" id="LN2971">2971</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span> fclose</span></td></tr>
<tr class="codeline" data-linenumber="2972"><td class="num" id="LN2972">2972</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FREAD<span class='macro_popup'>fread</span></span> fread</span></td></tr>
<tr class="codeline" data-linenumber="2973"><td class="num" id="LN2973">2973</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FWRITE<span class='macro_popup'>fwrite</span></span> fwrite</span></td></tr>
<tr class="codeline" data-linenumber="2974"><td class="num" id="LN2974">2974</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FTELL64<span class='macro_popup'>ftello</span></span> ftello</span></td></tr>
<tr class="codeline" data-linenumber="2975"><td class="num" id="LN2975">2975</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FSEEK64<span class='macro_popup'>fseeko</span></span> fseeko</span></td></tr>
<tr class="codeline" data-linenumber="2976"><td class="num" id="LN2976">2976</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE_STAT_STRUCT<span class='macro_popup'>stat</span></span> stat</span></td></tr>
<tr class="codeline" data-linenumber="2977"><td class="num" id="LN2977">2977</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FILE_STAT<span class='macro_popup'>stat</span></span> stat</span></td></tr>
<tr class="codeline" data-linenumber="2978"><td class="num" id="LN2978">2978</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FFLUSH<span class='macro_popup'>fflush</span></span> fflush</span></td></tr>
<tr class="codeline" data-linenumber="2979"><td class="num" id="LN2979">2979</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_FREOPEN(f, m, s)<span class='macro_popup'>freopen(f, m, s)</span></span> freopen(f, m, s)</span></td></tr>
<tr class="codeline" data-linenumber="2980"><td class="num" id="LN2980">2980</td><td class="line">    <span class='directive'>#define <span class='macro'>MZ_DELETE_FILE<span class='macro_popup'>remove</span></span> remove</span></td></tr>
<tr class="codeline" data-linenumber="2981"><td class="num" id="LN2981">2981</td><td class="line">  <span class='directive'>#endif // #ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="2982"><td class="num" id="LN2982">2982</td><td class="line"><span class='directive'>#endif // #ifdef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="2983"><td class="num" id="LN2983">2983</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2984"><td class="num" id="LN2984">2984</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_TOLOWER(c)<span class='macro_popup'>((((c) &gt;= 'A') &amp;&amp; ((c) &lt;= 'Z')) ? ((c) - 'A' + 'a'<br>) : (c))</span></span> ((((c) &gt;= 'A') &amp;&amp; ((c) &lt;= 'Z')) ? ((c) - 'A' + 'a') : (c))</span></td></tr>
<tr class="codeline" data-linenumber="2985"><td class="num" id="LN2985">2985</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="2986"><td class="num" id="LN2986">2986</td><td class="line"><span class='comment'>// Various ZIP archive enums. To completely avoid cross platform compiler alignment and platform endian issues, miniz.c doesn't use structs for any of this stuff.</span></td></tr>
<tr class="codeline" data-linenumber="2987"><td class="num" id="LN2987">2987</td><td class="line"><span class='keyword'>enum</span></td></tr>
<tr class="codeline" data-linenumber="2988"><td class="num" id="LN2988">2988</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="2989"><td class="num" id="LN2989">2989</td><td class="line">  <span class='comment'>// ZIP archive identifiers and record sizes</span></td></tr>
<tr class="codeline" data-linenumber="2990"><td class="num" id="LN2990">2990</td><td class="line">  MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIG = 0x06054b50, MZ_ZIP_CENTRAL_DIR_HEADER_SIG = 0x02014b50, MZ_ZIP_LOCAL_DIR_HEADER_SIG = 0x04034b50,</td></tr>
<tr class="codeline" data-linenumber="2991"><td class="num" id="LN2991">2991</td><td class="line">  MZ_ZIP_LOCAL_DIR_HEADER_SIZE = 30, MZ_ZIP_CENTRAL_DIR_HEADER_SIZE = 46, MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIZE = 22,</td></tr>
<tr class="codeline" data-linenumber="2992"><td class="num" id="LN2992">2992</td><td class="line">  <span class='comment'>// Central directory header record offsets</span></td></tr>
<tr class="codeline" data-linenumber="2993"><td class="num" id="LN2993">2993</td><td class="line">  MZ_ZIP_CDH_SIG_OFS = 0, MZ_ZIP_CDH_VERSION_MADE_BY_OFS = 4, MZ_ZIP_CDH_VERSION_NEEDED_OFS = 6, MZ_ZIP_CDH_BIT_FLAG_OFS = 8,</td></tr>
<tr class="codeline" data-linenumber="2994"><td class="num" id="LN2994">2994</td><td class="line">  MZ_ZIP_CDH_METHOD_OFS = 10, MZ_ZIP_CDH_FILE_TIME_OFS = 12, MZ_ZIP_CDH_FILE_DATE_OFS = 14, MZ_ZIP_CDH_CRC32_OFS = 16,</td></tr>
<tr class="codeline" data-linenumber="2995"><td class="num" id="LN2995">2995</td><td class="line">  MZ_ZIP_CDH_COMPRESSED_SIZE_OFS = 20, MZ_ZIP_CDH_DECOMPRESSED_SIZE_OFS = 24, MZ_ZIP_CDH_FILENAME_LEN_OFS = 28, MZ_ZIP_CDH_EXTRA_LEN_OFS = 30,</td></tr>
<tr class="codeline" data-linenumber="2996"><td class="num" id="LN2996">2996</td><td class="line">  MZ_ZIP_CDH_COMMENT_LEN_OFS = 32, MZ_ZIP_CDH_DISK_START_OFS = 34, MZ_ZIP_CDH_INTERNAL_ATTR_OFS = 36, MZ_ZIP_CDH_EXTERNAL_ATTR_OFS = 38, MZ_ZIP_CDH_LOCAL_HEADER_OFS = 42,</td></tr>
<tr class="codeline" data-linenumber="2997"><td class="num" id="LN2997">2997</td><td class="line">  <span class='comment'>// Local directory header offsets</span></td></tr>
<tr class="codeline" data-linenumber="2998"><td class="num" id="LN2998">2998</td><td class="line">  MZ_ZIP_LDH_SIG_OFS = 0, MZ_ZIP_LDH_VERSION_NEEDED_OFS = 4, MZ_ZIP_LDH_BIT_FLAG_OFS = 6, MZ_ZIP_LDH_METHOD_OFS = 8, MZ_ZIP_LDH_FILE_TIME_OFS = 10,</td></tr>
<tr class="codeline" data-linenumber="2999"><td class="num" id="LN2999">2999</td><td class="line">  MZ_ZIP_LDH_FILE_DATE_OFS = 12, MZ_ZIP_LDH_CRC32_OFS = 14, MZ_ZIP_LDH_COMPRESSED_SIZE_OFS = 18, MZ_ZIP_LDH_DECOMPRESSED_SIZE_OFS = 22,</td></tr>
<tr class="codeline" data-linenumber="3000"><td class="num" id="LN3000">3000</td><td class="line">  MZ_ZIP_LDH_FILENAME_LEN_OFS = 26, MZ_ZIP_LDH_EXTRA_LEN_OFS = 28,</td></tr>
<tr class="codeline" data-linenumber="3001"><td class="num" id="LN3001">3001</td><td class="line">  <span class='comment'>// End of central directory offsets</span></td></tr>
<tr class="codeline" data-linenumber="3002"><td class="num" id="LN3002">3002</td><td class="line">  MZ_ZIP_ECDH_SIG_OFS = 0, MZ_ZIP_ECDH_NUM_THIS_DISK_OFS = 4, MZ_ZIP_ECDH_NUM_DISK_CDIR_OFS = 6, MZ_ZIP_ECDH_CDIR_NUM_ENTRIES_ON_DISK_OFS = 8,</td></tr>
<tr class="codeline" data-linenumber="3003"><td class="num" id="LN3003">3003</td><td class="line">  MZ_ZIP_ECDH_CDIR_TOTAL_ENTRIES_OFS = 10, MZ_ZIP_ECDH_CDIR_SIZE_OFS = 12, MZ_ZIP_ECDH_CDIR_OFS_OFS = 16, MZ_ZIP_ECDH_COMMENT_SIZE_OFS = 20,</td></tr>
<tr class="codeline" data-linenumber="3004"><td class="num" id="LN3004">3004</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="3005"><td class="num" id="LN3005">3005</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3006"><td class="num" id="LN3006">3006</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="3007"><td class="num" id="LN3007">3007</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3008"><td class="num" id="LN3008">3008</td><td class="line">  <span class='keyword'>void</span> *m_p;</td></tr>
<tr class="codeline" data-linenumber="3009"><td class="num" id="LN3009">3009</td><td class="line">  size_t m_size, m_capacity;</td></tr>
<tr class="codeline" data-linenumber="3010"><td class="num" id="LN3010">3010</td><td class="line">  mz_uint m_element_size;</td></tr>
<tr class="codeline" data-linenumber="3011"><td class="num" id="LN3011">3011</td><td class="line">} mz_zip_array;</td></tr>
<tr class="codeline" data-linenumber="3012"><td class="num" id="LN3012">3012</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3013"><td class="num" id="LN3013">3013</td><td class="line"><span class='keyword'>struct</span> mz_zip_internal_state_tag</td></tr>
<tr class="codeline" data-linenumber="3014"><td class="num" id="LN3014">3014</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3015"><td class="num" id="LN3015">3015</td><td class="line">  mz_zip_array m_central_dir;</td></tr>
<tr class="codeline" data-linenumber="3016"><td class="num" id="LN3016">3016</td><td class="line">  mz_zip_array m_central_dir_offsets;</td></tr>
<tr class="codeline" data-linenumber="3017"><td class="num" id="LN3017">3017</td><td class="line">  mz_zip_array m_sorted_central_dir_offsets;</td></tr>
<tr class="codeline" data-linenumber="3018"><td class="num" id="LN3018">3018</td><td class="line">  <span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span> *m_pFile;</td></tr>
<tr class="codeline" data-linenumber="3019"><td class="num" id="LN3019">3019</td><td class="line">  <span class='keyword'>void</span> *m_pMem;</td></tr>
<tr class="codeline" data-linenumber="3020"><td class="num" id="LN3020">3020</td><td class="line">  size_t m_mem_size;</td></tr>
<tr class="codeline" data-linenumber="3021"><td class="num" id="LN3021">3021</td><td class="line">  size_t m_mem_capacity;</td></tr>
<tr class="codeline" data-linenumber="3022"><td class="num" id="LN3022">3022</td><td class="line">};</td></tr>
<tr class="codeline" data-linenumber="3023"><td class="num" id="LN3023">3023</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3024"><td class="num" id="LN3024">3024</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_ZIP_ARRAY_SET_ELEMENT_SIZE(array_ptr, element_size)<span class='macro_popup'>(array_ptr)-&gt;m_element_size = element_size</span></span> (array_ptr)-&gt;m_element_size = element_size</span></td></tr>
<tr class="codeline" data-linenumber="3025"><td class="num" id="LN3025">3025</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_ZIP_ARRAY_ELEMENT(array_ptr, element_type, index)<span class='macro_popup'>((element_type *)((array_ptr)-&gt;m_p))[index]</span></span> ((element_type *)((array_ptr)-&gt;m_p))[index]</span></td></tr>
<tr class="codeline" data-linenumber="3026"><td class="num" id="LN3026">3026</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3027"><td class="num" id="LN3027">3027</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> <span class='keyword'>void</span> mz_zip_array_clear(mz_zip_archive *pZip, mz_zip_array *pArray)</td></tr>
<tr class="codeline" data-linenumber="3028"><td class="num" id="LN3028">3028</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3029"><td class="num" id="LN3029">3029</td><td class="line">  pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pArray-&gt;m_p);</td></tr>
<tr class="codeline" data-linenumber="3030"><td class="num" id="LN3030">3030</td><td class="line">  memset(pArray, 0, <span class='keyword'>sizeof</span>(mz_zip_array));</td></tr>
<tr class="codeline" data-linenumber="3031"><td class="num" id="LN3031">3031</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3032"><td class="num" id="LN3032">3032</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3033"><td class="num" id="LN3033">3033</td><td class="line"><span class='keyword'>static</span> mz_bool mz_zip_array_ensure_capacity(mz_zip_archive *pZip, mz_zip_array *pArray, size_t min_new_capacity, mz_uint growing)</td></tr>
<tr class="codeline" data-linenumber="3034"><td class="num" id="LN3034">3034</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3035"><td class="num" id="LN3035">3035</td><td class="line">  <span class='keyword'>void</span> *pNew_p; size_t new_capacity = min_new_capacity; <span class='macro'>MZ_ASSERT(pArray-&gt;m_element_size)<span class='macro_popup'>((void) sizeof ((pArray-&gt;m_element_size) ? 1 : 0), __extension__<br> ({ if (pArray-&gt;m_element_size) ; else __assert_fail ("pArray-&gt;m_element_size"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 3035, __extension__ __PRETTY_FUNCTION__); }))</span></span>; <span class='keyword'>if</span> (pArray-&gt;m_capacity &gt;= min_new_capacity) <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3036"><td class="num" id="LN3036">3036</td><td class="line">  <span class='keyword'>if</span> (growing) { new_capacity = <span class='macro'>MZ_MAX(1, pArray-&gt;m_capacity)<span class='macro_popup'>(((1)&gt;(pArray-&gt;m_capacity))?(1):(pArray-&gt;m_capacity)<br>)</span></span>; <span class='keyword'>while</span> (new_capacity &lt; min_new_capacity) new_capacity *= 2; }</td></tr>
<tr class="codeline" data-linenumber="3037"><td class="num" id="LN3037">3037</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pNew_p = pZip-&gt;m_pRealloc(pZip-&gt;m_pAlloc_opaque, pArray-&gt;m_p, pArray-&gt;m_element_size, new_capacity))) <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3038"><td class="num" id="LN3038">3038</td><td class="line">  pArray-&gt;m_p = pNew_p; pArray-&gt;m_capacity = new_capacity;</td></tr>
<tr class="codeline" data-linenumber="3039"><td class="num" id="LN3039">3039</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3040"><td class="num" id="LN3040">3040</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3041"><td class="num" id="LN3041">3041</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3042"><td class="num" id="LN3042">3042</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> mz_bool mz_zip_array_reserve(mz_zip_archive *pZip, mz_zip_array *pArray, size_t new_capacity, mz_uint growing)</td></tr>
<tr class="codeline" data-linenumber="3043"><td class="num" id="LN3043">3043</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3044"><td class="num" id="LN3044">3044</td><td class="line">  <span class='keyword'>if</span> (new_capacity &gt; pArray-&gt;m_capacity) { <span class='keyword'>if</span> (!mz_zip_array_ensure_capacity(pZip, pArray, new_capacity, growing)) <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="3045"><td class="num" id="LN3045">3045</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3046"><td class="num" id="LN3046">3046</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3047"><td class="num" id="LN3047">3047</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3048"><td class="num" id="LN3048">3048</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> mz_bool mz_zip_array_resize(mz_zip_archive *pZip, mz_zip_array *pArray, size_t new_size, mz_uint growing)</td></tr>
<tr class="codeline" data-linenumber="3049"><td class="num" id="LN3049">3049</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3050"><td class="num" id="LN3050">3050</td><td class="line">  <span class='keyword'>if</span> (new_size &gt; pArray-&gt;m_capacity) { <span class='keyword'>if</span> (!mz_zip_array_ensure_capacity(pZip, pArray, new_size, growing)) <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="3051"><td class="num" id="LN3051">3051</td><td class="line">  pArray-&gt;m_size = new_size;</td></tr>
<tr class="codeline" data-linenumber="3052"><td class="num" id="LN3052">3052</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3053"><td class="num" id="LN3053">3053</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3054"><td class="num" id="LN3054">3054</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3055"><td class="num" id="LN3055">3055</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> mz_bool mz_zip_array_ensure_room(mz_zip_archive *pZip, mz_zip_array *pArray, size_t n)</td></tr>
<tr class="codeline" data-linenumber="3056"><td class="num" id="LN3056">3056</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3057"><td class="num" id="LN3057">3057</td><td class="line">  <span class='keyword'>return</span> mz_zip_array_reserve(pZip, pArray, pArray-&gt;m_size + n, <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3058"><td class="num" id="LN3058">3058</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3059"><td class="num" id="LN3059">3059</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3060"><td class="num" id="LN3060">3060</td><td class="line"><span id="start3"><span class='keyword'>static</span></span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> mz_bool mz_zip_array_push_back(mz_zip_archive *pZip, mz_zip_array *pArray, <span class='keyword'>const</span> <span class='keyword'>void</span> *pElements, size_t n)</td></tr>
<tr class="codeline" data-linenumber="3061"><td class="num" id="LN3061">3061</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3062"><td class="num" id="LN3062">3062</td><td class="line">  <span id="start2"><span id="end3">size_t</span></span> orig_size = pArray-&gt;m_size; <span class='keyword'>if</span> (!mz_zip_array_resize(pZip, pArray, orig_size + n, <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>)) <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path46" class="msg msgControl" style="margin-left:38ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">46</div></td><td><div class="PathNav"><a href="#Path45" title="Previous event (45)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#EndPath" title="Next event (47)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="3063"><td class="num" id="LN3063">3063</td><td class="line">  <span id="end0"><span id="start1"><span id="end2">memcpy</span></span></span>((mz_uint8*)<span id="start0"><span id="end1">pArray</span></span>-&gt;m_p + orig_size * pArray-&gt;m_element_size, <span class="mrange">pElements</span>, n * pArray-&gt;m_element_size);</td></tr>
<tr><td class="num"></td><td class="line"><div id="EndPath" class="msg msgEvent" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">47</div></td><td><div class="PathNav"><a href="#Path46" title="Previous event (46)">&#x2190;</a></div></td><td>Null pointer passed to 2nd parameter expecting 'nonnull'</td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="3064"><td class="num" id="LN3064">3064</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3065"><td class="num" id="LN3065">3065</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3066"><td class="num" id="LN3066">3066</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3067"><td class="num" id="LN3067">3067</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="3068"><td class="num" id="LN3068">3068</td><td class="line"><span class='keyword'>static</span> time_t mz_zip_dos_to_time_t(<span class='keyword'>int</span> dos_time, <span class='keyword'>int</span> dos_date)</td></tr>
<tr class="codeline" data-linenumber="3069"><td class="num" id="LN3069">3069</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3070"><td class="num" id="LN3070">3070</td><td class="line">  <span class='keyword'>struct</span> tm tm;</td></tr>
<tr class="codeline" data-linenumber="3071"><td class="num" id="LN3071">3071</td><td class="line">  memset(&amp;tm, 0, <span class='keyword'>sizeof</span>(tm)); tm.tm_isdst = -1;</td></tr>
<tr class="codeline" data-linenumber="3072"><td class="num" id="LN3072">3072</td><td class="line">  tm.tm_year = ((dos_date &gt;&gt; 9) &amp; 127) + 1980 - 1900; tm.tm_mon = ((dos_date &gt;&gt; 5) &amp; 15) - 1; tm.tm_mday = dos_date &amp; 31;</td></tr>
<tr class="codeline" data-linenumber="3073"><td class="num" id="LN3073">3073</td><td class="line">  tm.tm_hour = (dos_time &gt;&gt; 11) &amp; 31; tm.tm_min = (dos_time &gt;&gt; 5) &amp; 63; tm.tm_sec = (dos_time &lt;&lt; 1) &amp; 62;</td></tr>
<tr class="codeline" data-linenumber="3074"><td class="num" id="LN3074">3074</td><td class="line">  <span class='keyword'>return</span> mktime(&amp;tm);</td></tr>
<tr class="codeline" data-linenumber="3075"><td class="num" id="LN3075">3075</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3076"><td class="num" id="LN3076">3076</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3077"><td class="num" id="LN3077">3077</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> mz_zip_time_to_dos_time(time_t time, mz_uint16 *pDOS_time, mz_uint16 *pDOS_date)</td></tr>
<tr class="codeline" data-linenumber="3078"><td class="num" id="LN3078">3078</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3079"><td class="num" id="LN3079">3079</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="3080"><td class="num" id="LN3080">3080</td><td class="line">  <span class='keyword'>struct</span> tm tm_struct;</td></tr>
<tr class="codeline" data-linenumber="3081"><td class="num" id="LN3081">3081</td><td class="line">  <span class='keyword'>struct</span> tm *tm = &amp;tm_struct;</td></tr>
<tr class="codeline" data-linenumber="3082"><td class="num" id="LN3082">3082</td><td class="line">  errno_t err = localtime_s(tm, &amp;time);</td></tr>
<tr class="codeline" data-linenumber="3083"><td class="num" id="LN3083">3083</td><td class="line">  <span class='keyword'>if</span> (err)</td></tr>
<tr class="codeline" data-linenumber="3084"><td class="num" id="LN3084">3084</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3085"><td class="num" id="LN3085">3085</td><td class="line">    *pDOS_date = 0; *pDOS_time = 0;</td></tr>
<tr class="codeline" data-linenumber="3086"><td class="num" id="LN3086">3086</td><td class="line">    <span class='keyword'>return</span>;</td></tr>
<tr class="codeline" data-linenumber="3087"><td class="num" id="LN3087">3087</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3088"><td class="num" id="LN3088">3088</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="3089"><td class="num" id="LN3089">3089</td><td class="line">  <span class='keyword'>struct</span> tm *tm = localtime(&amp;time);</td></tr>
<tr class="codeline" data-linenumber="3090"><td class="num" id="LN3090">3090</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3091"><td class="num" id="LN3091">3091</td><td class="line">  *pDOS_time = (mz_uint16)(((tm-&gt;tm_hour) &lt;&lt; 11) + ((tm-&gt;tm_min) &lt;&lt; 5) + ((tm-&gt;tm_sec) &gt;&gt; 1));</td></tr>
<tr class="codeline" data-linenumber="3092"><td class="num" id="LN3092">3092</td><td class="line">  *pDOS_date = (mz_uint16)(((tm-&gt;tm_year + 1900 - 1980) &lt;&lt; 9) + ((tm-&gt;tm_mon + 1) &lt;&lt; 5) + tm-&gt;tm_mday);</td></tr>
<tr class="codeline" data-linenumber="3093"><td class="num" id="LN3093">3093</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3094"><td class="num" id="LN3094">3094</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3095"><td class="num" id="LN3095">3095</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3096"><td class="num" id="LN3096">3096</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="3097"><td class="num" id="LN3097">3097</td><td class="line"><span class='keyword'>static</span> mz_bool mz_zip_get_file_modified_time(<span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, mz_uint16 *pDOS_time, mz_uint16 *pDOS_date)</td></tr>
<tr class="codeline" data-linenumber="3098"><td class="num" id="LN3098">3098</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3099"><td class="num" id="LN3099">3099</td><td class="line"><span class='directive'>#ifdef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="3100"><td class="num" id="LN3100">3100</td><td class="line">  (<span class='keyword'>void</span>)pFilename; *pDOS_date = *pDOS_time = 0;</td></tr>
<tr class="codeline" data-linenumber="3101"><td class="num" id="LN3101">3101</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="3102"><td class="num" id="LN3102">3102</td><td class="line">  <span class='keyword'>struct</span> <span class='macro'>MZ_FILE_STAT_STRUCT<span class='macro_popup'>stat</span></span> file_stat;</td></tr>
<tr class="codeline" data-linenumber="3103"><td class="num" id="LN3103">3103</td><td class="line">  <span class='comment'>// On Linux with x86 glibc, this call will fail on large files (&gt;= 0x80000000 bytes) unless you compiled with _LARGEFILE64_SOURCE. Argh.</span></td></tr>
<tr class="codeline" data-linenumber="3104"><td class="num" id="LN3104">3104</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>MZ_FILE_STAT<span class='macro_popup'>stat</span></span>(pFilename, &amp;file_stat) != 0)</td></tr>
<tr class="codeline" data-linenumber="3105"><td class="num" id="LN3105">3105</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3106"><td class="num" id="LN3106">3106</td><td class="line">  mz_zip_time_to_dos_time(file_stat.<span class='macro'>st_mtime<span class='macro_popup'>st_mtim.tv_sec</span></span>, pDOS_time, pDOS_date);</td></tr>
<tr class="codeline" data-linenumber="3107"><td class="num" id="LN3107">3107</td><td class="line"><span class='directive'>#endif // #ifdef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="3108"><td class="num" id="LN3108">3108</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3109"><td class="num" id="LN3109">3109</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3110"><td class="num" id="LN3110">3110</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3111"><td class="num" id="LN3111">3111</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="3112"><td class="num" id="LN3112">3112</td><td class="line"><span class='keyword'>static</span> mz_bool mz_zip_set_file_times(<span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, time_t access_time, time_t modified_time)</td></tr>
<tr class="codeline" data-linenumber="3113"><td class="num" id="LN3113">3113</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3114"><td class="num" id="LN3114">3114</td><td class="line">  <span class='keyword'>struct</span> utimbuf t; t.actime = access_time; t.modtime = modified_time;</td></tr>
<tr class="codeline" data-linenumber="3115"><td class="num" id="LN3115">3115</td><td class="line">  <span class='keyword'>return</span> !utime(pFilename, &amp;t);</td></tr>
<tr class="codeline" data-linenumber="3116"><td class="num" id="LN3116">3116</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3117"><td class="num" id="LN3117">3117</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="3118"><td class="num" id="LN3118">3118</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="3119"><td class="num" id="LN3119">3119</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3120"><td class="num" id="LN3120">3120</td><td class="line"><span class='keyword'>static</span> mz_bool mz_zip_reader_init_internal(mz_zip_archive *pZip, mz_uint32 flags)</td></tr>
<tr class="codeline" data-linenumber="3121"><td class="num" id="LN3121">3121</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3122"><td class="num" id="LN3122">3122</td><td class="line">  (<span class='keyword'>void</span>)flags;</td></tr>
<tr class="codeline" data-linenumber="3123"><td class="num" id="LN3123">3123</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (pZip-&gt;m_pState) || (pZip-&gt;m_zip_mode != MZ_ZIP_MODE_INVALID))</td></tr>
<tr class="codeline" data-linenumber="3124"><td class="num" id="LN3124">3124</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3125"><td class="num" id="LN3125">3125</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3126"><td class="num" id="LN3126">3126</td><td class="line">  <span class='keyword'>if</span> (!pZip-&gt;m_pAlloc) pZip-&gt;m_pAlloc = def_alloc_func;</td></tr>
<tr class="codeline" data-linenumber="3127"><td class="num" id="LN3127">3127</td><td class="line">  <span class='keyword'>if</span> (!pZip-&gt;m_pFree) pZip-&gt;m_pFree = def_free_func;</td></tr>
<tr class="codeline" data-linenumber="3128"><td class="num" id="LN3128">3128</td><td class="line">  <span class='keyword'>if</span> (!pZip-&gt;m_pRealloc) pZip-&gt;m_pRealloc = def_realloc_func;</td></tr>
<tr class="codeline" data-linenumber="3129"><td class="num" id="LN3129">3129</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3130"><td class="num" id="LN3130">3130</td><td class="line">  pZip-&gt;m_zip_mode = MZ_ZIP_MODE_READING;</td></tr>
<tr class="codeline" data-linenumber="3131"><td class="num" id="LN3131">3131</td><td class="line">  pZip-&gt;m_archive_size = 0;</td></tr>
<tr class="codeline" data-linenumber="3132"><td class="num" id="LN3132">3132</td><td class="line">  pZip-&gt;m_central_directory_file_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="3133"><td class="num" id="LN3133">3133</td><td class="line">  pZip-&gt;m_total_files = 0;</td></tr>
<tr class="codeline" data-linenumber="3134"><td class="num" id="LN3134">3134</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3135"><td class="num" id="LN3135">3135</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pZip-&gt;m_pState = (mz_zip_internal_state *)pZip-&gt;m_pAlloc(pZip-&gt;m_pAlloc_opaque, 1, <span class='keyword'>sizeof</span>(mz_zip_internal_state))))</td></tr>
<tr class="codeline" data-linenumber="3136"><td class="num" id="LN3136">3136</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3137"><td class="num" id="LN3137">3137</td><td class="line">  memset(pZip-&gt;m_pState, 0, <span class='keyword'>sizeof</span>(mz_zip_internal_state));</td></tr>
<tr class="codeline" data-linenumber="3138"><td class="num" id="LN3138">3138</td><td class="line">  <span class='macro'>MZ_ZIP_ARRAY_SET_ELEMENT_SIZE(&amp;pZip-&gt;m_pState-&gt;m_central_dir, <span class='keyword'>sizeof</span>(mz_uint8))<span class='macro_popup'>(&amp;pZip-&gt;m_pState-&gt;m_central_dir)-&gt;m_element_size<br> = sizeof(mz_uint8)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3139"><td class="num" id="LN3139">3139</td><td class="line">  <span class='macro'>MZ_ZIP_ARRAY_SET_ELEMENT_SIZE(&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets, <span class='keyword'>sizeof</span>(mz_uint32))<span class='macro_popup'>(&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets)-&gt;m_element_size<br> = sizeof(mz_uint32)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3140"><td class="num" id="LN3140">3140</td><td class="line">  <span class='macro'>MZ_ZIP_ARRAY_SET_ELEMENT_SIZE(&amp;pZip-&gt;m_pState-&gt;m_sorted_central_dir_offsets, <span class='keyword'>sizeof</span>(mz_uint32))<span class='macro_popup'>(&amp;pZip-&gt;m_pState-&gt;m_sorted_central_dir_offsets)-&gt;<br>m_element_size = sizeof(mz_uint32)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3141"><td class="num" id="LN3141">3141</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3142"><td class="num" id="LN3142">3142</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3143"><td class="num" id="LN3143">3143</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3144"><td class="num" id="LN3144">3144</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> mz_bool mz_zip_reader_filename_less(<span class='keyword'>const</span> mz_zip_array *pCentral_dir_array, <span class='keyword'>const</span> mz_zip_array *pCentral_dir_offsets, mz_uint l_index, mz_uint r_index)</td></tr>
<tr class="codeline" data-linenumber="3145"><td class="num" id="LN3145">3145</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3146"><td class="num" id="LN3146">3146</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *pL = &amp;<span class='macro'>MZ_ZIP_ARRAY_ELEMENT(pCentral_dir_array, mz_uint8, MZ_ZIP_ARRAY_ELEMENT(pCentral_dir_offsets, mz_uint32, l_index))<span class='macro_popup'>((mz_uint8 *)((pCentral_dir_array)-&gt;m_p))[((mz_uint32 *)((<br>pCentral_dir_offsets)-&gt;m_p))[l_index]]</span></span>, *pE;</td></tr>
<tr class="codeline" data-linenumber="3147"><td class="num" id="LN3147">3147</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *pR = &amp;<span class='macro'>MZ_ZIP_ARRAY_ELEMENT(pCentral_dir_array, mz_uint8, MZ_ZIP_ARRAY_ELEMENT(pCentral_dir_offsets, mz_uint32, r_index))<span class='macro_popup'>((mz_uint8 *)((pCentral_dir_array)-&gt;m_p))[((mz_uint32 *)((<br>pCentral_dir_offsets)-&gt;m_p))[r_index]]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3148"><td class="num" id="LN3148">3148</td><td class="line">  mz_uint l_len = <span class='macro'>MZ_READ_LE16(pL + MZ_ZIP_CDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pL + MZ_ZIP_CDH_FILENAME_LEN_OFS))</span></span>, r_len = <span class='macro'>MZ_READ_LE16(pR + MZ_ZIP_CDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pR + MZ_ZIP_CDH_FILENAME_LEN_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3149"><td class="num" id="LN3149">3149</td><td class="line">  mz_uint8 l = 0, r = 0;</td></tr>
<tr class="codeline" data-linenumber="3150"><td class="num" id="LN3150">3150</td><td class="line">  pL += MZ_ZIP_CENTRAL_DIR_HEADER_SIZE; pR += MZ_ZIP_CENTRAL_DIR_HEADER_SIZE;</td></tr>
<tr class="codeline" data-linenumber="3151"><td class="num" id="LN3151">3151</td><td class="line">  pE = pL + <span class='macro'>MZ_MIN(l_len, r_len)<span class='macro_popup'>(((l_len)&lt;(r_len))?(l_len):(r_len))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3152"><td class="num" id="LN3152">3152</td><td class="line">  <span class='keyword'>while</span> (pL &lt; pE)</td></tr>
<tr class="codeline" data-linenumber="3153"><td class="num" id="LN3153">3153</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3154"><td class="num" id="LN3154">3154</td><td class="line">    <span class='keyword'>if</span> ((l = <span class='macro'>MZ_TOLOWER(*pL)<span class='macro_popup'>((((*pL) &gt;= 'A') &amp;&amp; ((*pL) &lt;= 'Z')) ? ((*pL) - 'A'<br> + 'a') : (*pL))</span></span>) != (r = <span class='macro'>MZ_TOLOWER(*pR)<span class='macro_popup'>((((*pR) &gt;= 'A') &amp;&amp; ((*pR) &lt;= 'Z')) ? ((*pR) - 'A'<br> + 'a') : (*pR))</span></span>))</td></tr>
<tr class="codeline" data-linenumber="3155"><td class="num" id="LN3155">3155</td><td class="line">      <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3156"><td class="num" id="LN3156">3156</td><td class="line">    pL++; pR++;</td></tr>
<tr class="codeline" data-linenumber="3157"><td class="num" id="LN3157">3157</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3158"><td class="num" id="LN3158">3158</td><td class="line">  <span class='keyword'>return</span> (pL == pE) ? (l_len &lt; r_len) : (l &lt; r);</td></tr>
<tr class="codeline" data-linenumber="3159"><td class="num" id="LN3159">3159</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3160"><td class="num" id="LN3160">3160</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3161"><td class="num" id="LN3161">3161</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_SWAP_UINT32(a, b)<span class='macro_popup'>do { mz_uint32 t = a; a = b; b = t; } while (0)</span></span> do { mz_uint32 t = a; a = b; b = t; } <span class='macro'>MZ_MACRO_END<span class='macro_popup'>while (0)</span></span></span></td></tr>
<tr class="codeline" data-linenumber="3162"><td class="num" id="LN3162">3162</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3163"><td class="num" id="LN3163">3163</td><td class="line"><span class='comment'>// Heap sort of lowercased filenames, used to help accelerate plain central directory searches by mz_zip_reader_locate_file(). (Could also use qsort(), but it could allocate memory.)</span></td></tr>
<tr class="codeline" data-linenumber="3164"><td class="num" id="LN3164">3164</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> mz_zip_reader_sort_central_dir_offsets_by_filename(mz_zip_archive *pZip)</td></tr>
<tr class="codeline" data-linenumber="3165"><td class="num" id="LN3165">3165</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3166"><td class="num" id="LN3166">3166</td><td class="line">  mz_zip_internal_state *pState = pZip-&gt;m_pState;</td></tr>
<tr class="codeline" data-linenumber="3167"><td class="num" id="LN3167">3167</td><td class="line">  <span class='keyword'>const</span> mz_zip_array *pCentral_dir_offsets = &amp;pState-&gt;m_central_dir_offsets;</td></tr>
<tr class="codeline" data-linenumber="3168"><td class="num" id="LN3168">3168</td><td class="line">  <span class='keyword'>const</span> mz_zip_array *pCentral_dir = &amp;pState-&gt;m_central_dir;</td></tr>
<tr class="codeline" data-linenumber="3169"><td class="num" id="LN3169">3169</td><td class="line">  mz_uint32 *pIndices = &amp;<span class='macro'>MZ_ZIP_ARRAY_ELEMENT(&amp;pState-&gt;m_sorted_central_dir_offsets, mz_uint32, 0)<span class='macro_popup'>((mz_uint32 *)((&amp;pState-&gt;m_sorted_central_dir_offsets)<br>-&gt;m_p))[0]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3170"><td class="num" id="LN3170">3170</td><td class="line">  <span class='keyword'>const</span> <span class='keyword'>int</span> size = pZip-&gt;m_total_files;</td></tr>
<tr class="codeline" data-linenumber="3171"><td class="num" id="LN3171">3171</td><td class="line">  <span class='keyword'>int</span> start = (size - 2) &gt;&gt; 1, end;</td></tr>
<tr class="codeline" data-linenumber="3172"><td class="num" id="LN3172">3172</td><td class="line">  <span class='keyword'>while</span> (start &gt;= 0)</td></tr>
<tr class="codeline" data-linenumber="3173"><td class="num" id="LN3173">3173</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3174"><td class="num" id="LN3174">3174</td><td class="line">    <span class='keyword'>int</span> child, root = start;</td></tr>
<tr class="codeline" data-linenumber="3175"><td class="num" id="LN3175">3175</td><td class="line">    <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="3176"><td class="num" id="LN3176">3176</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3177"><td class="num" id="LN3177">3177</td><td class="line">      <span class='keyword'>if</span> ((child = (root &lt;&lt; 1) + 1) &gt;= size)</td></tr>
<tr class="codeline" data-linenumber="3178"><td class="num" id="LN3178">3178</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3179"><td class="num" id="LN3179">3179</td><td class="line">      child += (((child + 1) &lt; size) &amp;&amp; (mz_zip_reader_filename_less(pCentral_dir, pCentral_dir_offsets, pIndices[child], pIndices[child + 1])));</td></tr>
<tr class="codeline" data-linenumber="3180"><td class="num" id="LN3180">3180</td><td class="line">      <span class='keyword'>if</span> (!mz_zip_reader_filename_less(pCentral_dir, pCentral_dir_offsets, pIndices[root], pIndices[child]))</td></tr>
<tr class="codeline" data-linenumber="3181"><td class="num" id="LN3181">3181</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3182"><td class="num" id="LN3182">3182</td><td class="line">      <span class='macro'>MZ_SWAP_UINT32(pIndices[root], pIndices[child])<span class='macro_popup'>do { mz_uint32 t = pIndices[root]; pIndices[root] = pIndices[<br>child]; pIndices[child] = t; } while (0)</span></span>; root = child;</td></tr>
<tr class="codeline" data-linenumber="3183"><td class="num" id="LN3183">3183</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3184"><td class="num" id="LN3184">3184</td><td class="line">    start--;</td></tr>
<tr class="codeline" data-linenumber="3185"><td class="num" id="LN3185">3185</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3186"><td class="num" id="LN3186">3186</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3187"><td class="num" id="LN3187">3187</td><td class="line">  end = size - 1;</td></tr>
<tr class="codeline" data-linenumber="3188"><td class="num" id="LN3188">3188</td><td class="line">  <span class='keyword'>while</span> (end &gt; 0)</td></tr>
<tr class="codeline" data-linenumber="3189"><td class="num" id="LN3189">3189</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3190"><td class="num" id="LN3190">3190</td><td class="line">    <span class='keyword'>int</span> child, root = 0;</td></tr>
<tr class="codeline" data-linenumber="3191"><td class="num" id="LN3191">3191</td><td class="line">    <span class='macro'>MZ_SWAP_UINT32(pIndices[end], pIndices[0])<span class='macro_popup'>do { mz_uint32 t = pIndices[end]; pIndices[end] = pIndices[0]<br>; pIndices[0] = t; } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3192"><td class="num" id="LN3192">3192</td><td class="line">    <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="3193"><td class="num" id="LN3193">3193</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3194"><td class="num" id="LN3194">3194</td><td class="line">      <span class='keyword'>if</span> ((child = (root &lt;&lt; 1) + 1) &gt;= end)</td></tr>
<tr class="codeline" data-linenumber="3195"><td class="num" id="LN3195">3195</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3196"><td class="num" id="LN3196">3196</td><td class="line">      child += (((child + 1) &lt; end) &amp;&amp; mz_zip_reader_filename_less(pCentral_dir, pCentral_dir_offsets, pIndices[child], pIndices[child + 1]));</td></tr>
<tr class="codeline" data-linenumber="3197"><td class="num" id="LN3197">3197</td><td class="line">      <span class='keyword'>if</span> (!mz_zip_reader_filename_less(pCentral_dir, pCentral_dir_offsets, pIndices[root], pIndices[child]))</td></tr>
<tr class="codeline" data-linenumber="3198"><td class="num" id="LN3198">3198</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3199"><td class="num" id="LN3199">3199</td><td class="line">      <span class='macro'>MZ_SWAP_UINT32(pIndices[root], pIndices[child])<span class='macro_popup'>do { mz_uint32 t = pIndices[root]; pIndices[root] = pIndices[<br>child]; pIndices[child] = t; } while (0)</span></span>; root = child;</td></tr>
<tr class="codeline" data-linenumber="3200"><td class="num" id="LN3200">3200</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3201"><td class="num" id="LN3201">3201</td><td class="line">    end--;</td></tr>
<tr class="codeline" data-linenumber="3202"><td class="num" id="LN3202">3202</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3203"><td class="num" id="LN3203">3203</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3204"><td class="num" id="LN3204">3204</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3205"><td class="num" id="LN3205">3205</td><td class="line"><span class='keyword'>static</span> mz_bool mz_zip_reader_read_central_dir(mz_zip_archive *pZip, mz_uint32 flags)</td></tr>
<tr class="codeline" data-linenumber="3206"><td class="num" id="LN3206">3206</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3207"><td class="num" id="LN3207">3207</td><td class="line">  mz_uint cdir_size, num_this_disk, cdir_disk_index;</td></tr>
<tr class="codeline" data-linenumber="3208"><td class="num" id="LN3208">3208</td><td class="line">  mz_uint64 cdir_ofs;</td></tr>
<tr class="codeline" data-linenumber="3209"><td class="num" id="LN3209">3209</td><td class="line">  mz_int64 cur_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="3210"><td class="num" id="LN3210">3210</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *p;</td></tr>
<tr class="codeline" data-linenumber="3211"><td class="num" id="LN3211">3211</td><td class="line">  mz_uint32 buf_u32[4096 / <span class='keyword'>sizeof</span>(mz_uint32)]; mz_uint8 *pBuf = (mz_uint8 *)buf_u32;</td></tr>
<tr class="codeline" data-linenumber="3212"><td class="num" id="LN3212">3212</td><td class="line">  mz_bool sort_central_dir = ((flags &amp; MZ_ZIP_FLAG_DO_NOT_SORT_CENTRAL_DIRECTORY) == 0);</td></tr>
<tr class="codeline" data-linenumber="3213"><td class="num" id="LN3213">3213</td><td class="line">  mz_bool zip_signature_found = 0;</td></tr>
<tr class="codeline" data-linenumber="3214"><td class="num" id="LN3214">3214</td><td class="line">  <span class='comment'>// Basic sanity checks - reject files which are too small, and check the first 4 bytes of the file to make sure a local header is there.</span></td></tr>
<tr class="codeline" data-linenumber="3215"><td class="num" id="LN3215">3215</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_archive_size &lt; MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIZE)</td></tr>
<tr class="codeline" data-linenumber="3216"><td class="num" id="LN3216">3216</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3217"><td class="num" id="LN3217">3217</td><td class="line">  <span class='comment'>// Find the end of central directory record by scanning the file from the end towards the beginning.</span></td></tr>
<tr class="codeline" data-linenumber="3218"><td class="num" id="LN3218">3218</td><td class="line">  cur_file_ofs = <span class='macro'>MZ_MAX((mz_int64)pZip-&gt;m_archive_size - (mz_int64)<span class='keyword'>sizeof</span>(buf_u32), 0)<span class='macro_popup'>((((mz_int64)pZip-&gt;m_archive_size - (mz_int64)sizeof(buf_u32<br>))&gt;(0))?((mz_int64)pZip-&gt;m_archive_size - (mz_int64)sizeof<br>(buf_u32)):(0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3219"><td class="num" id="LN3219">3219</td><td class="line">  <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="3220"><td class="num" id="LN3220">3220</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3221"><td class="num" id="LN3221">3221</td><td class="line">    <span class='keyword'>int</span> i, n = (<span class='keyword'>int</span>)<span class='macro'>MZ_MIN(<span class='keyword'>sizeof</span>(buf_u32), pZip-&gt;m_archive_size - cur_file_ofs)<span class='macro_popup'>(((sizeof(buf_u32))&lt;(pZip-&gt;m_archive_size - cur_file_ofs<br>))?(sizeof(buf_u32)):(pZip-&gt;m_archive_size - cur_file_ofs)<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3222"><td class="num" id="LN3222">3222</td><td class="line">    <span class='keyword'>if</span> (pZip-&gt;m_pRead(pZip-&gt;m_pIO_opaque, cur_file_ofs, pBuf, n) != (mz_uint)n)</td></tr>
<tr class="codeline" data-linenumber="3223"><td class="num" id="LN3223">3223</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3224"><td class="num" id="LN3224">3224</td><td class="line">    <span class='keyword'>for</span> (i = n - 4; i &gt;= 0; --i)</td></tr>
<tr class="codeline" data-linenumber="3225"><td class="num" id="LN3225">3225</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3226"><td class="num" id="LN3226">3226</td><td class="line">      <span class='keyword'>if</span> (<span class='macro'>MZ_READ_LE32(pBuf + i)<span class='macro_popup'>*((const mz_uint32 *)(pBuf + i))</span></span> == MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIG)</td></tr>
<tr class="codeline" data-linenumber="3227"><td class="num" id="LN3227">3227</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="3228"><td class="num" id="LN3228">3228</td><td class="line">        <span class='comment'>// Read and verify the end of central directory record.</span></td></tr>
<tr class="codeline" data-linenumber="3229"><td class="num" id="LN3229">3229</td><td class="line">        <span class='keyword'>if</span> (pZip-&gt;m_pRead(pZip-&gt;m_pIO_opaque, cur_file_ofs + i, pBuf, MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIZE) != MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIZE)</td></tr>
<tr class="codeline" data-linenumber="3230"><td class="num" id="LN3230">3230</td><td class="line">          <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="3231"><td class="num" id="LN3231">3231</td><td class="line">        <span class='keyword'>if</span> ((<span class='macro'>MZ_READ_LE32(pBuf + MZ_ZIP_ECDH_SIG_OFS)<span class='macro_popup'>*((const mz_uint32 *)(pBuf + MZ_ZIP_ECDH_SIG_OFS))</span></span> != MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIG) ||</td></tr>
<tr class="codeline" data-linenumber="3232"><td class="num" id="LN3232">3232</td><td class="line">        ((pZip-&gt;m_total_files = <span class='macro'>MZ_READ_LE16(pBuf + MZ_ZIP_ECDH_CDIR_TOTAL_ENTRIES_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pBuf + MZ_ZIP_ECDH_CDIR_TOTAL_ENTRIES_OFS<br>))</span></span>) != <span class='macro'>MZ_READ_LE16(pBuf + MZ_ZIP_ECDH_CDIR_NUM_ENTRIES_ON_DISK_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pBuf + MZ_ZIP_ECDH_CDIR_NUM_ENTRIES_ON_DISK_OFS<br>))</span></span>))</td></tr>
<tr class="codeline" data-linenumber="3233"><td class="num" id="LN3233">3233</td><td class="line">          <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="3234"><td class="num" id="LN3234">3234</td><td class="line">        zip_signature_found = 1;</td></tr>
<tr class="codeline" data-linenumber="3235"><td class="num" id="LN3235">3235</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3236"><td class="num" id="LN3236">3236</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="3237"><td class="num" id="LN3237">3237</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3238"><td class="num" id="LN3238">3238</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3239"><td class="num" id="LN3239">3239</td><td class="line">    <span class='keyword'>if</span> (zip_signature_found)</td></tr>
<tr class="codeline" data-linenumber="3240"><td class="num" id="LN3240">3240</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3241"><td class="num" id="LN3241">3241</td><td class="line">      cur_file_ofs += i;</td></tr>
<tr class="codeline" data-linenumber="3242"><td class="num" id="LN3242">3242</td><td class="line">      <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3243"><td class="num" id="LN3243">3243</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3244"><td class="num" id="LN3244">3244</td><td class="line">    <span class='keyword'>if</span> ((!cur_file_ofs) || (cur_file_ofs &lt; MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIZE))</td></tr>
<tr class="codeline" data-linenumber="3245"><td class="num" id="LN3245">3245</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3246"><td class="num" id="LN3246">3246</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3247"><td class="num" id="LN3247">3247</td><td class="line">    cur_file_ofs = <span class='macro'>MZ_MAX(cur_file_ofs - (mz_int64)(<span class='keyword'>sizeof</span>(buf_u32) - 3), 0)<span class='macro_popup'>(((cur_file_ofs - (mz_int64)(sizeof(buf_u32) - 3))&gt;(0))?(cur_file_ofs<br> - (mz_int64)(sizeof(buf_u32) - 3)):(0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3248"><td class="num" id="LN3248">3248</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3249"><td class="num" id="LN3249">3249</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3250"><td class="num" id="LN3250">3250</td><td class="line">  num_this_disk = <span class='macro'>MZ_READ_LE16(pBuf + MZ_ZIP_ECDH_NUM_THIS_DISK_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pBuf + MZ_ZIP_ECDH_NUM_THIS_DISK_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3251"><td class="num" id="LN3251">3251</td><td class="line">  cdir_disk_index = <span class='macro'>MZ_READ_LE16(pBuf + MZ_ZIP_ECDH_NUM_DISK_CDIR_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pBuf + MZ_ZIP_ECDH_NUM_DISK_CDIR_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3252"><td class="num" id="LN3252">3252</td><td class="line">  <span class='keyword'>if</span> (((num_this_disk | cdir_disk_index) != 0) &amp;&amp; ((num_this_disk != 1) || (cdir_disk_index != 1)))</td></tr>
<tr class="codeline" data-linenumber="3253"><td class="num" id="LN3253">3253</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3254"><td class="num" id="LN3254">3254</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3255"><td class="num" id="LN3255">3255</td><td class="line">  <span class='keyword'>if</span> ((cdir_size = <span class='macro'>MZ_READ_LE32(pBuf + MZ_ZIP_ECDH_CDIR_SIZE_OFS)<span class='macro_popup'>*((const mz_uint32 *)(pBuf + MZ_ZIP_ECDH_CDIR_SIZE_OFS))</span></span>) &lt; pZip-&gt;m_total_files * MZ_ZIP_CENTRAL_DIR_HEADER_SIZE)</td></tr>
<tr class="codeline" data-linenumber="3256"><td class="num" id="LN3256">3256</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3257"><td class="num" id="LN3257">3257</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3258"><td class="num" id="LN3258">3258</td><td class="line">  cdir_ofs = cur_file_ofs - cdir_size;</td></tr>
<tr class="codeline" data-linenumber="3259"><td class="num" id="LN3259">3259</td><td class="line">  <span class='keyword'>if</span> ((cdir_ofs + (mz_uint64)cdir_size) &gt; pZip-&gt;m_archive_size)</td></tr>
<tr class="codeline" data-linenumber="3260"><td class="num" id="LN3260">3260</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3261"><td class="num" id="LN3261">3261</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3262"><td class="num" id="LN3262">3262</td><td class="line">  pZip-&gt;m_central_directory_file_ofs = cdir_ofs;</td></tr>
<tr class="codeline" data-linenumber="3263"><td class="num" id="LN3263">3263</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3264"><td class="num" id="LN3264">3264</td><td class="line">  pZip-&gt;m_archive_file_ofs = cdir_ofs - <span class='macro'>MZ_READ_LE32(pBuf + MZ_ZIP_ECDH_CDIR_OFS_OFS)<span class='macro_popup'>*((const mz_uint32 *)(pBuf + MZ_ZIP_ECDH_CDIR_OFS_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3265"><td class="num" id="LN3265">3265</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_archive_file_ofs &gt; pZip-&gt;m_archive_size)</td></tr>
<tr class="codeline" data-linenumber="3266"><td class="num" id="LN3266">3266</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3267"><td class="num" id="LN3267">3267</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3268"><td class="num" id="LN3268">3268</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_total_files)</td></tr>
<tr class="codeline" data-linenumber="3269"><td class="num" id="LN3269">3269</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3270"><td class="num" id="LN3270">3270</td><td class="line">     mz_uint i, n;</td></tr>
<tr class="codeline" data-linenumber="3271"><td class="num" id="LN3271">3271</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3272"><td class="num" id="LN3272">3272</td><td class="line">    <span class='comment'>// Read the entire central directory into a heap block, and allocate another heap block to hold the unsorted central dir file record offsets, and another to hold the sorted indices.</span></td></tr>
<tr class="codeline" data-linenumber="3273"><td class="num" id="LN3273">3273</td><td class="line">    <span class='keyword'>if</span> ((!mz_zip_array_resize(pZip, &amp;pZip-&gt;m_pState-&gt;m_central_dir, cdir_size, <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>)) ||</td></tr>
<tr class="codeline" data-linenumber="3274"><td class="num" id="LN3274">3274</td><td class="line">        (!mz_zip_array_resize(pZip, &amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets, pZip-&gt;m_total_files, <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>)))</td></tr>
<tr class="codeline" data-linenumber="3275"><td class="num" id="LN3275">3275</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3276"><td class="num" id="LN3276">3276</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3277"><td class="num" id="LN3277">3277</td><td class="line">    <span class='keyword'>if</span> (sort_central_dir)</td></tr>
<tr class="codeline" data-linenumber="3278"><td class="num" id="LN3278">3278</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3279"><td class="num" id="LN3279">3279</td><td class="line">      <span class='keyword'>if</span> (!mz_zip_array_resize(pZip, &amp;pZip-&gt;m_pState-&gt;m_sorted_central_dir_offsets, pZip-&gt;m_total_files, <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="3280"><td class="num" id="LN3280">3280</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3281"><td class="num" id="LN3281">3281</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3282"><td class="num" id="LN3282">3282</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3283"><td class="num" id="LN3283">3283</td><td class="line">    <span class='keyword'>if</span> (pZip-&gt;m_pRead(pZip-&gt;m_pIO_opaque, cdir_ofs, pZip-&gt;m_pState-&gt;m_central_dir.m_p, cdir_size) != cdir_size)</td></tr>
<tr class="codeline" data-linenumber="3284"><td class="num" id="LN3284">3284</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3285"><td class="num" id="LN3285">3285</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3286"><td class="num" id="LN3286">3286</td><td class="line">    <span class='comment'>// Now create an index into the central directory file records, do some basic sanity checking on each record, and check for zip64 entries (which are not yet supported).</span></td></tr>
<tr class="codeline" data-linenumber="3287"><td class="num" id="LN3287">3287</td><td class="line">    p = (<span class='keyword'>const</span> mz_uint8 *)pZip-&gt;m_pState-&gt;m_central_dir.m_p;</td></tr>
<tr class="codeline" data-linenumber="3288"><td class="num" id="LN3288">3288</td><td class="line">    <span class='keyword'>for</span> (n = cdir_size, i = 0; i &lt; pZip-&gt;m_total_files; ++i)</td></tr>
<tr class="codeline" data-linenumber="3289"><td class="num" id="LN3289">3289</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3290"><td class="num" id="LN3290">3290</td><td class="line">      mz_uint total_header_size, comp_size, decomp_size, disk_index;</td></tr>
<tr class="codeline" data-linenumber="3291"><td class="num" id="LN3291">3291</td><td class="line">      <span class='keyword'>if</span> ((n &lt; MZ_ZIP_CENTRAL_DIR_HEADER_SIZE) || (<span class='macro'>MZ_READ_LE32(p)<span class='macro_popup'>*((const mz_uint32 *)(p))</span></span> != MZ_ZIP_CENTRAL_DIR_HEADER_SIG))</td></tr>
<tr class="codeline" data-linenumber="3292"><td class="num" id="LN3292">3292</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3293"><td class="num" id="LN3293">3293</td><td class="line">      <span class='macro'>MZ_ZIP_ARRAY_ELEMENT(&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets, mz_uint32, i)<span class='macro_popup'>((mz_uint32 *)((&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets<br>)-&gt;m_p))[i]</span></span> = (mz_uint32)(p - (<span class='keyword'>const</span> mz_uint8 *)pZip-&gt;m_pState-&gt;m_central_dir.m_p);</td></tr>
<tr class="codeline" data-linenumber="3294"><td class="num" id="LN3294">3294</td><td class="line">      <span class='keyword'>if</span> (sort_central_dir)</td></tr>
<tr class="codeline" data-linenumber="3295"><td class="num" id="LN3295">3295</td><td class="line">        <span class='macro'>MZ_ZIP_ARRAY_ELEMENT(&amp;pZip-&gt;m_pState-&gt;m_sorted_central_dir_offsets, mz_uint32, i)<span class='macro_popup'>((mz_uint32 *)((&amp;pZip-&gt;m_pState-&gt;m_sorted_central_dir_offsets<br>)-&gt;m_p))[i]</span></span> = i;</td></tr>
<tr class="codeline" data-linenumber="3296"><td class="num" id="LN3296">3296</td><td class="line">      comp_size = <span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_COMPRESSED_SIZE_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_COMPRESSED_SIZE_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3297"><td class="num" id="LN3297">3297</td><td class="line">      decomp_size = <span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_DECOMPRESSED_SIZE_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_DECOMPRESSED_SIZE_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3298"><td class="num" id="LN3298">3298</td><td class="line">      <span class='keyword'>if</span> (((!<span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_METHOD_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_METHOD_OFS))</span></span>) &amp;&amp; (decomp_size != comp_size)) || (decomp_size &amp;&amp; !comp_size) || (decomp_size == 0xFFFFFFFF) || (comp_size == 0xFFFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="3299"><td class="num" id="LN3299">3299</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3300"><td class="num" id="LN3300">3300</td><td class="line">      disk_index = <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_DISK_START_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_DISK_START_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3301"><td class="num" id="LN3301">3301</td><td class="line">      <span class='keyword'>if</span> ((disk_index != num_this_disk) &amp;&amp; (disk_index != 1))</td></tr>
<tr class="codeline" data-linenumber="3302"><td class="num" id="LN3302">3302</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3303"><td class="num" id="LN3303">3303</td><td class="line">      <span class='keyword'>if</span> (((mz_uint64)<span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_LOCAL_HEADER_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_LOCAL_HEADER_OFS))</span></span> + MZ_ZIP_LOCAL_DIR_HEADER_SIZE + comp_size) &gt; pZip-&gt;m_archive_size)</td></tr>
<tr class="codeline" data-linenumber="3304"><td class="num" id="LN3304">3304</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3305"><td class="num" id="LN3305">3305</td><td class="line">      <span class='keyword'>if</span> ((total_header_size = MZ_ZIP_CENTRAL_DIR_HEADER_SIZE + <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_FILENAME_LEN_OFS))</span></span> + <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_EXTRA_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_EXTRA_LEN_OFS))</span></span> + <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_COMMENT_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_COMMENT_LEN_OFS))</span></span>) &gt; n)</td></tr>
<tr class="codeline" data-linenumber="3306"><td class="num" id="LN3306">3306</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3307"><td class="num" id="LN3307">3307</td><td class="line">      n -= total_header_size; p += total_header_size;</td></tr>
<tr class="codeline" data-linenumber="3308"><td class="num" id="LN3308">3308</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3309"><td class="num" id="LN3309">3309</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3310"><td class="num" id="LN3310">3310</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3311"><td class="num" id="LN3311">3311</td><td class="line">  <span class='keyword'>if</span> (sort_central_dir)</td></tr>
<tr class="codeline" data-linenumber="3312"><td class="num" id="LN3312">3312</td><td class="line">    mz_zip_reader_sort_central_dir_offsets_by_filename(pZip);</td></tr>
<tr class="codeline" data-linenumber="3313"><td class="num" id="LN3313">3313</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3314"><td class="num" id="LN3314">3314</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3315"><td class="num" id="LN3315">3315</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3316"><td class="num" id="LN3316">3316</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3317"><td class="num" id="LN3317">3317</td><td class="line">mz_bool mz_zip_reader_init(mz_zip_archive *pZip, mz_uint64 size, mz_uint32 flags)</td></tr>
<tr class="codeline" data-linenumber="3318"><td class="num" id="LN3318">3318</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3319"><td class="num" id="LN3319">3319</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (!pZip-&gt;m_pRead))</td></tr>
<tr class="codeline" data-linenumber="3320"><td class="num" id="LN3320">3320</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3321"><td class="num" id="LN3321">3321</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_reader_init_internal(pZip, flags))</td></tr>
<tr class="codeline" data-linenumber="3322"><td class="num" id="LN3322">3322</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3323"><td class="num" id="LN3323">3323</td><td class="line">  pZip-&gt;m_archive_size = size;</td></tr>
<tr class="codeline" data-linenumber="3324"><td class="num" id="LN3324">3324</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_reader_read_central_dir(pZip, flags))</td></tr>
<tr class="codeline" data-linenumber="3325"><td class="num" id="LN3325">3325</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3326"><td class="num" id="LN3326">3326</td><td class="line">    mz_zip_reader_end(pZip);</td></tr>
<tr class="codeline" data-linenumber="3327"><td class="num" id="LN3327">3327</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3328"><td class="num" id="LN3328">3328</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3329"><td class="num" id="LN3329">3329</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3330"><td class="num" id="LN3330">3330</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3331"><td class="num" id="LN3331">3331</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3332"><td class="num" id="LN3332">3332</td><td class="line"><span class='keyword'>static</span> size_t mz_zip_mem_read_func(<span class='keyword'>void</span> *pOpaque, mz_uint64 file_ofs, <span class='keyword'>void</span> *pBuf, size_t n)</td></tr>
<tr class="codeline" data-linenumber="3333"><td class="num" id="LN3333">3333</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3334"><td class="num" id="LN3334">3334</td><td class="line">  mz_zip_archive *pZip = (mz_zip_archive *)pOpaque;</td></tr>
<tr class="codeline" data-linenumber="3335"><td class="num" id="LN3335">3335</td><td class="line">  size_t s = (file_ofs &gt;= pZip-&gt;m_archive_size) ? 0 : (size_t)<span class='macro'>MZ_MIN(pZip-&gt;m_archive_size - file_ofs, n)<span class='macro_popup'>(((pZip-&gt;m_archive_size - file_ofs)&lt;(n))?(pZip-&gt;m_archive_size<br> - file_ofs):(n))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3336"><td class="num" id="LN3336">3336</td><td class="line">  memcpy(pBuf, (<span class='keyword'>const</span> mz_uint8 *)pZip-&gt;m_pState-&gt;m_pMem + file_ofs, s);</td></tr>
<tr class="codeline" data-linenumber="3337"><td class="num" id="LN3337">3337</td><td class="line">  <span class='keyword'>return</span> s;</td></tr>
<tr class="codeline" data-linenumber="3338"><td class="num" id="LN3338">3338</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3339"><td class="num" id="LN3339">3339</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3340"><td class="num" id="LN3340">3340</td><td class="line">mz_bool mz_zip_reader_init_mem(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>void</span> *pMem, size_t size, mz_uint32 flags)</td></tr>
<tr class="codeline" data-linenumber="3341"><td class="num" id="LN3341">3341</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3342"><td class="num" id="LN3342">3342</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_reader_init_internal(pZip, flags))</td></tr>
<tr class="codeline" data-linenumber="3343"><td class="num" id="LN3343">3343</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3344"><td class="num" id="LN3344">3344</td><td class="line">  pZip-&gt;m_archive_size = size;</td></tr>
<tr class="codeline" data-linenumber="3345"><td class="num" id="LN3345">3345</td><td class="line">  pZip-&gt;m_pRead = mz_zip_mem_read_func;</td></tr>
<tr class="codeline" data-linenumber="3346"><td class="num" id="LN3346">3346</td><td class="line">  pZip-&gt;m_pIO_opaque = pZip;</td></tr>
<tr class="codeline" data-linenumber="3347"><td class="num" id="LN3347">3347</td><td class="line"><span class='directive'>#ifdef __cplusplus</span></td></tr>
<tr class="codeline" data-linenumber="3348"><td class="num" id="LN3348">3348</td><td class="line">  pZip-&gt;m_pState-&gt;m_pMem = const_cast&lt;<span class='keyword'>void</span> *&gt;(pMem);</td></tr>
<tr class="codeline" data-linenumber="3349"><td class="num" id="LN3349">3349</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="3350"><td class="num" id="LN3350">3350</td><td class="line">  pZip-&gt;m_pState-&gt;m_pMem = (<span class='keyword'>void</span> *)pMem;</td></tr>
<tr class="codeline" data-linenumber="3351"><td class="num" id="LN3351">3351</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3352"><td class="num" id="LN3352">3352</td><td class="line">  pZip-&gt;m_pState-&gt;m_mem_size = size;</td></tr>
<tr class="codeline" data-linenumber="3353"><td class="num" id="LN3353">3353</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_reader_read_central_dir(pZip, flags))</td></tr>
<tr class="codeline" data-linenumber="3354"><td class="num" id="LN3354">3354</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3355"><td class="num" id="LN3355">3355</td><td class="line">    mz_zip_reader_end(pZip);</td></tr>
<tr class="codeline" data-linenumber="3356"><td class="num" id="LN3356">3356</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3357"><td class="num" id="LN3357">3357</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3358"><td class="num" id="LN3358">3358</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3359"><td class="num" id="LN3359">3359</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3360"><td class="num" id="LN3360">3360</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3361"><td class="num" id="LN3361">3361</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="3362"><td class="num" id="LN3362">3362</td><td class="line"><span class='keyword'>static</span> size_t mz_zip_file_read_func(<span class='keyword'>void</span> *pOpaque, mz_uint64 file_ofs, <span class='keyword'>void</span> *pBuf, size_t n)</td></tr>
<tr class="codeline" data-linenumber="3363"><td class="num" id="LN3363">3363</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3364"><td class="num" id="LN3364">3364</td><td class="line">  mz_zip_archive *pZip = (mz_zip_archive *)pOpaque;</td></tr>
<tr class="codeline" data-linenumber="3365"><td class="num" id="LN3365">3365</td><td class="line">  mz_int64 cur_ofs = <span class='macro'>MZ_FTELL64<span class='macro_popup'>ftello</span></span>(pZip-&gt;m_pState-&gt;m_pFile);</td></tr>
<tr class="codeline" data-linenumber="3366"><td class="num" id="LN3366">3366</td><td class="line">  <span class='keyword'>if</span> (((mz_int64)file_ofs &lt; 0) || (((cur_ofs != (mz_int64)file_ofs)) &amp;&amp; (<span class='macro'>MZ_FSEEK64<span class='macro_popup'>fseeko</span></span>(pZip-&gt;m_pState-&gt;m_pFile, (mz_int64)file_ofs, <span class='macro'>SEEK_SET<span class='macro_popup'>0</span></span>))))</td></tr>
<tr class="codeline" data-linenumber="3367"><td class="num" id="LN3367">3367</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="3368"><td class="num" id="LN3368">3368</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_FREAD<span class='macro_popup'>fread</span></span>(pBuf, 1, n, pZip-&gt;m_pState-&gt;m_pFile);</td></tr>
<tr class="codeline" data-linenumber="3369"><td class="num" id="LN3369">3369</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3370"><td class="num" id="LN3370">3370</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3371"><td class="num" id="LN3371">3371</td><td class="line">mz_bool mz_zip_reader_init_file(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, mz_uint32 flags)</td></tr>
<tr class="codeline" data-linenumber="3372"><td class="num" id="LN3372">3372</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3373"><td class="num" id="LN3373">3373</td><td class="line">  mz_uint64 file_size;</td></tr>
<tr class="codeline" data-linenumber="3374"><td class="num" id="LN3374">3374</td><td class="line">  <span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span> *pFile = <span class='macro'>MZ_FOPEN(pFilename, <span class='string_literal'>"rb"</span>)<span class='macro_popup'>fopen(pFilename, "rb")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3375"><td class="num" id="LN3375">3375</td><td class="line">  <span class='keyword'>if</span> (!pFile)</td></tr>
<tr class="codeline" data-linenumber="3376"><td class="num" id="LN3376">3376</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3377"><td class="num" id="LN3377">3377</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>MZ_FSEEK64<span class='macro_popup'>fseeko</span></span>(pFile, 0, <span class='macro'>SEEK_END<span class='macro_popup'>2</span></span>))</td></tr>
<tr class="codeline" data-linenumber="3378"><td class="num" id="LN3378">3378</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3379"><td class="num" id="LN3379">3379</td><td class="line">    <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pFile);</td></tr>
<tr class="codeline" data-linenumber="3380"><td class="num" id="LN3380">3380</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3381"><td class="num" id="LN3381">3381</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3382"><td class="num" id="LN3382">3382</td><td class="line">  file_size = <span class='macro'>MZ_FTELL64<span class='macro_popup'>ftello</span></span>(pFile);</td></tr>
<tr class="codeline" data-linenumber="3383"><td class="num" id="LN3383">3383</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_reader_init_internal(pZip, flags))</td></tr>
<tr class="codeline" data-linenumber="3384"><td class="num" id="LN3384">3384</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3385"><td class="num" id="LN3385">3385</td><td class="line">    <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pFile);</td></tr>
<tr class="codeline" data-linenumber="3386"><td class="num" id="LN3386">3386</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3387"><td class="num" id="LN3387">3387</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3388"><td class="num" id="LN3388">3388</td><td class="line">  pZip-&gt;m_pRead = mz_zip_file_read_func;</td></tr>
<tr class="codeline" data-linenumber="3389"><td class="num" id="LN3389">3389</td><td class="line">  pZip-&gt;m_pIO_opaque = pZip;</td></tr>
<tr class="codeline" data-linenumber="3390"><td class="num" id="LN3390">3390</td><td class="line">  pZip-&gt;m_pState-&gt;m_pFile = pFile;</td></tr>
<tr class="codeline" data-linenumber="3391"><td class="num" id="LN3391">3391</td><td class="line">  pZip-&gt;m_archive_size = file_size;</td></tr>
<tr class="codeline" data-linenumber="3392"><td class="num" id="LN3392">3392</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_reader_read_central_dir(pZip, flags))</td></tr>
<tr class="codeline" data-linenumber="3393"><td class="num" id="LN3393">3393</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3394"><td class="num" id="LN3394">3394</td><td class="line">    mz_zip_reader_end(pZip);</td></tr>
<tr class="codeline" data-linenumber="3395"><td class="num" id="LN3395">3395</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3396"><td class="num" id="LN3396">3396</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3397"><td class="num" id="LN3397">3397</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3398"><td class="num" id="LN3398">3398</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3399"><td class="num" id="LN3399">3399</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="3400"><td class="num" id="LN3400">3400</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3401"><td class="num" id="LN3401">3401</td><td class="line">mz_uint mz_zip_reader_get_num_files(mz_zip_archive *pZip)</td></tr>
<tr class="codeline" data-linenumber="3402"><td class="num" id="LN3402">3402</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3403"><td class="num" id="LN3403">3403</td><td class="line">  <span class='keyword'>return</span> pZip ? pZip-&gt;m_total_files : 0;</td></tr>
<tr class="codeline" data-linenumber="3404"><td class="num" id="LN3404">3404</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3405"><td class="num" id="LN3405">3405</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3406"><td class="num" id="LN3406">3406</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> <span class='keyword'>const</span> mz_uint8 *mz_zip_reader_get_cdh(mz_zip_archive *pZip, mz_uint file_index)</td></tr>
<tr class="codeline" data-linenumber="3407"><td class="num" id="LN3407">3407</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3408"><td class="num" id="LN3408">3408</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (!pZip-&gt;m_pState) || (file_index &gt;= pZip-&gt;m_total_files) || (pZip-&gt;m_zip_mode != MZ_ZIP_MODE_READING))</td></tr>
<tr class="codeline" data-linenumber="3409"><td class="num" id="LN3409">3409</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3410"><td class="num" id="LN3410">3410</td><td class="line">  <span class='keyword'>return</span> &amp;<span class='macro'>MZ_ZIP_ARRAY_ELEMENT(&amp;pZip-&gt;m_pState-&gt;m_central_dir, mz_uint8, MZ_ZIP_ARRAY_ELEMENT(&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets, mz_uint32, file_index))<span class='macro_popup'>((mz_uint8 *)((&amp;pZip-&gt;m_pState-&gt;m_central_dir)-&gt;<br>m_p))[((mz_uint32 *)((&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets<br>)-&gt;m_p))[file_index]]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3411"><td class="num" id="LN3411">3411</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3412"><td class="num" id="LN3412">3412</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3413"><td class="num" id="LN3413">3413</td><td class="line">mz_bool mz_zip_reader_is_file_encrypted(mz_zip_archive *pZip, mz_uint file_index)</td></tr>
<tr class="codeline" data-linenumber="3414"><td class="num" id="LN3414">3414</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3415"><td class="num" id="LN3415">3415</td><td class="line">  mz_uint m_bit_flag;</td></tr>
<tr class="codeline" data-linenumber="3416"><td class="num" id="LN3416">3416</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *p = mz_zip_reader_get_cdh(pZip, file_index);</td></tr>
<tr class="codeline" data-linenumber="3417"><td class="num" id="LN3417">3417</td><td class="line">  <span class='keyword'>if</span> (!p)</td></tr>
<tr class="codeline" data-linenumber="3418"><td class="num" id="LN3418">3418</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3419"><td class="num" id="LN3419">3419</td><td class="line">  m_bit_flag = <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_BIT_FLAG_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_BIT_FLAG_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3420"><td class="num" id="LN3420">3420</td><td class="line">  <span class='keyword'>return</span> (m_bit_flag &amp; 1);</td></tr>
<tr class="codeline" data-linenumber="3421"><td class="num" id="LN3421">3421</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3422"><td class="num" id="LN3422">3422</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3423"><td class="num" id="LN3423">3423</td><td class="line">mz_bool mz_zip_reader_is_file_a_directory(mz_zip_archive *pZip, mz_uint file_index)</td></tr>
<tr class="codeline" data-linenumber="3424"><td class="num" id="LN3424">3424</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3425"><td class="num" id="LN3425">3425</td><td class="line">  mz_uint filename_len, external_attr;</td></tr>
<tr class="codeline" data-linenumber="3426"><td class="num" id="LN3426">3426</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *p = mz_zip_reader_get_cdh(pZip, file_index);</td></tr>
<tr class="codeline" data-linenumber="3427"><td class="num" id="LN3427">3427</td><td class="line">  <span class='keyword'>if</span> (!p)</td></tr>
<tr class="codeline" data-linenumber="3428"><td class="num" id="LN3428">3428</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3429"><td class="num" id="LN3429">3429</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3430"><td class="num" id="LN3430">3430</td><td class="line">  <span class='comment'>// First see if the filename ends with a '/' character.</span></td></tr>
<tr class="codeline" data-linenumber="3431"><td class="num" id="LN3431">3431</td><td class="line">  filename_len = <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_FILENAME_LEN_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3432"><td class="num" id="LN3432">3432</td><td class="line">  <span class='keyword'>if</span> (filename_len)</td></tr>
<tr class="codeline" data-linenumber="3433"><td class="num" id="LN3433">3433</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3434"><td class="num" id="LN3434">3434</td><td class="line">    <span class='keyword'>if</span> (*(p + MZ_ZIP_CENTRAL_DIR_HEADER_SIZE + filename_len - 1) == '/')</td></tr>
<tr class="codeline" data-linenumber="3435"><td class="num" id="LN3435">3435</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3436"><td class="num" id="LN3436">3436</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3437"><td class="num" id="LN3437">3437</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3438"><td class="num" id="LN3438">3438</td><td class="line">  <span class='comment'>// Bugfix: This code was also checking if the internal attribute was non-zero, which wasn't correct.</span></td></tr>
<tr class="codeline" data-linenumber="3439"><td class="num" id="LN3439">3439</td><td class="line">  <span class='comment'>// Most/all zip writers (hopefully) set DOS file/directory attributes in the low 16-bits, so check for the DOS directory flag and ignore the source OS ID in the created by field.</span></td></tr>
<tr class="codeline" data-linenumber="3440"><td class="num" id="LN3440">3440</td><td class="line">  <span class='comment'>// FIXME: Remove this check? Is it necessary - we already check the filename.</span></td></tr>
<tr class="codeline" data-linenumber="3441"><td class="num" id="LN3441">3441</td><td class="line">  external_attr = <span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_EXTERNAL_ATTR_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_EXTERNAL_ATTR_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3442"><td class="num" id="LN3442">3442</td><td class="line">  <span class='keyword'>if</span> ((external_attr &amp; 0x10) != 0)</td></tr>
<tr class="codeline" data-linenumber="3443"><td class="num" id="LN3443">3443</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3444"><td class="num" id="LN3444">3444</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3445"><td class="num" id="LN3445">3445</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3446"><td class="num" id="LN3446">3446</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3447"><td class="num" id="LN3447">3447</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3448"><td class="num" id="LN3448">3448</td><td class="line">mz_bool mz_zip_reader_file_stat(mz_zip_archive *pZip, mz_uint file_index, mz_zip_archive_file_stat *pStat)</td></tr>
<tr class="codeline" data-linenumber="3449"><td class="num" id="LN3449">3449</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3450"><td class="num" id="LN3450">3450</td><td class="line">  mz_uint n;</td></tr>
<tr class="codeline" data-linenumber="3451"><td class="num" id="LN3451">3451</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *p = mz_zip_reader_get_cdh(pZip, file_index);</td></tr>
<tr class="codeline" data-linenumber="3452"><td class="num" id="LN3452">3452</td><td class="line">  <span class='keyword'>if</span> ((!p) || (!pStat))</td></tr>
<tr class="codeline" data-linenumber="3453"><td class="num" id="LN3453">3453</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3454"><td class="num" id="LN3454">3454</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3455"><td class="num" id="LN3455">3455</td><td class="line">  <span class='comment'>// Unpack the central directory record.</span></td></tr>
<tr class="codeline" data-linenumber="3456"><td class="num" id="LN3456">3456</td><td class="line">  pStat-&gt;m_file_index = file_index;</td></tr>
<tr class="codeline" data-linenumber="3457"><td class="num" id="LN3457">3457</td><td class="line">  pStat-&gt;m_central_dir_ofs = <span class='macro'>MZ_ZIP_ARRAY_ELEMENT(&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets, mz_uint32, file_index)<span class='macro_popup'>((mz_uint32 *)((&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets<br>)-&gt;m_p))[file_index]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3458"><td class="num" id="LN3458">3458</td><td class="line">  pStat-&gt;m_version_made_by = <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_VERSION_MADE_BY_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_VERSION_MADE_BY_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3459"><td class="num" id="LN3459">3459</td><td class="line">  pStat-&gt;m_version_needed = <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_VERSION_NEEDED_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_VERSION_NEEDED_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3460"><td class="num" id="LN3460">3460</td><td class="line">  pStat-&gt;m_bit_flag = <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_BIT_FLAG_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_BIT_FLAG_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3461"><td class="num" id="LN3461">3461</td><td class="line">  pStat-&gt;m_method = <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_METHOD_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_METHOD_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3462"><td class="num" id="LN3462">3462</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="3463"><td class="num" id="LN3463">3463</td><td class="line">  pStat-&gt;m_time = mz_zip_dos_to_time_t(<span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_FILE_TIME_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_FILE_TIME_OFS))</span></span>, <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_FILE_DATE_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_FILE_DATE_OFS))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="3464"><td class="num" id="LN3464">3464</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3465"><td class="num" id="LN3465">3465</td><td class="line">  pStat-&gt;m_crc32 = <span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_CRC32_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_CRC32_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3466"><td class="num" id="LN3466">3466</td><td class="line">  pStat-&gt;m_comp_size = <span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_COMPRESSED_SIZE_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_COMPRESSED_SIZE_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3467"><td class="num" id="LN3467">3467</td><td class="line">  pStat-&gt;m_uncomp_size = <span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_DECOMPRESSED_SIZE_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_DECOMPRESSED_SIZE_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3468"><td class="num" id="LN3468">3468</td><td class="line">  pStat-&gt;m_internal_attr = <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_INTERNAL_ATTR_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_INTERNAL_ATTR_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3469"><td class="num" id="LN3469">3469</td><td class="line">  pStat-&gt;m_external_attr = <span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_EXTERNAL_ATTR_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_EXTERNAL_ATTR_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3470"><td class="num" id="LN3470">3470</td><td class="line">  pStat-&gt;m_local_header_ofs = <span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_LOCAL_HEADER_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_LOCAL_HEADER_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3471"><td class="num" id="LN3471">3471</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3472"><td class="num" id="LN3472">3472</td><td class="line">  <span class='comment'>// Copy as much of the filename and comment as possible.</span></td></tr>
<tr class="codeline" data-linenumber="3473"><td class="num" id="LN3473">3473</td><td class="line">  n = <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_FILENAME_LEN_OFS))</span></span>; n = <span class='macro'>MZ_MIN(n, MZ_ZIP_MAX_ARCHIVE_FILENAME_SIZE - 1)<span class='macro_popup'>(((n)&lt;(MZ_ZIP_MAX_ARCHIVE_FILENAME_SIZE - 1))?(n):(MZ_ZIP_MAX_ARCHIVE_FILENAME_SIZE<br> - 1))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3474"><td class="num" id="LN3474">3474</td><td class="line">  memcpy(pStat-&gt;m_filename, p + MZ_ZIP_CENTRAL_DIR_HEADER_SIZE, n); pStat-&gt;m_filename[n] = '\0';</td></tr>
<tr class="codeline" data-linenumber="3475"><td class="num" id="LN3475">3475</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3476"><td class="num" id="LN3476">3476</td><td class="line">  n = <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_COMMENT_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_COMMENT_LEN_OFS))</span></span>; n = <span class='macro'>MZ_MIN(n, MZ_ZIP_MAX_ARCHIVE_FILE_COMMENT_SIZE - 1)<span class='macro_popup'>(((n)&lt;(MZ_ZIP_MAX_ARCHIVE_FILE_COMMENT_SIZE - 1))?(n):(MZ_ZIP_MAX_ARCHIVE_FILE_COMMENT_SIZE<br> - 1))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3477"><td class="num" id="LN3477">3477</td><td class="line">  pStat-&gt;m_comment_size = n;</td></tr>
<tr class="codeline" data-linenumber="3478"><td class="num" id="LN3478">3478</td><td class="line">  memcpy(pStat-&gt;m_comment, p + MZ_ZIP_CENTRAL_DIR_HEADER_SIZE + <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_FILENAME_LEN_OFS))</span></span> + <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_EXTRA_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_EXTRA_LEN_OFS))</span></span>, n); pStat-&gt;m_comment[n] = '\0';</td></tr>
<tr class="codeline" data-linenumber="3479"><td class="num" id="LN3479">3479</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3480"><td class="num" id="LN3480">3480</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3481"><td class="num" id="LN3481">3481</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3482"><td class="num" id="LN3482">3482</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3483"><td class="num" id="LN3483">3483</td><td class="line">mz_uint mz_zip_reader_get_filename(mz_zip_archive *pZip, mz_uint file_index, <span class='keyword'>char</span> *pFilename, mz_uint filename_buf_size)</td></tr>
<tr class="codeline" data-linenumber="3484"><td class="num" id="LN3484">3484</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3485"><td class="num" id="LN3485">3485</td><td class="line">  mz_uint n;</td></tr>
<tr class="codeline" data-linenumber="3486"><td class="num" id="LN3486">3486</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *p = mz_zip_reader_get_cdh(pZip, file_index);</td></tr>
<tr class="codeline" data-linenumber="3487"><td class="num" id="LN3487">3487</td><td class="line">  <span class='keyword'>if</span> (!p) { <span class='keyword'>if</span> (filename_buf_size) pFilename[0] = '\0'; <span class='keyword'>return</span> 0; }</td></tr>
<tr class="codeline" data-linenumber="3488"><td class="num" id="LN3488">3488</td><td class="line">  n = <span class='macro'>MZ_READ_LE16(p + MZ_ZIP_CDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(p + MZ_ZIP_CDH_FILENAME_LEN_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3489"><td class="num" id="LN3489">3489</td><td class="line">  <span class='keyword'>if</span> (filename_buf_size)</td></tr>
<tr class="codeline" data-linenumber="3490"><td class="num" id="LN3490">3490</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3491"><td class="num" id="LN3491">3491</td><td class="line">    n = <span class='macro'>MZ_MIN(n, filename_buf_size - 1)<span class='macro_popup'>(((n)&lt;(filename_buf_size - 1))?(n):(filename_buf_size - 1)<br>)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3492"><td class="num" id="LN3492">3492</td><td class="line">    memcpy(pFilename, p + MZ_ZIP_CENTRAL_DIR_HEADER_SIZE, n);</td></tr>
<tr class="codeline" data-linenumber="3493"><td class="num" id="LN3493">3493</td><td class="line">    pFilename[n] = '\0';</td></tr>
<tr class="codeline" data-linenumber="3494"><td class="num" id="LN3494">3494</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3495"><td class="num" id="LN3495">3495</td><td class="line">  <span class='keyword'>return</span> n + 1;</td></tr>
<tr class="codeline" data-linenumber="3496"><td class="num" id="LN3496">3496</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3497"><td class="num" id="LN3497">3497</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3498"><td class="num" id="LN3498">3498</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> mz_bool mz_zip_reader_string_equal(<span class='keyword'>const</span> <span class='keyword'>char</span> *pA, <span class='keyword'>const</span> <span class='keyword'>char</span> *pB, mz_uint len, mz_uint flags)</td></tr>
<tr class="codeline" data-linenumber="3499"><td class="num" id="LN3499">3499</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3500"><td class="num" id="LN3500">3500</td><td class="line">  mz_uint i;</td></tr>
<tr class="codeline" data-linenumber="3501"><td class="num" id="LN3501">3501</td><td class="line">  <span class='keyword'>if</span> (flags &amp; MZ_ZIP_FLAG_CASE_SENSITIVE)</td></tr>
<tr class="codeline" data-linenumber="3502"><td class="num" id="LN3502">3502</td><td class="line">    <span class='keyword'>return</span> 0 == memcmp(pA, pB, len);</td></tr>
<tr class="codeline" data-linenumber="3503"><td class="num" id="LN3503">3503</td><td class="line">  <span class='keyword'>for</span> (i = 0; i &lt; len; ++i)</td></tr>
<tr class="codeline" data-linenumber="3504"><td class="num" id="LN3504">3504</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>MZ_TOLOWER(pA[i])<span class='macro_popup'>((((pA[i]) &gt;= 'A') &amp;&amp; ((pA[i]) &lt;= 'Z')) ? ((pA[<br>i]) - 'A' + 'a') : (pA[i]))</span></span> != <span class='macro'>MZ_TOLOWER(pB[i])<span class='macro_popup'>((((pB[i]) &gt;= 'A') &amp;&amp; ((pB[i]) &lt;= 'Z')) ? ((pB[<br>i]) - 'A' + 'a') : (pB[i]))</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3505"><td class="num" id="LN3505">3505</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3506"><td class="num" id="LN3506">3506</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3507"><td class="num" id="LN3507">3507</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3508"><td class="num" id="LN3508">3508</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3509"><td class="num" id="LN3509">3509</td><td class="line"><span class='keyword'>static</span> <span class='macro'>MZ_FORCEINLINE<span class='macro_popup'>inline __attribute__((__always_inline__))</span></span> <span class='keyword'>int</span> mz_zip_reader_filename_compare(<span class='keyword'>const</span> mz_zip_array *pCentral_dir_array, <span class='keyword'>const</span> mz_zip_array *pCentral_dir_offsets, mz_uint l_index, <span class='keyword'>const</span> <span class='keyword'>char</span> *pR, mz_uint r_len)</td></tr>
<tr class="codeline" data-linenumber="3510"><td class="num" id="LN3510">3510</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3511"><td class="num" id="LN3511">3511</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *pL = &amp;<span class='macro'>MZ_ZIP_ARRAY_ELEMENT(pCentral_dir_array, mz_uint8, MZ_ZIP_ARRAY_ELEMENT(pCentral_dir_offsets, mz_uint32, l_index))<span class='macro_popup'>((mz_uint8 *)((pCentral_dir_array)-&gt;m_p))[((mz_uint32 *)((<br>pCentral_dir_offsets)-&gt;m_p))[l_index]]</span></span>, *pE;</td></tr>
<tr class="codeline" data-linenumber="3512"><td class="num" id="LN3512">3512</td><td class="line">  mz_uint l_len = <span class='macro'>MZ_READ_LE16(pL + MZ_ZIP_CDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pL + MZ_ZIP_CDH_FILENAME_LEN_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3513"><td class="num" id="LN3513">3513</td><td class="line">  mz_uint8 l = 0, r = 0;</td></tr>
<tr class="codeline" data-linenumber="3514"><td class="num" id="LN3514">3514</td><td class="line">  pL += MZ_ZIP_CENTRAL_DIR_HEADER_SIZE;</td></tr>
<tr class="codeline" data-linenumber="3515"><td class="num" id="LN3515">3515</td><td class="line">  pE = pL + <span class='macro'>MZ_MIN(l_len, r_len)<span class='macro_popup'>(((l_len)&lt;(r_len))?(l_len):(r_len))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3516"><td class="num" id="LN3516">3516</td><td class="line">  <span class='keyword'>while</span> (pL &lt; pE)</td></tr>
<tr class="codeline" data-linenumber="3517"><td class="num" id="LN3517">3517</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3518"><td class="num" id="LN3518">3518</td><td class="line">    <span class='keyword'>if</span> ((l = <span class='macro'>MZ_TOLOWER(*pL)<span class='macro_popup'>((((*pL) &gt;= 'A') &amp;&amp; ((*pL) &lt;= 'Z')) ? ((*pL) - 'A'<br> + 'a') : (*pL))</span></span>) != (r = <span class='macro'>MZ_TOLOWER(*pR)<span class='macro_popup'>((((*pR) &gt;= 'A') &amp;&amp; ((*pR) &lt;= 'Z')) ? ((*pR) - 'A'<br> + 'a') : (*pR))</span></span>))</td></tr>
<tr class="codeline" data-linenumber="3519"><td class="num" id="LN3519">3519</td><td class="line">      <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3520"><td class="num" id="LN3520">3520</td><td class="line">    pL++; pR++;</td></tr>
<tr class="codeline" data-linenumber="3521"><td class="num" id="LN3521">3521</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3522"><td class="num" id="LN3522">3522</td><td class="line">  <span class='keyword'>return</span> (pL == pE) ? (<span class='keyword'>int</span>)(l_len - r_len) : (l - r);</td></tr>
<tr class="codeline" data-linenumber="3523"><td class="num" id="LN3523">3523</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3524"><td class="num" id="LN3524">3524</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3525"><td class="num" id="LN3525">3525</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>int</span> mz_zip_reader_locate_file_binary_search(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename)</td></tr>
<tr class="codeline" data-linenumber="3526"><td class="num" id="LN3526">3526</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3527"><td class="num" id="LN3527">3527</td><td class="line">  mz_zip_internal_state *pState = pZip-&gt;m_pState;</td></tr>
<tr class="codeline" data-linenumber="3528"><td class="num" id="LN3528">3528</td><td class="line">  <span class='keyword'>const</span> mz_zip_array *pCentral_dir_offsets = &amp;pState-&gt;m_central_dir_offsets;</td></tr>
<tr class="codeline" data-linenumber="3529"><td class="num" id="LN3529">3529</td><td class="line">  <span class='keyword'>const</span> mz_zip_array *pCentral_dir = &amp;pState-&gt;m_central_dir;</td></tr>
<tr class="codeline" data-linenumber="3530"><td class="num" id="LN3530">3530</td><td class="line">  mz_uint32 *pIndices = &amp;<span class='macro'>MZ_ZIP_ARRAY_ELEMENT(&amp;pState-&gt;m_sorted_central_dir_offsets, mz_uint32, 0)<span class='macro_popup'>((mz_uint32 *)((&amp;pState-&gt;m_sorted_central_dir_offsets)<br>-&gt;m_p))[0]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3531"><td class="num" id="LN3531">3531</td><td class="line">  <span class='keyword'>const</span> <span class='keyword'>int</span> size = pZip-&gt;m_total_files;</td></tr>
<tr class="codeline" data-linenumber="3532"><td class="num" id="LN3532">3532</td><td class="line">  <span class='keyword'>const</span> mz_uint filename_len = (mz_uint)strlen(pFilename);</td></tr>
<tr class="codeline" data-linenumber="3533"><td class="num" id="LN3533">3533</td><td class="line">  <span class='keyword'>int</span> l = 0, h = size - 1;</td></tr>
<tr class="codeline" data-linenumber="3534"><td class="num" id="LN3534">3534</td><td class="line">  <span class='keyword'>while</span> (l &lt;= h)</td></tr>
<tr class="codeline" data-linenumber="3535"><td class="num" id="LN3535">3535</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3536"><td class="num" id="LN3536">3536</td><td class="line">    <span class='keyword'>int</span> m = (l + h) &gt;&gt; 1, file_index = pIndices[m], comp = mz_zip_reader_filename_compare(pCentral_dir, pCentral_dir_offsets, file_index, pFilename, filename_len);</td></tr>
<tr class="codeline" data-linenumber="3537"><td class="num" id="LN3537">3537</td><td class="line">    <span class='keyword'>if</span> (!comp)</td></tr>
<tr class="codeline" data-linenumber="3538"><td class="num" id="LN3538">3538</td><td class="line">      <span class='keyword'>return</span> file_index;</td></tr>
<tr class="codeline" data-linenumber="3539"><td class="num" id="LN3539">3539</td><td class="line">    <span class='keyword'>else</span> <span class='keyword'>if</span> (comp &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="3540"><td class="num" id="LN3540">3540</td><td class="line">      l = m + 1;</td></tr>
<tr class="codeline" data-linenumber="3541"><td class="num" id="LN3541">3541</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3542"><td class="num" id="LN3542">3542</td><td class="line">      h = m - 1;</td></tr>
<tr class="codeline" data-linenumber="3543"><td class="num" id="LN3543">3543</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3544"><td class="num" id="LN3544">3544</td><td class="line">  <span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="3545"><td class="num" id="LN3545">3545</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3546"><td class="num" id="LN3546">3546</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3547"><td class="num" id="LN3547">3547</td><td class="line"><span class='keyword'>int</span> mz_zip_reader_locate_file(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pName, <span class='keyword'>const</span> <span class='keyword'>char</span> *pComment, mz_uint flags)</td></tr>
<tr class="codeline" data-linenumber="3548"><td class="num" id="LN3548">3548</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3549"><td class="num" id="LN3549">3549</td><td class="line">  mz_uint file_index; size_t name_len, comment_len;</td></tr>
<tr class="codeline" data-linenumber="3550"><td class="num" id="LN3550">3550</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (!pZip-&gt;m_pState) || (!pName) || (pZip-&gt;m_zip_mode != MZ_ZIP_MODE_READING))</td></tr>
<tr class="codeline" data-linenumber="3551"><td class="num" id="LN3551">3551</td><td class="line">    <span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="3552"><td class="num" id="LN3552">3552</td><td class="line">  <span class='keyword'>if</span> (((flags &amp; (MZ_ZIP_FLAG_IGNORE_PATH | MZ_ZIP_FLAG_CASE_SENSITIVE)) == 0) &amp;&amp; (!pComment) &amp;&amp; (pZip-&gt;m_pState-&gt;m_sorted_central_dir_offsets.m_size))</td></tr>
<tr class="codeline" data-linenumber="3553"><td class="num" id="LN3553">3553</td><td class="line">    <span class='keyword'>return</span> mz_zip_reader_locate_file_binary_search(pZip, pName);</td></tr>
<tr class="codeline" data-linenumber="3554"><td class="num" id="LN3554">3554</td><td class="line">  name_len = strlen(pName); <span class='keyword'>if</span> (name_len &gt; 0xFFFF) <span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="3555"><td class="num" id="LN3555">3555</td><td class="line">  comment_len = pComment ? strlen(pComment) : 0; <span class='keyword'>if</span> (comment_len &gt; 0xFFFF) <span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="3556"><td class="num" id="LN3556">3556</td><td class="line">  <span class='keyword'>for</span> (file_index = 0; file_index &lt; pZip-&gt;m_total_files; file_index++)</td></tr>
<tr class="codeline" data-linenumber="3557"><td class="num" id="LN3557">3557</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3558"><td class="num" id="LN3558">3558</td><td class="line">    <span class='keyword'>const</span> mz_uint8 *pHeader = &amp;<span class='macro'>MZ_ZIP_ARRAY_ELEMENT(&amp;pZip-&gt;m_pState-&gt;m_central_dir, mz_uint8, MZ_ZIP_ARRAY_ELEMENT(&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets, mz_uint32, file_index))<span class='macro_popup'>((mz_uint8 *)((&amp;pZip-&gt;m_pState-&gt;m_central_dir)-&gt;<br>m_p))[((mz_uint32 *)((&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets<br>)-&gt;m_p))[file_index]]</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3559"><td class="num" id="LN3559">3559</td><td class="line">    mz_uint filename_len = <span class='macro'>MZ_READ_LE16(pHeader + MZ_ZIP_CDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pHeader + MZ_ZIP_CDH_FILENAME_LEN_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3560"><td class="num" id="LN3560">3560</td><td class="line">    <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename = (<span class='keyword'>const</span> <span class='keyword'>char</span> *)pHeader + MZ_ZIP_CENTRAL_DIR_HEADER_SIZE;</td></tr>
<tr class="codeline" data-linenumber="3561"><td class="num" id="LN3561">3561</td><td class="line">    <span class='keyword'>if</span> (filename_len &lt; name_len)</td></tr>
<tr class="codeline" data-linenumber="3562"><td class="num" id="LN3562">3562</td><td class="line">      <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="3563"><td class="num" id="LN3563">3563</td><td class="line">    <span class='keyword'>if</span> (comment_len)</td></tr>
<tr class="codeline" data-linenumber="3564"><td class="num" id="LN3564">3564</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3565"><td class="num" id="LN3565">3565</td><td class="line">      mz_uint file_extra_len = <span class='macro'>MZ_READ_LE16(pHeader + MZ_ZIP_CDH_EXTRA_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pHeader + MZ_ZIP_CDH_EXTRA_LEN_OFS))</span></span>, file_comment_len = <span class='macro'>MZ_READ_LE16(pHeader + MZ_ZIP_CDH_COMMENT_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pHeader + MZ_ZIP_CDH_COMMENT_LEN_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3566"><td class="num" id="LN3566">3566</td><td class="line">      <span class='keyword'>const</span> <span class='keyword'>char</span> *pFile_comment = pFilename + filename_len + file_extra_len;</td></tr>
<tr class="codeline" data-linenumber="3567"><td class="num" id="LN3567">3567</td><td class="line">      <span class='keyword'>if</span> ((file_comment_len != comment_len) || (!mz_zip_reader_string_equal(pComment, pFile_comment, file_comment_len, flags)))</td></tr>
<tr class="codeline" data-linenumber="3568"><td class="num" id="LN3568">3568</td><td class="line">        <span class='keyword'>continue</span>;</td></tr>
<tr class="codeline" data-linenumber="3569"><td class="num" id="LN3569">3569</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3570"><td class="num" id="LN3570">3570</td><td class="line">    <span class='keyword'>if</span> ((flags &amp; MZ_ZIP_FLAG_IGNORE_PATH) &amp;&amp; (filename_len))</td></tr>
<tr class="codeline" data-linenumber="3571"><td class="num" id="LN3571">3571</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3572"><td class="num" id="LN3572">3572</td><td class="line">      <span class='keyword'>int</span> ofs = filename_len - 1;</td></tr>
<tr class="codeline" data-linenumber="3573"><td class="num" id="LN3573">3573</td><td class="line">      <span class='keyword'>do</span></td></tr>
<tr class="codeline" data-linenumber="3574"><td class="num" id="LN3574">3574</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="3575"><td class="num" id="LN3575">3575</td><td class="line">        <span class='keyword'>if</span> ((pFilename[ofs] == '/') || (pFilename[ofs] == '\\') || (pFilename[ofs] == ':'))</td></tr>
<tr class="codeline" data-linenumber="3576"><td class="num" id="LN3576">3576</td><td class="line">          <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3577"><td class="num" id="LN3577">3577</td><td class="line">      } <span class='keyword'>while</span> (--ofs &gt;= 0);</td></tr>
<tr class="codeline" data-linenumber="3578"><td class="num" id="LN3578">3578</td><td class="line">      ofs++;</td></tr>
<tr class="codeline" data-linenumber="3579"><td class="num" id="LN3579">3579</td><td class="line">      pFilename += ofs; filename_len -= ofs;</td></tr>
<tr class="codeline" data-linenumber="3580"><td class="num" id="LN3580">3580</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3581"><td class="num" id="LN3581">3581</td><td class="line">    <span class='keyword'>if</span> ((filename_len == name_len) &amp;&amp; (mz_zip_reader_string_equal(pName, pFilename, filename_len, flags)))</td></tr>
<tr class="codeline" data-linenumber="3582"><td class="num" id="LN3582">3582</td><td class="line">      <span class='keyword'>return</span> file_index;</td></tr>
<tr class="codeline" data-linenumber="3583"><td class="num" id="LN3583">3583</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3584"><td class="num" id="LN3584">3584</td><td class="line">  <span class='keyword'>return</span> -1;</td></tr>
<tr class="codeline" data-linenumber="3585"><td class="num" id="LN3585">3585</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3586"><td class="num" id="LN3586">3586</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3587"><td class="num" id="LN3587">3587</td><td class="line">mz_bool mz_zip_reader_extract_to_mem_no_alloc(mz_zip_archive *pZip, mz_uint file_index, <span class='keyword'>void</span> *pBuf, size_t buf_size, mz_uint flags, <span class='keyword'>void</span> *pUser_read_buf, size_t user_read_buf_size)</td></tr>
<tr class="codeline" data-linenumber="3588"><td class="num" id="LN3588">3588</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3589"><td class="num" id="LN3589">3589</td><td class="line">  <span class='keyword'>int</span> status = TINFL_STATUS_DONE;</td></tr>
<tr class="codeline" data-linenumber="3590"><td class="num" id="LN3590">3590</td><td class="line">  mz_uint64 needed_size, cur_file_ofs, comp_remaining, out_buf_ofs = 0, read_buf_size, read_buf_ofs = 0, read_buf_avail;</td></tr>
<tr class="codeline" data-linenumber="3591"><td class="num" id="LN3591">3591</td><td class="line">  mz_zip_archive_file_stat file_stat;</td></tr>
<tr class="codeline" data-linenumber="3592"><td class="num" id="LN3592">3592</td><td class="line">  <span class='keyword'>void</span> *pRead_buf;</td></tr>
<tr class="codeline" data-linenumber="3593"><td class="num" id="LN3593">3593</td><td class="line">  mz_uint32 local_header_u32[(MZ_ZIP_LOCAL_DIR_HEADER_SIZE + <span class='keyword'>sizeof</span>(mz_uint32) - 1) / <span class='keyword'>sizeof</span>(mz_uint32)]; mz_uint8 *pLocal_header = (mz_uint8 *)local_header_u32;</td></tr>
<tr class="codeline" data-linenumber="3594"><td class="num" id="LN3594">3594</td><td class="line">  tinfl_decompressor inflator;</td></tr>
<tr class="codeline" data-linenumber="3595"><td class="num" id="LN3595">3595</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3596"><td class="num" id="LN3596">3596</td><td class="line">  <span class='keyword'>if</span> ((buf_size) &amp;&amp; (!pBuf))</td></tr>
<tr class="codeline" data-linenumber="3597"><td class="num" id="LN3597">3597</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3598"><td class="num" id="LN3598">3598</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3599"><td class="num" id="LN3599">3599</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_reader_file_stat(pZip, file_index, &amp;file_stat))</td></tr>
<tr class="codeline" data-linenumber="3600"><td class="num" id="LN3600">3600</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3601"><td class="num" id="LN3601">3601</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3602"><td class="num" id="LN3602">3602</td><td class="line">  <span class='comment'>// Empty file, or a directory (but not always a directory - I've seen odd zips with directories that have compressed data which inflates to 0 bytes)</span></td></tr>
<tr class="codeline" data-linenumber="3603"><td class="num" id="LN3603">3603</td><td class="line">  <span class='keyword'>if</span> (!file_stat.m_comp_size)</td></tr>
<tr class="codeline" data-linenumber="3604"><td class="num" id="LN3604">3604</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3605"><td class="num" id="LN3605">3605</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3606"><td class="num" id="LN3606">3606</td><td class="line">  <span class='comment'>// Entry is a subdirectory (I've seen old zips with dir entries which have compressed deflate data which inflates to 0 bytes, but these entries claim to uncompress to 512 bytes in the headers).</span></td></tr>
<tr class="codeline" data-linenumber="3607"><td class="num" id="LN3607">3607</td><td class="line">  <span class='comment'>// I'm torn how to handle this case - should it fail instead?</span></td></tr>
<tr class="codeline" data-linenumber="3608"><td class="num" id="LN3608">3608</td><td class="line">  <span class='keyword'>if</span> (mz_zip_reader_is_file_a_directory(pZip, file_index))</td></tr>
<tr class="codeline" data-linenumber="3609"><td class="num" id="LN3609">3609</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3610"><td class="num" id="LN3610">3610</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3611"><td class="num" id="LN3611">3611</td><td class="line">  <span class='comment'>// Encryption and patch files are not supported.</span></td></tr>
<tr class="codeline" data-linenumber="3612"><td class="num" id="LN3612">3612</td><td class="line">  <span class='keyword'>if</span> (file_stat.m_bit_flag &amp; (1 | 32))</td></tr>
<tr class="codeline" data-linenumber="3613"><td class="num" id="LN3613">3613</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3614"><td class="num" id="LN3614">3614</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3615"><td class="num" id="LN3615">3615</td><td class="line">  <span class='comment'>// This function only supports stored and deflate.</span></td></tr>
<tr class="codeline" data-linenumber="3616"><td class="num" id="LN3616">3616</td><td class="line">  <span class='keyword'>if</span> ((!(flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA)) &amp;&amp; (file_stat.m_method != 0) &amp;&amp; (file_stat.m_method != <span class='macro'>MZ_DEFLATED<span class='macro_popup'>8</span></span>))</td></tr>
<tr class="codeline" data-linenumber="3617"><td class="num" id="LN3617">3617</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3618"><td class="num" id="LN3618">3618</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3619"><td class="num" id="LN3619">3619</td><td class="line">  <span class='comment'>// Ensure supplied output buffer is large enough.</span></td></tr>
<tr class="codeline" data-linenumber="3620"><td class="num" id="LN3620">3620</td><td class="line">  needed_size = (flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA) ? file_stat.m_comp_size : file_stat.m_uncomp_size;</td></tr>
<tr class="codeline" data-linenumber="3621"><td class="num" id="LN3621">3621</td><td class="line">  <span class='keyword'>if</span> (buf_size &lt; needed_size)</td></tr>
<tr class="codeline" data-linenumber="3622"><td class="num" id="LN3622">3622</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3623"><td class="num" id="LN3623">3623</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3624"><td class="num" id="LN3624">3624</td><td class="line">  <span class='comment'>// Read and parse the local directory entry.</span></td></tr>
<tr class="codeline" data-linenumber="3625"><td class="num" id="LN3625">3625</td><td class="line">  cur_file_ofs = pZip-&gt;m_archive_file_ofs + file_stat.m_local_header_ofs;</td></tr>
<tr class="codeline" data-linenumber="3626"><td class="num" id="LN3626">3626</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_pRead(pZip-&gt;m_pIO_opaque, cur_file_ofs, pLocal_header, MZ_ZIP_LOCAL_DIR_HEADER_SIZE) != MZ_ZIP_LOCAL_DIR_HEADER_SIZE)</td></tr>
<tr class="codeline" data-linenumber="3627"><td class="num" id="LN3627">3627</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3628"><td class="num" id="LN3628">3628</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>MZ_READ_LE32(pLocal_header)<span class='macro_popup'>*((const mz_uint32 *)(pLocal_header))</span></span> != MZ_ZIP_LOCAL_DIR_HEADER_SIG)</td></tr>
<tr class="codeline" data-linenumber="3629"><td class="num" id="LN3629">3629</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3630"><td class="num" id="LN3630">3630</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3631"><td class="num" id="LN3631">3631</td><td class="line">  cur_file_ofs += MZ_ZIP_LOCAL_DIR_HEADER_SIZE + <span class='macro'>MZ_READ_LE16(pLocal_header + MZ_ZIP_LDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pLocal_header + MZ_ZIP_LDH_FILENAME_LEN_OFS<br>))</span></span> + <span class='macro'>MZ_READ_LE16(pLocal_header + MZ_ZIP_LDH_EXTRA_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pLocal_header + MZ_ZIP_LDH_EXTRA_LEN_OFS<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3632"><td class="num" id="LN3632">3632</td><td class="line">  <span class='keyword'>if</span> ((cur_file_ofs + file_stat.m_comp_size) &gt; pZip-&gt;m_archive_size)</td></tr>
<tr class="codeline" data-linenumber="3633"><td class="num" id="LN3633">3633</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3634"><td class="num" id="LN3634">3634</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3635"><td class="num" id="LN3635">3635</td><td class="line">  <span class='keyword'>if</span> ((flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA) || (!file_stat.m_method))</td></tr>
<tr class="codeline" data-linenumber="3636"><td class="num" id="LN3636">3636</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3637"><td class="num" id="LN3637">3637</td><td class="line">    <span class='comment'>// The file is stored or the caller has requested the compressed data.</span></td></tr>
<tr class="codeline" data-linenumber="3638"><td class="num" id="LN3638">3638</td><td class="line">    <span class='keyword'>if</span> (pZip-&gt;m_pRead(pZip-&gt;m_pIO_opaque, cur_file_ofs, pBuf, (size_t)needed_size) != needed_size)</td></tr>
<tr class="codeline" data-linenumber="3639"><td class="num" id="LN3639">3639</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3640"><td class="num" id="LN3640">3640</td><td class="line">    <span class='keyword'>return</span> ((flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA) != 0) || (mz_crc32(<span class='macro'>MZ_CRC32_INIT<span class='macro_popup'>(0)</span></span>, (<span class='keyword'>const</span> mz_uint8 *)pBuf, (size_t)file_stat.m_uncomp_size) == file_stat.m_crc32);</td></tr>
<tr class="codeline" data-linenumber="3641"><td class="num" id="LN3641">3641</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3642"><td class="num" id="LN3642">3642</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3643"><td class="num" id="LN3643">3643</td><td class="line">  <span class='comment'>// Decompress the file either directly from memory or from a file input buffer.</span></td></tr>
<tr class="codeline" data-linenumber="3644"><td class="num" id="LN3644">3644</td><td class="line">  <span class='macro'>tinfl_init(&amp;inflator)<span class='macro_popup'>do { (&amp;inflator)-&gt;m_state = 0; } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3645"><td class="num" id="LN3645">3645</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3646"><td class="num" id="LN3646">3646</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_pState-&gt;m_pMem)</td></tr>
<tr class="codeline" data-linenumber="3647"><td class="num" id="LN3647">3647</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3648"><td class="num" id="LN3648">3648</td><td class="line">    <span class='comment'>// Read directly from the archive in memory.</span></td></tr>
<tr class="codeline" data-linenumber="3649"><td class="num" id="LN3649">3649</td><td class="line">    pRead_buf = (mz_uint8 *)pZip-&gt;m_pState-&gt;m_pMem + cur_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="3650"><td class="num" id="LN3650">3650</td><td class="line">    read_buf_size = read_buf_avail = file_stat.m_comp_size;</td></tr>
<tr class="codeline" data-linenumber="3651"><td class="num" id="LN3651">3651</td><td class="line">    comp_remaining = 0;</td></tr>
<tr class="codeline" data-linenumber="3652"><td class="num" id="LN3652">3652</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3653"><td class="num" id="LN3653">3653</td><td class="line">  <span class='keyword'>else</span> <span class='keyword'>if</span> (pUser_read_buf)</td></tr>
<tr class="codeline" data-linenumber="3654"><td class="num" id="LN3654">3654</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3655"><td class="num" id="LN3655">3655</td><td class="line">    <span class='comment'>// Use a user provided read buffer.</span></td></tr>
<tr class="codeline" data-linenumber="3656"><td class="num" id="LN3656">3656</td><td class="line">    <span class='keyword'>if</span> (!user_read_buf_size)</td></tr>
<tr class="codeline" data-linenumber="3657"><td class="num" id="LN3657">3657</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3658"><td class="num" id="LN3658">3658</td><td class="line">    pRead_buf = (mz_uint8 *)pUser_read_buf;</td></tr>
<tr class="codeline" data-linenumber="3659"><td class="num" id="LN3659">3659</td><td class="line">    read_buf_size = user_read_buf_size;</td></tr>
<tr class="codeline" data-linenumber="3660"><td class="num" id="LN3660">3660</td><td class="line">    read_buf_avail = 0;</td></tr>
<tr class="codeline" data-linenumber="3661"><td class="num" id="LN3661">3661</td><td class="line">    comp_remaining = file_stat.m_comp_size;</td></tr>
<tr class="codeline" data-linenumber="3662"><td class="num" id="LN3662">3662</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3663"><td class="num" id="LN3663">3663</td><td class="line">  <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3664"><td class="num" id="LN3664">3664</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3665"><td class="num" id="LN3665">3665</td><td class="line">    <span class='comment'>// Temporarily allocate a read buffer.</span></td></tr>
<tr class="codeline" data-linenumber="3666"><td class="num" id="LN3666">3666</td><td class="line">    read_buf_size = <span class='macro'>MZ_MIN(file_stat.m_comp_size, MZ_ZIP_MAX_IO_BUF_SIZE)<span class='macro_popup'>(((file_stat.m_comp_size)&lt;(MZ_ZIP_MAX_IO_BUF_SIZE))?(file_stat<br>.m_comp_size):(MZ_ZIP_MAX_IO_BUF_SIZE))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3667"><td class="num" id="LN3667">3667</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="3668"><td class="num" id="LN3668">3668</td><td class="line">    <span class='keyword'>if</span> (((0, <span class='keyword'>sizeof</span>(size_t) == <span class='keyword'>sizeof</span>(mz_uint32))) &amp;&amp; (read_buf_size &gt; 0x7FFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="3669"><td class="num" id="LN3669">3669</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="3670"><td class="num" id="LN3670">3670</td><td class="line">    <span class='keyword'>if</span> (((<span class='keyword'>sizeof</span>(size_t) == <span class='keyword'>sizeof</span>(mz_uint32))) &amp;&amp; (read_buf_size &gt; 0x7FFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="3671"><td class="num" id="LN3671">3671</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3672"><td class="num" id="LN3672">3672</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3673"><td class="num" id="LN3673">3673</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pRead_buf = pZip-&gt;m_pAlloc(pZip-&gt;m_pAlloc_opaque, 1, (size_t)read_buf_size)))</td></tr>
<tr class="codeline" data-linenumber="3674"><td class="num" id="LN3674">3674</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3675"><td class="num" id="LN3675">3675</td><td class="line">    read_buf_avail = 0;</td></tr>
<tr class="codeline" data-linenumber="3676"><td class="num" id="LN3676">3676</td><td class="line">    comp_remaining = file_stat.m_comp_size;</td></tr>
<tr class="codeline" data-linenumber="3677"><td class="num" id="LN3677">3677</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3678"><td class="num" id="LN3678">3678</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3679"><td class="num" id="LN3679">3679</td><td class="line">  <span class='keyword'>do</span></td></tr>
<tr class="codeline" data-linenumber="3680"><td class="num" id="LN3680">3680</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3681"><td class="num" id="LN3681">3681</td><td class="line">    size_t in_buf_size, out_buf_size = (size_t)(file_stat.m_uncomp_size - out_buf_ofs);</td></tr>
<tr class="codeline" data-linenumber="3682"><td class="num" id="LN3682">3682</td><td class="line">    <span class='keyword'>if</span> ((!read_buf_avail) &amp;&amp; (!pZip-&gt;m_pState-&gt;m_pMem))</td></tr>
<tr class="codeline" data-linenumber="3683"><td class="num" id="LN3683">3683</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3684"><td class="num" id="LN3684">3684</td><td class="line">      read_buf_avail = <span class='macro'>MZ_MIN(read_buf_size, comp_remaining)<span class='macro_popup'>(((read_buf_size)&lt;(comp_remaining))?(read_buf_size):(comp_remaining<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3685"><td class="num" id="LN3685">3685</td><td class="line">      <span class='keyword'>if</span> (pZip-&gt;m_pRead(pZip-&gt;m_pIO_opaque, cur_file_ofs, pRead_buf, (size_t)read_buf_avail) != read_buf_avail)</td></tr>
<tr class="codeline" data-linenumber="3686"><td class="num" id="LN3686">3686</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="3687"><td class="num" id="LN3687">3687</td><td class="line">        status = TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="3688"><td class="num" id="LN3688">3688</td><td class="line">        <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3689"><td class="num" id="LN3689">3689</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="3690"><td class="num" id="LN3690">3690</td><td class="line">      cur_file_ofs += read_buf_avail;</td></tr>
<tr class="codeline" data-linenumber="3691"><td class="num" id="LN3691">3691</td><td class="line">      comp_remaining -= read_buf_avail;</td></tr>
<tr class="codeline" data-linenumber="3692"><td class="num" id="LN3692">3692</td><td class="line">      read_buf_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="3693"><td class="num" id="LN3693">3693</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3694"><td class="num" id="LN3694">3694</td><td class="line">    in_buf_size = (size_t)read_buf_avail;</td></tr>
<tr class="codeline" data-linenumber="3695"><td class="num" id="LN3695">3695</td><td class="line">    status = tinfl_decompress(&amp;inflator, (mz_uint8 *)pRead_buf + read_buf_ofs, &amp;in_buf_size, (mz_uint8 *)pBuf, (mz_uint8 *)pBuf + out_buf_ofs, &amp;out_buf_size, TINFL_FLAG_USING_NON_WRAPPING_OUTPUT_BUF | (comp_remaining ? TINFL_FLAG_HAS_MORE_INPUT : 0));</td></tr>
<tr class="codeline" data-linenumber="3696"><td class="num" id="LN3696">3696</td><td class="line">    read_buf_avail -= in_buf_size;</td></tr>
<tr class="codeline" data-linenumber="3697"><td class="num" id="LN3697">3697</td><td class="line">    read_buf_ofs += in_buf_size;</td></tr>
<tr class="codeline" data-linenumber="3698"><td class="num" id="LN3698">3698</td><td class="line">    out_buf_ofs += out_buf_size;</td></tr>
<tr class="codeline" data-linenumber="3699"><td class="num" id="LN3699">3699</td><td class="line">  } <span class='keyword'>while</span> (status == TINFL_STATUS_NEEDS_MORE_INPUT);</td></tr>
<tr class="codeline" data-linenumber="3700"><td class="num" id="LN3700">3700</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3701"><td class="num" id="LN3701">3701</td><td class="line">  <span class='keyword'>if</span> (status == TINFL_STATUS_DONE)</td></tr>
<tr class="codeline" data-linenumber="3702"><td class="num" id="LN3702">3702</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3703"><td class="num" id="LN3703">3703</td><td class="line">    <span class='comment'>// Make sure the entire file was decompressed, and check its CRC.</span></td></tr>
<tr class="codeline" data-linenumber="3704"><td class="num" id="LN3704">3704</td><td class="line">    <span class='keyword'>if</span> ((out_buf_ofs != file_stat.m_uncomp_size) || (mz_crc32(<span class='macro'>MZ_CRC32_INIT<span class='macro_popup'>(0)</span></span>, (<span class='keyword'>const</span> mz_uint8 *)pBuf, (size_t)file_stat.m_uncomp_size) != file_stat.m_crc32))</td></tr>
<tr class="codeline" data-linenumber="3705"><td class="num" id="LN3705">3705</td><td class="line">      status = TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="3706"><td class="num" id="LN3706">3706</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3707"><td class="num" id="LN3707">3707</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3708"><td class="num" id="LN3708">3708</td><td class="line">  <span class='keyword'>if</span> ((!pZip-&gt;m_pState-&gt;m_pMem) &amp;&amp; (!pUser_read_buf))</td></tr>
<tr class="codeline" data-linenumber="3709"><td class="num" id="LN3709">3709</td><td class="line">    pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pRead_buf);</td></tr>
<tr class="codeline" data-linenumber="3710"><td class="num" id="LN3710">3710</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3711"><td class="num" id="LN3711">3711</td><td class="line">  <span class='keyword'>return</span> status == TINFL_STATUS_DONE;</td></tr>
<tr class="codeline" data-linenumber="3712"><td class="num" id="LN3712">3712</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3713"><td class="num" id="LN3713">3713</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3714"><td class="num" id="LN3714">3714</td><td class="line">mz_bool mz_zip_reader_extract_file_to_mem_no_alloc(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, <span class='keyword'>void</span> *pBuf, size_t buf_size, mz_uint flags, <span class='keyword'>void</span> *pUser_read_buf, size_t user_read_buf_size)</td></tr>
<tr class="codeline" data-linenumber="3715"><td class="num" id="LN3715">3715</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3716"><td class="num" id="LN3716">3716</td><td class="line">  <span class='keyword'>int</span> file_index = mz_zip_reader_locate_file(pZip, pFilename, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, flags);</td></tr>
<tr class="codeline" data-linenumber="3717"><td class="num" id="LN3717">3717</td><td class="line">  <span class='keyword'>if</span> (file_index &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="3718"><td class="num" id="LN3718">3718</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3719"><td class="num" id="LN3719">3719</td><td class="line">  <span class='keyword'>return</span> mz_zip_reader_extract_to_mem_no_alloc(pZip, file_index, pBuf, buf_size, flags, pUser_read_buf, user_read_buf_size);</td></tr>
<tr class="codeline" data-linenumber="3720"><td class="num" id="LN3720">3720</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3721"><td class="num" id="LN3721">3721</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3722"><td class="num" id="LN3722">3722</td><td class="line">mz_bool mz_zip_reader_extract_to_mem(mz_zip_archive *pZip, mz_uint file_index, <span class='keyword'>void</span> *pBuf, size_t buf_size, mz_uint flags)</td></tr>
<tr class="codeline" data-linenumber="3723"><td class="num" id="LN3723">3723</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3724"><td class="num" id="LN3724">3724</td><td class="line">  <span class='keyword'>return</span> mz_zip_reader_extract_to_mem_no_alloc(pZip, file_index, pBuf, buf_size, flags, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="3725"><td class="num" id="LN3725">3725</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3726"><td class="num" id="LN3726">3726</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3727"><td class="num" id="LN3727">3727</td><td class="line">mz_bool mz_zip_reader_extract_file_to_mem(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, <span class='keyword'>void</span> *pBuf, size_t buf_size, mz_uint flags)</td></tr>
<tr class="codeline" data-linenumber="3728"><td class="num" id="LN3728">3728</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3729"><td class="num" id="LN3729">3729</td><td class="line">  <span class='keyword'>return</span> mz_zip_reader_extract_file_to_mem_no_alloc(pZip, pFilename, pBuf, buf_size, flags, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0);</td></tr>
<tr class="codeline" data-linenumber="3730"><td class="num" id="LN3730">3730</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3731"><td class="num" id="LN3731">3731</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3732"><td class="num" id="LN3732">3732</td><td class="line"><span class='keyword'>void</span> *mz_zip_reader_extract_to_heap(mz_zip_archive *pZip, mz_uint file_index, size_t *pSize, mz_uint flags)</td></tr>
<tr class="codeline" data-linenumber="3733"><td class="num" id="LN3733">3733</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3734"><td class="num" id="LN3734">3734</td><td class="line">  mz_uint64 comp_size, uncomp_size, alloc_size;</td></tr>
<tr class="codeline" data-linenumber="3735"><td class="num" id="LN3735">3735</td><td class="line">  <span class='keyword'>const</span> mz_uint8 *p = mz_zip_reader_get_cdh(pZip, file_index);</td></tr>
<tr class="codeline" data-linenumber="3736"><td class="num" id="LN3736">3736</td><td class="line">  <span class='keyword'>void</span> *pBuf;</td></tr>
<tr class="codeline" data-linenumber="3737"><td class="num" id="LN3737">3737</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3738"><td class="num" id="LN3738">3738</td><td class="line">  <span class='keyword'>if</span> (pSize)</td></tr>
<tr class="codeline" data-linenumber="3739"><td class="num" id="LN3739">3739</td><td class="line">    *pSize = 0;</td></tr>
<tr class="codeline" data-linenumber="3740"><td class="num" id="LN3740">3740</td><td class="line">  <span class='keyword'>if</span> (!p)</td></tr>
<tr class="codeline" data-linenumber="3741"><td class="num" id="LN3741">3741</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3742"><td class="num" id="LN3742">3742</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3743"><td class="num" id="LN3743">3743</td><td class="line">  comp_size = <span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_COMPRESSED_SIZE_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_COMPRESSED_SIZE_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3744"><td class="num" id="LN3744">3744</td><td class="line">  uncomp_size = <span class='macro'>MZ_READ_LE32(p + MZ_ZIP_CDH_DECOMPRESSED_SIZE_OFS)<span class='macro_popup'>*((const mz_uint32 *)(p + MZ_ZIP_CDH_DECOMPRESSED_SIZE_OFS))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3745"><td class="num" id="LN3745">3745</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3746"><td class="num" id="LN3746">3746</td><td class="line">  alloc_size = (flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA) ? comp_size : uncomp_size;</td></tr>
<tr class="codeline" data-linenumber="3747"><td class="num" id="LN3747">3747</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="3748"><td class="num" id="LN3748">3748</td><td class="line">  <span class='keyword'>if</span> (((0, <span class='keyword'>sizeof</span>(size_t) == <span class='keyword'>sizeof</span>(mz_uint32))) &amp;&amp; (alloc_size &gt; 0x7FFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="3749"><td class="num" id="LN3749">3749</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="3750"><td class="num" id="LN3750">3750</td><td class="line">  <span class='keyword'>if</span> (((<span class='keyword'>sizeof</span>(size_t) == <span class='keyword'>sizeof</span>(mz_uint32))) &amp;&amp; (alloc_size &gt; 0x7FFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="3751"><td class="num" id="LN3751">3751</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3752"><td class="num" id="LN3752">3752</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3753"><td class="num" id="LN3753">3753</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pBuf = pZip-&gt;m_pAlloc(pZip-&gt;m_pAlloc_opaque, 1, (size_t)alloc_size)))</td></tr>
<tr class="codeline" data-linenumber="3754"><td class="num" id="LN3754">3754</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3755"><td class="num" id="LN3755">3755</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3756"><td class="num" id="LN3756">3756</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_reader_extract_to_mem(pZip, file_index, pBuf, (size_t)alloc_size, flags))</td></tr>
<tr class="codeline" data-linenumber="3757"><td class="num" id="LN3757">3757</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3758"><td class="num" id="LN3758">3758</td><td class="line">    pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pBuf);</td></tr>
<tr class="codeline" data-linenumber="3759"><td class="num" id="LN3759">3759</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3760"><td class="num" id="LN3760">3760</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3761"><td class="num" id="LN3761">3761</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3762"><td class="num" id="LN3762">3762</td><td class="line">  <span class='keyword'>if</span> (pSize) *pSize = (size_t)alloc_size;</td></tr>
<tr class="codeline" data-linenumber="3763"><td class="num" id="LN3763">3763</td><td class="line">  <span class='keyword'>return</span> pBuf;</td></tr>
<tr class="codeline" data-linenumber="3764"><td class="num" id="LN3764">3764</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3765"><td class="num" id="LN3765">3765</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3766"><td class="num" id="LN3766">3766</td><td class="line"><span class='keyword'>void</span> *mz_zip_reader_extract_file_to_heap(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, size_t *pSize, mz_uint flags)</td></tr>
<tr class="codeline" data-linenumber="3767"><td class="num" id="LN3767">3767</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3768"><td class="num" id="LN3768">3768</td><td class="line">  <span class='keyword'>int</span> file_index = mz_zip_reader_locate_file(pZip, pFilename, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, flags);</td></tr>
<tr class="codeline" data-linenumber="3769"><td class="num" id="LN3769">3769</td><td class="line">  <span class='keyword'>if</span> (file_index &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="3770"><td class="num" id="LN3770">3770</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3771"><td class="num" id="LN3771">3771</td><td class="line">    <span class='keyword'>if</span> (pSize) *pSize = 0;</td></tr>
<tr class="codeline" data-linenumber="3772"><td class="num" id="LN3772">3772</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3773"><td class="num" id="LN3773">3773</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3774"><td class="num" id="LN3774">3774</td><td class="line">  <span class='keyword'>return</span> mz_zip_reader_extract_to_heap(pZip, file_index, pSize, flags);</td></tr>
<tr class="codeline" data-linenumber="3775"><td class="num" id="LN3775">3775</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3776"><td class="num" id="LN3776">3776</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3777"><td class="num" id="LN3777">3777</td><td class="line">mz_bool mz_zip_reader_extract_to_callback(mz_zip_archive *pZip, mz_uint file_index, mz_file_write_func pCallback, <span class='keyword'>void</span> *pOpaque, mz_uint flags)</td></tr>
<tr class="codeline" data-linenumber="3778"><td class="num" id="LN3778">3778</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3779"><td class="num" id="LN3779">3779</td><td class="line">  <span class='keyword'>int</span> status = TINFL_STATUS_DONE; mz_uint file_crc32 = <span class='macro'>MZ_CRC32_INIT<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3780"><td class="num" id="LN3780">3780</td><td class="line">  mz_uint64 read_buf_size, read_buf_ofs = 0, read_buf_avail, comp_remaining, out_buf_ofs = 0, cur_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="3781"><td class="num" id="LN3781">3781</td><td class="line">  mz_zip_archive_file_stat file_stat;</td></tr>
<tr class="codeline" data-linenumber="3782"><td class="num" id="LN3782">3782</td><td class="line">  <span class='keyword'>void</span> *pRead_buf = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>; <span class='keyword'>void</span> *pWrite_buf = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3783"><td class="num" id="LN3783">3783</td><td class="line">  mz_uint32 local_header_u32[(MZ_ZIP_LOCAL_DIR_HEADER_SIZE + <span class='keyword'>sizeof</span>(mz_uint32) - 1) / <span class='keyword'>sizeof</span>(mz_uint32)]; mz_uint8 *pLocal_header = (mz_uint8 *)local_header_u32;</td></tr>
<tr class="codeline" data-linenumber="3784"><td class="num" id="LN3784">3784</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3785"><td class="num" id="LN3785">3785</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_reader_file_stat(pZip, file_index, &amp;file_stat))</td></tr>
<tr class="codeline" data-linenumber="3786"><td class="num" id="LN3786">3786</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3787"><td class="num" id="LN3787">3787</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3788"><td class="num" id="LN3788">3788</td><td class="line">  <span class='comment'>// Empty file, or a directory (but not always a directory - I've seen odd zips with directories that have compressed data which inflates to 0 bytes)</span></td></tr>
<tr class="codeline" data-linenumber="3789"><td class="num" id="LN3789">3789</td><td class="line">  <span class='keyword'>if</span> (!file_stat.m_comp_size)</td></tr>
<tr class="codeline" data-linenumber="3790"><td class="num" id="LN3790">3790</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3791"><td class="num" id="LN3791">3791</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3792"><td class="num" id="LN3792">3792</td><td class="line">  <span class='comment'>// Entry is a subdirectory (I've seen old zips with dir entries which have compressed deflate data which inflates to 0 bytes, but these entries claim to uncompress to 512 bytes in the headers).</span></td></tr>
<tr class="codeline" data-linenumber="3793"><td class="num" id="LN3793">3793</td><td class="line">  <span class='comment'>// I'm torn how to handle this case - should it fail instead?</span></td></tr>
<tr class="codeline" data-linenumber="3794"><td class="num" id="LN3794">3794</td><td class="line">  <span class='keyword'>if</span> (mz_zip_reader_is_file_a_directory(pZip, file_index))</td></tr>
<tr class="codeline" data-linenumber="3795"><td class="num" id="LN3795">3795</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3796"><td class="num" id="LN3796">3796</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3797"><td class="num" id="LN3797">3797</td><td class="line">  <span class='comment'>// Encryption and patch files are not supported.</span></td></tr>
<tr class="codeline" data-linenumber="3798"><td class="num" id="LN3798">3798</td><td class="line">  <span class='keyword'>if</span> (file_stat.m_bit_flag &amp; (1 | 32))</td></tr>
<tr class="codeline" data-linenumber="3799"><td class="num" id="LN3799">3799</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3800"><td class="num" id="LN3800">3800</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3801"><td class="num" id="LN3801">3801</td><td class="line">  <span class='comment'>// This function only supports stored and deflate.</span></td></tr>
<tr class="codeline" data-linenumber="3802"><td class="num" id="LN3802">3802</td><td class="line">  <span class='keyword'>if</span> ((!(flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA)) &amp;&amp; (file_stat.m_method != 0) &amp;&amp; (file_stat.m_method != <span class='macro'>MZ_DEFLATED<span class='macro_popup'>8</span></span>))</td></tr>
<tr class="codeline" data-linenumber="3803"><td class="num" id="LN3803">3803</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3804"><td class="num" id="LN3804">3804</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3805"><td class="num" id="LN3805">3805</td><td class="line">  <span class='comment'>// Read and parse the local directory entry.</span></td></tr>
<tr class="codeline" data-linenumber="3806"><td class="num" id="LN3806">3806</td><td class="line">  cur_file_ofs = file_stat.m_local_header_ofs;</td></tr>
<tr class="codeline" data-linenumber="3807"><td class="num" id="LN3807">3807</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_pRead(pZip-&gt;m_pIO_opaque, cur_file_ofs, pLocal_header, MZ_ZIP_LOCAL_DIR_HEADER_SIZE) != MZ_ZIP_LOCAL_DIR_HEADER_SIZE)</td></tr>
<tr class="codeline" data-linenumber="3808"><td class="num" id="LN3808">3808</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3809"><td class="num" id="LN3809">3809</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>MZ_READ_LE32(pLocal_header)<span class='macro_popup'>*((const mz_uint32 *)(pLocal_header))</span></span> != MZ_ZIP_LOCAL_DIR_HEADER_SIG)</td></tr>
<tr class="codeline" data-linenumber="3810"><td class="num" id="LN3810">3810</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3811"><td class="num" id="LN3811">3811</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3812"><td class="num" id="LN3812">3812</td><td class="line">  cur_file_ofs += MZ_ZIP_LOCAL_DIR_HEADER_SIZE + <span class='macro'>MZ_READ_LE16(pLocal_header + MZ_ZIP_LDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pLocal_header + MZ_ZIP_LDH_FILENAME_LEN_OFS<br>))</span></span> + <span class='macro'>MZ_READ_LE16(pLocal_header + MZ_ZIP_LDH_EXTRA_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pLocal_header + MZ_ZIP_LDH_EXTRA_LEN_OFS<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3813"><td class="num" id="LN3813">3813</td><td class="line">  <span class='keyword'>if</span> ((cur_file_ofs + file_stat.m_comp_size) &gt; pZip-&gt;m_archive_size)</td></tr>
<tr class="codeline" data-linenumber="3814"><td class="num" id="LN3814">3814</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3815"><td class="num" id="LN3815">3815</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3816"><td class="num" id="LN3816">3816</td><td class="line">  <span class='comment'>// Decompress the file either directly from memory or from a file input buffer.</span></td></tr>
<tr class="codeline" data-linenumber="3817"><td class="num" id="LN3817">3817</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_pState-&gt;m_pMem)</td></tr>
<tr class="codeline" data-linenumber="3818"><td class="num" id="LN3818">3818</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3819"><td class="num" id="LN3819">3819</td><td class="line">    pRead_buf = (mz_uint8 *)pZip-&gt;m_pState-&gt;m_pMem + cur_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="3820"><td class="num" id="LN3820">3820</td><td class="line">    read_buf_size = read_buf_avail = file_stat.m_comp_size;</td></tr>
<tr class="codeline" data-linenumber="3821"><td class="num" id="LN3821">3821</td><td class="line">    comp_remaining = 0;</td></tr>
<tr class="codeline" data-linenumber="3822"><td class="num" id="LN3822">3822</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3823"><td class="num" id="LN3823">3823</td><td class="line">  <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3824"><td class="num" id="LN3824">3824</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3825"><td class="num" id="LN3825">3825</td><td class="line">    read_buf_size = <span class='macro'>MZ_MIN(file_stat.m_comp_size, MZ_ZIP_MAX_IO_BUF_SIZE)<span class='macro_popup'>(((file_stat.m_comp_size)&lt;(MZ_ZIP_MAX_IO_BUF_SIZE))?(file_stat<br>.m_comp_size):(MZ_ZIP_MAX_IO_BUF_SIZE))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3826"><td class="num" id="LN3826">3826</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pRead_buf = pZip-&gt;m_pAlloc(pZip-&gt;m_pAlloc_opaque, 1, (size_t)read_buf_size)))</td></tr>
<tr class="codeline" data-linenumber="3827"><td class="num" id="LN3827">3827</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3828"><td class="num" id="LN3828">3828</td><td class="line">    read_buf_avail = 0;</td></tr>
<tr class="codeline" data-linenumber="3829"><td class="num" id="LN3829">3829</td><td class="line">    comp_remaining = file_stat.m_comp_size;</td></tr>
<tr class="codeline" data-linenumber="3830"><td class="num" id="LN3830">3830</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3831"><td class="num" id="LN3831">3831</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3832"><td class="num" id="LN3832">3832</td><td class="line">  <span class='keyword'>if</span> ((flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA) || (!file_stat.m_method))</td></tr>
<tr class="codeline" data-linenumber="3833"><td class="num" id="LN3833">3833</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3834"><td class="num" id="LN3834">3834</td><td class="line">    <span class='comment'>// The file is stored or the caller has requested the compressed data.</span></td></tr>
<tr class="codeline" data-linenumber="3835"><td class="num" id="LN3835">3835</td><td class="line">    <span class='keyword'>if</span> (pZip-&gt;m_pState-&gt;m_pMem)</td></tr>
<tr class="codeline" data-linenumber="3836"><td class="num" id="LN3836">3836</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3837"><td class="num" id="LN3837">3837</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="3838"><td class="num" id="LN3838">3838</td><td class="line">      <span class='keyword'>if</span> (((0, <span class='keyword'>sizeof</span>(size_t) == <span class='keyword'>sizeof</span>(mz_uint32))) &amp;&amp; (file_stat.m_comp_size &gt; 0xFFFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="3839"><td class="num" id="LN3839">3839</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="3840"><td class="num" id="LN3840">3840</td><td class="line">      <span class='keyword'>if</span> (((<span class='keyword'>sizeof</span>(size_t) == <span class='keyword'>sizeof</span>(mz_uint32))) &amp;&amp; (file_stat.m_comp_size &gt; 0xFFFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="3841"><td class="num" id="LN3841">3841</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3842"><td class="num" id="LN3842">3842</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3843"><td class="num" id="LN3843">3843</td><td class="line">      <span class='keyword'>if</span> (pCallback(pOpaque, out_buf_ofs, pRead_buf, (size_t)file_stat.m_comp_size) != file_stat.m_comp_size)</td></tr>
<tr class="codeline" data-linenumber="3844"><td class="num" id="LN3844">3844</td><td class="line">        status = TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="3845"><td class="num" id="LN3845">3845</td><td class="line">      <span class='keyword'>else</span> <span class='keyword'>if</span> (!(flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA))</td></tr>
<tr class="codeline" data-linenumber="3846"><td class="num" id="LN3846">3846</td><td class="line">        file_crc32 = (mz_uint32)mz_crc32(file_crc32, (<span class='keyword'>const</span> mz_uint8 *)pRead_buf, (size_t)file_stat.m_comp_size);</td></tr>
<tr class="codeline" data-linenumber="3847"><td class="num" id="LN3847">3847</td><td class="line">      cur_file_ofs += file_stat.m_comp_size;</td></tr>
<tr class="codeline" data-linenumber="3848"><td class="num" id="LN3848">3848</td><td class="line">      out_buf_ofs += file_stat.m_comp_size;</td></tr>
<tr class="codeline" data-linenumber="3849"><td class="num" id="LN3849">3849</td><td class="line">      comp_remaining = 0;</td></tr>
<tr class="codeline" data-linenumber="3850"><td class="num" id="LN3850">3850</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3851"><td class="num" id="LN3851">3851</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3852"><td class="num" id="LN3852">3852</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3853"><td class="num" id="LN3853">3853</td><td class="line">      <span class='keyword'>while</span> (comp_remaining)</td></tr>
<tr class="codeline" data-linenumber="3854"><td class="num" id="LN3854">3854</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="3855"><td class="num" id="LN3855">3855</td><td class="line">        read_buf_avail = <span class='macro'>MZ_MIN(read_buf_size, comp_remaining)<span class='macro_popup'>(((read_buf_size)&lt;(comp_remaining))?(read_buf_size):(comp_remaining<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3856"><td class="num" id="LN3856">3856</td><td class="line">        <span class='keyword'>if</span> (pZip-&gt;m_pRead(pZip-&gt;m_pIO_opaque, cur_file_ofs, pRead_buf, (size_t)read_buf_avail) != read_buf_avail)</td></tr>
<tr class="codeline" data-linenumber="3857"><td class="num" id="LN3857">3857</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3858"><td class="num" id="LN3858">3858</td><td class="line">          status = TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="3859"><td class="num" id="LN3859">3859</td><td class="line">          <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3860"><td class="num" id="LN3860">3860</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3861"><td class="num" id="LN3861">3861</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3862"><td class="num" id="LN3862">3862</td><td class="line">        <span class='keyword'>if</span> (!(flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA))</td></tr>
<tr class="codeline" data-linenumber="3863"><td class="num" id="LN3863">3863</td><td class="line">          file_crc32 = (mz_uint32)mz_crc32(file_crc32, (<span class='keyword'>const</span> mz_uint8 *)pRead_buf, (size_t)read_buf_avail);</td></tr>
<tr class="codeline" data-linenumber="3864"><td class="num" id="LN3864">3864</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3865"><td class="num" id="LN3865">3865</td><td class="line">        <span class='keyword'>if</span> (pCallback(pOpaque, out_buf_ofs, pRead_buf, (size_t)read_buf_avail) != read_buf_avail)</td></tr>
<tr class="codeline" data-linenumber="3866"><td class="num" id="LN3866">3866</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3867"><td class="num" id="LN3867">3867</td><td class="line">          status = TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="3868"><td class="num" id="LN3868">3868</td><td class="line">          <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3869"><td class="num" id="LN3869">3869</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3870"><td class="num" id="LN3870">3870</td><td class="line">        cur_file_ofs += read_buf_avail;</td></tr>
<tr class="codeline" data-linenumber="3871"><td class="num" id="LN3871">3871</td><td class="line">        out_buf_ofs += read_buf_avail;</td></tr>
<tr class="codeline" data-linenumber="3872"><td class="num" id="LN3872">3872</td><td class="line">        comp_remaining -= read_buf_avail;</td></tr>
<tr class="codeline" data-linenumber="3873"><td class="num" id="LN3873">3873</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="3874"><td class="num" id="LN3874">3874</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3875"><td class="num" id="LN3875">3875</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3876"><td class="num" id="LN3876">3876</td><td class="line">  <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3877"><td class="num" id="LN3877">3877</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3878"><td class="num" id="LN3878">3878</td><td class="line">    tinfl_decompressor inflator;</td></tr>
<tr class="codeline" data-linenumber="3879"><td class="num" id="LN3879">3879</td><td class="line">    <span class='macro'>tinfl_init(&amp;inflator)<span class='macro_popup'>do { (&amp;inflator)-&gt;m_state = 0; } while (0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3880"><td class="num" id="LN3880">3880</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3881"><td class="num" id="LN3881">3881</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pWrite_buf = pZip-&gt;m_pAlloc(pZip-&gt;m_pAlloc_opaque, 1, <span class='macro'>TINFL_LZ_DICT_SIZE<span class='macro_popup'>32768</span></span>)))</td></tr>
<tr class="codeline" data-linenumber="3882"><td class="num" id="LN3882">3882</td><td class="line">      status = TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="3883"><td class="num" id="LN3883">3883</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="3884"><td class="num" id="LN3884">3884</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3885"><td class="num" id="LN3885">3885</td><td class="line">      <span class='keyword'>do</span></td></tr>
<tr class="codeline" data-linenumber="3886"><td class="num" id="LN3886">3886</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="3887"><td class="num" id="LN3887">3887</td><td class="line">        mz_uint8 *pWrite_buf_cur = (mz_uint8 *)pWrite_buf + (out_buf_ofs &amp; (<span class='macro'>TINFL_LZ_DICT_SIZE<span class='macro_popup'>32768</span></span> - 1));</td></tr>
<tr class="codeline" data-linenumber="3888"><td class="num" id="LN3888">3888</td><td class="line">        size_t in_buf_size, out_buf_size = <span class='macro'>TINFL_LZ_DICT_SIZE<span class='macro_popup'>32768</span></span> - (out_buf_ofs &amp; (<span class='macro'>TINFL_LZ_DICT_SIZE<span class='macro_popup'>32768</span></span> - 1));</td></tr>
<tr class="codeline" data-linenumber="3889"><td class="num" id="LN3889">3889</td><td class="line">        <span class='keyword'>if</span> ((!read_buf_avail) &amp;&amp; (!pZip-&gt;m_pState-&gt;m_pMem))</td></tr>
<tr class="codeline" data-linenumber="3890"><td class="num" id="LN3890">3890</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3891"><td class="num" id="LN3891">3891</td><td class="line">          read_buf_avail = <span class='macro'>MZ_MIN(read_buf_size, comp_remaining)<span class='macro_popup'>(((read_buf_size)&lt;(comp_remaining))?(read_buf_size):(comp_remaining<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3892"><td class="num" id="LN3892">3892</td><td class="line">          <span class='keyword'>if</span> (pZip-&gt;m_pRead(pZip-&gt;m_pIO_opaque, cur_file_ofs, pRead_buf, (size_t)read_buf_avail) != read_buf_avail)</td></tr>
<tr class="codeline" data-linenumber="3893"><td class="num" id="LN3893">3893</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="3894"><td class="num" id="LN3894">3894</td><td class="line">            status = TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="3895"><td class="num" id="LN3895">3895</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3896"><td class="num" id="LN3896">3896</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="3897"><td class="num" id="LN3897">3897</td><td class="line">          cur_file_ofs += read_buf_avail;</td></tr>
<tr class="codeline" data-linenumber="3898"><td class="num" id="LN3898">3898</td><td class="line">          comp_remaining -= read_buf_avail;</td></tr>
<tr class="codeline" data-linenumber="3899"><td class="num" id="LN3899">3899</td><td class="line">          read_buf_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="3900"><td class="num" id="LN3900">3900</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3901"><td class="num" id="LN3901">3901</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3902"><td class="num" id="LN3902">3902</td><td class="line">        in_buf_size = (size_t)read_buf_avail;</td></tr>
<tr class="codeline" data-linenumber="3903"><td class="num" id="LN3903">3903</td><td class="line">        status = tinfl_decompress(&amp;inflator, (<span class='keyword'>const</span> mz_uint8 *)pRead_buf + read_buf_ofs, &amp;in_buf_size, (mz_uint8 *)pWrite_buf, pWrite_buf_cur, &amp;out_buf_size, comp_remaining ? TINFL_FLAG_HAS_MORE_INPUT : 0);</td></tr>
<tr class="codeline" data-linenumber="3904"><td class="num" id="LN3904">3904</td><td class="line">        read_buf_avail -= in_buf_size;</td></tr>
<tr class="codeline" data-linenumber="3905"><td class="num" id="LN3905">3905</td><td class="line">        read_buf_ofs += in_buf_size;</td></tr>
<tr class="codeline" data-linenumber="3906"><td class="num" id="LN3906">3906</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3907"><td class="num" id="LN3907">3907</td><td class="line">        <span class='keyword'>if</span> (out_buf_size)</td></tr>
<tr class="codeline" data-linenumber="3908"><td class="num" id="LN3908">3908</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="3909"><td class="num" id="LN3909">3909</td><td class="line">          <span class='keyword'>if</span> (pCallback(pOpaque, out_buf_ofs, pWrite_buf_cur, out_buf_size) != out_buf_size)</td></tr>
<tr class="codeline" data-linenumber="3910"><td class="num" id="LN3910">3910</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="3911"><td class="num" id="LN3911">3911</td><td class="line">            status = TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="3912"><td class="num" id="LN3912">3912</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3913"><td class="num" id="LN3913">3913</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="3914"><td class="num" id="LN3914">3914</td><td class="line">          file_crc32 = (mz_uint32)mz_crc32(file_crc32, pWrite_buf_cur, out_buf_size);</td></tr>
<tr class="codeline" data-linenumber="3915"><td class="num" id="LN3915">3915</td><td class="line">          <span class='keyword'>if</span> ((out_buf_ofs += out_buf_size) &gt; file_stat.m_uncomp_size)</td></tr>
<tr class="codeline" data-linenumber="3916"><td class="num" id="LN3916">3916</td><td class="line">          {</td></tr>
<tr class="codeline" data-linenumber="3917"><td class="num" id="LN3917">3917</td><td class="line">            status = TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="3918"><td class="num" id="LN3918">3918</td><td class="line">            <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="3919"><td class="num" id="LN3919">3919</td><td class="line">          }</td></tr>
<tr class="codeline" data-linenumber="3920"><td class="num" id="LN3920">3920</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="3921"><td class="num" id="LN3921">3921</td><td class="line">      } <span class='keyword'>while</span> ((status == TINFL_STATUS_NEEDS_MORE_INPUT) || (status == TINFL_STATUS_HAS_MORE_OUTPUT));</td></tr>
<tr class="codeline" data-linenumber="3922"><td class="num" id="LN3922">3922</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3923"><td class="num" id="LN3923">3923</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3924"><td class="num" id="LN3924">3924</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3925"><td class="num" id="LN3925">3925</td><td class="line">  <span class='keyword'>if</span> ((status == TINFL_STATUS_DONE) &amp;&amp; (!(flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA)))</td></tr>
<tr class="codeline" data-linenumber="3926"><td class="num" id="LN3926">3926</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3927"><td class="num" id="LN3927">3927</td><td class="line">    <span class='comment'>// Make sure the entire file was decompressed, and check its CRC.</span></td></tr>
<tr class="codeline" data-linenumber="3928"><td class="num" id="LN3928">3928</td><td class="line">    <span class='keyword'>if</span> ((out_buf_ofs != file_stat.m_uncomp_size) || (file_crc32 != file_stat.m_crc32))</td></tr>
<tr class="codeline" data-linenumber="3929"><td class="num" id="LN3929">3929</td><td class="line">      status = TINFL_STATUS_FAILED;</td></tr>
<tr class="codeline" data-linenumber="3930"><td class="num" id="LN3930">3930</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3931"><td class="num" id="LN3931">3931</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3932"><td class="num" id="LN3932">3932</td><td class="line">  <span class='keyword'>if</span> (!pZip-&gt;m_pState-&gt;m_pMem)</td></tr>
<tr class="codeline" data-linenumber="3933"><td class="num" id="LN3933">3933</td><td class="line">    pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pRead_buf);</td></tr>
<tr class="codeline" data-linenumber="3934"><td class="num" id="LN3934">3934</td><td class="line">  <span class='keyword'>if</span> (pWrite_buf)</td></tr>
<tr class="codeline" data-linenumber="3935"><td class="num" id="LN3935">3935</td><td class="line">    pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pWrite_buf);</td></tr>
<tr class="codeline" data-linenumber="3936"><td class="num" id="LN3936">3936</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3937"><td class="num" id="LN3937">3937</td><td class="line">  <span class='keyword'>return</span> status == TINFL_STATUS_DONE;</td></tr>
<tr class="codeline" data-linenumber="3938"><td class="num" id="LN3938">3938</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3939"><td class="num" id="LN3939">3939</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3940"><td class="num" id="LN3940">3940</td><td class="line">mz_bool mz_zip_reader_extract_file_to_callback(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, mz_file_write_func pCallback, <span class='keyword'>void</span> *pOpaque, mz_uint flags)</td></tr>
<tr class="codeline" data-linenumber="3941"><td class="num" id="LN3941">3941</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3942"><td class="num" id="LN3942">3942</td><td class="line">  <span class='keyword'>int</span> file_index = mz_zip_reader_locate_file(pZip, pFilename, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, flags);</td></tr>
<tr class="codeline" data-linenumber="3943"><td class="num" id="LN3943">3943</td><td class="line">  <span class='keyword'>if</span> (file_index &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="3944"><td class="num" id="LN3944">3944</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3945"><td class="num" id="LN3945">3945</td><td class="line">  <span class='keyword'>return</span> mz_zip_reader_extract_to_callback(pZip, file_index, pCallback, pOpaque, flags);</td></tr>
<tr class="codeline" data-linenumber="3946"><td class="num" id="LN3946">3946</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3947"><td class="num" id="LN3947">3947</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3948"><td class="num" id="LN3948">3948</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="3949"><td class="num" id="LN3949">3949</td><td class="line"><span class='keyword'>static</span> size_t mz_zip_file_write_callback(<span class='keyword'>void</span> *pOpaque, mz_uint64 ofs, <span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t n)</td></tr>
<tr class="codeline" data-linenumber="3950"><td class="num" id="LN3950">3950</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3951"><td class="num" id="LN3951">3951</td><td class="line">  (<span class='keyword'>void</span>)ofs; <span class='keyword'>return</span> <span class='macro'>MZ_FWRITE<span class='macro_popup'>fwrite</span></span>(pBuf, 1, n, (<span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span>*)pOpaque);</td></tr>
<tr class="codeline" data-linenumber="3952"><td class="num" id="LN3952">3952</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3953"><td class="num" id="LN3953">3953</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3954"><td class="num" id="LN3954">3954</td><td class="line">mz_bool mz_zip_reader_extract_to_file(mz_zip_archive *pZip, mz_uint file_index, <span class='keyword'>const</span> <span class='keyword'>char</span> *pDst_filename, mz_uint flags)</td></tr>
<tr class="codeline" data-linenumber="3955"><td class="num" id="LN3955">3955</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3956"><td class="num" id="LN3956">3956</td><td class="line">  mz_bool status;</td></tr>
<tr class="codeline" data-linenumber="3957"><td class="num" id="LN3957">3957</td><td class="line">  mz_zip_archive_file_stat file_stat;</td></tr>
<tr class="codeline" data-linenumber="3958"><td class="num" id="LN3958">3958</td><td class="line">  <span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span> *pFile;</td></tr>
<tr class="codeline" data-linenumber="3959"><td class="num" id="LN3959">3959</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_reader_file_stat(pZip, file_index, &amp;file_stat))</td></tr>
<tr class="codeline" data-linenumber="3960"><td class="num" id="LN3960">3960</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3961"><td class="num" id="LN3961">3961</td><td class="line">  pFile = <span class='macro'>MZ_FOPEN(pDst_filename, <span class='string_literal'>"wb"</span>)<span class='macro_popup'>fopen(pDst_filename, "wb")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3962"><td class="num" id="LN3962">3962</td><td class="line">  <span class='keyword'>if</span> (!pFile)</td></tr>
<tr class="codeline" data-linenumber="3963"><td class="num" id="LN3963">3963</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3964"><td class="num" id="LN3964">3964</td><td class="line">  status = mz_zip_reader_extract_to_callback(pZip, file_index, mz_zip_file_write_callback, pFile, flags);</td></tr>
<tr class="codeline" data-linenumber="3965"><td class="num" id="LN3965">3965</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pFile) == <span class='macro'>EOF<span class='macro_popup'>(-1)</span></span>)</td></tr>
<tr class="codeline" data-linenumber="3966"><td class="num" id="LN3966">3966</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3967"><td class="num" id="LN3967">3967</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="3968"><td class="num" id="LN3968">3968</td><td class="line">  <span class='keyword'>if</span> (status)</td></tr>
<tr class="codeline" data-linenumber="3969"><td class="num" id="LN3969">3969</td><td class="line">    mz_zip_set_file_times(pDst_filename, file_stat.m_time, file_stat.m_time);</td></tr>
<tr class="codeline" data-linenumber="3970"><td class="num" id="LN3970">3970</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="3971"><td class="num" id="LN3971">3971</td><td class="line">  <span class='keyword'>return</span> status;</td></tr>
<tr class="codeline" data-linenumber="3972"><td class="num" id="LN3972">3972</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="3973"><td class="num" id="LN3973">3973</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="3974"><td class="num" id="LN3974">3974</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3975"><td class="num" id="LN3975">3975</td><td class="line">mz_bool mz_zip_reader_end(mz_zip_archive *pZip)</td></tr>
<tr class="codeline" data-linenumber="3976"><td class="num" id="LN3976">3976</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="3977"><td class="num" id="LN3977">3977</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (!pZip-&gt;m_pState) || (!pZip-&gt;m_pAlloc) || (!pZip-&gt;m_pFree) || (pZip-&gt;m_zip_mode != MZ_ZIP_MODE_READING))</td></tr>
<tr class="codeline" data-linenumber="3978"><td class="num" id="LN3978">3978</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3979"><td class="num" id="LN3979">3979</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3980"><td class="num" id="LN3980">3980</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_pState)</td></tr>
<tr class="codeline" data-linenumber="3981"><td class="num" id="LN3981">3981</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="3982"><td class="num" id="LN3982">3982</td><td class="line">    mz_zip_internal_state *pState = pZip-&gt;m_pState; pZip-&gt;m_pState = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3983"><td class="num" id="LN3983">3983</td><td class="line">    mz_zip_array_clear(pZip, &amp;pState-&gt;m_central_dir);</td></tr>
<tr class="codeline" data-linenumber="3984"><td class="num" id="LN3984">3984</td><td class="line">    mz_zip_array_clear(pZip, &amp;pState-&gt;m_central_dir_offsets);</td></tr>
<tr class="codeline" data-linenumber="3985"><td class="num" id="LN3985">3985</td><td class="line">    mz_zip_array_clear(pZip, &amp;pState-&gt;m_sorted_central_dir_offsets);</td></tr>
<tr class="codeline" data-linenumber="3986"><td class="num" id="LN3986">3986</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3987"><td class="num" id="LN3987">3987</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="3988"><td class="num" id="LN3988">3988</td><td class="line">    <span class='keyword'>if</span> (pState-&gt;m_pFile)</td></tr>
<tr class="codeline" data-linenumber="3989"><td class="num" id="LN3989">3989</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="3990"><td class="num" id="LN3990">3990</td><td class="line">      <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pState-&gt;m_pFile);</td></tr>
<tr class="codeline" data-linenumber="3991"><td class="num" id="LN3991">3991</td><td class="line">      pState-&gt;m_pFile = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="3992"><td class="num" id="LN3992">3992</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="3993"><td class="num" id="LN3993">3993</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="3994"><td class="num" id="LN3994">3994</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3995"><td class="num" id="LN3995">3995</td><td class="line">    pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pState);</td></tr>
<tr class="codeline" data-linenumber="3996"><td class="num" id="LN3996">3996</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="3997"><td class="num" id="LN3997">3997</td><td class="line">  pZip-&gt;m_zip_mode = MZ_ZIP_MODE_INVALID;</td></tr>
<tr class="codeline" data-linenumber="3998"><td class="num" id="LN3998">3998</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="3999"><td class="num" id="LN3999">3999</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4000"><td class="num" id="LN4000">4000</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4001"><td class="num" id="LN4001">4001</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4002"><td class="num" id="LN4002">4002</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4003"><td class="num" id="LN4003">4003</td><td class="line">mz_bool mz_zip_reader_extract_file_to_file(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_filename, <span class='keyword'>const</span> <span class='keyword'>char</span> *pDst_filename, mz_uint flags)</td></tr>
<tr class="codeline" data-linenumber="4004"><td class="num" id="LN4004">4004</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4005"><td class="num" id="LN4005">4005</td><td class="line">  <span class='keyword'>int</span> file_index = mz_zip_reader_locate_file(pZip, pArchive_filename, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, flags);</td></tr>
<tr class="codeline" data-linenumber="4006"><td class="num" id="LN4006">4006</td><td class="line">  <span class='keyword'>if</span> (file_index &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="4007"><td class="num" id="LN4007">4007</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4008"><td class="num" id="LN4008">4008</td><td class="line">  <span class='keyword'>return</span> mz_zip_reader_extract_to_file(pZip, file_index, pDst_filename, flags);</td></tr>
<tr class="codeline" data-linenumber="4009"><td class="num" id="LN4009">4009</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4010"><td class="num" id="LN4010">4010</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4011"><td class="num" id="LN4011">4011</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4012"><td class="num" id="LN4012">4012</td><td class="line"><span class='comment'>// ------------------- .ZIP archive writing</span></td></tr>
<tr class="codeline" data-linenumber="4013"><td class="num" id="LN4013">4013</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4014"><td class="num" id="LN4014">4014</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_ARCHIVE_WRITING_APIS</span></td></tr>
<tr class="codeline" data-linenumber="4015"><td class="num" id="LN4015">4015</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4016"><td class="num" id="LN4016">4016</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> mz_write_le16(mz_uint8 *p, mz_uint16 v) { p[0] = (mz_uint8)v; p[1] = (mz_uint8)(v &gt;&gt; 8); }</td></tr>
<tr class="codeline" data-linenumber="4017"><td class="num" id="LN4017">4017</td><td class="line"><span class='keyword'>static</span> <span class='keyword'>void</span> mz_write_le32(mz_uint8 *p, mz_uint32 v) { p[0] = (mz_uint8)v; p[1] = (mz_uint8)(v &gt;&gt; 8); p[2] = (mz_uint8)(v &gt;&gt; 16); p[3] = (mz_uint8)(v &gt;&gt; 24); }</td></tr>
<tr class="codeline" data-linenumber="4018"><td class="num" id="LN4018">4018</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_WRITE_LE16(p, v)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(p), (mz_uint16)(v))</span></span> mz_write_le16((mz_uint8 *)(p), (mz_uint16)(v))</span></td></tr>
<tr class="codeline" data-linenumber="4019"><td class="num" id="LN4019">4019</td><td class="line"><span class='directive'>#define <span class='macro'>MZ_WRITE_LE32(p, v)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(p), (mz_uint32)(v))</span></span> mz_write_le32((mz_uint8 *)(p), (mz_uint32)(v))</span></td></tr>
<tr class="codeline" data-linenumber="4020"><td class="num" id="LN4020">4020</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4021"><td class="num" id="LN4021">4021</td><td class="line">mz_bool mz_zip_writer_init(mz_zip_archive *pZip, mz_uint64 existing_size)</td></tr>
<tr class="codeline" data-linenumber="4022"><td class="num" id="LN4022">4022</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4023"><td class="num" id="LN4023">4023</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (pZip-&gt;m_pState) || (!pZip-&gt;m_pWrite) || (pZip-&gt;m_zip_mode != MZ_ZIP_MODE_INVALID))</td></tr>
<tr class="codeline" data-linenumber="4024"><td class="num" id="LN4024">4024</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4025"><td class="num" id="LN4025">4025</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4026"><td class="num" id="LN4026">4026</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_file_offset_alignment)</td></tr>
<tr class="codeline" data-linenumber="4027"><td class="num" id="LN4027">4027</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4028"><td class="num" id="LN4028">4028</td><td class="line">    <span class='comment'>// Ensure user specified file offset alignment is a power of 2.</span></td></tr>
<tr class="codeline" data-linenumber="4029"><td class="num" id="LN4029">4029</td><td class="line">    <span class='keyword'>if</span> (pZip-&gt;m_file_offset_alignment &amp; (pZip-&gt;m_file_offset_alignment - 1))</td></tr>
<tr class="codeline" data-linenumber="4030"><td class="num" id="LN4030">4030</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4031"><td class="num" id="LN4031">4031</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4032"><td class="num" id="LN4032">4032</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4033"><td class="num" id="LN4033">4033</td><td class="line">  <span class='keyword'>if</span> (!pZip-&gt;m_pAlloc) pZip-&gt;m_pAlloc = def_alloc_func;</td></tr>
<tr class="codeline" data-linenumber="4034"><td class="num" id="LN4034">4034</td><td class="line">  <span class='keyword'>if</span> (!pZip-&gt;m_pFree) pZip-&gt;m_pFree = def_free_func;</td></tr>
<tr class="codeline" data-linenumber="4035"><td class="num" id="LN4035">4035</td><td class="line">  <span class='keyword'>if</span> (!pZip-&gt;m_pRealloc) pZip-&gt;m_pRealloc = def_realloc_func;</td></tr>
<tr class="codeline" data-linenumber="4036"><td class="num" id="LN4036">4036</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4037"><td class="num" id="LN4037">4037</td><td class="line">  pZip-&gt;m_zip_mode = MZ_ZIP_MODE_WRITING;</td></tr>
<tr class="codeline" data-linenumber="4038"><td class="num" id="LN4038">4038</td><td class="line">  pZip-&gt;m_archive_size = existing_size;</td></tr>
<tr class="codeline" data-linenumber="4039"><td class="num" id="LN4039">4039</td><td class="line">  pZip-&gt;m_central_directory_file_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="4040"><td class="num" id="LN4040">4040</td><td class="line">  pZip-&gt;m_total_files = 0;</td></tr>
<tr class="codeline" data-linenumber="4041"><td class="num" id="LN4041">4041</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4042"><td class="num" id="LN4042">4042</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pZip-&gt;m_pState = (mz_zip_internal_state *)pZip-&gt;m_pAlloc(pZip-&gt;m_pAlloc_opaque, 1, <span class='keyword'>sizeof</span>(mz_zip_internal_state))))</td></tr>
<tr class="codeline" data-linenumber="4043"><td class="num" id="LN4043">4043</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4044"><td class="num" id="LN4044">4044</td><td class="line">  memset(pZip-&gt;m_pState, 0, <span class='keyword'>sizeof</span>(mz_zip_internal_state));</td></tr>
<tr class="codeline" data-linenumber="4045"><td class="num" id="LN4045">4045</td><td class="line">  <span class='macro'>MZ_ZIP_ARRAY_SET_ELEMENT_SIZE(&amp;pZip-&gt;m_pState-&gt;m_central_dir, <span class='keyword'>sizeof</span>(mz_uint8))<span class='macro_popup'>(&amp;pZip-&gt;m_pState-&gt;m_central_dir)-&gt;m_element_size<br> = sizeof(mz_uint8)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4046"><td class="num" id="LN4046">4046</td><td class="line">  <span class='macro'>MZ_ZIP_ARRAY_SET_ELEMENT_SIZE(&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets, <span class='keyword'>sizeof</span>(mz_uint32))<span class='macro_popup'>(&amp;pZip-&gt;m_pState-&gt;m_central_dir_offsets)-&gt;m_element_size<br> = sizeof(mz_uint32)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4047"><td class="num" id="LN4047">4047</td><td class="line">  <span class='macro'>MZ_ZIP_ARRAY_SET_ELEMENT_SIZE(&amp;pZip-&gt;m_pState-&gt;m_sorted_central_dir_offsets, <span class='keyword'>sizeof</span>(mz_uint32))<span class='macro_popup'>(&amp;pZip-&gt;m_pState-&gt;m_sorted_central_dir_offsets)-&gt;<br>m_element_size = sizeof(mz_uint32)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4048"><td class="num" id="LN4048">4048</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4049"><td class="num" id="LN4049">4049</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4050"><td class="num" id="LN4050">4050</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4051"><td class="num" id="LN4051">4051</td><td class="line"><span class='keyword'>static</span> size_t mz_zip_heap_write_func(<span class='keyword'>void</span> *pOpaque, mz_uint64 file_ofs, <span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t n)</td></tr>
<tr class="codeline" data-linenumber="4052"><td class="num" id="LN4052">4052</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4053"><td class="num" id="LN4053">4053</td><td class="line">  mz_zip_archive *pZip = (mz_zip_archive *)pOpaque;</td></tr>
<tr class="codeline" data-linenumber="4054"><td class="num" id="LN4054">4054</td><td class="line">  mz_zip_internal_state *pState = pZip-&gt;m_pState;</td></tr>
<tr class="codeline" data-linenumber="4055"><td class="num" id="LN4055">4055</td><td class="line">  mz_uint64 new_size = <span class='macro'>MZ_MAX(file_ofs + n, pState-&gt;m_mem_size)<span class='macro_popup'>(((file_ofs + n)&gt;(pState-&gt;m_mem_size))?(file_ofs + n):(<br>pState-&gt;m_mem_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4056"><td class="num" id="LN4056">4056</td><td class="line"><span class='directive'>#ifdef _MSC_VER</span></td></tr>
<tr class="codeline" data-linenumber="4057"><td class="num" id="LN4057">4057</td><td class="line">  <span class='keyword'>if</span> ((!n) || ((0, <span class='keyword'>sizeof</span>(size_t) == <span class='keyword'>sizeof</span>(mz_uint32)) &amp;&amp; (new_size &gt; 0x7FFFFFFF)))</td></tr>
<tr class="codeline" data-linenumber="4058"><td class="num" id="LN4058">4058</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="4059"><td class="num" id="LN4059">4059</td><td class="line">  <span class='keyword'>if</span> ((!n) || ((<span class='keyword'>sizeof</span>(size_t) == <span class='keyword'>sizeof</span>(mz_uint32)) &amp;&amp; (new_size &gt; 0x7FFFFFFF)))</td></tr>
<tr class="codeline" data-linenumber="4060"><td class="num" id="LN4060">4060</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4061"><td class="num" id="LN4061">4061</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4062"><td class="num" id="LN4062">4062</td><td class="line">  <span class='keyword'>if</span> (new_size &gt; pState-&gt;m_mem_capacity)</td></tr>
<tr class="codeline" data-linenumber="4063"><td class="num" id="LN4063">4063</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4064"><td class="num" id="LN4064">4064</td><td class="line">    <span class='keyword'>void</span> *pNew_block;</td></tr>
<tr class="codeline" data-linenumber="4065"><td class="num" id="LN4065">4065</td><td class="line">    size_t new_capacity = <span class='macro'>MZ_MAX(64, pState-&gt;m_mem_capacity)<span class='macro_popup'>(((64)&gt;(pState-&gt;m_mem_capacity))?(64):(pState-&gt;m_mem_capacity<br>))</span></span>; <span class='keyword'>while</span> (new_capacity &lt; new_size) new_capacity *= 2;</td></tr>
<tr class="codeline" data-linenumber="4066"><td class="num" id="LN4066">4066</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pNew_block = pZip-&gt;m_pRealloc(pZip-&gt;m_pAlloc_opaque, pState-&gt;m_pMem, 1, new_capacity)))</td></tr>
<tr class="codeline" data-linenumber="4067"><td class="num" id="LN4067">4067</td><td class="line">      <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4068"><td class="num" id="LN4068">4068</td><td class="line">    pState-&gt;m_pMem = pNew_block; pState-&gt;m_mem_capacity = new_capacity;</td></tr>
<tr class="codeline" data-linenumber="4069"><td class="num" id="LN4069">4069</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4070"><td class="num" id="LN4070">4070</td><td class="line">  memcpy((mz_uint8 *)pState-&gt;m_pMem + file_ofs, pBuf, n);</td></tr>
<tr class="codeline" data-linenumber="4071"><td class="num" id="LN4071">4071</td><td class="line">  pState-&gt;m_mem_size = (size_t)new_size;</td></tr>
<tr class="codeline" data-linenumber="4072"><td class="num" id="LN4072">4072</td><td class="line">  <span class='keyword'>return</span> n;</td></tr>
<tr class="codeline" data-linenumber="4073"><td class="num" id="LN4073">4073</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4074"><td class="num" id="LN4074">4074</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4075"><td class="num" id="LN4075">4075</td><td class="line">mz_bool mz_zip_writer_init_heap(mz_zip_archive *pZip, size_t size_to_reserve_at_beginning, size_t initial_allocation_size)</td></tr>
<tr class="codeline" data-linenumber="4076"><td class="num" id="LN4076">4076</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4077"><td class="num" id="LN4077">4077</td><td class="line">  pZip-&gt;m_pWrite = mz_zip_heap_write_func;</td></tr>
<tr class="codeline" data-linenumber="4078"><td class="num" id="LN4078">4078</td><td class="line">  pZip-&gt;m_pIO_opaque = pZip;</td></tr>
<tr class="codeline" data-linenumber="4079"><td class="num" id="LN4079">4079</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_writer_init(pZip, size_to_reserve_at_beginning))</td></tr>
<tr class="codeline" data-linenumber="4080"><td class="num" id="LN4080">4080</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4081"><td class="num" id="LN4081">4081</td><td class="line">  <span class='keyword'>if</span> (0 != (initial_allocation_size = <span class='macro'>MZ_MAX(initial_allocation_size, size_to_reserve_at_beginning)<span class='macro_popup'>(((initial_allocation_size)&gt;(size_to_reserve_at_beginning)<br>)?(initial_allocation_size):(size_to_reserve_at_beginning))</span></span>))</td></tr>
<tr class="codeline" data-linenumber="4082"><td class="num" id="LN4082">4082</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4083"><td class="num" id="LN4083">4083</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pZip-&gt;m_pState-&gt;m_pMem = pZip-&gt;m_pAlloc(pZip-&gt;m_pAlloc_opaque, 1, initial_allocation_size)))</td></tr>
<tr class="codeline" data-linenumber="4084"><td class="num" id="LN4084">4084</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4085"><td class="num" id="LN4085">4085</td><td class="line">      mz_zip_writer_end(pZip);</td></tr>
<tr class="codeline" data-linenumber="4086"><td class="num" id="LN4086">4086</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4087"><td class="num" id="LN4087">4087</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4088"><td class="num" id="LN4088">4088</td><td class="line">    pZip-&gt;m_pState-&gt;m_mem_capacity = initial_allocation_size;</td></tr>
<tr class="codeline" data-linenumber="4089"><td class="num" id="LN4089">4089</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4090"><td class="num" id="LN4090">4090</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4091"><td class="num" id="LN4091">4091</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4092"><td class="num" id="LN4092">4092</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4093"><td class="num" id="LN4093">4093</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4094"><td class="num" id="LN4094">4094</td><td class="line"><span class='keyword'>static</span> size_t mz_zip_file_write_func(<span class='keyword'>void</span> *pOpaque, mz_uint64 file_ofs, <span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t n)</td></tr>
<tr class="codeline" data-linenumber="4095"><td class="num" id="LN4095">4095</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4096"><td class="num" id="LN4096">4096</td><td class="line">  mz_zip_archive *pZip = (mz_zip_archive *)pOpaque;</td></tr>
<tr class="codeline" data-linenumber="4097"><td class="num" id="LN4097">4097</td><td class="line">  mz_int64 cur_ofs = <span class='macro'>MZ_FTELL64<span class='macro_popup'>ftello</span></span>(pZip-&gt;m_pState-&gt;m_pFile);</td></tr>
<tr class="codeline" data-linenumber="4098"><td class="num" id="LN4098">4098</td><td class="line">  <span class='keyword'>if</span> (((mz_int64)file_ofs &lt; 0) || (((cur_ofs != (mz_int64)file_ofs)) &amp;&amp; (<span class='macro'>MZ_FSEEK64<span class='macro_popup'>fseeko</span></span>(pZip-&gt;m_pState-&gt;m_pFile, (mz_int64)file_ofs, <span class='macro'>SEEK_SET<span class='macro_popup'>0</span></span>))))</td></tr>
<tr class="codeline" data-linenumber="4099"><td class="num" id="LN4099">4099</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4100"><td class="num" id="LN4100">4100</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_FWRITE<span class='macro_popup'>fwrite</span></span>(pBuf, 1, n, pZip-&gt;m_pState-&gt;m_pFile);</td></tr>
<tr class="codeline" data-linenumber="4101"><td class="num" id="LN4101">4101</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4102"><td class="num" id="LN4102">4102</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4103"><td class="num" id="LN4103">4103</td><td class="line">mz_bool mz_zip_writer_init_file(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, mz_uint64 size_to_reserve_at_beginning)</td></tr>
<tr class="codeline" data-linenumber="4104"><td class="num" id="LN4104">4104</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4105"><td class="num" id="LN4105">4105</td><td class="line">  <span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span> *pFile;</td></tr>
<tr class="codeline" data-linenumber="4106"><td class="num" id="LN4106">4106</td><td class="line">  pZip-&gt;m_pWrite = mz_zip_file_write_func;</td></tr>
<tr class="codeline" data-linenumber="4107"><td class="num" id="LN4107">4107</td><td class="line">  pZip-&gt;m_pIO_opaque = pZip;</td></tr>
<tr class="codeline" data-linenumber="4108"><td class="num" id="LN4108">4108</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_writer_init(pZip, size_to_reserve_at_beginning))</td></tr>
<tr class="codeline" data-linenumber="4109"><td class="num" id="LN4109">4109</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4110"><td class="num" id="LN4110">4110</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pFile = <span class='macro'>MZ_FOPEN(pFilename, <span class='string_literal'>"wb"</span>)<span class='macro_popup'>fopen(pFilename, "wb")</span></span>))</td></tr>
<tr class="codeline" data-linenumber="4111"><td class="num" id="LN4111">4111</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4112"><td class="num" id="LN4112">4112</td><td class="line">    mz_zip_writer_end(pZip);</td></tr>
<tr class="codeline" data-linenumber="4113"><td class="num" id="LN4113">4113</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4114"><td class="num" id="LN4114">4114</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4115"><td class="num" id="LN4115">4115</td><td class="line">  pZip-&gt;m_pState-&gt;m_pFile = pFile;</td></tr>
<tr class="codeline" data-linenumber="4116"><td class="num" id="LN4116">4116</td><td class="line">  <span class='keyword'>if</span> (size_to_reserve_at_beginning)</td></tr>
<tr class="codeline" data-linenumber="4117"><td class="num" id="LN4117">4117</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4118"><td class="num" id="LN4118">4118</td><td class="line">    mz_uint64 cur_ofs = 0; <span class='keyword'>char</span> buf[4096]; <span class='macro'>MZ_CLEAR_OBJ(buf)<span class='macro_popup'>memset(&amp;(buf), 0, sizeof(buf))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4119"><td class="num" id="LN4119">4119</td><td class="line">    <span class='keyword'>do</span></td></tr>
<tr class="codeline" data-linenumber="4120"><td class="num" id="LN4120">4120</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4121"><td class="num" id="LN4121">4121</td><td class="line">      size_t n = (size_t)<span class='macro'>MZ_MIN(<span class='keyword'>sizeof</span>(buf), size_to_reserve_at_beginning)<span class='macro_popup'>(((sizeof(buf))&lt;(size_to_reserve_at_beginning))?(sizeof(buf<br>)):(size_to_reserve_at_beginning))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4122"><td class="num" id="LN4122">4122</td><td class="line">      <span class='keyword'>if</span> (pZip-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, cur_ofs, buf, n) != n)</td></tr>
<tr class="codeline" data-linenumber="4123"><td class="num" id="LN4123">4123</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="4124"><td class="num" id="LN4124">4124</td><td class="line">        mz_zip_writer_end(pZip);</td></tr>
<tr class="codeline" data-linenumber="4125"><td class="num" id="LN4125">4125</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4126"><td class="num" id="LN4126">4126</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4127"><td class="num" id="LN4127">4127</td><td class="line">      cur_ofs += n; size_to_reserve_at_beginning -= n;</td></tr>
<tr class="codeline" data-linenumber="4128"><td class="num" id="LN4128">4128</td><td class="line">    } <span class='keyword'>while</span> (size_to_reserve_at_beginning);</td></tr>
<tr class="codeline" data-linenumber="4129"><td class="num" id="LN4129">4129</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4130"><td class="num" id="LN4130">4130</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4131"><td class="num" id="LN4131">4131</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4132"><td class="num" id="LN4132">4132</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4133"><td class="num" id="LN4133">4133</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4134"><td class="num" id="LN4134">4134</td><td class="line">mz_bool mz_zip_writer_init_from_reader(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename)</td></tr>
<tr class="codeline" data-linenumber="4135"><td class="num" id="LN4135">4135</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4136"><td class="num" id="LN4136">4136</td><td class="line">  mz_zip_internal_state *pState;</td></tr>
<tr class="codeline" data-linenumber="4137"><td class="num" id="LN4137">4137</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (!pZip-&gt;m_pState) || (pZip-&gt;m_zip_mode != MZ_ZIP_MODE_READING))</td></tr>
<tr class="codeline" data-linenumber="4138"><td class="num" id="LN4138">4138</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4139"><td class="num" id="LN4139">4139</td><td class="line">  <span class='comment'>// No sense in trying to write to an archive that's already at the support max size</span></td></tr>
<tr class="codeline" data-linenumber="4140"><td class="num" id="LN4140">4140</td><td class="line">  <span class='keyword'>if</span> ((pZip-&gt;m_total_files == 0xFFFF) || ((pZip-&gt;m_archive_size + MZ_ZIP_CENTRAL_DIR_HEADER_SIZE + MZ_ZIP_LOCAL_DIR_HEADER_SIZE) &gt; 0xFFFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="4141"><td class="num" id="LN4141">4141</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4142"><td class="num" id="LN4142">4142</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4143"><td class="num" id="LN4143">4143</td><td class="line">  pState = pZip-&gt;m_pState;</td></tr>
<tr class="codeline" data-linenumber="4144"><td class="num" id="LN4144">4144</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4145"><td class="num" id="LN4145">4145</td><td class="line">  <span class='keyword'>if</span> (pState-&gt;m_pFile)</td></tr>
<tr class="codeline" data-linenumber="4146"><td class="num" id="LN4146">4146</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4147"><td class="num" id="LN4147">4147</td><td class="line"><span class='directive'>#ifdef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4148"><td class="num" id="LN4148">4148</td><td class="line">    pFilename; <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4149"><td class="num" id="LN4149">4149</td><td class="line"><span class='directive'>#else</span></td></tr>
<tr class="codeline" data-linenumber="4150"><td class="num" id="LN4150">4150</td><td class="line">    <span class='comment'>// Archive is being read from stdio - try to reopen as writable.</span></td></tr>
<tr class="codeline" data-linenumber="4151"><td class="num" id="LN4151">4151</td><td class="line">    <span class='keyword'>if</span> (pZip-&gt;m_pIO_opaque != pZip)</td></tr>
<tr class="codeline" data-linenumber="4152"><td class="num" id="LN4152">4152</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4153"><td class="num" id="LN4153">4153</td><td class="line">    <span class='keyword'>if</span> (!pFilename)</td></tr>
<tr class="codeline" data-linenumber="4154"><td class="num" id="LN4154">4154</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4155"><td class="num" id="LN4155">4155</td><td class="line">    pZip-&gt;m_pWrite = mz_zip_file_write_func;</td></tr>
<tr class="codeline" data-linenumber="4156"><td class="num" id="LN4156">4156</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pState-&gt;m_pFile = <span class='macro'>MZ_FREOPEN(pFilename, <span class='string_literal'>"r+b"</span>, pState-&gt;m_pFile)<span class='macro_popup'>freopen(pFilename, "r+b", pState-&gt;m_pFile)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="4157"><td class="num" id="LN4157">4157</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4158"><td class="num" id="LN4158">4158</td><td class="line">      <span class='comment'>// The mz_zip_archive is now in a bogus state because pState-&gt;m_pFile is NULL, so just close it.</span></td></tr>
<tr class="codeline" data-linenumber="4159"><td class="num" id="LN4159">4159</td><td class="line">      mz_zip_reader_end(pZip);</td></tr>
<tr class="codeline" data-linenumber="4160"><td class="num" id="LN4160">4160</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4161"><td class="num" id="LN4161">4161</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4162"><td class="num" id="LN4162">4162</td><td class="line"><span class='directive'>#endif // #ifdef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4163"><td class="num" id="LN4163">4163</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4164"><td class="num" id="LN4164">4164</td><td class="line">  <span class='keyword'>else</span> <span class='keyword'>if</span> (pState-&gt;m_pMem)</td></tr>
<tr class="codeline" data-linenumber="4165"><td class="num" id="LN4165">4165</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4166"><td class="num" id="LN4166">4166</td><td class="line">    <span class='comment'>// Archive lives in a memory block. Assume it's from the heap that we can resize using the realloc callback.</span></td></tr>
<tr class="codeline" data-linenumber="4167"><td class="num" id="LN4167">4167</td><td class="line">    <span class='keyword'>if</span> (pZip-&gt;m_pIO_opaque != pZip)</td></tr>
<tr class="codeline" data-linenumber="4168"><td class="num" id="LN4168">4168</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4169"><td class="num" id="LN4169">4169</td><td class="line">    pState-&gt;m_mem_capacity = pState-&gt;m_mem_size;</td></tr>
<tr class="codeline" data-linenumber="4170"><td class="num" id="LN4170">4170</td><td class="line">    pZip-&gt;m_pWrite = mz_zip_heap_write_func;</td></tr>
<tr class="codeline" data-linenumber="4171"><td class="num" id="LN4171">4171</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4172"><td class="num" id="LN4172">4172</td><td class="line">  <span class='comment'>// Archive is being read via a user provided read function - make sure the user has specified a write function too.</span></td></tr>
<tr class="codeline" data-linenumber="4173"><td class="num" id="LN4173">4173</td><td class="line">  <span class='keyword'>else</span> <span class='keyword'>if</span> (!pZip-&gt;m_pWrite)</td></tr>
<tr class="codeline" data-linenumber="4174"><td class="num" id="LN4174">4174</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4175"><td class="num" id="LN4175">4175</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4176"><td class="num" id="LN4176">4176</td><td class="line">  <span class='comment'>// Start writing new files at the archive's current central directory location.</span></td></tr>
<tr class="codeline" data-linenumber="4177"><td class="num" id="LN4177">4177</td><td class="line">  pZip-&gt;m_archive_size = pZip-&gt;m_central_directory_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="4178"><td class="num" id="LN4178">4178</td><td class="line">  pZip-&gt;m_zip_mode = MZ_ZIP_MODE_WRITING;</td></tr>
<tr class="codeline" data-linenumber="4179"><td class="num" id="LN4179">4179</td><td class="line">  pZip-&gt;m_central_directory_file_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="4180"><td class="num" id="LN4180">4180</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4181"><td class="num" id="LN4181">4181</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4182"><td class="num" id="LN4182">4182</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4183"><td class="num" id="LN4183">4183</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4184"><td class="num" id="LN4184">4184</td><td class="line">mz_bool mz_zip_writer_add_mem(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_name, <span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t buf_size, mz_uint level_and_flags)</td></tr>
<tr class="codeline" data-linenumber="4185"><td class="num" id="LN4185">4185</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4186"><td class="num" id="LN4186">4186</td><td class="line">  <span class='keyword'>return</span> mz_zip_writer_add_mem_ex(pZip, pArchive_name, pBuf, buf_size, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0, level_and_flags, 0, 0);</td></tr>
<tr class="codeline" data-linenumber="4187"><td class="num" id="LN4187">4187</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4188"><td class="num" id="LN4188">4188</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4189"><td class="num" id="LN4189">4189</td><td class="line"><span class='keyword'>typedef</span> <span class='keyword'>struct</span></td></tr>
<tr class="codeline" data-linenumber="4190"><td class="num" id="LN4190">4190</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4191"><td class="num" id="LN4191">4191</td><td class="line">  mz_zip_archive *m_pZip;</td></tr>
<tr class="codeline" data-linenumber="4192"><td class="num" id="LN4192">4192</td><td class="line">  mz_uint64 m_cur_archive_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="4193"><td class="num" id="LN4193">4193</td><td class="line">  mz_uint64 m_comp_size;</td></tr>
<tr class="codeline" data-linenumber="4194"><td class="num" id="LN4194">4194</td><td class="line">} mz_zip_writer_add_state;</td></tr>
<tr class="codeline" data-linenumber="4195"><td class="num" id="LN4195">4195</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4196"><td class="num" id="LN4196">4196</td><td class="line"><span class='keyword'>static</span> mz_bool mz_zip_writer_add_put_buf_callback(<span class='keyword'>const</span> <span class='keyword'>void</span>* pBuf, <span class='keyword'>int</span> len, <span class='keyword'>void</span> *pUser)</td></tr>
<tr class="codeline" data-linenumber="4197"><td class="num" id="LN4197">4197</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4198"><td class="num" id="LN4198">4198</td><td class="line">  mz_zip_writer_add_state *pState = (mz_zip_writer_add_state *)pUser;</td></tr>
<tr class="codeline" data-linenumber="4199"><td class="num" id="LN4199">4199</td><td class="line">  <span class='keyword'>if</span> ((<span class='keyword'>int</span>)pState-&gt;m_pZip-&gt;m_pWrite(pState-&gt;m_pZip-&gt;m_pIO_opaque, pState-&gt;m_cur_archive_file_ofs, pBuf, len) != len)</td></tr>
<tr class="codeline" data-linenumber="4200"><td class="num" id="LN4200">4200</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4201"><td class="num" id="LN4201">4201</td><td class="line">  pState-&gt;m_cur_archive_file_ofs += len;</td></tr>
<tr class="codeline" data-linenumber="4202"><td class="num" id="LN4202">4202</td><td class="line">  pState-&gt;m_comp_size += len;</td></tr>
<tr class="codeline" data-linenumber="4203"><td class="num" id="LN4203">4203</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4204"><td class="num" id="LN4204">4204</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4205"><td class="num" id="LN4205">4205</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4206"><td class="num" id="LN4206">4206</td><td class="line"><span class='keyword'>static</span> mz_bool mz_zip_writer_create_local_dir_header(mz_zip_archive *pZip, mz_uint8 *pDst, mz_uint16 filename_size, mz_uint16 extra_size, mz_uint64 uncomp_size, mz_uint64 comp_size, mz_uint32 uncomp_crc32, mz_uint16 method, mz_uint16 bit_flags, mz_uint16 dos_time, mz_uint16 dos_date)</td></tr>
<tr class="codeline" data-linenumber="4207"><td class="num" id="LN4207">4207</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4208"><td class="num" id="LN4208">4208</td><td class="line">  (<span class='keyword'>void</span>)pZip;</td></tr>
<tr class="codeline" data-linenumber="4209"><td class="num" id="LN4209">4209</td><td class="line">  memset(pDst, 0, MZ_ZIP_LOCAL_DIR_HEADER_SIZE);</td></tr>
<tr class="codeline" data-linenumber="4210"><td class="num" id="LN4210">4210</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(pDst + MZ_ZIP_LDH_SIG_OFS, MZ_ZIP_LOCAL_DIR_HEADER_SIG)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(pDst + MZ_ZIP_LDH_SIG_OFS), (mz_uint32<br>)(MZ_ZIP_LOCAL_DIR_HEADER_SIG))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4211"><td class="num" id="LN4211">4211</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_LDH_VERSION_NEEDED_OFS, method ? 20 : 0)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_LDH_VERSION_NEEDED_OFS<br>), (mz_uint16)(method ? 20 : 0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4212"><td class="num" id="LN4212">4212</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_LDH_BIT_FLAG_OFS, bit_flags)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_LDH_BIT_FLAG_OFS), (<br>mz_uint16)(bit_flags))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4213"><td class="num" id="LN4213">4213</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_LDH_METHOD_OFS, method)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_LDH_METHOD_OFS), (mz_uint16<br>)(method))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4214"><td class="num" id="LN4214">4214</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_LDH_FILE_TIME_OFS, dos_time)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_LDH_FILE_TIME_OFS), (<br>mz_uint16)(dos_time))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4215"><td class="num" id="LN4215">4215</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_LDH_FILE_DATE_OFS, dos_date)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_LDH_FILE_DATE_OFS), (<br>mz_uint16)(dos_date))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4216"><td class="num" id="LN4216">4216</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(pDst + MZ_ZIP_LDH_CRC32_OFS, uncomp_crc32)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(pDst + MZ_ZIP_LDH_CRC32_OFS), (mz_uint32<br>)(uncomp_crc32))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4217"><td class="num" id="LN4217">4217</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(pDst + MZ_ZIP_LDH_COMPRESSED_SIZE_OFS, comp_size)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(pDst + MZ_ZIP_LDH_COMPRESSED_SIZE_OFS<br>), (mz_uint32)(comp_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4218"><td class="num" id="LN4218">4218</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(pDst + MZ_ZIP_LDH_DECOMPRESSED_SIZE_OFS, uncomp_size)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(pDst + MZ_ZIP_LDH_DECOMPRESSED_SIZE_OFS<br>), (mz_uint32)(uncomp_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4219"><td class="num" id="LN4219">4219</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_LDH_FILENAME_LEN_OFS, filename_size)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_LDH_FILENAME_LEN_OFS<br>), (mz_uint16)(filename_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4220"><td class="num" id="LN4220">4220</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_LDH_EXTRA_LEN_OFS, extra_size)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_LDH_EXTRA_LEN_OFS), (<br>mz_uint16)(extra_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4221"><td class="num" id="LN4221">4221</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4222"><td class="num" id="LN4222">4222</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4223"><td class="num" id="LN4223">4223</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4224"><td class="num" id="LN4224">4224</td><td class="line"><span class='keyword'>static</span> mz_bool mz_zip_writer_create_central_dir_header(mz_zip_archive *pZip, mz_uint8 *pDst, mz_uint16 filename_size, mz_uint16 extra_size, mz_uint16 comment_size, mz_uint64 uncomp_size, mz_uint64 comp_size, mz_uint32 uncomp_crc32, mz_uint16 method, mz_uint16 bit_flags, mz_uint16 dos_time, mz_uint16 dos_date, mz_uint64 local_header_ofs, mz_uint32 ext_attributes)</td></tr>
<tr class="codeline" data-linenumber="4225"><td class="num" id="LN4225">4225</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4226"><td class="num" id="LN4226">4226</td><td class="line">  (<span class='keyword'>void</span>)pZip;</td></tr>
<tr class="codeline" data-linenumber="4227"><td class="num" id="LN4227">4227</td><td class="line">  memset(pDst, 0, MZ_ZIP_CENTRAL_DIR_HEADER_SIZE);</td></tr>
<tr class="codeline" data-linenumber="4228"><td class="num" id="LN4228">4228</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(pDst + MZ_ZIP_CDH_SIG_OFS, MZ_ZIP_CENTRAL_DIR_HEADER_SIG)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(pDst + MZ_ZIP_CDH_SIG_OFS), (mz_uint32<br>)(MZ_ZIP_CENTRAL_DIR_HEADER_SIG))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4229"><td class="num" id="LN4229">4229</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_CDH_VERSION_NEEDED_OFS, method ? 20 : 0)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_CDH_VERSION_NEEDED_OFS<br>), (mz_uint16)(method ? 20 : 0))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4230"><td class="num" id="LN4230">4230</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_CDH_BIT_FLAG_OFS, bit_flags)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_CDH_BIT_FLAG_OFS), (<br>mz_uint16)(bit_flags))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4231"><td class="num" id="LN4231">4231</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_CDH_METHOD_OFS, method)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_CDH_METHOD_OFS), (mz_uint16<br>)(method))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4232"><td class="num" id="LN4232">4232</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_CDH_FILE_TIME_OFS, dos_time)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_CDH_FILE_TIME_OFS), (<br>mz_uint16)(dos_time))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4233"><td class="num" id="LN4233">4233</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_CDH_FILE_DATE_OFS, dos_date)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_CDH_FILE_DATE_OFS), (<br>mz_uint16)(dos_date))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4234"><td class="num" id="LN4234">4234</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(pDst + MZ_ZIP_CDH_CRC32_OFS, uncomp_crc32)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(pDst + MZ_ZIP_CDH_CRC32_OFS), (mz_uint32<br>)(uncomp_crc32))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4235"><td class="num" id="LN4235">4235</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(pDst + MZ_ZIP_CDH_COMPRESSED_SIZE_OFS, comp_size)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(pDst + MZ_ZIP_CDH_COMPRESSED_SIZE_OFS<br>), (mz_uint32)(comp_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4236"><td class="num" id="LN4236">4236</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(pDst + MZ_ZIP_CDH_DECOMPRESSED_SIZE_OFS, uncomp_size)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(pDst + MZ_ZIP_CDH_DECOMPRESSED_SIZE_OFS<br>), (mz_uint32)(uncomp_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4237"><td class="num" id="LN4237">4237</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_CDH_FILENAME_LEN_OFS, filename_size)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_CDH_FILENAME_LEN_OFS<br>), (mz_uint16)(filename_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4238"><td class="num" id="LN4238">4238</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_CDH_EXTRA_LEN_OFS, extra_size)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_CDH_EXTRA_LEN_OFS), (<br>mz_uint16)(extra_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4239"><td class="num" id="LN4239">4239</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(pDst + MZ_ZIP_CDH_COMMENT_LEN_OFS, comment_size)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(pDst + MZ_ZIP_CDH_COMMENT_LEN_OFS)<br>, (mz_uint16)(comment_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4240"><td class="num" id="LN4240">4240</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(pDst + MZ_ZIP_CDH_EXTERNAL_ATTR_OFS, ext_attributes)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(pDst + MZ_ZIP_CDH_EXTERNAL_ATTR_OFS<br>), (mz_uint32)(ext_attributes))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4241"><td class="num" id="LN4241">4241</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(pDst + MZ_ZIP_CDH_LOCAL_HEADER_OFS, local_header_ofs)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(pDst + MZ_ZIP_CDH_LOCAL_HEADER_OFS<br>), (mz_uint32)(local_header_ofs))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4242"><td class="num" id="LN4242">4242</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4243"><td class="num" id="LN4243">4243</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4244"><td class="num" id="LN4244">4244</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4245"><td class="num" id="LN4245">4245</td><td class="line"><span id="start13"><span class='keyword'>static</span></span> mz_bool mz_zip_writer_add_to_central_dir(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pFilename, mz_uint16 filename_size, <span class='keyword'>const</span> <span class='keyword'>void</span> *pExtra, mz_uint16 extra_size, <span class='keyword'>const</span> <span class='keyword'>void</span> *pComment, mz_uint16 comment_size, mz_uint64 uncomp_size, mz_uint64 comp_size, mz_uint32 uncomp_crc32, mz_uint16 method, mz_uint16 bit_flags, mz_uint16 dos_time, mz_uint16 dos_date, mz_uint64 local_header_ofs, mz_uint32 ext_attributes)</td></tr>
<tr class="codeline" data-linenumber="4246"><td class="num" id="LN4246">4246</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4247"><td class="num" id="LN4247">4247</td><td class="line">  <span id="start12"><span id="end13">mz_zip_internal_state</span></span> *pState = pZip-&gt;m_pState;</td></tr>
<tr class="codeline" data-linenumber="4248"><td class="num" id="LN4248">4248</td><td class="line">  mz_uint32 central_dir_ofs = (mz_uint32)pState-&gt;m_central_dir.m_size;</td></tr>
<tr class="codeline" data-linenumber="4249"><td class="num" id="LN4249">4249</td><td class="line">  size_t orig_central_dir_size = pState-&gt;m_central_dir.m_size;</td></tr>
<tr class="codeline" data-linenumber="4250"><td class="num" id="LN4250">4250</td><td class="line">  mz_uint8 central_dir_header[MZ_ZIP_CENTRAL_DIR_HEADER_SIZE];</td></tr>
<tr class="codeline" data-linenumber="4251"><td class="num" id="LN4251">4251</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4252"><td class="num" id="LN4252">4252</td><td class="line">  <span class='comment'>// No zip64 support yet</span></td></tr>
<tr class="codeline" data-linenumber="4253"><td class="num" id="LN4253">4253</td><td class="line">  <span id="start11"><span id="end12"><span class='keyword'>if</span></span></span> ((<span id="start10"><span class="mrange"><span id="end11">local_header_ofs</span></span> &gt; 0xFFFFFFFF</span>) || (<span id="start9"><span class="mrange"><span id="end10">(</span></span>(mz_uint64)pState-&gt;m_central_dir.m_size + MZ_ZIP_CENTRAL_DIR_HEADER_SIZE + filename_size + extra_size + comment_size) &gt; 0xFFFFFFFF</span>))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path41" class="msg msgEvent" style="margin-left:8ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">41</div></td><td><div class="PathNav"><a href="#Path40" title="Previous event (40)">&#x2190;</a></div></td><td>Assuming 'local_header_ofs' is &lt;= -1</td><td><div class="PathNav"><a href="#Path42" title="Next event (42)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path42" class="msg msgEvent" style="margin-left:43ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">42</div></td><td><div class="PathNav"><a href="#Path41" title="Previous event (41)">&#x2190;</a></div></td><td>Assuming the condition is false</td><td><div class="PathNav"><a href="#Path43" title="Next event (43)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path43" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">43</div></td><td><div class="PathNav"><a href="#Path42" title="Previous event (42)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path44" title="Next event (44)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4254"><td class="num" id="LN4254">4254</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4255"><td class="num" id="LN4255">4255</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4256"><td class="num" id="LN4256">4256</td><td class="line">  <span id="start8"><span id="end9"><span class='keyword'>if</span></span></span> (!mz_zip_writer_create_central_dir_header(<span id="start7"><span id="end8">pZip</span></span>, central_dir_header, filename_size, extra_size, comment_size, uncomp_size, comp_size, uncomp_crc32, method, bit_flags, dos_time, dos_date, local_header_ofs, ext_attributes))</td></tr>
<tr class="codeline" data-linenumber="4257"><td class="num" id="LN4257">4257</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4258"><td class="num" id="LN4258">4258</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4259"><td class="num" id="LN4259">4259</td><td class="line">  <span id="start6"><span id="end7"><span class='keyword'>if</span></span></span> (<span id="end6">(</span>!mz_zip_array_push_back(<span id="start5">pZip</span>, &amp;pState-&gt;m_central_dir, central_dir_header, MZ_ZIP_CENTRAL_DIR_HEADER_SIZE)) ||</td></tr>
<tr class="codeline" data-linenumber="4260"><td class="num" id="LN4260">4260</td><td class="line">      (!mz_zip_array_push_back(pZip, &amp;pState-&gt;m_central_dir, pFilename, filename_size)) ||</td></tr>
<tr class="codeline" data-linenumber="4261"><td class="num" id="LN4261">4261</td><td class="line">      (!<span class="mrange"><span id="end4">mz_zip_array_push_back</span>(pZip, &amp;pState-&gt;m_central_dir, <span id="start4"><span class="mrange"><span id="end5">pExtra</span></span></span>, extra_size)</span>) ||</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path44" class="msg msgEvent" style="margin-left:62ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">44</div></td><td><div class="PathNav"><a href="#Path43" title="Previous event (43)">&#x2190;</a></div></td><td>Passing null pointer value via 3rd parameter 'pElements'</td><td><div class="PathNav"><a href="#Path45" title="Next event (45)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path45" class="msg msgEvent" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">45</div></td><td><div class="PathNav"><a href="#Path44" title="Previous event (44)">&#x2190;</a></div></td><td>Calling 'mz_zip_array_push_back'</td><td><div class="PathNav"><a href="#Path46" title="Next event (46)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4262"><td class="num" id="LN4262">4262</td><td class="line">      (!mz_zip_array_push_back(pZip, &amp;pState-&gt;m_central_dir, pComment, comment_size)) ||</td></tr>
<tr class="codeline" data-linenumber="4263"><td class="num" id="LN4263">4263</td><td class="line">      (!mz_zip_array_push_back(pZip, &amp;pState-&gt;m_central_dir_offsets, &amp;central_dir_ofs, 1)))</td></tr>
<tr class="codeline" data-linenumber="4264"><td class="num" id="LN4264">4264</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4265"><td class="num" id="LN4265">4265</td><td class="line">    <span class='comment'>// Try to push the central directory array back into its original state.</span></td></tr>
<tr class="codeline" data-linenumber="4266"><td class="num" id="LN4266">4266</td><td class="line">    mz_zip_array_resize(pZip, &amp;pState-&gt;m_central_dir, orig_central_dir_size, <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4267"><td class="num" id="LN4267">4267</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4268"><td class="num" id="LN4268">4268</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4269"><td class="num" id="LN4269">4269</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4270"><td class="num" id="LN4270">4270</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4271"><td class="num" id="LN4271">4271</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4272"><td class="num" id="LN4272">4272</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4273"><td class="num" id="LN4273">4273</td><td class="line"><span class='keyword'>static</span> mz_bool mz_zip_writer_validate_archive_name(<span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_name)</td></tr>
<tr class="codeline" data-linenumber="4274"><td class="num" id="LN4274">4274</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4275"><td class="num" id="LN4275">4275</td><td class="line">  <span class='comment'>// Basic ZIP archive filename validity checks: Valid filenames cannot start with a forward slash, cannot contain a drive letter, and cannot use DOS-style backward slashes.</span></td></tr>
<tr class="codeline" data-linenumber="4276"><td class="num" id="LN4276">4276</td><td class="line">  <span class='keyword'>if</span> (*pArchive_name == '/')</td></tr>
<tr class="codeline" data-linenumber="4277"><td class="num" id="LN4277">4277</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4278"><td class="num" id="LN4278">4278</td><td class="line">  <span class='keyword'>while</span> (*pArchive_name)</td></tr>
<tr class="codeline" data-linenumber="4279"><td class="num" id="LN4279">4279</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4280"><td class="num" id="LN4280">4280</td><td class="line">    <span class='keyword'>if</span> ((*pArchive_name == '\\') || (*pArchive_name == ':'))</td></tr>
<tr class="codeline" data-linenumber="4281"><td class="num" id="LN4281">4281</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4282"><td class="num" id="LN4282">4282</td><td class="line">    pArchive_name++;</td></tr>
<tr class="codeline" data-linenumber="4283"><td class="num" id="LN4283">4283</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4284"><td class="num" id="LN4284">4284</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4285"><td class="num" id="LN4285">4285</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4286"><td class="num" id="LN4286">4286</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4287"><td class="num" id="LN4287">4287</td><td class="line"><span class='keyword'>static</span> mz_uint mz_zip_writer_compute_padding_needed_for_file_alignment(mz_zip_archive *pZip)</td></tr>
<tr class="codeline" data-linenumber="4288"><td class="num" id="LN4288">4288</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4289"><td class="num" id="LN4289">4289</td><td class="line">  mz_uint32 n;</td></tr>
<tr class="codeline" data-linenumber="4290"><td class="num" id="LN4290">4290</td><td class="line">  <span class='keyword'>if</span> (!pZip-&gt;m_file_offset_alignment)</td></tr>
<tr class="codeline" data-linenumber="4291"><td class="num" id="LN4291">4291</td><td class="line">    <span class='keyword'>return</span> 0;</td></tr>
<tr class="codeline" data-linenumber="4292"><td class="num" id="LN4292">4292</td><td class="line">  n = (mz_uint32)(pZip-&gt;m_archive_size &amp; (pZip-&gt;m_file_offset_alignment - 1));</td></tr>
<tr class="codeline" data-linenumber="4293"><td class="num" id="LN4293">4293</td><td class="line">  <span class='keyword'>return</span> (pZip-&gt;m_file_offset_alignment - n) &amp; (pZip-&gt;m_file_offset_alignment - 1);</td></tr>
<tr class="codeline" data-linenumber="4294"><td class="num" id="LN4294">4294</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4295"><td class="num" id="LN4295">4295</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4296"><td class="num" id="LN4296">4296</td><td class="line"><span class='keyword'>static</span> mz_bool mz_zip_writer_write_zeros(mz_zip_archive *pZip, mz_uint64 cur_file_ofs, mz_uint32 n)</td></tr>
<tr class="codeline" data-linenumber="4297"><td class="num" id="LN4297">4297</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4298"><td class="num" id="LN4298">4298</td><td class="line">  <span class='keyword'>char</span> buf[4096];</td></tr>
<tr class="codeline" data-linenumber="4299"><td class="num" id="LN4299">4299</td><td class="line">  memset(buf, 0, <span class='macro'>MZ_MIN(<span class='keyword'>sizeof</span>(buf), n)<span class='macro_popup'>(((sizeof(buf))&lt;(n))?(sizeof(buf)):(n))</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4300"><td class="num" id="LN4300">4300</td><td class="line">  <span class='keyword'>while</span> (n)</td></tr>
<tr class="codeline" data-linenumber="4301"><td class="num" id="LN4301">4301</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4302"><td class="num" id="LN4302">4302</td><td class="line">    mz_uint32 s = <span class='macro'>MZ_MIN(<span class='keyword'>sizeof</span>(buf), n)<span class='macro_popup'>(((sizeof(buf))&lt;(n))?(sizeof(buf)):(n))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4303"><td class="num" id="LN4303">4303</td><td class="line">    <span class='keyword'>if</span> (pZip-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, cur_file_ofs, buf, s) != s)</td></tr>
<tr class="codeline" data-linenumber="4304"><td class="num" id="LN4304">4304</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4305"><td class="num" id="LN4305">4305</td><td class="line">    cur_file_ofs += s; n -= s;</td></tr>
<tr class="codeline" data-linenumber="4306"><td class="num" id="LN4306">4306</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4307"><td class="num" id="LN4307">4307</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4308"><td class="num" id="LN4308">4308</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4309"><td class="num" id="LN4309">4309</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4310"><td class="num" id="LN4310">4310</td><td class="line"><span id="start86">mz_bool</span> mz_zip_writer_add_mem_ex(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_name, <span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t buf_size, <span class='keyword'>const</span> <span class='keyword'>void</span> *pComment, mz_uint16 comment_size, mz_uint level_and_flags, mz_uint64 uncomp_size, mz_uint32 uncomp_crc32)</td></tr>
<tr class="codeline" data-linenumber="4311"><td class="num" id="LN4311">4311</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4312"><td class="num" id="LN4312">4312</td><td class="line">  mz_uint16 <span id="start85"><span id="end86">method</span></span> = 0, dos_time = 0, dos_date = 0;</td></tr>
<tr class="codeline" data-linenumber="4313"><td class="num" id="LN4313">4313</td><td class="line">  mz_uint level, ext_attributes = 0, num_alignment_padding_bytes;</td></tr>
<tr class="codeline" data-linenumber="4314"><td class="num" id="LN4314">4314</td><td class="line">  mz_uint64 local_dir_header_ofs = pZip-&gt;m_archive_size, cur_archive_file_ofs = pZip-&gt;m_archive_size, comp_size = 0;</td></tr>
<tr class="codeline" data-linenumber="4315"><td class="num" id="LN4315">4315</td><td class="line">  size_t archive_name_size;</td></tr>
<tr class="codeline" data-linenumber="4316"><td class="num" id="LN4316">4316</td><td class="line">  mz_uint8 local_dir_header[MZ_ZIP_LOCAL_DIR_HEADER_SIZE];</td></tr>
<tr class="codeline" data-linenumber="4317"><td class="num" id="LN4317">4317</td><td class="line">  tdefl_compressor *pComp = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4318"><td class="num" id="LN4318">4318</td><td class="line">  mz_bool store_data_uncompressed;</td></tr>
<tr class="codeline" data-linenumber="4319"><td class="num" id="LN4319">4319</td><td class="line">  mz_zip_internal_state *pState;</td></tr>
<tr class="codeline" data-linenumber="4320"><td class="num" id="LN4320">4320</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4321"><td class="num" id="LN4321">4321</td><td class="line">  <span id="start84"><span id="end85"><span class='keyword'>if</span></span></span> (<span id="start83"><span id="end84"><span class='variable'>(</span></span><span class='keyword'>int</span>)level_and_flags<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>13.1</div></td><td>'level_and_flags' is >= 0</td></tr></tbody></table></span> &lt; 0)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path14" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">14</div></td><td><div class="PathNav"><a href="#Path13" title="Previous event (13)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path15" title="Next event (15)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4322"><td class="num" id="LN4322">4322</td><td class="line">    level_and_flags = MZ_DEFAULT_LEVEL;</td></tr>
<tr class="codeline" data-linenumber="4323"><td class="num" id="LN4323">4323</td><td class="line">  <span id="start80"><span id="end81"><span id="start82"><span id="end83">level</span></span></span></span> = <span id="start81"><span id="end82">level_and_flags</span></span> &amp; 0xF;</td></tr>
<tr class="codeline" data-linenumber="4324"><td class="num" id="LN4324">4324</td><td class="line">  <span id="start77"><span id="end78"><span id="start79"><span id="end80">store_data_uncompressed</span></span></span></span> = (<span id="end79">(</span><span id="start78"><span class="mrange">!</span>level</span>) || (level_and_flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA));</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path15" class="msg msgEvent" style="margin-left:31ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">15</div></td><td><div class="PathNav"><a href="#Path14" title="Previous event (14)">&#x2190;</a></div></td><td>Assuming 'level' is not equal to 0</td><td><div class="PathNav"><a href="#Path16" title="Next event (16)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4325"><td class="num" id="LN4325">4325</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4326"><td class="num" id="LN4326">4326</td><td class="line">  <span id="start66"><span id="end67"><span id="start72"><span id="end73"><span id="start76"><span id="end77"><span class='keyword'>if</span></span></span></span></span></span></span> (<span id="start71"><span id="end72"><span id="end76">(</span></span></span>!<span id="start75"><span class='variable'>pZip<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>15.1</div></td><td>'pZip' is non-null</td></tr></tbody></table></span></span>) || (!pZip-&gt;<span id="start74"><span id="end75"><span class='variable'>m_pState<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>15.2</div></td><td>Field 'm_pState' is non-null</td></tr></tbody></table></span></span></span>) || (pZip-&gt;<span id="start73"><span id="end74"><span class='variable'>m_zip_mode<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>15.3</div></td><td>Field 'm_zip_mode' is equal to MZ_ZIP_MODE_WRITING</td></tr></tbody></table></span></span></span> != MZ_ZIP_MODE_WRITING) || (<span id="end71">(</span><span id="start70"><span class='variable'>buf_size<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>15.4</div></td><td>'buf_size' is 0</td></tr></tbody></table></span></span>) &amp;&amp; (!pBuf)) || (!<span id="start69"><span id="end70"><span class='variable'>pArchive_name<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>15.5</div></td><td>'pArchive_name' is non-null</td></tr></tbody></table></span></span></span>) || (<span id="end69">(</span><span id="start68"><span class='variable'>comment_size<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>15.6</div></td><td>'comment_size' is 0</td></tr></tbody></table></span></span>) &amp;&amp; (!pComment)) || (pZip-&gt;<span id="start67"><span id="end68"><span class='variable'>m_total_files<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>15.7</div></td><td>Field 'm_total_files' is not equal to 65535</td></tr></tbody></table></span></span></span> == 0xFFFF) || (<span id="start65"><span id="end66"><span class='variable'>level<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>15.8</div></td><td>'level' is <= MZ_UBER_COMPRESSION</td></tr></tbody></table></span></span></span> &gt; MZ_UBER_COMPRESSION))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path16" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">16</div></td><td><div class="PathNav"><a href="#Path15" title="Previous event (15)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path17" title="Next event (17)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4327"><td class="num" id="LN4327">4327</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4328"><td class="num" id="LN4328">4328</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4329"><td class="num" id="LN4329">4329</td><td class="line">  <span id="start62"><span id="end63"><span id="start64"><span id="end65">pState</span></span></span></span> = <span id="start63"><span id="end64">pZip</span></span>-&gt;m_pState;</td></tr>
<tr class="codeline" data-linenumber="4330"><td class="num" id="LN4330">4330</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4331"><td class="num" id="LN4331">4331</td><td class="line">  <span id="start61"><span id="end62"><span class='keyword'>if</span></span></span> ((<span id="start60"><span class="mrange"><span id="end61">!</span></span>(level_and_flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA)</span>) &amp;&amp; (uncomp_size))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path17" class="msg msgEvent" style="margin-left:8ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">17</div></td><td><div class="PathNav"><a href="#Path16" title="Previous event (16)">&#x2190;</a></div></td><td>Assuming the condition is false</td><td><div class="PathNav"><a href="#Path18" title="Next event (18)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4332"><td class="num" id="LN4332">4332</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4333"><td class="num" id="LN4333">4333</td><td class="line">  <span class='comment'>// No zip64 support yet</span></td></tr>
<tr class="codeline" data-linenumber="4334"><td class="num" id="LN4334">4334</td><td class="line">  <span id="start59"><span id="end60"><span class='keyword'>if</span></span></span> ((<span id="start58"><span id="end59"><span class='variable'>buf_size<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>17.1</div></td><td>'buf_size' is <= -1</td></tr></tbody></table></span></span></span> &gt; 0xFFFFFFFF) || (<span id="start57"><span id="end58"><span class='variable'>uncomp_size<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>17.2</div></td><td>'uncomp_size' is <= -1</td></tr></tbody></table></span></span></span> &gt; 0xFFFFFFFF))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path18" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">18</div></td><td><div class="PathNav"><a href="#Path17" title="Previous event (17)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path19" title="Next event (19)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4335"><td class="num" id="LN4335">4335</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4336"><td class="num" id="LN4336">4336</td><td class="line">  <span id="start56"><span id="end57"><span class='keyword'>if</span></span></span> (!mz_zip_writer_validate_archive_name(<span id="start55"><span id="end56">pArchive_name</span></span>))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path19" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">19</div></td><td><div class="PathNav"><a href="#Path18" title="Previous event (18)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path20" title="Next event (20)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4337"><td class="num" id="LN4337">4337</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4338"><td class="num" id="LN4338">4338</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4339"><td class="num" id="LN4339">4339</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="4340"><td class="num" id="LN4340">4340</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4341"><td class="num" id="LN4341">4341</td><td class="line">    <span id="start54"><span id="end55">time_t</span></span> cur_time; time(&amp;cur_time);</td></tr>
<tr class="codeline" data-linenumber="4342"><td class="num" id="LN4342">4342</td><td class="line">    <span id="start53"><span id="end54">mz_zip_time_to_dos_time</span></span>(cur_time, &amp;dos_time, &amp;dos_date);</td></tr>
<tr class="codeline" data-linenumber="4343"><td class="num" id="LN4343">4343</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4344"><td class="num" id="LN4344">4344</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_TIME</span></td></tr>
<tr class="codeline" data-linenumber="4345"><td class="num" id="LN4345">4345</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4346"><td class="num" id="LN4346">4346</td><td class="line">  <span id="start52"><span id="end53">archive_name_size</span></span> = strlen(pArchive_name);</td></tr>
<tr class="codeline" data-linenumber="4347"><td class="num" id="LN4347">4347</td><td class="line">  <span id="start51"><span id="end52"><span class='keyword'>if</span></span></span> (<span id="start50"><span class="mrange"><span id="end51">archive_name_size</span></span> &gt; 0xFFFF</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path20" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">20</div></td><td><div class="PathNav"><a href="#Path19" title="Previous event (19)">&#x2190;</a></div></td><td>Assuming 'archive_name_size' is &lt;= 65535</td><td><div class="PathNav"><a href="#Path21" title="Next event (21)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path21" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">21</div></td><td><div class="PathNav"><a href="#Path20" title="Previous event (20)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path22" title="Next event (22)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4348"><td class="num" id="LN4348">4348</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4349"><td class="num" id="LN4349">4349</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4350"><td class="num" id="LN4350">4350</td><td class="line">  <span id="start47"><span id="end48"><span id="start49"><span id="end50">num_alignment_padding_bytes</span></span></span></span> = mz_zip_writer_compute_padding_needed_for_file_alignment(<span id="start48"><span id="end49">pZip</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4351"><td class="num" id="LN4351">4351</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4352"><td class="num" id="LN4352">4352</td><td class="line">  <span class='comment'>// no zip64 support yet</span></td></tr>
<tr class="codeline" data-linenumber="4353"><td class="num" id="LN4353">4353</td><td class="line">  <span id="start45"><span id="end46"><span class='keyword'>if</span></span></span> ((pZip-&gt;<span id="start46"><span id="end47"><span class='variable'>m_total_files<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>21.1</div></td><td>Field 'm_total_files' is not equal to 65535</td></tr></tbody></table></span></span></span> == 0xFFFF) || (<span id="start44"><span class="mrange"><span id="end45">(</span></span>pZip-&gt;m_archive_size + num_alignment_padding_bytes + MZ_ZIP_LOCAL_DIR_HEADER_SIZE + MZ_ZIP_CENTRAL_DIR_HEADER_SIZE + comment_size + archive_name_size) &gt; 0xFFFFFFFF</span>))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path22" class="msg msgEvent" style="margin-left:43ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">22</div></td><td><div class="PathNav"><a href="#Path21" title="Previous event (21)">&#x2190;</a></div></td><td>Assuming the condition is false</td><td><div class="PathNav"><a href="#Path23" title="Next event (23)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4354"><td class="num" id="LN4354">4354</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4355"><td class="num" id="LN4355">4355</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4356"><td class="num" id="LN4356">4356</td><td class="line">  <span id="start43"><span id="end44"><span class='keyword'>if</span></span></span> (<span id="start42"><span class="mrange"><span id="end43">(</span></span>archive_name_size)</span> &amp;&amp; (pArchive_name[archive_name_size - 1] == '/'))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path23" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">23</div></td><td><div class="PathNav"><a href="#Path22" title="Previous event (22)">&#x2190;</a></div></td><td>Assuming 'archive_name_size' is 0</td><td><div class="PathNav"><a href="#Path24" title="Next event (24)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4357"><td class="num" id="LN4357">4357</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4358"><td class="num" id="LN4358">4358</td><td class="line">    <span class='comment'>// Set DOS Subdirectory attribute bit.</span></td></tr>
<tr class="codeline" data-linenumber="4359"><td class="num" id="LN4359">4359</td><td class="line">    ext_attributes |= 0x10;</td></tr>
<tr class="codeline" data-linenumber="4360"><td class="num" id="LN4360">4360</td><td class="line">    <span class='comment'>// Subdirectories cannot contain data.</span></td></tr>
<tr class="codeline" data-linenumber="4361"><td class="num" id="LN4361">4361</td><td class="line">    <span class='keyword'>if</span> ((buf_size) || (uncomp_size))</td></tr>
<tr class="codeline" data-linenumber="4362"><td class="num" id="LN4362">4362</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4363"><td class="num" id="LN4363">4363</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4364"><td class="num" id="LN4364">4364</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4365"><td class="num" id="LN4365">4365</td><td class="line">  <span class='comment'>// Try to do any allocations before writing to the archive, so if an allocation fails the file remains unmodified. (A good idea if we're doing an in-place modification.)</span></td></tr>
<tr class="codeline" data-linenumber="4366"><td class="num" id="LN4366">4366</td><td class="line">  <span class='keyword'>if</span> ((!mz_zip_array_ensure_room(pZip, &amp;pState-&gt;m_central_dir, MZ_ZIP_CENTRAL_DIR_HEADER_SIZE + archive_name_size + comment_size)) || (!mz_zip_array_ensure_room(pZip, &amp;pState-&gt;m_central_dir_offsets, 1)))</td></tr>
<tr class="codeline" data-linenumber="4367"><td class="num" id="LN4367">4367</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4368"><td class="num" id="LN4368">4368</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4369"><td class="num" id="LN4369">4369</td><td class="line">  <span id="start41"><span id="end42"><span class='keyword'>if</span></span></span> (<span id="end41">(</span>!<span id="start40"><span class='variable'>store_data_uncompressed<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>23.1</div></td><td>'store_data_uncompressed' is not equal to 0</td></tr></tbody></table></span></span>) &amp;&amp; (buf_size))</td></tr>
<tr class="codeline" data-linenumber="4370"><td class="num" id="LN4370">4370</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4371"><td class="num" id="LN4371">4371</td><td class="line">    <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pComp = (tdefl_compressor *)pZip-&gt;m_pAlloc(pZip-&gt;m_pAlloc_opaque, 1, <span class='keyword'>sizeof</span>(tdefl_compressor))))</td></tr>
<tr class="codeline" data-linenumber="4372"><td class="num" id="LN4372">4372</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4373"><td class="num" id="LN4373">4373</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4374"><td class="num" id="LN4374">4374</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4375"><td class="num" id="LN4375">4375</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_writer_write_zeros(pZip, cur_archive_file_ofs, num_alignment_padding_bytes + <span class='keyword'>sizeof</span>(local_dir_header)))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path24" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">24</div></td><td><div class="PathNav"><a href="#Path23" title="Previous event (23)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path25" title="Next event (25)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4376"><td class="num" id="LN4376">4376</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4377"><td class="num" id="LN4377">4377</td><td class="line">    pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pComp);</td></tr>
<tr class="codeline" data-linenumber="4378"><td class="num" id="LN4378">4378</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4379"><td class="num" id="LN4379">4379</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4380"><td class="num" id="LN4380">4380</td><td class="line">  <span id="start39"><span id="end40">local_dir_header_ofs</span></span> += num_alignment_padding_bytes;</td></tr>
<tr class="codeline" data-linenumber="4381"><td class="num" id="LN4381">4381</td><td class="line">  <span id="start38"><span id="end39"><span class='keyword'>if</span></span></span> (<span id="start37"><span class="mrange"><span id="end38">pZip</span></span>-&gt;m_file_offset_alignment</span>) { <span class='macro'>MZ_ASSERT((local_dir_header_ofs &amp; (pZip-&gt;m_file_offset_alignment - 1)) == 0)<span class='macro_popup'>((void) sizeof (((local_dir_header_ofs &amp; (pZip-&gt;m_file_offset_alignment<br> - 1)) == 0) ? 1 : 0), __extension__ ({ if ((local_dir_header_ofs<br> &amp; (pZip-&gt;m_file_offset_alignment - 1)) == 0) ; else __assert_fail<br> ("(local_dir_header_ofs &amp; (pZip-&gt;m_file_offset_alignment - 1)) == 0"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 4381, __extension__ __PRETTY_FUNCTION__); }))</span></span>; }</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path25" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">25</div></td><td><div class="PathNav"><a href="#Path24" title="Previous event (24)">&#x2190;</a></div></td><td>Assuming field 'm_file_offset_alignment' is 0</td><td><div class="PathNav"><a href="#Path26" title="Next event (26)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path26" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">26</div></td><td><div class="PathNav"><a href="#Path25" title="Previous event (25)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path27" title="Next event (27)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4382"><td class="num" id="LN4382">4382</td><td class="line">  <span id="start36"><span id="end37">cur_archive_file_ofs</span></span> += num_alignment_padding_bytes + <span class='keyword'>sizeof</span>(local_dir_header);</td></tr>
<tr class="codeline" data-linenumber="4383"><td class="num" id="LN4383">4383</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4384"><td class="num" id="LN4384">4384</td><td class="line">  <span class='macro'>MZ_CLEAR_OBJ(local_dir_header)<span class='macro_popup'>memset(&amp;(local_dir_header), 0, sizeof(local_dir_header))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4385"><td class="num" id="LN4385">4385</td><td class="line">  <span id="start35"><span id="end36"><span class='keyword'>if</span></span></span> (<span id="start34"><span class="mrange"><span id="end35">pZip</span></span>-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, cur_archive_file_ofs, pArchive_name, archive_name_size) != archive_name_size</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path27" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">27</div></td><td><div class="PathNav"><a href="#Path26" title="Previous event (26)">&#x2190;</a></div></td><td>Assuming the condition is false</td><td><div class="PathNav"><a href="#Path28" title="Next event (28)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path28" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">28</div></td><td><div class="PathNav"><a href="#Path27" title="Previous event (27)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path29" title="Next event (29)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4386"><td class="num" id="LN4386">4386</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4387"><td class="num" id="LN4387">4387</td><td class="line">    pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pComp);</td></tr>
<tr class="codeline" data-linenumber="4388"><td class="num" id="LN4388">4388</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4389"><td class="num" id="LN4389">4389</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4390"><td class="num" id="LN4390">4390</td><td class="line">  <span id="start33"><span id="end34">cur_archive_file_ofs</span></span> += archive_name_size;</td></tr>
<tr class="codeline" data-linenumber="4391"><td class="num" id="LN4391">4391</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4392"><td class="num" id="LN4392">4392</td><td class="line">  <span id="start32"><span id="end33"><span class='keyword'>if</span></span></span> (!(level_and_flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path29" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">29</div></td><td><div class="PathNav"><a href="#Path28" title="Previous event (28)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path30" title="Next event (30)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4393"><td class="num" id="LN4393">4393</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4394"><td class="num" id="LN4394">4394</td><td class="line">    uncomp_crc32 = (mz_uint32)mz_crc32(<span class='macro'>MZ_CRC32_INIT<span class='macro_popup'>(0)</span></span>, (<span class='keyword'>const</span> mz_uint8*)pBuf, buf_size);</td></tr>
<tr class="codeline" data-linenumber="4395"><td class="num" id="LN4395">4395</td><td class="line">    uncomp_size = buf_size;</td></tr>
<tr class="codeline" data-linenumber="4396"><td class="num" id="LN4396">4396</td><td class="line">    <span class='keyword'>if</span> (uncomp_size &lt;= 3)</td></tr>
<tr class="codeline" data-linenumber="4397"><td class="num" id="LN4397">4397</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4398"><td class="num" id="LN4398">4398</td><td class="line">      level = 0;</td></tr>
<tr class="codeline" data-linenumber="4399"><td class="num" id="LN4399">4399</td><td class="line">      store_data_uncompressed = <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4400"><td class="num" id="LN4400">4400</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4401"><td class="num" id="LN4401">4401</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4402"><td class="num" id="LN4402">4402</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4403"><td class="num" id="LN4403">4403</td><td class="line">  <span id="start31"><span id="end32"><span class='keyword'>if</span></span></span> (<span id="start30"><span id="end31"><span class='variable'>store_data_uncompressed<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>29.1</div></td><td>'store_data_uncompressed' is not equal to 0</td></tr></tbody></table></span></span></span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path30" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">30</div></td><td><div class="PathNav"><a href="#Path29" title="Previous event (29)">&#x2190;</a></div></td><td>Taking true branch</td><td><div class="PathNav"><a href="#Path31" title="Next event (31)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4404"><td class="num" id="LN4404">4404</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4405"><td class="num" id="LN4405">4405</td><td class="line">    <span id="start29"><span id="end30"><span class='keyword'>if</span></span></span> (<span id="start28"><span class="mrange"><span id="end29">pZip</span></span>-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, cur_archive_file_ofs, pBuf, buf_size) != buf_size</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path31" class="msg msgEvent" style="margin-left:9ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">31</div></td><td><div class="PathNav"><a href="#Path30" title="Previous event (30)">&#x2190;</a></div></td><td>Assuming the condition is false</td><td><div class="PathNav"><a href="#Path32" title="Next event (32)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path32" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">32</div></td><td><div class="PathNav"><a href="#Path31" title="Previous event (31)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path33" title="Next event (33)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4406"><td class="num" id="LN4406">4406</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4407"><td class="num" id="LN4407">4407</td><td class="line">      pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pComp);</td></tr>
<tr class="codeline" data-linenumber="4408"><td class="num" id="LN4408">4408</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4409"><td class="num" id="LN4409">4409</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4410"><td class="num" id="LN4410">4410</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4411"><td class="num" id="LN4411">4411</td><td class="line">    <span id="start27"><span id="end28">cur_archive_file_ofs</span></span> += buf_size;</td></tr>
<tr class="codeline" data-linenumber="4412"><td class="num" id="LN4412">4412</td><td class="line">    <span id="start26"><span id="end27">comp_size</span></span> = buf_size;</td></tr>
<tr class="codeline" data-linenumber="4413"><td class="num" id="LN4413">4413</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4414"><td class="num" id="LN4414">4414</td><td class="line">    <span class='keyword'>if</span> (level_and_flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path33" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">33</div></td><td><div class="PathNav"><a href="#Path32" title="Previous event (32)">&#x2190;</a></div></td><td>Taking true branch</td><td><div class="PathNav"><a href="#Path34" title="Next event (34)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4415"><td class="num" id="LN4415">4415</td><td class="line">      <span id="start25"><span id="end26">method</span></span> = <span class='macro'>MZ_DEFLATED<span class='macro_popup'>8</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4416"><td class="num" id="LN4416">4416</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4417"><td class="num" id="LN4417">4417</td><td class="line">  <span class='keyword'>else</span> <span class='keyword'>if</span> (buf_size)</td></tr>
<tr class="codeline" data-linenumber="4418"><td class="num" id="LN4418">4418</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4419"><td class="num" id="LN4419">4419</td><td class="line">    mz_zip_writer_add_state state;</td></tr>
<tr class="codeline" data-linenumber="4420"><td class="num" id="LN4420">4420</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4421"><td class="num" id="LN4421">4421</td><td class="line">    state.m_pZip = pZip;</td></tr>
<tr class="codeline" data-linenumber="4422"><td class="num" id="LN4422">4422</td><td class="line">    state.m_cur_archive_file_ofs = cur_archive_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="4423"><td class="num" id="LN4423">4423</td><td class="line">    state.m_comp_size = 0;</td></tr>
<tr class="codeline" data-linenumber="4424"><td class="num" id="LN4424">4424</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4425"><td class="num" id="LN4425">4425</td><td class="line">    <span class='keyword'>if</span> ((tdefl_init(pComp, mz_zip_writer_add_put_buf_callback, &amp;state, tdefl_create_comp_flags_from_zip_params(level, -15, MZ_DEFAULT_STRATEGY)) != TDEFL_STATUS_OKAY) ||</td></tr>
<tr class="codeline" data-linenumber="4426"><td class="num" id="LN4426">4426</td><td class="line">        (tdefl_compress_buffer(pComp, pBuf, buf_size, TDEFL_FINISH) != TDEFL_STATUS_DONE))</td></tr>
<tr class="codeline" data-linenumber="4427"><td class="num" id="LN4427">4427</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4428"><td class="num" id="LN4428">4428</td><td class="line">      pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pComp);</td></tr>
<tr class="codeline" data-linenumber="4429"><td class="num" id="LN4429">4429</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4430"><td class="num" id="LN4430">4430</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4431"><td class="num" id="LN4431">4431</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4432"><td class="num" id="LN4432">4432</td><td class="line">    comp_size = state.m_comp_size;</td></tr>
<tr class="codeline" data-linenumber="4433"><td class="num" id="LN4433">4433</td><td class="line">    cur_archive_file_ofs = state.m_cur_archive_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="4434"><td class="num" id="LN4434">4434</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4435"><td class="num" id="LN4435">4435</td><td class="line">    method = <span class='macro'>MZ_DEFLATED<span class='macro_popup'>8</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4436"><td class="num" id="LN4436">4436</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4437"><td class="num" id="LN4437">4437</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4438"><td class="num" id="LN4438">4438</td><td class="line">  <span id="start24"><span id="end25">pZip</span></span>-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pComp);</td></tr>
<tr class="codeline" data-linenumber="4439"><td class="num" id="LN4439">4439</td><td class="line">  pComp = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4440"><td class="num" id="LN4440">4440</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4441"><td class="num" id="LN4441">4441</td><td class="line">  <span class='comment'>// no zip64 support yet</span></td></tr>
<tr class="codeline" data-linenumber="4442"><td class="num" id="LN4442">4442</td><td class="line">  <span id="start23"><span id="end24"><span class='keyword'>if</span></span></span> ((<span id="start22"><span id="end23"><span class='variable'>comp_size<table class='variable_popup'><tbody><tr><td valign='top'><div class='PathIndex PathIndexPopUp'>33.1</div></td><td>'comp_size' is <= -1</td></tr></tbody></table></span></span></span> &gt; 0xFFFFFFFF) || (<span id="start21"><span class="mrange"><span id="end22">cur_archive_file_ofs</span></span> &gt; 0xFFFFFFFF</span>))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path34" class="msg msgEvent" style="margin-left:36ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">34</div></td><td><div class="PathNav"><a href="#Path33" title="Previous event (33)">&#x2190;</a></div></td><td>Assuming 'cur_archive_file_ofs' is &lt;= -1</td><td><div class="PathNav"><a href="#Path35" title="Next event (35)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path35" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">35</div></td><td><div class="PathNav"><a href="#Path34" title="Previous event (34)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path36" title="Next event (36)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4443"><td class="num" id="LN4443">4443</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4444"><td class="num" id="LN4444">4444</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4445"><td class="num" id="LN4445">4445</td><td class="line">  <span id="start20"><span id="end21"><span class='keyword'>if</span></span></span> (!mz_zip_writer_create_local_dir_header(<span id="start19"><span id="end20">pZip</span></span>, local_dir_header, (mz_uint16)archive_name_size, 0, uncomp_size, comp_size, uncomp_crc32, method, 0, dos_time, dos_date))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path36" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">36</div></td><td><div class="PathNav"><a href="#Path35" title="Previous event (35)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path37" title="Next event (37)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4446"><td class="num" id="LN4446">4446</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4447"><td class="num" id="LN4447">4447</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4448"><td class="num" id="LN4448">4448</td><td class="line">  <span id="start18"><span id="end19"><span class='keyword'>if</span></span></span> (<span id="start17"><span class="mrange"><span id="end18">pZip</span></span>-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, local_dir_header_ofs, local_dir_header, <span class='keyword'>sizeof</span>(local_dir_header)) != <span class='keyword'>sizeof</span>(local_dir_header)</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path37" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">37</div></td><td><div class="PathNav"><a href="#Path36" title="Previous event (36)">&#x2190;</a></div></td><td>Assuming the condition is false</td><td><div class="PathNav"><a href="#Path38" title="Next event (38)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path38" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">38</div></td><td><div class="PathNav"><a href="#Path37" title="Previous event (37)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path39" title="Next event (39)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4449"><td class="num" id="LN4449">4449</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4450"><td class="num" id="LN4450">4450</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4451"><td class="num" id="LN4451">4451</td><td class="line">  <span id="start16"><span id="end17"><span class='keyword'>if</span></span></span> (!<span class="mrange"><span id="end14">mz_zip_writer_add_to_central_dir</span>(<span id="start15"><span id="end16">pZip</span></span>, pArchive_name, (mz_uint16)archive_name_size, <span id="start14"><span class="mrange"><span id="end15"><span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span></span></span></span>, 0, pComment, comment_size, uncomp_size, comp_size, uncomp_crc32, method, 0, dos_time, dos_date, local_dir_header_ofs, ext_attributes)</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path39" class="msg msgEvent" style="margin-left:92ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">39</div></td><td><div class="PathNav"><a href="#Path38" title="Previous event (38)">&#x2190;</a></div></td><td>Passing null pointer value via 4th parameter 'pExtra'</td><td><div class="PathNav"><a href="#Path40" title="Next event (40)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path40" class="msg msgEvent" style="margin-left:8ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">40</div></td><td><div class="PathNav"><a href="#Path39" title="Previous event (39)">&#x2190;</a></div></td><td>Calling 'mz_zip_writer_add_to_central_dir'</td><td><div class="PathNav"><a href="#Path41" title="Next event (41)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4452"><td class="num" id="LN4452">4452</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4453"><td class="num" id="LN4453">4453</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4454"><td class="num" id="LN4454">4454</td><td class="line">  pZip-&gt;m_total_files++;</td></tr>
<tr class="codeline" data-linenumber="4455"><td class="num" id="LN4455">4455</td><td class="line">  pZip-&gt;m_archive_size = cur_archive_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="4456"><td class="num" id="LN4456">4456</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4457"><td class="num" id="LN4457">4457</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4458"><td class="num" id="LN4458">4458</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4459"><td class="num" id="LN4459">4459</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4460"><td class="num" id="LN4460">4460</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4461"><td class="num" id="LN4461">4461</td><td class="line">mz_bool mz_zip_writer_add_file(mz_zip_archive *pZip, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_name, <span class='keyword'>const</span> <span class='keyword'>char</span> *pSrc_filename, <span class='keyword'>const</span> <span class='keyword'>void</span> *pComment, mz_uint16 comment_size, mz_uint level_and_flags)</td></tr>
<tr class="codeline" data-linenumber="4462"><td class="num" id="LN4462">4462</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4463"><td class="num" id="LN4463">4463</td><td class="line">  mz_uint uncomp_crc32 = <span class='macro'>MZ_CRC32_INIT<span class='macro_popup'>(0)</span></span>, level, num_alignment_padding_bytes;</td></tr>
<tr class="codeline" data-linenumber="4464"><td class="num" id="LN4464">4464</td><td class="line">  mz_uint16 method = 0, dos_time = 0, dos_date = 0, ext_attributes = 0;</td></tr>
<tr class="codeline" data-linenumber="4465"><td class="num" id="LN4465">4465</td><td class="line">  mz_uint64 local_dir_header_ofs = pZip-&gt;m_archive_size, cur_archive_file_ofs = pZip-&gt;m_archive_size, uncomp_size = 0, comp_size = 0;</td></tr>
<tr class="codeline" data-linenumber="4466"><td class="num" id="LN4466">4466</td><td class="line">  size_t archive_name_size;</td></tr>
<tr class="codeline" data-linenumber="4467"><td class="num" id="LN4467">4467</td><td class="line">  mz_uint8 local_dir_header[MZ_ZIP_LOCAL_DIR_HEADER_SIZE];</td></tr>
<tr class="codeline" data-linenumber="4468"><td class="num" id="LN4468">4468</td><td class="line">  <span class='macro'>MZ_FILE<span class='macro_popup'>FILE</span></span> *pSrc_file = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4469"><td class="num" id="LN4469">4469</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4470"><td class="num" id="LN4470">4470</td><td class="line">  <span class='keyword'>if</span> ((<span class='keyword'>int</span>)level_and_flags &lt; 0)</td></tr>
<tr class="codeline" data-linenumber="4471"><td class="num" id="LN4471">4471</td><td class="line">    level_and_flags = MZ_DEFAULT_LEVEL;</td></tr>
<tr class="codeline" data-linenumber="4472"><td class="num" id="LN4472">4472</td><td class="line">  level = level_and_flags &amp; 0xF;</td></tr>
<tr class="codeline" data-linenumber="4473"><td class="num" id="LN4473">4473</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4474"><td class="num" id="LN4474">4474</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (!pZip-&gt;m_pState) || (pZip-&gt;m_zip_mode != MZ_ZIP_MODE_WRITING) || (!pArchive_name) || ((comment_size) &amp;&amp; (!pComment)) || (level &gt; MZ_UBER_COMPRESSION))</td></tr>
<tr class="codeline" data-linenumber="4475"><td class="num" id="LN4475">4475</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4476"><td class="num" id="LN4476">4476</td><td class="line">  <span class='keyword'>if</span> (level_and_flags &amp; MZ_ZIP_FLAG_COMPRESSED_DATA)</td></tr>
<tr class="codeline" data-linenumber="4477"><td class="num" id="LN4477">4477</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4478"><td class="num" id="LN4478">4478</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_writer_validate_archive_name(pArchive_name))</td></tr>
<tr class="codeline" data-linenumber="4479"><td class="num" id="LN4479">4479</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4480"><td class="num" id="LN4480">4480</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4481"><td class="num" id="LN4481">4481</td><td class="line">  archive_name_size = strlen(pArchive_name);</td></tr>
<tr class="codeline" data-linenumber="4482"><td class="num" id="LN4482">4482</td><td class="line">  <span class='keyword'>if</span> (archive_name_size &gt; 0xFFFF)</td></tr>
<tr class="codeline" data-linenumber="4483"><td class="num" id="LN4483">4483</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4484"><td class="num" id="LN4484">4484</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4485"><td class="num" id="LN4485">4485</td><td class="line">  num_alignment_padding_bytes = mz_zip_writer_compute_padding_needed_for_file_alignment(pZip);</td></tr>
<tr class="codeline" data-linenumber="4486"><td class="num" id="LN4486">4486</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4487"><td class="num" id="LN4487">4487</td><td class="line">  <span class='comment'>// no zip64 support yet</span></td></tr>
<tr class="codeline" data-linenumber="4488"><td class="num" id="LN4488">4488</td><td class="line">  <span class='keyword'>if</span> ((pZip-&gt;m_total_files == 0xFFFF) || ((pZip-&gt;m_archive_size + num_alignment_padding_bytes + MZ_ZIP_LOCAL_DIR_HEADER_SIZE + MZ_ZIP_CENTRAL_DIR_HEADER_SIZE + comment_size + archive_name_size) &gt; 0xFFFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="4489"><td class="num" id="LN4489">4489</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4490"><td class="num" id="LN4490">4490</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4491"><td class="num" id="LN4491">4491</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_get_file_modified_time(pSrc_filename, &amp;dos_time, &amp;dos_date))</td></tr>
<tr class="codeline" data-linenumber="4492"><td class="num" id="LN4492">4492</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4493"><td class="num" id="LN4493">4493</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4494"><td class="num" id="LN4494">4494</td><td class="line">  pSrc_file = <span class='macro'>MZ_FOPEN(pSrc_filename, <span class='string_literal'>"rb"</span>)<span class='macro_popup'>fopen(pSrc_filename, "rb")</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4495"><td class="num" id="LN4495">4495</td><td class="line">  <span class='keyword'>if</span> (!pSrc_file)</td></tr>
<tr class="codeline" data-linenumber="4496"><td class="num" id="LN4496">4496</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4497"><td class="num" id="LN4497">4497</td><td class="line">  <span class='macro'>MZ_FSEEK64<span class='macro_popup'>fseeko</span></span>(pSrc_file, 0, <span class='macro'>SEEK_END<span class='macro_popup'>2</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4498"><td class="num" id="LN4498">4498</td><td class="line">  uncomp_size = <span class='macro'>MZ_FTELL64<span class='macro_popup'>ftello</span></span>(pSrc_file);</td></tr>
<tr class="codeline" data-linenumber="4499"><td class="num" id="LN4499">4499</td><td class="line">  <span class='macro'>MZ_FSEEK64<span class='macro_popup'>fseeko</span></span>(pSrc_file, 0, <span class='macro'>SEEK_SET<span class='macro_popup'>0</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4500"><td class="num" id="LN4500">4500</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4501"><td class="num" id="LN4501">4501</td><td class="line">  <span class='keyword'>if</span> (uncomp_size &gt; 0xFFFFFFFF)</td></tr>
<tr class="codeline" data-linenumber="4502"><td class="num" id="LN4502">4502</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4503"><td class="num" id="LN4503">4503</td><td class="line">    <span class='comment'>// No zip64 support yet</span></td></tr>
<tr class="codeline" data-linenumber="4504"><td class="num" id="LN4504">4504</td><td class="line">    <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pSrc_file);</td></tr>
<tr class="codeline" data-linenumber="4505"><td class="num" id="LN4505">4505</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4506"><td class="num" id="LN4506">4506</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4507"><td class="num" id="LN4507">4507</td><td class="line">  <span class='keyword'>if</span> (uncomp_size &lt;= 3)</td></tr>
<tr class="codeline" data-linenumber="4508"><td class="num" id="LN4508">4508</td><td class="line">    level = 0;</td></tr>
<tr class="codeline" data-linenumber="4509"><td class="num" id="LN4509">4509</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4510"><td class="num" id="LN4510">4510</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_writer_write_zeros(pZip, cur_archive_file_ofs, num_alignment_padding_bytes + <span class='keyword'>sizeof</span>(local_dir_header)))</td></tr>
<tr class="codeline" data-linenumber="4511"><td class="num" id="LN4511">4511</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4512"><td class="num" id="LN4512">4512</td><td class="line">    <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pSrc_file);</td></tr>
<tr class="codeline" data-linenumber="4513"><td class="num" id="LN4513">4513</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4514"><td class="num" id="LN4514">4514</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4515"><td class="num" id="LN4515">4515</td><td class="line">  local_dir_header_ofs += num_alignment_padding_bytes;</td></tr>
<tr class="codeline" data-linenumber="4516"><td class="num" id="LN4516">4516</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_file_offset_alignment) { <span class='macro'>MZ_ASSERT((local_dir_header_ofs &amp; (pZip-&gt;m_file_offset_alignment - 1)) == 0)<span class='macro_popup'>((void) sizeof (((local_dir_header_ofs &amp; (pZip-&gt;m_file_offset_alignment<br> - 1)) == 0) ? 1 : 0), __extension__ ({ if ((local_dir_header_ofs<br> &amp; (pZip-&gt;m_file_offset_alignment - 1)) == 0) ; else __assert_fail<br> ("(local_dir_header_ofs &amp; (pZip-&gt;m_file_offset_alignment - 1)) == 0"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 4516, __extension__ __PRETTY_FUNCTION__); }))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="4517"><td class="num" id="LN4517">4517</td><td class="line">  cur_archive_file_ofs += num_alignment_padding_bytes + <span class='keyword'>sizeof</span>(local_dir_header);</td></tr>
<tr class="codeline" data-linenumber="4518"><td class="num" id="LN4518">4518</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4519"><td class="num" id="LN4519">4519</td><td class="line">  <span class='macro'>MZ_CLEAR_OBJ(local_dir_header)<span class='macro_popup'>memset(&amp;(local_dir_header), 0, sizeof(local_dir_header))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4520"><td class="num" id="LN4520">4520</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, cur_archive_file_ofs, pArchive_name, archive_name_size) != archive_name_size)</td></tr>
<tr class="codeline" data-linenumber="4521"><td class="num" id="LN4521">4521</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4522"><td class="num" id="LN4522">4522</td><td class="line">    <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pSrc_file);</td></tr>
<tr class="codeline" data-linenumber="4523"><td class="num" id="LN4523">4523</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4524"><td class="num" id="LN4524">4524</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4525"><td class="num" id="LN4525">4525</td><td class="line">  cur_archive_file_ofs += archive_name_size;</td></tr>
<tr class="codeline" data-linenumber="4526"><td class="num" id="LN4526">4526</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4527"><td class="num" id="LN4527">4527</td><td class="line">  <span class='keyword'>if</span> (uncomp_size)</td></tr>
<tr class="codeline" data-linenumber="4528"><td class="num" id="LN4528">4528</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4529"><td class="num" id="LN4529">4529</td><td class="line">    mz_uint64 uncomp_remaining = uncomp_size;</td></tr>
<tr class="codeline" data-linenumber="4530"><td class="num" id="LN4530">4530</td><td class="line">    <span class='keyword'>void</span> *pRead_buf = pZip-&gt;m_pAlloc(pZip-&gt;m_pAlloc_opaque, 1, MZ_ZIP_MAX_IO_BUF_SIZE);</td></tr>
<tr class="codeline" data-linenumber="4531"><td class="num" id="LN4531">4531</td><td class="line">    <span class='keyword'>if</span> (!pRead_buf)</td></tr>
<tr class="codeline" data-linenumber="4532"><td class="num" id="LN4532">4532</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4533"><td class="num" id="LN4533">4533</td><td class="line">      <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pSrc_file);</td></tr>
<tr class="codeline" data-linenumber="4534"><td class="num" id="LN4534">4534</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4535"><td class="num" id="LN4535">4535</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4536"><td class="num" id="LN4536">4536</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4537"><td class="num" id="LN4537">4537</td><td class="line">    <span class='keyword'>if</span> (!level)</td></tr>
<tr class="codeline" data-linenumber="4538"><td class="num" id="LN4538">4538</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4539"><td class="num" id="LN4539">4539</td><td class="line">      <span class='keyword'>while</span> (uncomp_remaining)</td></tr>
<tr class="codeline" data-linenumber="4540"><td class="num" id="LN4540">4540</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="4541"><td class="num" id="LN4541">4541</td><td class="line">        mz_uint n = (mz_uint)<span class='macro'>MZ_MIN(MZ_ZIP_MAX_IO_BUF_SIZE, uncomp_remaining)<span class='macro_popup'>(((MZ_ZIP_MAX_IO_BUF_SIZE)&lt;(uncomp_remaining))?(MZ_ZIP_MAX_IO_BUF_SIZE<br>):(uncomp_remaining))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4542"><td class="num" id="LN4542">4542</td><td class="line">        <span class='keyword'>if</span> ((<span class='macro'>MZ_FREAD<span class='macro_popup'>fread</span></span>(pRead_buf, 1, n, pSrc_file) != n) || (pZip-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, cur_archive_file_ofs, pRead_buf, n) != n))</td></tr>
<tr class="codeline" data-linenumber="4543"><td class="num" id="LN4543">4543</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="4544"><td class="num" id="LN4544">4544</td><td class="line">          pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pRead_buf);</td></tr>
<tr class="codeline" data-linenumber="4545"><td class="num" id="LN4545">4545</td><td class="line">          <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pSrc_file);</td></tr>
<tr class="codeline" data-linenumber="4546"><td class="num" id="LN4546">4546</td><td class="line">          <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4547"><td class="num" id="LN4547">4547</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="4548"><td class="num" id="LN4548">4548</td><td class="line">        uncomp_crc32 = (mz_uint32)mz_crc32(uncomp_crc32, (<span class='keyword'>const</span> mz_uint8 *)pRead_buf, n);</td></tr>
<tr class="codeline" data-linenumber="4549"><td class="num" id="LN4549">4549</td><td class="line">        uncomp_remaining -= n;</td></tr>
<tr class="codeline" data-linenumber="4550"><td class="num" id="LN4550">4550</td><td class="line">        cur_archive_file_ofs += n;</td></tr>
<tr class="codeline" data-linenumber="4551"><td class="num" id="LN4551">4551</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4552"><td class="num" id="LN4552">4552</td><td class="line">      comp_size = uncomp_size;</td></tr>
<tr class="codeline" data-linenumber="4553"><td class="num" id="LN4553">4553</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4554"><td class="num" id="LN4554">4554</td><td class="line">    <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4555"><td class="num" id="LN4555">4555</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4556"><td class="num" id="LN4556">4556</td><td class="line">      mz_bool result = <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4557"><td class="num" id="LN4557">4557</td><td class="line">      mz_zip_writer_add_state state;</td></tr>
<tr class="codeline" data-linenumber="4558"><td class="num" id="LN4558">4558</td><td class="line">      tdefl_compressor *pComp = (tdefl_compressor *)pZip-&gt;m_pAlloc(pZip-&gt;m_pAlloc_opaque, 1, <span class='keyword'>sizeof</span>(tdefl_compressor));</td></tr>
<tr class="codeline" data-linenumber="4559"><td class="num" id="LN4559">4559</td><td class="line">      <span class='keyword'>if</span> (!pComp)</td></tr>
<tr class="codeline" data-linenumber="4560"><td class="num" id="LN4560">4560</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="4561"><td class="num" id="LN4561">4561</td><td class="line">        pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pRead_buf);</td></tr>
<tr class="codeline" data-linenumber="4562"><td class="num" id="LN4562">4562</td><td class="line">        <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pSrc_file);</td></tr>
<tr class="codeline" data-linenumber="4563"><td class="num" id="LN4563">4563</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4564"><td class="num" id="LN4564">4564</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4565"><td class="num" id="LN4565">4565</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4566"><td class="num" id="LN4566">4566</td><td class="line">      state.m_pZip = pZip;</td></tr>
<tr class="codeline" data-linenumber="4567"><td class="num" id="LN4567">4567</td><td class="line">      state.m_cur_archive_file_ofs = cur_archive_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="4568"><td class="num" id="LN4568">4568</td><td class="line">      state.m_comp_size = 0;</td></tr>
<tr class="codeline" data-linenumber="4569"><td class="num" id="LN4569">4569</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4570"><td class="num" id="LN4570">4570</td><td class="line">      <span class='keyword'>if</span> (tdefl_init(pComp, mz_zip_writer_add_put_buf_callback, &amp;state, tdefl_create_comp_flags_from_zip_params(level, -15, MZ_DEFAULT_STRATEGY)) != TDEFL_STATUS_OKAY)</td></tr>
<tr class="codeline" data-linenumber="4571"><td class="num" id="LN4571">4571</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="4572"><td class="num" id="LN4572">4572</td><td class="line">        pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pComp);</td></tr>
<tr class="codeline" data-linenumber="4573"><td class="num" id="LN4573">4573</td><td class="line">        pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pRead_buf);</td></tr>
<tr class="codeline" data-linenumber="4574"><td class="num" id="LN4574">4574</td><td class="line">        <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pSrc_file);</td></tr>
<tr class="codeline" data-linenumber="4575"><td class="num" id="LN4575">4575</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4576"><td class="num" id="LN4576">4576</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4577"><td class="num" id="LN4577">4577</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4578"><td class="num" id="LN4578">4578</td><td class="line">      <span class='keyword'>for</span> ( ; ; )</td></tr>
<tr class="codeline" data-linenumber="4579"><td class="num" id="LN4579">4579</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="4580"><td class="num" id="LN4580">4580</td><td class="line">        size_t in_buf_size = (mz_uint32)<span class='macro'>MZ_MIN(uncomp_remaining, MZ_ZIP_MAX_IO_BUF_SIZE)<span class='macro_popup'>(((uncomp_remaining)&lt;(MZ_ZIP_MAX_IO_BUF_SIZE))?(uncomp_remaining<br>):(MZ_ZIP_MAX_IO_BUF_SIZE))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4581"><td class="num" id="LN4581">4581</td><td class="line">        tdefl_status status;</td></tr>
<tr class="codeline" data-linenumber="4582"><td class="num" id="LN4582">4582</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4583"><td class="num" id="LN4583">4583</td><td class="line">        <span class='keyword'>if</span> (<span class='macro'>MZ_FREAD<span class='macro_popup'>fread</span></span>(pRead_buf, 1, in_buf_size, pSrc_file) != in_buf_size)</td></tr>
<tr class="codeline" data-linenumber="4584"><td class="num" id="LN4584">4584</td><td class="line">          <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4585"><td class="num" id="LN4585">4585</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4586"><td class="num" id="LN4586">4586</td><td class="line">        uncomp_crc32 = (mz_uint32)mz_crc32(uncomp_crc32, (<span class='keyword'>const</span> mz_uint8 *)pRead_buf, in_buf_size);</td></tr>
<tr class="codeline" data-linenumber="4587"><td class="num" id="LN4587">4587</td><td class="line">        uncomp_remaining -= in_buf_size;</td></tr>
<tr class="codeline" data-linenumber="4588"><td class="num" id="LN4588">4588</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4589"><td class="num" id="LN4589">4589</td><td class="line">        status = tdefl_compress_buffer(pComp, pRead_buf, in_buf_size, uncomp_remaining ? TDEFL_NO_FLUSH : TDEFL_FINISH);</td></tr>
<tr class="codeline" data-linenumber="4590"><td class="num" id="LN4590">4590</td><td class="line">        <span class='keyword'>if</span> (status == TDEFL_STATUS_DONE)</td></tr>
<tr class="codeline" data-linenumber="4591"><td class="num" id="LN4591">4591</td><td class="line">        {</td></tr>
<tr class="codeline" data-linenumber="4592"><td class="num" id="LN4592">4592</td><td class="line">          result = <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4593"><td class="num" id="LN4593">4593</td><td class="line">          <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4594"><td class="num" id="LN4594">4594</td><td class="line">        }</td></tr>
<tr class="codeline" data-linenumber="4595"><td class="num" id="LN4595">4595</td><td class="line">        <span class='keyword'>else</span> <span class='keyword'>if</span> (status != TDEFL_STATUS_OKAY)</td></tr>
<tr class="codeline" data-linenumber="4596"><td class="num" id="LN4596">4596</td><td class="line">          <span class='keyword'>break</span>;</td></tr>
<tr class="codeline" data-linenumber="4597"><td class="num" id="LN4597">4597</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4598"><td class="num" id="LN4598">4598</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4599"><td class="num" id="LN4599">4599</td><td class="line">      pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pComp);</td></tr>
<tr class="codeline" data-linenumber="4600"><td class="num" id="LN4600">4600</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4601"><td class="num" id="LN4601">4601</td><td class="line">      <span class='keyword'>if</span> (!result)</td></tr>
<tr class="codeline" data-linenumber="4602"><td class="num" id="LN4602">4602</td><td class="line">      {</td></tr>
<tr class="codeline" data-linenumber="4603"><td class="num" id="LN4603">4603</td><td class="line">        pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pRead_buf);</td></tr>
<tr class="codeline" data-linenumber="4604"><td class="num" id="LN4604">4604</td><td class="line">        <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pSrc_file);</td></tr>
<tr class="codeline" data-linenumber="4605"><td class="num" id="LN4605">4605</td><td class="line">        <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4606"><td class="num" id="LN4606">4606</td><td class="line">      }</td></tr>
<tr class="codeline" data-linenumber="4607"><td class="num" id="LN4607">4607</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4608"><td class="num" id="LN4608">4608</td><td class="line">      comp_size = state.m_comp_size;</td></tr>
<tr class="codeline" data-linenumber="4609"><td class="num" id="LN4609">4609</td><td class="line">      cur_archive_file_ofs = state.m_cur_archive_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="4610"><td class="num" id="LN4610">4610</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4611"><td class="num" id="LN4611">4611</td><td class="line">      method = <span class='macro'>MZ_DEFLATED<span class='macro_popup'>8</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4612"><td class="num" id="LN4612">4612</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4613"><td class="num" id="LN4613">4613</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4614"><td class="num" id="LN4614">4614</td><td class="line">    pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pRead_buf);</td></tr>
<tr class="codeline" data-linenumber="4615"><td class="num" id="LN4615">4615</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4616"><td class="num" id="LN4616">4616</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4617"><td class="num" id="LN4617">4617</td><td class="line">  <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pSrc_file); pSrc_file = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4618"><td class="num" id="LN4618">4618</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4619"><td class="num" id="LN4619">4619</td><td class="line">  <span class='comment'>// no zip64 support yet</span></td></tr>
<tr class="codeline" data-linenumber="4620"><td class="num" id="LN4620">4620</td><td class="line">  <span class='keyword'>if</span> ((comp_size &gt; 0xFFFFFFFF) || (cur_archive_file_ofs &gt; 0xFFFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="4621"><td class="num" id="LN4621">4621</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4622"><td class="num" id="LN4622">4622</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4623"><td class="num" id="LN4623">4623</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_writer_create_local_dir_header(pZip, local_dir_header, (mz_uint16)archive_name_size, 0, uncomp_size, comp_size, uncomp_crc32, method, 0, dos_time, dos_date))</td></tr>
<tr class="codeline" data-linenumber="4624"><td class="num" id="LN4624">4624</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4625"><td class="num" id="LN4625">4625</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4626"><td class="num" id="LN4626">4626</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, local_dir_header_ofs, local_dir_header, <span class='keyword'>sizeof</span>(local_dir_header)) != <span class='keyword'>sizeof</span>(local_dir_header))</td></tr>
<tr class="codeline" data-linenumber="4627"><td class="num" id="LN4627">4627</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4628"><td class="num" id="LN4628">4628</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4629"><td class="num" id="LN4629">4629</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_writer_add_to_central_dir(pZip, pArchive_name, (mz_uint16)archive_name_size, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, 0, pComment, comment_size, uncomp_size, comp_size, uncomp_crc32, method, 0, dos_time, dos_date, local_dir_header_ofs, ext_attributes))</td></tr>
<tr class="codeline" data-linenumber="4630"><td class="num" id="LN4630">4630</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4631"><td class="num" id="LN4631">4631</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4632"><td class="num" id="LN4632">4632</td><td class="line">  pZip-&gt;m_total_files++;</td></tr>
<tr class="codeline" data-linenumber="4633"><td class="num" id="LN4633">4633</td><td class="line">  pZip-&gt;m_archive_size = cur_archive_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="4634"><td class="num" id="LN4634">4634</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4635"><td class="num" id="LN4635">4635</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4636"><td class="num" id="LN4636">4636</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4637"><td class="num" id="LN4637">4637</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4638"><td class="num" id="LN4638">4638</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4639"><td class="num" id="LN4639">4639</td><td class="line">mz_bool mz_zip_writer_add_from_zip_reader(mz_zip_archive *pZip, mz_zip_archive *pSource_zip, mz_uint file_index)</td></tr>
<tr class="codeline" data-linenumber="4640"><td class="num" id="LN4640">4640</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4641"><td class="num" id="LN4641">4641</td><td class="line">  mz_uint n, bit_flags, num_alignment_padding_bytes;</td></tr>
<tr class="codeline" data-linenumber="4642"><td class="num" id="LN4642">4642</td><td class="line">  mz_uint64 comp_bytes_remaining, local_dir_header_ofs;</td></tr>
<tr class="codeline" data-linenumber="4643"><td class="num" id="LN4643">4643</td><td class="line">  mz_uint64 cur_src_file_ofs, cur_dst_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="4644"><td class="num" id="LN4644">4644</td><td class="line">  mz_uint32 local_header_u32[(MZ_ZIP_LOCAL_DIR_HEADER_SIZE + <span class='keyword'>sizeof</span>(mz_uint32) - 1) / <span class='keyword'>sizeof</span>(mz_uint32)]; mz_uint8 *pLocal_header = (mz_uint8 *)local_header_u32;</td></tr>
<tr class="codeline" data-linenumber="4645"><td class="num" id="LN4645">4645</td><td class="line">  mz_uint8 central_header[MZ_ZIP_CENTRAL_DIR_HEADER_SIZE];</td></tr>
<tr class="codeline" data-linenumber="4646"><td class="num" id="LN4646">4646</td><td class="line">  size_t orig_central_dir_size;</td></tr>
<tr class="codeline" data-linenumber="4647"><td class="num" id="LN4647">4647</td><td class="line">  mz_zip_internal_state *pState;</td></tr>
<tr class="codeline" data-linenumber="4648"><td class="num" id="LN4648">4648</td><td class="line">  <span class='keyword'>void</span> *pBuf; <span class='keyword'>const</span> mz_uint8 *pSrc_central_header;</td></tr>
<tr class="codeline" data-linenumber="4649"><td class="num" id="LN4649">4649</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4650"><td class="num" id="LN4650">4650</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (!pZip-&gt;m_pState) || (pZip-&gt;m_zip_mode != MZ_ZIP_MODE_WRITING))</td></tr>
<tr class="codeline" data-linenumber="4651"><td class="num" id="LN4651">4651</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4652"><td class="num" id="LN4652">4652</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pSrc_central_header = mz_zip_reader_get_cdh(pSource_zip, file_index)))</td></tr>
<tr class="codeline" data-linenumber="4653"><td class="num" id="LN4653">4653</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4654"><td class="num" id="LN4654">4654</td><td class="line">  pState = pZip-&gt;m_pState;</td></tr>
<tr class="codeline" data-linenumber="4655"><td class="num" id="LN4655">4655</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4656"><td class="num" id="LN4656">4656</td><td class="line">  num_alignment_padding_bytes = mz_zip_writer_compute_padding_needed_for_file_alignment(pZip);</td></tr>
<tr class="codeline" data-linenumber="4657"><td class="num" id="LN4657">4657</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4658"><td class="num" id="LN4658">4658</td><td class="line">  <span class='comment'>// no zip64 support yet</span></td></tr>
<tr class="codeline" data-linenumber="4659"><td class="num" id="LN4659">4659</td><td class="line">  <span class='keyword'>if</span> ((pZip-&gt;m_total_files == 0xFFFF) || ((pZip-&gt;m_archive_size + num_alignment_padding_bytes + MZ_ZIP_LOCAL_DIR_HEADER_SIZE + MZ_ZIP_CENTRAL_DIR_HEADER_SIZE) &gt; 0xFFFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="4660"><td class="num" id="LN4660">4660</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4661"><td class="num" id="LN4661">4661</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4662"><td class="num" id="LN4662">4662</td><td class="line">  cur_src_file_ofs = pSource_zip-&gt;m_archive_file_ofs + <span class='macro'>MZ_READ_LE32(pSrc_central_header + MZ_ZIP_CDH_LOCAL_HEADER_OFS)<span class='macro_popup'>*((const mz_uint32 *)(pSrc_central_header + MZ_ZIP_CDH_LOCAL_HEADER_OFS<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4663"><td class="num" id="LN4663">4663</td><td class="line">  cur_dst_file_ofs = pZip-&gt;m_archive_size;</td></tr>
<tr class="codeline" data-linenumber="4664"><td class="num" id="LN4664">4664</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4665"><td class="num" id="LN4665">4665</td><td class="line">  <span class='keyword'>if</span> (pSource_zip-&gt;m_pRead(pSource_zip-&gt;m_pIO_opaque, cur_src_file_ofs, pLocal_header, MZ_ZIP_LOCAL_DIR_HEADER_SIZE) != MZ_ZIP_LOCAL_DIR_HEADER_SIZE)</td></tr>
<tr class="codeline" data-linenumber="4666"><td class="num" id="LN4666">4666</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4667"><td class="num" id="LN4667">4667</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>MZ_READ_LE32(pLocal_header)<span class='macro_popup'>*((const mz_uint32 *)(pLocal_header))</span></span> != MZ_ZIP_LOCAL_DIR_HEADER_SIG)</td></tr>
<tr class="codeline" data-linenumber="4668"><td class="num" id="LN4668">4668</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4669"><td class="num" id="LN4669">4669</td><td class="line">  cur_src_file_ofs += MZ_ZIP_LOCAL_DIR_HEADER_SIZE;</td></tr>
<tr class="codeline" data-linenumber="4670"><td class="num" id="LN4670">4670</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4671"><td class="num" id="LN4671">4671</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_writer_write_zeros(pZip, cur_dst_file_ofs, num_alignment_padding_bytes))</td></tr>
<tr class="codeline" data-linenumber="4672"><td class="num" id="LN4672">4672</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4673"><td class="num" id="LN4673">4673</td><td class="line">  cur_dst_file_ofs += num_alignment_padding_bytes;</td></tr>
<tr class="codeline" data-linenumber="4674"><td class="num" id="LN4674">4674</td><td class="line">  local_dir_header_ofs = cur_dst_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="4675"><td class="num" id="LN4675">4675</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_file_offset_alignment) { <span class='macro'>MZ_ASSERT((local_dir_header_ofs &amp; (pZip-&gt;m_file_offset_alignment - 1)) == 0)<span class='macro_popup'>((void) sizeof (((local_dir_header_ofs &amp; (pZip-&gt;m_file_offset_alignment<br> - 1)) == 0) ? 1 : 0), __extension__ ({ if ((local_dir_header_ofs<br> &amp; (pZip-&gt;m_file_offset_alignment - 1)) == 0) ; else __assert_fail<br> ("(local_dir_header_ofs &amp; (pZip-&gt;m_file_offset_alignment - 1)) == 0"<br>, "/work/repo/external/CppMicroServices/third_party/miniz.c",<br> 4675, __extension__ __PRETTY_FUNCTION__); }))</span></span>; }</td></tr>
<tr class="codeline" data-linenumber="4676"><td class="num" id="LN4676">4676</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4677"><td class="num" id="LN4677">4677</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, cur_dst_file_ofs, pLocal_header, MZ_ZIP_LOCAL_DIR_HEADER_SIZE) != MZ_ZIP_LOCAL_DIR_HEADER_SIZE)</td></tr>
<tr class="codeline" data-linenumber="4678"><td class="num" id="LN4678">4678</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4679"><td class="num" id="LN4679">4679</td><td class="line">  cur_dst_file_ofs += MZ_ZIP_LOCAL_DIR_HEADER_SIZE;</td></tr>
<tr class="codeline" data-linenumber="4680"><td class="num" id="LN4680">4680</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4681"><td class="num" id="LN4681">4681</td><td class="line">  n = <span class='macro'>MZ_READ_LE16(pLocal_header + MZ_ZIP_LDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pLocal_header + MZ_ZIP_LDH_FILENAME_LEN_OFS<br>))</span></span> + <span class='macro'>MZ_READ_LE16(pLocal_header + MZ_ZIP_LDH_EXTRA_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pLocal_header + MZ_ZIP_LDH_EXTRA_LEN_OFS<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4682"><td class="num" id="LN4682">4682</td><td class="line">  comp_bytes_remaining = n + <span class='macro'>MZ_READ_LE32(pSrc_central_header + MZ_ZIP_CDH_COMPRESSED_SIZE_OFS)<span class='macro_popup'>*((const mz_uint32 *)(pSrc_central_header + MZ_ZIP_CDH_COMPRESSED_SIZE_OFS<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4683"><td class="num" id="LN4683">4683</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4684"><td class="num" id="LN4684">4684</td><td class="line">  <span class='keyword'>if</span> (<span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span> == (pBuf = pZip-&gt;m_pAlloc(pZip-&gt;m_pAlloc_opaque, 1, (size_t)<span class='macro'>MZ_MAX(<span class='keyword'>sizeof</span>(mz_uint32) * 4, MZ_MIN(MZ_ZIP_MAX_IO_BUF_SIZE, comp_bytes_remaining))<span class='macro_popup'>(((sizeof(mz_uint32) * 4)&gt;((((MZ_ZIP_MAX_IO_BUF_SIZE)&lt;(<br>comp_bytes_remaining))?(MZ_ZIP_MAX_IO_BUF_SIZE):(comp_bytes_remaining<br>))))?(sizeof(mz_uint32) * 4):((((MZ_ZIP_MAX_IO_BUF_SIZE)&lt;(<br>comp_bytes_remaining))?(MZ_ZIP_MAX_IO_BUF_SIZE):(comp_bytes_remaining<br>))))</span></span>)))</td></tr>
<tr class="codeline" data-linenumber="4685"><td class="num" id="LN4685">4685</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4686"><td class="num" id="LN4686">4686</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4687"><td class="num" id="LN4687">4687</td><td class="line">  <span class='keyword'>while</span> (comp_bytes_remaining)</td></tr>
<tr class="codeline" data-linenumber="4688"><td class="num" id="LN4688">4688</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4689"><td class="num" id="LN4689">4689</td><td class="line">    n = (mz_uint)<span class='macro'>MZ_MIN(MZ_ZIP_MAX_IO_BUF_SIZE, comp_bytes_remaining)<span class='macro_popup'>(((MZ_ZIP_MAX_IO_BUF_SIZE)&lt;(comp_bytes_remaining))?(MZ_ZIP_MAX_IO_BUF_SIZE<br>):(comp_bytes_remaining))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4690"><td class="num" id="LN4690">4690</td><td class="line">    <span class='keyword'>if</span> (pSource_zip-&gt;m_pRead(pSource_zip-&gt;m_pIO_opaque, cur_src_file_ofs, pBuf, n) != n)</td></tr>
<tr class="codeline" data-linenumber="4691"><td class="num" id="LN4691">4691</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4692"><td class="num" id="LN4692">4692</td><td class="line">      pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pBuf);</td></tr>
<tr class="codeline" data-linenumber="4693"><td class="num" id="LN4693">4693</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4694"><td class="num" id="LN4694">4694</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4695"><td class="num" id="LN4695">4695</td><td class="line">    cur_src_file_ofs += n;</td></tr>
<tr class="codeline" data-linenumber="4696"><td class="num" id="LN4696">4696</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4697"><td class="num" id="LN4697">4697</td><td class="line">    <span class='keyword'>if</span> (pZip-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, cur_dst_file_ofs, pBuf, n) != n)</td></tr>
<tr class="codeline" data-linenumber="4698"><td class="num" id="LN4698">4698</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4699"><td class="num" id="LN4699">4699</td><td class="line">      pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pBuf);</td></tr>
<tr class="codeline" data-linenumber="4700"><td class="num" id="LN4700">4700</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4701"><td class="num" id="LN4701">4701</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4702"><td class="num" id="LN4702">4702</td><td class="line">    cur_dst_file_ofs += n;</td></tr>
<tr class="codeline" data-linenumber="4703"><td class="num" id="LN4703">4703</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4704"><td class="num" id="LN4704">4704</td><td class="line">    comp_bytes_remaining -= n;</td></tr>
<tr class="codeline" data-linenumber="4705"><td class="num" id="LN4705">4705</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4706"><td class="num" id="LN4706">4706</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4707"><td class="num" id="LN4707">4707</td><td class="line">  bit_flags = <span class='macro'>MZ_READ_LE16(pLocal_header + MZ_ZIP_LDH_BIT_FLAG_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pLocal_header + MZ_ZIP_LDH_BIT_FLAG_OFS<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4708"><td class="num" id="LN4708">4708</td><td class="line">  <span class='keyword'>if</span> (bit_flags &amp; 8)</td></tr>
<tr class="codeline" data-linenumber="4709"><td class="num" id="LN4709">4709</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4710"><td class="num" id="LN4710">4710</td><td class="line">    <span class='comment'>// Copy data descriptor</span></td></tr>
<tr class="codeline" data-linenumber="4711"><td class="num" id="LN4711">4711</td><td class="line">    <span class='keyword'>if</span> (pSource_zip-&gt;m_pRead(pSource_zip-&gt;m_pIO_opaque, cur_src_file_ofs, pBuf, <span class='keyword'>sizeof</span>(mz_uint32) * 4) != <span class='keyword'>sizeof</span>(mz_uint32) * 4)</td></tr>
<tr class="codeline" data-linenumber="4712"><td class="num" id="LN4712">4712</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4713"><td class="num" id="LN4713">4713</td><td class="line">      pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pBuf);</td></tr>
<tr class="codeline" data-linenumber="4714"><td class="num" id="LN4714">4714</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4715"><td class="num" id="LN4715">4715</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4716"><td class="num" id="LN4716">4716</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4717"><td class="num" id="LN4717">4717</td><td class="line">    n = <span class='keyword'>sizeof</span>(mz_uint32) * ((<span class='macro'>MZ_READ_LE32(pBuf)<span class='macro_popup'>*((const mz_uint32 *)(pBuf))</span></span> == 0x08074b50) ? 4 : 3);</td></tr>
<tr class="codeline" data-linenumber="4718"><td class="num" id="LN4718">4718</td><td class="line">    <span class='keyword'>if</span> (pZip-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, cur_dst_file_ofs, pBuf, n) != n)</td></tr>
<tr class="codeline" data-linenumber="4719"><td class="num" id="LN4719">4719</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4720"><td class="num" id="LN4720">4720</td><td class="line">      pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pBuf);</td></tr>
<tr class="codeline" data-linenumber="4721"><td class="num" id="LN4721">4721</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4722"><td class="num" id="LN4722">4722</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4723"><td class="num" id="LN4723">4723</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4724"><td class="num" id="LN4724">4724</td><td class="line">    cur_src_file_ofs += n;</td></tr>
<tr class="codeline" data-linenumber="4725"><td class="num" id="LN4725">4725</td><td class="line">    cur_dst_file_ofs += n;</td></tr>
<tr class="codeline" data-linenumber="4726"><td class="num" id="LN4726">4726</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4727"><td class="num" id="LN4727">4727</td><td class="line">  pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pBuf);</td></tr>
<tr class="codeline" data-linenumber="4728"><td class="num" id="LN4728">4728</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4729"><td class="num" id="LN4729">4729</td><td class="line">  <span class='comment'>// no zip64 support yet</span></td></tr>
<tr class="codeline" data-linenumber="4730"><td class="num" id="LN4730">4730</td><td class="line">  <span class='keyword'>if</span> (cur_dst_file_ofs &gt; 0xFFFFFFFF)</td></tr>
<tr class="codeline" data-linenumber="4731"><td class="num" id="LN4731">4731</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4732"><td class="num" id="LN4732">4732</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4733"><td class="num" id="LN4733">4733</td><td class="line">  orig_central_dir_size = pState-&gt;m_central_dir.m_size;</td></tr>
<tr class="codeline" data-linenumber="4734"><td class="num" id="LN4734">4734</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4735"><td class="num" id="LN4735">4735</td><td class="line">  memcpy(central_header, pSrc_central_header, MZ_ZIP_CENTRAL_DIR_HEADER_SIZE);</td></tr>
<tr class="codeline" data-linenumber="4736"><td class="num" id="LN4736">4736</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(central_header + MZ_ZIP_CDH_LOCAL_HEADER_OFS, local_dir_header_ofs)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(central_header + MZ_ZIP_CDH_LOCAL_HEADER_OFS<br>), (mz_uint32)(local_dir_header_ofs))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4737"><td class="num" id="LN4737">4737</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_array_push_back(pZip, &amp;pState-&gt;m_central_dir, central_header, MZ_ZIP_CENTRAL_DIR_HEADER_SIZE))</td></tr>
<tr class="codeline" data-linenumber="4738"><td class="num" id="LN4738">4738</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4739"><td class="num" id="LN4739">4739</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4740"><td class="num" id="LN4740">4740</td><td class="line">  n = <span class='macro'>MZ_READ_LE16(pSrc_central_header + MZ_ZIP_CDH_FILENAME_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pSrc_central_header + MZ_ZIP_CDH_FILENAME_LEN_OFS<br>))</span></span> + <span class='macro'>MZ_READ_LE16(pSrc_central_header + MZ_ZIP_CDH_EXTRA_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pSrc_central_header + MZ_ZIP_CDH_EXTRA_LEN_OFS<br>))</span></span> + <span class='macro'>MZ_READ_LE16(pSrc_central_header + MZ_ZIP_CDH_COMMENT_LEN_OFS)<span class='macro_popup'>*((const mz_uint16 *)(pSrc_central_header + MZ_ZIP_CDH_COMMENT_LEN_OFS<br>))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4741"><td class="num" id="LN4741">4741</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_array_push_back(pZip, &amp;pState-&gt;m_central_dir, pSrc_central_header + MZ_ZIP_CENTRAL_DIR_HEADER_SIZE, n))</td></tr>
<tr class="codeline" data-linenumber="4742"><td class="num" id="LN4742">4742</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4743"><td class="num" id="LN4743">4743</td><td class="line">    mz_zip_array_resize(pZip, &amp;pState-&gt;m_central_dir, orig_central_dir_size, <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4744"><td class="num" id="LN4744">4744</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4745"><td class="num" id="LN4745">4745</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4746"><td class="num" id="LN4746">4746</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4747"><td class="num" id="LN4747">4747</td><td class="line">  <span class='keyword'>if</span> (pState-&gt;m_central_dir.m_size &gt; 0xFFFFFFFF)</td></tr>
<tr class="codeline" data-linenumber="4748"><td class="num" id="LN4748">4748</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4749"><td class="num" id="LN4749">4749</td><td class="line">  n = (mz_uint32)orig_central_dir_size;</td></tr>
<tr class="codeline" data-linenumber="4750"><td class="num" id="LN4750">4750</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_array_push_back(pZip, &amp;pState-&gt;m_central_dir_offsets, &amp;n, 1))</td></tr>
<tr class="codeline" data-linenumber="4751"><td class="num" id="LN4751">4751</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4752"><td class="num" id="LN4752">4752</td><td class="line">    mz_zip_array_resize(pZip, &amp;pState-&gt;m_central_dir, orig_central_dir_size, <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>);</td></tr>
<tr class="codeline" data-linenumber="4753"><td class="num" id="LN4753">4753</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4754"><td class="num" id="LN4754">4754</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4755"><td class="num" id="LN4755">4755</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4756"><td class="num" id="LN4756">4756</td><td class="line">  pZip-&gt;m_total_files++;</td></tr>
<tr class="codeline" data-linenumber="4757"><td class="num" id="LN4757">4757</td><td class="line">  pZip-&gt;m_archive_size = cur_dst_file_ofs;</td></tr>
<tr class="codeline" data-linenumber="4758"><td class="num" id="LN4758">4758</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4759"><td class="num" id="LN4759">4759</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4760"><td class="num" id="LN4760">4760</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4761"><td class="num" id="LN4761">4761</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4762"><td class="num" id="LN4762">4762</td><td class="line">mz_bool mz_zip_writer_finalize_archive(mz_zip_archive *pZip)</td></tr>
<tr class="codeline" data-linenumber="4763"><td class="num" id="LN4763">4763</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4764"><td class="num" id="LN4764">4764</td><td class="line">  mz_zip_internal_state *pState;</td></tr>
<tr class="codeline" data-linenumber="4765"><td class="num" id="LN4765">4765</td><td class="line">  mz_uint64 central_dir_ofs, central_dir_size;</td></tr>
<tr class="codeline" data-linenumber="4766"><td class="num" id="LN4766">4766</td><td class="line">  mz_uint8 hdr[MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIZE];</td></tr>
<tr class="codeline" data-linenumber="4767"><td class="num" id="LN4767">4767</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4768"><td class="num" id="LN4768">4768</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (!pZip-&gt;m_pState) || (pZip-&gt;m_zip_mode != MZ_ZIP_MODE_WRITING))</td></tr>
<tr class="codeline" data-linenumber="4769"><td class="num" id="LN4769">4769</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4770"><td class="num" id="LN4770">4770</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4771"><td class="num" id="LN4771">4771</td><td class="line">  pState = pZip-&gt;m_pState;</td></tr>
<tr class="codeline" data-linenumber="4772"><td class="num" id="LN4772">4772</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4773"><td class="num" id="LN4773">4773</td><td class="line">  <span class='comment'>// no zip64 support yet</span></td></tr>
<tr class="codeline" data-linenumber="4774"><td class="num" id="LN4774">4774</td><td class="line">  <span class='keyword'>if</span> ((pZip-&gt;m_total_files &gt; 0xFFFF) || ((pZip-&gt;m_archive_size + pState-&gt;m_central_dir.m_size + MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIZE) &gt; 0xFFFFFFFF))</td></tr>
<tr class="codeline" data-linenumber="4775"><td class="num" id="LN4775">4775</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4776"><td class="num" id="LN4776">4776</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4777"><td class="num" id="LN4777">4777</td><td class="line">  central_dir_ofs = 0;</td></tr>
<tr class="codeline" data-linenumber="4778"><td class="num" id="LN4778">4778</td><td class="line">  central_dir_size = 0;</td></tr>
<tr class="codeline" data-linenumber="4779"><td class="num" id="LN4779">4779</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_total_files)</td></tr>
<tr class="codeline" data-linenumber="4780"><td class="num" id="LN4780">4780</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4781"><td class="num" id="LN4781">4781</td><td class="line">    <span class='comment'>// Write central directory</span></td></tr>
<tr class="codeline" data-linenumber="4782"><td class="num" id="LN4782">4782</td><td class="line">    central_dir_ofs = pZip-&gt;m_archive_size;</td></tr>
<tr class="codeline" data-linenumber="4783"><td class="num" id="LN4783">4783</td><td class="line">    central_dir_size = pState-&gt;m_central_dir.m_size;</td></tr>
<tr class="codeline" data-linenumber="4784"><td class="num" id="LN4784">4784</td><td class="line">    pZip-&gt;m_central_directory_file_ofs = central_dir_ofs;</td></tr>
<tr class="codeline" data-linenumber="4785"><td class="num" id="LN4785">4785</td><td class="line">    <span class='keyword'>if</span> (pZip-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, central_dir_ofs, pState-&gt;m_central_dir.m_p, (size_t)central_dir_size) != central_dir_size)</td></tr>
<tr class="codeline" data-linenumber="4786"><td class="num" id="LN4786">4786</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4787"><td class="num" id="LN4787">4787</td><td class="line">    pZip-&gt;m_archive_size += central_dir_size;</td></tr>
<tr class="codeline" data-linenumber="4788"><td class="num" id="LN4788">4788</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4789"><td class="num" id="LN4789">4789</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4790"><td class="num" id="LN4790">4790</td><td class="line">  <span class='comment'>// Write end of central directory record</span></td></tr>
<tr class="codeline" data-linenumber="4791"><td class="num" id="LN4791">4791</td><td class="line">  <span class='macro'>MZ_CLEAR_OBJ(hdr)<span class='macro_popup'>memset(&amp;(hdr), 0, sizeof(hdr))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4792"><td class="num" id="LN4792">4792</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(hdr + MZ_ZIP_ECDH_SIG_OFS, MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIG)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(hdr + MZ_ZIP_ECDH_SIG_OFS), (mz_uint32<br>)(MZ_ZIP_END_OF_CENTRAL_DIR_HEADER_SIG))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4793"><td class="num" id="LN4793">4793</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(hdr + MZ_ZIP_ECDH_CDIR_NUM_ENTRIES_ON_DISK_OFS, pZip-&gt;m_total_files)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(hdr + MZ_ZIP_ECDH_CDIR_NUM_ENTRIES_ON_DISK_OFS<br>), (mz_uint16)(pZip-&gt;m_total_files))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4794"><td class="num" id="LN4794">4794</td><td class="line">  <span class='macro'>MZ_WRITE_LE16(hdr + MZ_ZIP_ECDH_CDIR_TOTAL_ENTRIES_OFS, pZip-&gt;m_total_files)<span class='macro_popup'>mz_write_le16((mz_uint8 *)(hdr + MZ_ZIP_ECDH_CDIR_TOTAL_ENTRIES_OFS<br>), (mz_uint16)(pZip-&gt;m_total_files))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4795"><td class="num" id="LN4795">4795</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(hdr + MZ_ZIP_ECDH_CDIR_SIZE_OFS, central_dir_size)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(hdr + MZ_ZIP_ECDH_CDIR_SIZE_OFS), (<br>mz_uint32)(central_dir_size))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4796"><td class="num" id="LN4796">4796</td><td class="line">  <span class='macro'>MZ_WRITE_LE32(hdr + MZ_ZIP_ECDH_CDIR_OFS_OFS, central_dir_ofs)<span class='macro_popup'>mz_write_le32((mz_uint8 *)(hdr + MZ_ZIP_ECDH_CDIR_OFS_OFS), (<br>mz_uint32)(central_dir_ofs))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4797"><td class="num" id="LN4797">4797</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4798"><td class="num" id="LN4798">4798</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_pWrite(pZip-&gt;m_pIO_opaque, pZip-&gt;m_archive_size, hdr, <span class='keyword'>sizeof</span>(hdr)) != <span class='keyword'>sizeof</span>(hdr))</td></tr>
<tr class="codeline" data-linenumber="4799"><td class="num" id="LN4799">4799</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4800"><td class="num" id="LN4800">4800</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4801"><td class="num" id="LN4801">4801</td><td class="line">  <span class='keyword'>if</span> ((pState-&gt;m_pFile) &amp;&amp; (<span class='macro'>MZ_FFLUSH<span class='macro_popup'>fflush</span></span>(pState-&gt;m_pFile) == <span class='macro'>EOF<span class='macro_popup'>(-1)</span></span>))</td></tr>
<tr class="codeline" data-linenumber="4802"><td class="num" id="LN4802">4802</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4803"><td class="num" id="LN4803">4803</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4804"><td class="num" id="LN4804">4804</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4805"><td class="num" id="LN4805">4805</td><td class="line">  pZip-&gt;m_archive_size += <span class='keyword'>sizeof</span>(hdr);</td></tr>
<tr class="codeline" data-linenumber="4806"><td class="num" id="LN4806">4806</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4807"><td class="num" id="LN4807">4807</td><td class="line">  pZip-&gt;m_zip_mode = MZ_ZIP_MODE_WRITING_HAS_BEEN_FINALIZED;</td></tr>
<tr class="codeline" data-linenumber="4808"><td class="num" id="LN4808">4808</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4809"><td class="num" id="LN4809">4809</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4810"><td class="num" id="LN4810">4810</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4811"><td class="num" id="LN4811">4811</td><td class="line">mz_bool mz_zip_writer_finalize_heap_archive(mz_zip_archive *pZip, <span class='keyword'>void</span> **pBuf, size_t *pSize)</td></tr>
<tr class="codeline" data-linenumber="4812"><td class="num" id="LN4812">4812</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4813"><td class="num" id="LN4813">4813</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (!pZip-&gt;m_pState) || (!pBuf) || (!pSize))</td></tr>
<tr class="codeline" data-linenumber="4814"><td class="num" id="LN4814">4814</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4815"><td class="num" id="LN4815">4815</td><td class="line">  <span class='keyword'>if</span> (pZip-&gt;m_pWrite != mz_zip_heap_write_func)</td></tr>
<tr class="codeline" data-linenumber="4816"><td class="num" id="LN4816">4816</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4817"><td class="num" id="LN4817">4817</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_writer_finalize_archive(pZip))</td></tr>
<tr class="codeline" data-linenumber="4818"><td class="num" id="LN4818">4818</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4819"><td class="num" id="LN4819">4819</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4820"><td class="num" id="LN4820">4820</td><td class="line">  *pBuf = pZip-&gt;m_pState-&gt;m_pMem;</td></tr>
<tr class="codeline" data-linenumber="4821"><td class="num" id="LN4821">4821</td><td class="line">  *pSize = pZip-&gt;m_pState-&gt;m_mem_size;</td></tr>
<tr class="codeline" data-linenumber="4822"><td class="num" id="LN4822">4822</td><td class="line">  pZip-&gt;m_pState-&gt;m_pMem = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4823"><td class="num" id="LN4823">4823</td><td class="line">  pZip-&gt;m_pState-&gt;m_mem_size = pZip-&gt;m_pState-&gt;m_mem_capacity = 0;</td></tr>
<tr class="codeline" data-linenumber="4824"><td class="num" id="LN4824">4824</td><td class="line">  <span class='keyword'>return</span> <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4825"><td class="num" id="LN4825">4825</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4826"><td class="num" id="LN4826">4826</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4827"><td class="num" id="LN4827">4827</td><td class="line">mz_bool mz_zip_writer_end(mz_zip_archive *pZip)</td></tr>
<tr class="codeline" data-linenumber="4828"><td class="num" id="LN4828">4828</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4829"><td class="num" id="LN4829">4829</td><td class="line">  mz_zip_internal_state *pState;</td></tr>
<tr class="codeline" data-linenumber="4830"><td class="num" id="LN4830">4830</td><td class="line">  mz_bool status = <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4831"><td class="num" id="LN4831">4831</td><td class="line">  <span class='keyword'>if</span> ((!pZip) || (!pZip-&gt;m_pState) || (!pZip-&gt;m_pAlloc) || (!pZip-&gt;m_pFree) || ((pZip-&gt;m_zip_mode != MZ_ZIP_MODE_WRITING) &amp;&amp; (pZip-&gt;m_zip_mode != MZ_ZIP_MODE_WRITING_HAS_BEEN_FINALIZED)))</td></tr>
<tr class="codeline" data-linenumber="4832"><td class="num" id="LN4832">4832</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4833"><td class="num" id="LN4833">4833</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4834"><td class="num" id="LN4834">4834</td><td class="line">  pState = pZip-&gt;m_pState;</td></tr>
<tr class="codeline" data-linenumber="4835"><td class="num" id="LN4835">4835</td><td class="line">  pZip-&gt;m_pState = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4836"><td class="num" id="LN4836">4836</td><td class="line">  mz_zip_array_clear(pZip, &amp;pState-&gt;m_central_dir);</td></tr>
<tr class="codeline" data-linenumber="4837"><td class="num" id="LN4837">4837</td><td class="line">  mz_zip_array_clear(pZip, &amp;pState-&gt;m_central_dir_offsets);</td></tr>
<tr class="codeline" data-linenumber="4838"><td class="num" id="LN4838">4838</td><td class="line">  mz_zip_array_clear(pZip, &amp;pState-&gt;m_sorted_central_dir_offsets);</td></tr>
<tr class="codeline" data-linenumber="4839"><td class="num" id="LN4839">4839</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4840"><td class="num" id="LN4840">4840</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4841"><td class="num" id="LN4841">4841</td><td class="line">  <span class='keyword'>if</span> (pState-&gt;m_pFile)</td></tr>
<tr class="codeline" data-linenumber="4842"><td class="num" id="LN4842">4842</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4843"><td class="num" id="LN4843">4843</td><td class="line">    <span class='macro'>MZ_FCLOSE<span class='macro_popup'>fclose</span></span>(pState-&gt;m_pFile);</td></tr>
<tr class="codeline" data-linenumber="4844"><td class="num" id="LN4844">4844</td><td class="line">    pState-&gt;m_pFile = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4845"><td class="num" id="LN4845">4845</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4846"><td class="num" id="LN4846">4846</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4847"><td class="num" id="LN4847">4847</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4848"><td class="num" id="LN4848">4848</td><td class="line">  <span class='keyword'>if</span> ((pZip-&gt;m_pWrite == mz_zip_heap_write_func) &amp;&amp; (pState-&gt;m_pMem))</td></tr>
<tr class="codeline" data-linenumber="4849"><td class="num" id="LN4849">4849</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4850"><td class="num" id="LN4850">4850</td><td class="line">    pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pState-&gt;m_pMem);</td></tr>
<tr class="codeline" data-linenumber="4851"><td class="num" id="LN4851">4851</td><td class="line">    pState-&gt;m_pMem = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4852"><td class="num" id="LN4852">4852</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4853"><td class="num" id="LN4853">4853</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4854"><td class="num" id="LN4854">4854</td><td class="line">  pZip-&gt;m_pFree(pZip-&gt;m_pAlloc_opaque, pState);</td></tr>
<tr class="codeline" data-linenumber="4855"><td class="num" id="LN4855">4855</td><td class="line">  pZip-&gt;m_zip_mode = MZ_ZIP_MODE_INVALID;</td></tr>
<tr class="codeline" data-linenumber="4856"><td class="num" id="LN4856">4856</td><td class="line">  <span class='keyword'>return</span> status;</td></tr>
<tr class="codeline" data-linenumber="4857"><td class="num" id="LN4857">4857</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4858"><td class="num" id="LN4858">4858</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4859"><td class="num" id="LN4859">4859</td><td class="line"><span class='directive'>#ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4860"><td class="num" id="LN4860">4860</td><td class="line">mz_bool mz_zip_add_mem_to_archive_file_in_place(<span class='keyword'>const</span> <span class='keyword'>char</span> *pZip_filename, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_name, <span class='keyword'>const</span> <span class='keyword'>void</span> *pBuf, size_t buf_size, <span class='keyword'>const</span> <span class='keyword'>void</span> *pComment, mz_uint16 comment_size, mz_uint level_and_flags)</td></tr>
<tr class="codeline" data-linenumber="4861"><td class="num" id="LN4861">4861</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4862"><td class="num" id="LN4862">4862</td><td class="line">  mz_bool <span id="start106">status</span>, created_new_archive = <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4863"><td class="num" id="LN4863">4863</td><td class="line">  mz_zip_archive zip_archive;</td></tr>
<tr class="codeline" data-linenumber="4864"><td class="num" id="LN4864">4864</td><td class="line">  <span class='keyword'>struct</span> <span class='macro'>MZ_FILE_STAT_STRUCT<span class='macro_popup'>stat</span></span> file_stat;</td></tr>
<tr class="codeline" data-linenumber="4865"><td class="num" id="LN4865">4865</td><td class="line">  <span class='macro'>MZ_CLEAR_OBJ(zip_archive)<span class='macro_popup'>memset(&amp;(zip_archive), 0, sizeof(zip_archive))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4866"><td class="num" id="LN4866">4866</td><td class="line">  <span id="start105"><span id="end106"><span class='keyword'>if</span></span></span> (<span id="start104"><span class="mrange"><span id="end105">(</span></span><span class='keyword'>int</span>)level_and_flags &lt; 0</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path1" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">1</div></td><td>Assuming 'level_and_flags' is &gt;= 0</td><td><div class="PathNav"><a href="#Path2" title="Next event (2)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4867"><td class="num" id="LN4867">4867</td><td class="line">     level_and_flags = MZ_DEFAULT_LEVEL;</td></tr>
<tr class="codeline" data-linenumber="4868"><td class="num" id="LN4868">4868</td><td class="line">  <span id="start103"><span id="end104"><span class='keyword'>if</span></span></span> (<span id="end103">(</span><span id="start102"><span class="mrange">!</span>pZip_filename</span>) || (<span id="start101"><span class="mrange"><span id="end102">!</span></span>pArchive_name</span>) || (<span id="start100"><span class="mrange"><span id="end101">(</span></span>buf_size)</span> &amp;&amp; (!pBuf)) || (<span id="start99"><span class="mrange"><span id="end100">(</span></span>comment_size)</span> &amp;&amp; (!pComment)) || (<span id="start98"><span class="mrange"><span id="end99">(</span></span>level_and_flags &amp; 0xF) &gt; MZ_UBER_COMPRESSION</span>))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path2" class="msg msgEvent" style="margin-left:8ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">2</div></td><td><div class="PathNav"><a href="#Path1" title="Previous event (1)">&#x2190;</a></div></td><td>Assuming 'pZip_filename' is non-null</td><td><div class="PathNav"><a href="#Path3" title="Next event (3)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path3" class="msg msgEvent" style="margin-left:28ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">3</div></td><td><div class="PathNav"><a href="#Path2" title="Previous event (2)">&#x2190;</a></div></td><td>Assuming 'pArchive_name' is non-null</td><td><div class="PathNav"><a href="#Path4" title="Next event (4)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path4" class="msg msgEvent" style="margin-left:48ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">4</div></td><td><div class="PathNav"><a href="#Path3" title="Previous event (3)">&#x2190;</a></div></td><td>Assuming 'buf_size' is 0</td><td><div class="PathNav"><a href="#Path5" title="Next event (5)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path5" class="msg msgEvent" style="margin-left:75ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">5</div></td><td><div class="PathNav"><a href="#Path4" title="Previous event (4)">&#x2190;</a></div></td><td>Assuming 'comment_size' is 0</td><td><div class="PathNav"><a href="#Path6" title="Next event (6)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path6" class="msg msgEvent" style="margin-left:110ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">6</div></td><td><div class="PathNav"><a href="#Path5" title="Previous event (5)">&#x2190;</a></div></td><td>Assuming the condition is false</td><td><div class="PathNav"><a href="#Path7" title="Next event (7)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path7" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">7</div></td><td><div class="PathNav"><a href="#Path6" title="Previous event (6)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path8" title="Next event (8)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4869"><td class="num" id="LN4869">4869</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4870"><td class="num" id="LN4870">4870</td><td class="line">  <span id="start97"><span id="end98"><span class='keyword'>if</span></span></span> (!mz_zip_writer_validate_archive_name(<span id="start96"><span id="end97">pArchive_name</span></span>))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path8" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">8</div></td><td><div class="PathNav"><a href="#Path7" title="Previous event (7)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path9" title="Next event (9)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4871"><td class="num" id="LN4871">4871</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4872"><td class="num" id="LN4872">4872</td><td class="line">  <span id="start95"><span id="end96"><span class='keyword'>if</span></span></span> (<span id="start93"><span class="mrange"><span id="end94"><span class='macro'>MZ_FILE_STAT<span class='macro_popup'>stat</span></span></span></span>(<span id="start94"><span id="end95">pZip_filename</span></span>, &amp;file_stat) != 0</span>)</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path9" class="msg msgEvent" style="margin-left:7ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">9</div></td><td><div class="PathNav"><a href="#Path8" title="Previous event (8)">&#x2190;</a></div></td><td>Assuming the condition is false</td><td><div class="PathNav"><a href="#Path10" title="Next event (10)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr><td class="num"></td><td class="line"><div id="Path10" class="msg msgControl" style="margin-left:3ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">10</div></td><td><div class="PathNav"><a href="#Path9" title="Previous event (9)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path11" title="Next event (11)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4873"><td class="num" id="LN4873">4873</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4874"><td class="num" id="LN4874">4874</td><td class="line">    <span class='comment'>// Create a new archive.</span></td></tr>
<tr class="codeline" data-linenumber="4875"><td class="num" id="LN4875">4875</td><td class="line">    <span class='keyword'>if</span> (!mz_zip_writer_init_file(&amp;zip_archive, pZip_filename, 0))</td></tr>
<tr class="codeline" data-linenumber="4876"><td class="num" id="LN4876">4876</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4877"><td class="num" id="LN4877">4877</td><td class="line">    created_new_archive = <span class='macro'>MZ_TRUE<span class='macro_popup'>(1)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4878"><td class="num" id="LN4878">4878</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4879"><td class="num" id="LN4879">4879</td><td class="line">  <span class='keyword'>else</span></td></tr>
<tr class="codeline" data-linenumber="4880"><td class="num" id="LN4880">4880</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4881"><td class="num" id="LN4881">4881</td><td class="line">    <span class='comment'>// Append to an existing archive.</span></td></tr>
<tr class="codeline" data-linenumber="4882"><td class="num" id="LN4882">4882</td><td class="line">    <span id="start92"><span id="end93"><span class='keyword'>if</span></span></span> (!mz_zip_reader_init_file(&amp;<span id="start91"><span id="end92">zip_archive</span></span>, pZip_filename, level_and_flags | MZ_ZIP_FLAG_DO_NOT_SORT_CENTRAL_DIRECTORY))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path11" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">11</div></td><td><div class="PathNav"><a href="#Path10" title="Previous event (10)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path12" title="Next event (12)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4883"><td class="num" id="LN4883">4883</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4884"><td class="num" id="LN4884">4884</td><td class="line">    <span id="start90"><span id="end91"><span class='keyword'>if</span></span></span> (!mz_zip_writer_init_from_reader(&amp;<span id="start89"><span id="end90">zip_archive</span></span>, pZip_filename))</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path12" class="msg msgControl" style="margin-left:5ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexControl">12</div></td><td><div class="PathNav"><a href="#Path11" title="Previous event (11)">&#x2190;</a></div></td><td>Taking false branch</td><td><div class="PathNav"><a href="#Path13" title="Next event (13)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4885"><td class="num" id="LN4885">4885</td><td class="line">    {</td></tr>
<tr class="codeline" data-linenumber="4886"><td class="num" id="LN4886">4886</td><td class="line">      mz_zip_reader_end(&amp;zip_archive);</td></tr>
<tr class="codeline" data-linenumber="4887"><td class="num" id="LN4887">4887</td><td class="line">      <span class='keyword'>return</span> <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4888"><td class="num" id="LN4888">4888</td><td class="line">    }</td></tr>
<tr class="codeline" data-linenumber="4889"><td class="num" id="LN4889">4889</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4890"><td class="num" id="LN4890">4890</td><td class="line">  <span id="start88"><span id="end89">status</span></span> = <span class="mrange"><span id="end87">mz_zip_writer_add_mem_ex</span>(&amp;<span id="start87"><span id="end88">zip_archive</span></span>, pArchive_name, pBuf, buf_size, pComment, comment_size, level_and_flags, 0, 0)</span>;</td></tr>
<tr><td class="num"></td><td class="line"><div id="Path13" class="msg msgEvent" style="margin-left:12ex"><table class="msgT"><tr><td valign="top"><div class="PathIndex PathIndexEvent">13</div></td><td><div class="PathNav"><a href="#Path12" title="Previous event (12)">&#x2190;</a></div></td><td>Calling 'mz_zip_writer_add_mem_ex'</td><td><div class="PathNav"><a href="#Path14" title="Next event (14)">&#x2192;</a></div></td></tr></table></div></td></tr>
<tr class="codeline" data-linenumber="4891"><td class="num" id="LN4891">4891</td><td class="line">  <span class='comment'>// Always finalize, even if adding failed for some reason, so we have a valid central directory. (This may not always succeed, but we can try.)</span></td></tr>
<tr class="codeline" data-linenumber="4892"><td class="num" id="LN4892">4892</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_writer_finalize_archive(&amp;zip_archive))</td></tr>
<tr class="codeline" data-linenumber="4893"><td class="num" id="LN4893">4893</td><td class="line">    status = <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4894"><td class="num" id="LN4894">4894</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_writer_end(&amp;zip_archive))</td></tr>
<tr class="codeline" data-linenumber="4895"><td class="num" id="LN4895">4895</td><td class="line">    status = <span class='macro'>MZ_FALSE<span class='macro_popup'>(0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4896"><td class="num" id="LN4896">4896</td><td class="line">  <span class='keyword'>if</span> ((!status) &amp;&amp; (created_new_archive))</td></tr>
<tr class="codeline" data-linenumber="4897"><td class="num" id="LN4897">4897</td><td class="line">  {</td></tr>
<tr class="codeline" data-linenumber="4898"><td class="num" id="LN4898">4898</td><td class="line">    <span class='comment'>// It's a new archive and something went wrong, so just delete it.</span></td></tr>
<tr class="codeline" data-linenumber="4899"><td class="num" id="LN4899">4899</td><td class="line">    <span class='keyword'>int</span> ignoredStatus = <span class='macro'>MZ_DELETE_FILE<span class='macro_popup'>remove</span></span>(pZip_filename);</td></tr>
<tr class="codeline" data-linenumber="4900"><td class="num" id="LN4900">4900</td><td class="line">    (<span class='keyword'>void</span>)ignoredStatus;</td></tr>
<tr class="codeline" data-linenumber="4901"><td class="num" id="LN4901">4901</td><td class="line">  }</td></tr>
<tr class="codeline" data-linenumber="4902"><td class="num" id="LN4902">4902</td><td class="line">  <span class='keyword'>return</span> status;</td></tr>
<tr class="codeline" data-linenumber="4903"><td class="num" id="LN4903">4903</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4904"><td class="num" id="LN4904">4904</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4905"><td class="num" id="LN4905">4905</td><td class="line"><span class='keyword'>void</span> *mz_zip_extract_archive_file_to_heap(<span class='keyword'>const</span> <span class='keyword'>char</span> *pZip_filename, <span class='keyword'>const</span> <span class='keyword'>char</span> *pArchive_name, size_t *pSize, mz_uint flags)</td></tr>
<tr class="codeline" data-linenumber="4906"><td class="num" id="LN4906">4906</td><td class="line">{</td></tr>
<tr class="codeline" data-linenumber="4907"><td class="num" id="LN4907">4907</td><td class="line">  <span class='keyword'>int</span> file_index;</td></tr>
<tr class="codeline" data-linenumber="4908"><td class="num" id="LN4908">4908</td><td class="line">  mz_zip_archive zip_archive;</td></tr>
<tr class="codeline" data-linenumber="4909"><td class="num" id="LN4909">4909</td><td class="line">  <span class='keyword'>void</span> *p = <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4910"><td class="num" id="LN4910">4910</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4911"><td class="num" id="LN4911">4911</td><td class="line">  <span class='keyword'>if</span> (pSize)</td></tr>
<tr class="codeline" data-linenumber="4912"><td class="num" id="LN4912">4912</td><td class="line">    *pSize = 0;</td></tr>
<tr class="codeline" data-linenumber="4913"><td class="num" id="LN4913">4913</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4914"><td class="num" id="LN4914">4914</td><td class="line">  <span class='keyword'>if</span> ((!pZip_filename) || (!pArchive_name))</td></tr>
<tr class="codeline" data-linenumber="4915"><td class="num" id="LN4915">4915</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4916"><td class="num" id="LN4916">4916</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4917"><td class="num" id="LN4917">4917</td><td class="line">  <span class='macro'>MZ_CLEAR_OBJ(zip_archive)<span class='macro_popup'>memset(&amp;(zip_archive), 0, sizeof(zip_archive))</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4918"><td class="num" id="LN4918">4918</td><td class="line">  <span class='keyword'>if</span> (!mz_zip_reader_init_file(&amp;zip_archive, pZip_filename, flags | MZ_ZIP_FLAG_DO_NOT_SORT_CENTRAL_DIRECTORY))</td></tr>
<tr class="codeline" data-linenumber="4919"><td class="num" id="LN4919">4919</td><td class="line">    <span class='keyword'>return</span> <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>;</td></tr>
<tr class="codeline" data-linenumber="4920"><td class="num" id="LN4920">4920</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4921"><td class="num" id="LN4921">4921</td><td class="line">  <span class='keyword'>if</span> ((file_index = mz_zip_reader_locate_file(&amp;zip_archive, pArchive_name, <span class='macro'>NULL<span class='macro_popup'>((void*)0)</span></span>, flags)) &gt;= 0)</td></tr>
<tr class="codeline" data-linenumber="4922"><td class="num" id="LN4922">4922</td><td class="line">    p = mz_zip_reader_extract_to_heap(&amp;zip_archive, file_index, pSize, flags);</td></tr>
<tr class="codeline" data-linenumber="4923"><td class="num" id="LN4923">4923</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4924"><td class="num" id="LN4924">4924</td><td class="line">  mz_zip_reader_end(&amp;zip_archive);</td></tr>
<tr class="codeline" data-linenumber="4925"><td class="num" id="LN4925">4925</td><td class="line">  <span class='keyword'>return</span> p;</td></tr>
<tr class="codeline" data-linenumber="4926"><td class="num" id="LN4926">4926</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4927"><td class="num" id="LN4927">4927</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4928"><td class="num" id="LN4928">4928</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_STDIO</span></td></tr>
<tr class="codeline" data-linenumber="4929"><td class="num" id="LN4929">4929</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4930"><td class="num" id="LN4930">4930</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_ARCHIVE_WRITING_APIS</span></td></tr>
<tr class="codeline" data-linenumber="4931"><td class="num" id="LN4931">4931</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4932"><td class="num" id="LN4932">4932</td><td class="line"><span class='directive'>#endif // #ifndef MINIZ_NO_ARCHIVE_APIS</span></td></tr>
<tr class="codeline" data-linenumber="4933"><td class="num" id="LN4933">4933</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4934"><td class="num" id="LN4934">4934</td><td class="line"><span class='directive'>#ifdef __cplusplus</span></td></tr>
<tr class="codeline" data-linenumber="4935"><td class="num" id="LN4935">4935</td><td class="line">}</td></tr>
<tr class="codeline" data-linenumber="4936"><td class="num" id="LN4936">4936</td><td class="line"><span class='directive'>#endif</span></td></tr>
<tr class="codeline" data-linenumber="4937"><td class="num" id="LN4937">4937</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4938"><td class="num" id="LN4938">4938</td><td class="line"><span class='directive'>#endif // MINIZ_HEADER_FILE_ONLY</span></td></tr>
<tr class="codeline" data-linenumber="4939"><td class="num" id="LN4939">4939</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4940"><td class="num" id="LN4940">4940</td><td class="line"><span class='comment'>/*</span></td></tr>
<tr class="codeline" data-linenumber="4941"><td class="num" id="LN4941">4941</td><td class="line">  <span class='comment'>This is free and unencumbered software released into the public domain.</span></td></tr>
<tr class="codeline" data-linenumber="4942"><td class="num" id="LN4942">4942</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4943"><td class="num" id="LN4943">4943</td><td class="line">  <span class='comment'>Anyone is free to copy, modify, publish, use, compile, sell, or</span></td></tr>
<tr class="codeline" data-linenumber="4944"><td class="num" id="LN4944">4944</td><td class="line">  <span class='comment'>distribute this software, either in source code form or as a compiled</span></td></tr>
<tr class="codeline" data-linenumber="4945"><td class="num" id="LN4945">4945</td><td class="line">  <span class='comment'>binary, for any purpose, commercial or non-commercial, and by any</span></td></tr>
<tr class="codeline" data-linenumber="4946"><td class="num" id="LN4946">4946</td><td class="line">  <span class='comment'>means.</span></td></tr>
<tr class="codeline" data-linenumber="4947"><td class="num" id="LN4947">4947</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4948"><td class="num" id="LN4948">4948</td><td class="line">  <span class='comment'>In jurisdictions that recognize copyright laws, the author or authors</span></td></tr>
<tr class="codeline" data-linenumber="4949"><td class="num" id="LN4949">4949</td><td class="line">  <span class='comment'>of this software dedicate any and all copyright interest in the</span></td></tr>
<tr class="codeline" data-linenumber="4950"><td class="num" id="LN4950">4950</td><td class="line">  <span class='comment'>software to the public domain. We make this dedication for the benefit</span></td></tr>
<tr class="codeline" data-linenumber="4951"><td class="num" id="LN4951">4951</td><td class="line">  <span class='comment'>of the public at large and to the detriment of our heirs and</span></td></tr>
<tr class="codeline" data-linenumber="4952"><td class="num" id="LN4952">4952</td><td class="line">  <span class='comment'>successors. We intend this dedication to be an overt act of</span></td></tr>
<tr class="codeline" data-linenumber="4953"><td class="num" id="LN4953">4953</td><td class="line">  <span class='comment'>relinquishment in perpetuity of all present and future rights to this</span></td></tr>
<tr class="codeline" data-linenumber="4954"><td class="num" id="LN4954">4954</td><td class="line">  <span class='comment'>software under copyright law.</span></td></tr>
<tr class="codeline" data-linenumber="4955"><td class="num" id="LN4955">4955</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4956"><td class="num" id="LN4956">4956</td><td class="line">  <span class='comment'>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,</span></td></tr>
<tr class="codeline" data-linenumber="4957"><td class="num" id="LN4957">4957</td><td class="line">  <span class='comment'>EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span></td></tr>
<tr class="codeline" data-linenumber="4958"><td class="num" id="LN4958">4958</td><td class="line">  <span class='comment'>MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.</span></td></tr>
<tr class="codeline" data-linenumber="4959"><td class="num" id="LN4959">4959</td><td class="line">  <span class='comment'>IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR</span></td></tr>
<tr class="codeline" data-linenumber="4960"><td class="num" id="LN4960">4960</td><td class="line">  <span class='comment'>OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,</span></td></tr>
<tr class="codeline" data-linenumber="4961"><td class="num" id="LN4961">4961</td><td class="line">  <span class='comment'>ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</span></td></tr>
<tr class="codeline" data-linenumber="4962"><td class="num" id="LN4962">4962</td><td class="line">  <span class='comment'>OTHER DEALINGS IN THE SOFTWARE.</span></td></tr>
<tr class="codeline" data-linenumber="4963"><td class="num" id="LN4963">4963</td><td class="line"> </td></tr>
<tr class="codeline" data-linenumber="4964"><td class="num" id="LN4964">4964</td><td class="line">  <span class='comment'>For more information, please refer to &lt;http://unlicense.org/&gt;</span></td></tr>
<tr class="codeline" data-linenumber="4965"><td class="num" id="LN4965">4965</td><td class="line"><span class='comment'>*/</span></td></tr>
</table></body></html>
